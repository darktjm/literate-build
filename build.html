<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<!--
Generated using noweb; original .nw source attached as tar.gz in comment at end
Extract with uudecode, or, if uudecode chokes, use:
   tr '|~m`' '<>- ' | uudecode -o 'build.tar.gz'
-->

<head>
  <meta name="generator" content="HTML Tidy for Linux (vers 25 March 2009), see www.w3.org" />
  <meta name="generator" content="noweave -html -filter l2h, highlight-3" />
  <style type="text/css">
/*<![CDATA[*/
  <!--
  .code  { color:#404048; background-color:#f8f8f8; font-size: smaller;}
  .code a        { color:#404048; background-color:#f8f8f8; font-size: smaller;}
  .code .num { color:#2020ff; }
  .code .esc { color:#005858; }
  .code .str { color:#2020ff; }
  .code .pps { color:#2020ff; }
  .code .slc { color:#ff00c0; font-style:italic; }
  .code .com { color:#ff00c0; font-style:italic; }
  .code .ppc { color:#007387; }
  .code .opt { color:#404048; }
  .code .ipl { color:#8a5588; }
  .code .lin { color:#ff00c0; }
  .code .kwa { color:#008858; font-weight:bold; }
  .code .kwb { color:#7040ff; font-weight:bold; }
  .code .kwc { color:#87002f; font-weight:bold; }
  .code .kwd { color:#404048; font-weight:bold; }
  .code li {display: block;}
  /* either above line to remove line #s, or make space for line #s with: */
  /* .code {margin-left: 2em;} */
  /* optional: add border around code */
  /* .code {border: thin solid black;} */
  code {font-style: normal;}
  pre.defn {margin-bottom: 0;}
  .code {margin-left: 10pt; margin-right: 10pt; margin-top: 0; padding: 1px}
  .code li,pre {margin-top: 0; margin-bottom: 0;}
  .code a {text-decoration: none;}
  pre.dfn a {text-decoration: none;}
  //-->
  /*]]>*/
  </style>

  <title>Syntax Highlighting Modular Build System for NoWeb</title>
</head>

<body>
  <h1><a name="toc1" id="toc1">Syntax Highlighting Modular Build System for NoWeb</a></h1>

  <address>
    Thomas J. Moore
  </address><b>Version 3.13.160<br />
  2012-11-22 15:07:26 -0600 (Thu, 22 Nov 2012)</b> <!--title goes here-->

  <h2><a name="toc2" id="toc2">Abstract</a></h2>

  <blockquote>
    This document describes, implements, and is built using a modular `literate programming <sup><a href="#fn1">1</a></sup> ' build system with syntax highlighting, based on Norman Ramsey's NoWeb <sup><a href="#fn2">2</a></sup> , GNU <sup><a href="#fn3">3</a></sup> make, and a number of other freely available support tools.

    <p>This document is &copy; 2003--2012 Thomas J. Moore. This document is licensed under the Apache License, Version 2.0 (the `License'); you may not use this document except in compliance with the License. You may obtain a copy of the License at <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a>. Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an `AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
  </blockquote>

  <h1>Table of Contents</h1>

  <ul compact="compact">
    <li>
      <a href="#toc7">Binaries</a>

      <ul compact="compact">
        <li><a href="#toc8">Support Files</a></li>

        <li><a href="#toc9">Support Chunks</a></li>
      </ul>
    </li>

    <li>
      <a href="#toc10">PDF Code Documentation</a>

      <ul compact="compact">
        <li><a href="#toc11">Pretty Printing Wrapper</a></li>

        <li><a href="#toc12">Pretty Printing with a highlighter and framed</a></li>

        <li><a href="#toc13">Pretty Printing with listings</a></li>

        <li><a href="#toc14">Additional Output Adjustments</a></li>

        <li><a href="#toc15">Attaching Files</a></li>

        <li><a href="#toc16">User Documentation</a></li>

        <li><a href="#toc17">Include Directive Processing</a></li>
      </ul>
    </li>

    <li>
      <a href="#toc18">HTML Code Documentation</a>

      <ul compact="compact">
        <li><a href="#toc19">HTML from TeX4ht</a></li>

        <li><a href="#toc20">HTML from l2h</a></li>

        <li><a href="#toc21">Method Selection</a></li>
      </ul>
    </li>

    <li><a href="#toc22">Usage</a></li>

    <li><a href="#toc27">Code Index</a></li>

    <li>
      <a href="#toc28">TODO</a>

      <ul compact="compact">
        <li><a href="#toc29">Not missing</a></li>

        <li><a href="#toc30">Missing</a></li>

        <li><a href="#toc31">Needs testing</a></li>

        <li><a href="#toc32">Improvements</a></li>
      </ul>
    </li>
  </ul>

  <h2><a name="toc3" id="toc3">Overview</a></h2>

  <p>Most of my old personal programming projects started out as a general idea, along with numerous scattered pieces of paper with notes detaling some particular aspects of the design. Most of my professional programming projects instead started with formal design documents containing similar information. Over time, the design documents and notes were lost and/or forgotten, and/or they diverged from the actual product. In any case, the organization of any design documentation rarely corresponds with the actual code, as efficient code follows much different rules than efficient human communication. Literate programming provides two main features that alleviate these problems: the design document is kept with the source code, and the code can be written in the order of the design document, to be reordered later for more efficient compilation.</p>

  <p>Literate programming is a method of programming devised and named by Donald Knuth in 1983, along with the tools to help implement that method (Web). It mainly emphasizes writing a human-readable document with embedded code rather than the other way around. Over the years, as others have adopted and adapted the style, the same term has been used to mean slightly different things, and the tools have emphasized different features. To me, the important features are mixing of documentation and code, and reordering of code chunks to match the text, rather than the other way around. Systems which do not display the source code and documentation at the same time (e.g. Doxygen, perl's pod) and/or do not provide code reordering (e.g. dtx, lgrind, code2html) do not support literate programming. Knuth would probably be even pickier, and reject my use of large code chunks, short variable names for temporary variables, long sequences of multiple code chunks, and multiple source files and programs in a single document, as well as my lack of a language-specific symbol cross reference and index (in addition to the chunk index).</p>

  <p>Knuth felt that programs should be pleasant to read, like documents which happen to have executable code in them. He believed that his method would allow creation of programs which are by their nature easier to maintain and less error-prone. Whether or not a document is pleasant to read is always very dependent on the writer (and, to a lesser extent, the reader). Easier maintenance and fewer bugs are but a pipe dream: people will in fact be even more tempted to ignore the source code in favor of the commentary, thus missing obvious bugs. Code reordering, and especially small code chunks may also make it difficult for some to follow the code to find out what <em>really</em> gets executed. My own reasons for doing this are mainly to keep my scattered design notes in one place (the source) and to keep the design document in sync with the implementation (since they are the same thing).</p>

  <p>Creating programs as documents using literate programming principles requires a system that supports easy-to-write documentation, and code that is both structured like the documentation and actually part of the documentation. For simple programs, a set of tools which support only a single source language and a single program file can be used. As programs become more complicated, though, the number of source files may increase, and when designing entire products, the number of source languages may increase as well. Current common public documentation standards also require a system which produces at least HTML and PDF output. After long searching, I have not found any systems which meet these requirements. Instead, the closest is the NoWeb package. It supports LaTeX and HTML output, and an arbitrary number of output files and source languages. However, it does little to make the code look like part of the documentation. The code in this document serves to provide a build system that includes syntax-highlighted code, at the very least.</p>

  <p>While the build system could simply be a carefully crafted shell script, a makefile is used instead. This allows use of implicit rules and the system-wide <code>CC</code> and <code>CFLAGS</code> defaults. The default chunk is set to the makefile, requiring no chunk name to extract. <!-- Begin-doc build-doc-->
  To build, place the NoWeb source files into their own directory (optionally extracting them from the document you are reading first), extract the makefile, and make using GNU make:</p>

  <p><!-- Uses \jobname instead of \emph{<this file>} so that cut & paste works mostly--></p>

  <blockquote>
    <tt>uudecode build.html<br />
    # if uudecode chokes, use this instead:<br />
    # tr '|<i>~</i>m`' '&lt;&gt;- ' &lt; build.html | uudecode -o build.tar.gz<br />
    gzip -dc build.tar.gz | tar xf -<br />
    # then extract the makefile and build<br />
    notangle -t8 build.nw &gt; makefile<br />
    make install</tt>
  </blockquote>

  <p>If NoWeb is not available, but perl is, the following code can be copied and pasted into a text file using a reasonable document viewer and made executable as an imperfect, but adequate <code>notangle</code> replacement:</p>

  <blockquote>
    <pre>
#!/bin/sh
#!perl
# This code barely resembles noweb's notangle enough to work for simple builds
eval 'exec perl -x -f "$0" "$@"'
  if 0;
my $chunk = '*';  my $tab = 0;

while($#ARGV &gt; 0 &amp;&amp; $ARGV[0] =~ /^-.*/) {
  if($ARGV[0] =~ /^-R/) {
    $chunk = $ARGV[0];
    $chunk =~ s/-R//;
  } elsif($ARGV[0] =~ /^-t(.*)/) {
    $tab = $1;
  }
  shift @ARGV;
}
my ($inchunk, %chunks);
while(&lt;&gt;) {
  if(/^&lt;&lt;(.*)&gt;&gt;=$/) {
    $inchunk = $1;
  } elsif(/^@( |$)/) {
    $inchunk = "";
  } elsif($inchunk ne "") {
    $chunks{$inchunk} .= $_;
  }
}
my $chunkout = $chunks{$chunk};
while($chunkout =~ /(?:^|\n)(|[^\n]*[^\n@])(?:&lt;&lt;((?:[^&gt;\n]|&gt;[^&gt;\n])*)&gt;&gt;)/) {
  my $cv = $chunks{$2};
  my $ws = $1;
  $cv =~ s/\n$//;
  $ws =~ s/\S/ /g;
  $cv =~ s/\n/$&amp;$ws/g;
  $chunkout =~ s/(^|[^@])(&lt;&lt;(([^&gt;\n]|&gt;[^&gt;\n])*)&gt;&gt;)/$1$cv/;
}
$chunkout =~ s/@(&lt;&lt;|&gt;&gt;)/\1/g;
$chunkout =~ s/((^|\n)\t*) {$tab}/$1\t/g if($tab gt 0);
print $chunkout;
</pre>
  </blockquote><!-- End-doc build-doc-->
  As noted below, additional makefile components are created in separate files. <!-- Begin-doc build-doc-->
  Additional build configuration can be done in <tt>makefile.config</tt> before installing (in particular, the install locations). This file can be generated using either <tt>make makefile.config</tt> or <tt>make -n</tt>. On the other hand, to avoid having to modify this file after cleaning, <tt>makefile.config.local</tt> can be created for this purpose instead. <!-- End-doc build-doc-->

  <h3><a name="toc4" id="toc4">Makefile</a></h3>

  <p>The makefile is for building the support files, executable binaries, and printable source code (HTML and PDF), maybe installing them, and cleaning up afterwards. Configuration information, variable definitions, and miscellaneous rules are extracted from not only this NoWeb file, but also any others that use it. The makefile itself can be used to include that information, but to simplify makefile extraction, all of that information is kept in separate files. Modules that wish to extend the makefile can do so using <code><a href="#NW0-3TUZd-1"><i>&lt;makefile.config&gt;</i></a></code> for user-adjustable variables, <code><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a></code> for any other variable definitions, and <code><a href="#NW0-3uTryu-1"><i>&lt;makefile.rules&gt;</i></a></code> for new rules. Some configuration variables may need values before the configuration file is built, though, so defaults are included in the makefile, to be overridden by the configuration file. Note that any variable which does not depend on unknowns (noweb chunks or variables not yet defined) should be defined using GNU make's `simply expanded' variable flavor (i.e., <code>:=</code> instead of plain <code>=</code>) for improved performance. This has a disadvantage in that overriding simply defined variables will require overriding any of its dependents as well, but the performance improvement is usually worth it.</p>

  <p>I have made some adjustments to the ordering of this in order to support Daniel Pfeiffer's Makepp <sup><a href="#fn4">4</a></sup> , a GNU make clone which adds MD5 checksums as a file change detection mechanism. This magically fixes the problem of rebuilding every time, at the expense of dealing with Makepp-specific issues. The first of these is that include files cannot be automatically (re)built unless they appear after the rules which create them. This means that the two variables which control their creation can no longer come from the configuration file. They can only be set using the command line. Another, related issue is that even though Makepp solves the rebuild problem for most files, it makes the problem worse for the makefile and its include files. These are unconditionally rebuilt every single time makepp is invoked. The use of Makepp is detected by checking for the existence of a non-empty <code>$(MAKEPP_VERSION)</code>.</p>
  <pre class="dfn">
<a name="NW0-1p0Y9w-1" href="#NW0-1p0Y9w-1" id="NW0-1p0Y9w-1"><dfn>&lt;*&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-1p0Y9w-1-u1" href="#NW0-1yQJDW-1" id="NW0-1p0Y9w-1-u1"><i>&lt;makefile&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1yQJDW-1" href="#NW0-1yQJDW-1" id="NW0-1yQJDW-1"><dfn>&lt;makefile&gt;=</dfn></a> <b>(<a href="#NW0-1p0Y9w-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1yQJDW-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># See makefile.config for variables to override</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Put local config in makefile.config or makefile.config.local</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1yQJDW-1-u1" href="#NW0-3IzIGd-1" id="NW0-1yQJDW-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># default rule</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">all</span><span class="opt">: </span>misc bin doc
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifneq </span><span class="opt">($(</span>MAKEPP_VERSION<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># not much point, since it doesn't filter out #line directives</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># and therefore most changes to NoWeb source will result in file changes</span>
</pre>
      </li>

      <li>
        <pre>
signature c_compilation_md5
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1yQJDW-1-u2" href="#NW0-xNRJd-1" id="NW0-1yQJDW-1-u2"><i>&lt;Defaults for <code>makefile.config</code>&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This is the right place to include them, but makepp can't handle it</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#-include makefile.config</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.config.local
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1yQJDW-1-u3" href="#NW0-1MIpmy-1" id="NW0-1yQJDW-1-u3"><i>&lt;Build variables for makefile includes&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1yQJDW-1-u4" href="#NW0-p3SeT-1" id="NW0-1yQJDW-1-u4"><i>&lt;Build rules for makefile includes&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.config
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># reinclude to ensure overrides</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.config.local
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.vars
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># keep intermediate files</span>
</pre>
      </li>

      <li>
        <pre>
.SECONDARY<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># mark a few phonies - not really necessary</span>
</pre>
      </li>

      <li>
        <pre>
.PHONY<span class="opt">: </span><span class="kwa">all </span>misc bin doc <span class="kwa">install clean distclean</span>
</pre>
      </li>

      <li>
        <pre>
bin<span class="opt">: $(</span>LIB_FILES<span class="opt">) $(</span>EXEC_FILES<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
doc<span class="opt">: $(</span>DOC_FILES<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
misc<span class="opt">: $(</span>MISC_FILES<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.rules
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3IzIGd-1" href="#NW0-3IzIGd-1" id="NW0-3IzIGd-1"><dfn>&lt;Common NoWeb Warning&gt;=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a> <a href="#NW0-3uTryu-1">U-&gt;</a> <a href="#NW0-4NQJhz-1">U-&gt;</a> <a href="#NW0-2Aa10L-1">U-&gt;</a> <a href="#NW0-lrTIc-1">U-&gt;</a> <a href="#NW0-nmy1B-1">U-&gt;</a> <a href="#NW0-1LtyCx-1">U-&gt;</a> <a href="#NW0-3yZ7b5-1">U-&gt;</a> <a href="#NW0-3Wv0ER-1">U-&gt;</a> <a href="#NW0-1H5Xxg-1">U-&gt;</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># GENERATED FILE:  DO NOT EDIT OR READ THIS FILE</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Instead, read or edit the NoWeb file(s) from which this was generated,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># listed below.  Copyright notice and license terms can be found there.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># $Id: build.nw 160 2012-11-22 21:07:26Z darktjm $</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-s2DzW-1" href="#NW0-s2DzW-1" id="NW0-s2DzW-1"><dfn>&lt;Sources&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
$Id: build.nw 160 2012-11-22 21:07:26Z darktjm $
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-1" href="#NW0-3uTryu-1" id="NW0-3uTryu-1"><dfn>&lt;makefile.rules&gt;=</dfn></a> <b>[D<a href="#NW0-3uTryu-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-3uTryu-1-u1" href="#NW0-3IzIGd-1" id="NW0-3uTryu-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">install</span><span class="opt">: </span>misc bin
</pre>
      </li>

      <li>
        <pre>
        mkdir <span class="opt">-</span>p <span class="opt">$(</span>DESTDIR<span class="opt">)$(</span>BIN_DIR<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        for x in <span class="opt">$(</span>EXEC_FILES<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
           <span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>DESTDIR<span class="opt">)$(</span>BIN_DIR<span class="opt">)/$</span><span class="kwd">$x</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           cp <span class="opt">-</span>p <span class="opt">$</span><span class="kwd">$x </span><span class="opt">$(</span>DESTDIR<span class="opt">)$(</span>BIN_DIR<span class="opt">); </span>\
</pre>
      </li>

      <li>
        <pre>
         done
</pre>
      </li>

      <li>
        <pre>
        <a name="NW0-3uTryu-1-u2" href="#NW0-4NpOpq-1" id="NW0-3uTryu-1-u2"><i>&lt;Install other files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">clean</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        <a name="NW0-3uTryu-1-u3" href="#NW0-4erxh5-1" id="NW0-3uTryu-1-u3"><i>&lt;Clean temporary files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">rm </span><span class="opt">-</span>f makefile.<span class="opt">{</span>config<span class="opt">,</span>vars<span class="opt">,</span>rules<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">distclean</span><span class="opt">: </span><span class="kwa">clean</span>
</pre>
      </li>

      <li>
        <pre>
        <a name="NW0-3uTryu-1-u4" href="#NW0-1VdTlf-1" id="NW0-3uTryu-1-u4"><i>&lt;Clean built files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">rm </span><span class="opt">-</span>rf .makepp
</pre>
      </li>

      <li>
        <pre>
        <a name="NW0-3uTryu-1-u5" href="#NW0-SD0EF-1" id="NW0-3uTryu-1-u5"><i>&lt;Remove makefile&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3TUZd-1" href="#NW0-3TUZd-1" id="NW0-3TUZd-1"><dfn>&lt;makefile.config&gt;=</dfn></a> <b>[D<a href="#NW0-3TUZd-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Installation prefix to apply to all install locations</span>
</pre>
      </li>

      <li>
        <pre>
DESTDIR<span class="opt">:=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Installation directory for binaries</span>
</pre>
      </li>

      <li>
        <pre>
BIN_DIR<span class="opt">:=/</span>usr<span class="opt">/</span>local<span class="opt">/</span>bin
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-1" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-1"><dfn>&lt;makefile.vars&gt;=</dfn></a> <b>[D<a href="#NW0-4NQJhz-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-4NQJhz-1-u1" href="#NW0-3IzIGd-1" id="NW0-4NQJhz-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
MAKEFILES<span class="opt">:=</span>makefile makefile.config makefile.vars makefile.rules
</pre>
      </li>

      <li>
        <pre>
EXEC_FILES <span class="opt">= </span><a name="NW0-4NQJhz-1-u2" href="#NW0-1BSm48-1" id="NW0-4NQJhz-1-u2"><i>&lt;Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
LIB_FILES <span class="opt">= </span><a name="NW0-4NQJhz-1-u3" href="#NW0-3V5yfh-1" id="NW0-4NQJhz-1-u3"><i>&lt;Libraries&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
DOC_FILES <span class="opt">= </span><a name="NW0-4NQJhz-1-u4" href="#NW0-42a72-1" id="NW0-4NQJhz-1-u4"><i>&lt;Source Code Documentation Files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
MISC_FILES <span class="opt">= </span><a name="NW0-4NQJhz-1-u5" href="#NW0-yWsmS-1" id="NW0-4NQJhz-1-u5"><i>&lt;Plain Files&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NpOpq-1" href="#NW0-4NpOpq-1" id="NW0-4NpOpq-1"><dfn>&lt;Install other files&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b>
</pre>

  <ol class="code"></ol>
  <pre class="dfn">
<a name="NW0-yWsmS-1" href="#NW0-yWsmS-1" id="NW0-yWsmS-1"><dfn>&lt;Plain Files&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>

  <p>The makefile can make itself, as well. This is dependent only on its source file; there is little point in making this dependent on the included files, as they will be automatically rebuilt as needed, anyway. A quick check before writing out the file ensures that a blank or otherwise seriously invalid makefile will never be created due to errors in the source file.</p>

  <p>Note that Makepp has issues with recursive make invocation for the verification of the makefile, so this step is skipped.</p>
  <pre class="dfn">
<a name="NW0-3TUZd-2" href="#NW0-3TUZd-1" id="NW0-3TUZd-2"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-1">&lt;-</a>D<a href="#NW0-3TUZd-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The name of the file containing the makefile</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># or in makefile.config.local</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#BUILD_NOWEB:=build.nw</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-xNRJd-1" href="#NW0-xNRJd-1" id="NW0-xNRJd-1"><dfn>&lt;Defaults for <code>makefile.config</code>&gt;=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-xNRJd-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
BUILD_NOWEB<span class="opt">=</span>build.nw
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-p3SeT-1" href="#NW0-p3SeT-1" id="NW0-p3SeT-1"><dfn>&lt;Build rules for makefile includes&gt;=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-p3SeT-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
makefile<span class="opt">: $(</span>BUILD_NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>BUILD_NOWEB<span class="opt">) </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | grep <span class="opt">-</span>v <span class="str">'^$$'</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#notangle -t8 -R$@ $(BUILD_NOWEB) 2&gt;/dev/null | \ #</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#    env -i $(MAKE) -n -f- /dev/null &gt;/dev/null</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>BUILD_NOWEB<span class="opt">) &gt; $</span>@
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-SD0EF-1" href="#NW0-SD0EF-1" id="NW0-SD0EF-1"><dfn>&lt;Remove makefile&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f makefile
</pre>
      </li>

      <li>
        <pre>
@echo
</pre>
      </li>

      <li>
        <pre>
@echo Regenerate the makefile with<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
@echo notangle <span class="opt">-</span>t8 <span class="opt">$(</span>BUILD_NOWEB<span class="opt">) </span>\<span class="opt">&gt; </span>makefile
</pre>
      </li>
    </ol>
  </div>

  <p>Generating the other files requires the ability to correctly assemble them from all the other NoWeb files.</p>
  <pre class="dfn">
<a name="NW0-3TUZd-3" href="#NW0-3TUZd-1" id="NW0-3TUZd-3"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-2">&lt;-</a>D<a href="#NW0-3TUZd-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The name of the source files</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Any time you change this, makefile.* should be removed and rebuilt</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># or in makefile.config.local</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#NOWEB:=$(wildcard *.nw)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-xNRJd-2" href="#NW0-xNRJd-1" id="NW0-xNRJd-2"><dfn>&lt;Defaults for <code>makefile.config</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-xNRJd-1">&lt;-</a>D<a href="#NW0-xNRJd-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
NOWEB<span class="opt">:=$(</span><span class="kwa">wildcard </span><span class="opt">*</span>.nw<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc5" id="toc5">Merging Sources</a></h3>

  <p>From these files, an order of building must be derived. This is done using a dependency tree created from special comments in the source files. These comments are at the beginning of a line, and are of the form <tt>%%%requires <em>X</em></tt>, where <em>X</em> is either the name of a NoWeb file or the name with the <tt>.nw</tt> removed. An explicit <tt>\input{</tt><em>X</em><tt>.nw</tt> creates a dependency as well. Top-level build files are those on which no others depend. The tree order consists of the top-level files, followed by their direct dependencies, in the order found in those files, followed by those files' direct dependencies, and so forth, with no file repeated.</p>

  <p>Finding the dependency directives requires <code>egrep</code>, and removing the pattern requires <code>sed</code>. Due to the sloppiness of the patterns and other parsing, no file names can contain colons or spaces. This is all done using GNU make's internal functions so that the results can be easily used in other rules.</p>
  <pre class="dfn">
<a name="NW0-1MIpmy-1" href="#NW0-1MIpmy-1" id="NW0-1MIpmy-1"><dfn>&lt;Build variables for makefile includes&gt;=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1MIpmy-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
NOWEB_DEPS<span class="opt">:=$(</span><span class="kwa">shell </span>egrep <span class="str">'^%%% requires |^</span><span class="esc">\\</span><span class="str">input{.*\.nw}$$'</span> <span class="opt">$(</span>NOWEB<span class="opt">) /</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
                    sed <span class="opt">-</span>e <span class="str">'s/%%% requires //;s/</span><span class="esc">\\</span><span class="str">input{\(.*\)}$$/\1/'</span> \
</pre>
      </li>

      <li>
        <pre>
                        <span class="opt">-</span>e <span class="str">'s/[[:space:]]*\(%.*\)*$$//;s/:/ /'</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>After the dependencies are found, they are separated into files which depend on others (<code>NOWEB_UPPER</code>), and files which are depended on (<code>NOWEB_LOWER</code>). The files whilch are depended on may be specified without the <tt>.nw</tt> extension, so the filesystem is checked for the file, and <tt>.nw</tt> is added if the file does not exist. If it still does not exist after tacking on <tt>.nw</tt>, the missing file is an error.</p>
  <pre class="dfn">
<a name="NW0-1MIpmy-2" href="#NW0-1MIpmy-1" id="NW0-1MIpmy-2"><dfn>&lt;Build variables for makefile includes&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1MIpmy-1">&lt;-</a>D<a href="#NW0-1MIpmy-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># return rest of words of parm 2, starting at parm 1</span>
</pre>
      </li>

      <li>
        <pre>
rest <span class="opt">= $(</span>wordlist <span class="kwd">$1</span><span class="opt">,$(</span><span class="kwa">words </span><span class="kwd">$2</span><span class="opt">),</span><span class="kwd">$2</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># return every other word of parm, starting with first</span>
</pre>
      </li>

      <li>
        <pre>
ret_other <span class="opt">= $(</span><span class="kwa">word </span><span class="num">1</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">) $(</span>if <span class="opt">$(</span><span class="kwa">word </span><span class="num">3</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">),$(</span>call ret_other<span class="opt">,$(</span>call rest<span class="opt">,</span><span class="num">3</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
NOWEB_UPPER<span class="opt">:=$(</span>call ret_other<span class="opt">,$(</span>NOWEB_DEPS<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
NOWEB_LOWER_BASE<span class="opt">:=$(</span>call ret_other<span class="opt">,$(</span>wordlist <span class="num">2</span><span class="opt">,$(</span><span class="kwa">words </span><span class="opt">$(</span>NOWEB_DEPS<span class="opt">)),$(</span>NOWEB_DEPS<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
NOWEB_LOWER<span class="opt">:=$(</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>NOWEB_LOWER_BASE<span class="opt">),$(</span>if <span class="opt">$(</span><span class="kwa">wildcard </span><span class="kwd">$f</span><span class="opt">),</span><span class="kwd">$f</span><span class="opt">,</span>\
</pre>
      </li>

      <li>
        <pre>
                                           <span class="opt">$(</span>if <span class="opt">$(</span><span class="kwa">wildcard </span><span class="kwd">$f</span>.nw<span class="opt">),</span><span class="kwd">$f</span>.nw<span class="opt">, </span>\
</pre>
      </li>

      <li>
        <pre>
                                           <span class="opt">$(</span>error <span class="kwd">$f </span>and <span class="kwd">$f</span>.nw not found<span class="opt">))))</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, the tree is traversed, from top to bottom. The top is simply the list of files on which no other files depend. There must be at least one file at the top, or nothing will work correctly. Then, each file in the list is checked for as-yet unfulfilled dependencies to tack on. No dependency may appear before files upon which it depends, so the dependecies are repeatedly tacked onto the start of the list and stripped from the rest until the tree settles.</p>
  <pre class="dfn">
<a name="NW0-1MIpmy-3" href="#NW0-1MIpmy-1" id="NW0-1MIpmy-3"><dfn>&lt;Build variables for makefile includes&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1MIpmy-2">&lt;-</a>D<a href="#NW0-1MIpmy-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
NOWEB_HIGHEST<span class="opt">:=$(</span><span class="kwa">filter-out </span><span class="opt">$(</span>NOWEB_LOWER<span class="opt">),$(</span>NOWEB<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>if <span class="opt">$(</span>NOWEB_HIGHEST<span class="opt">),,$(</span>error Invalid dependency tree<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># return words from parm #3 in positions of parm #2 which match parm #1</span>
</pre>
      </li>

      <li>
        <pre>
match_words <span class="opt">= $(</span>if <span class="opt">$(</span><span class="kwa">filter </span><span class="kwd">$1</span><span class="opt">,$(</span><span class="kwa">word </span><span class="num">1</span><span class="opt">,</span><span class="kwd">$2</span><span class="opt">)),$(</span><span class="kwa">word </span><span class="num">1</span><span class="opt">,</span><span class="kwd">$3</span><span class="opt">)) </span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">$(</span>if <span class="opt">$(</span><span class="kwa">word </span><span class="num">2</span><span class="opt">,</span><span class="kwd">$2</span><span class="opt">),$(</span>call match_words<span class="opt">,</span><span class="kwd">$1</span><span class="opt">,$(</span>call rest<span class="opt">,</span><span class="num">2</span><span class="opt">,</span><span class="kwd">$2</span><span class="opt">),$(</span>call rest<span class="opt">,</span><span class="num">2</span><span class="opt">,</span><span class="kwd">$3</span><span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># return only unique words in parm, keeping only first occurrence</span>
</pre>
      </li>

      <li>
        <pre>
uniq <span class="opt">= $(</span>if <span class="kwd">$1</span><span class="opt">,</span>\
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">$(</span><span class="kwa">firstword </span><span class="kwd">$1</span><span class="opt">) $(</span>call uniq<span class="opt">,$(</span><span class="kwa">filter-out </span><span class="opt">$(</span><span class="kwa">firstword </span><span class="kwd">$1</span><span class="opt">),$(</span>call rest<span class="opt">,</span><span class="num">2</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">))))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># tack dependencies to left</span>
</pre>
      </li>

      <li>
        <pre>
predeps <span class="opt">= $(</span>call uniq<span class="opt">, $(</span><span class="kwa">foreach </span>f<span class="opt">,</span><span class="kwd">$1</span><span class="opt">,</span>\
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">$(</span>call match_words<span class="opt">,</span><span class="kwd">$f</span><span class="opt">,$(</span>NOWEB_UPPER<span class="opt">),$(</span>NOWEB_LOWER<span class="opt">))) </span><span class="kwd">$1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># true if lists not equal</span>
</pre>
      </li>

      <li>
        <pre>
listne <span class="opt">= $(</span><span class="kwa">strip </span><span class="opt">$(</span>if <span class="kwd">$1</span><span class="opt">,$(</span>if <span class="kwd">$2</span><span class="opt">,$(</span>if <span class="opt">$(</span><span class="kwa">filter </span><span class="opt">$(</span><span class="kwa">word </span><span class="num">1</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">),$(</span><span class="kwa">word </span><span class="num">1</span><span class="opt">,</span><span class="kwd">$2</span><span class="opt">)), </span>\
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">$(</span>call listne<span class="opt">,$(</span>call rest<span class="opt">,</span><span class="num">2</span><span class="opt">,</span><span class="kwd">$1</span><span class="opt">),$(</span>call rest<span class="opt">,</span><span class="num">2</span><span class="opt">,</span><span class="kwd">$2</span><span class="opt">)), </span>\
</pre>
      </li>

      <li>
        <pre>
                  y1<span class="opt">), </span>y2<span class="opt">), $(</span>if <span class="kwd">$2</span><span class="opt">, </span>y3<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># expand dependencies until there are no more</span>
</pre>
      </li>

      <li>
        <pre>
tree <span class="opt">= $(</span>if <span class="opt">$(</span>call listne<span class="opt">,</span><span class="kwd">$1</span><span class="opt">,$(</span>call predeps<span class="opt">,</span><span class="kwd">$1</span><span class="opt">)), </span>\
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">$(</span>call tree<span class="opt">,$(</span>call predeps<span class="opt">,</span><span class="kwd">$1</span><span class="opt">)), </span><span class="kwd">$1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
NOWEB_ORDER<span class="opt">:=$(</span>call tree<span class="opt">,$(</span>NOWEB_HIGHEST<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>PROJECT_NAME<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
PROJECT_NAME<span class="opt">:=$(</span><span class="kwa">subst </span>.nw<span class="opt">,,$(</span><span class="kwa">firstword </span><span class="opt">$(</span>NOWEB_HIGHEST<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3TUZd-4" href="#NW0-3TUZd-1" id="NW0-3TUZd-4"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-3">&lt;-</a>D<a href="#NW0-3TUZd-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#Set to override the automatically determined project name</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#PROJECT_NAME=</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-2" href="#NW0-3uTryu-1" id="NW0-3uTryu-2"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-1">&lt;-</a>D<a href="#NW0-3uTryu-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
prtree<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Project<span class="opt">: $(</span>PROJECT_NAME<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Deps<span class="opt">: $(</span>NOWEB_DEPS<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Highest<span class="opt">: $(</span>NOWEB_HIGHEST<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Upper<span class="opt">: $(</span>NOWEB_UPPER<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Lower<span class="opt">: $(</span>NOWEB_LOWER<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @echo Order<span class="opt">: $(</span>NOWEB_ORDER<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>So, to generate a file, all of these NoWeb files are concatenated, in reverse order, and passed into <code>notangle</code>. The makefile components in particular need to be checked for errors in mostly the same way as the main makefile.</p>
  <pre class="dfn">
<a name="NW0-p3SeT-2" href="#NW0-p3SeT-1" id="NW0-p3SeT-2"><dfn>&lt;Build rules for makefile includes&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-p3SeT-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
makefile.config<span class="opt">: $(</span>NOWEB_ORDER<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$</span>^ <span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | grep <span class="opt">-</span>v <span class="str">'^$$'</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#notangle -t8 -R$@ $^ 2&gt;/dev/null | env -i $(MAKE) -n -f- /dev/null &gt;/dev/null</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$</span>^ <span class="opt">&gt; $</span>@
</pre>
      </li>

      <li>
        <pre>
makefile.vars<span class="opt">: </span>makefile.config
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | grep <span class="opt">-</span>v <span class="str">'^$$'</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#notangle -t8 -Rmakefile.config -R$@ $(NOWEB_ORDER) 2&gt;/dev/null | \ #</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#        env -i $(MAKE) -n -f- /dev/null &gt;/dev/null</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt; $</span>@
</pre>
      </li>

      <li>
        <pre>
makefile.rules<span class="opt">: </span>makefile.vars
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | grep <span class="opt">-</span>v <span class="str">'^$$'</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#notangle -t8 -Rmakefile.config -Rmakefile.vars -R$@ \ #</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#                                     $(NOWEB_ORDER) 2&gt;/dev/null | \ #</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc">#        env -i $(MAKE) -n -f- /dev/null &gt;/dev/null #</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>t8 <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt; $</span>@
</pre>
      </li>
    </ol>
  </div>

  <p>Building plain files is done the same way, but without the complicated checks, assuming that no additional processing needs to be done. For files where additional processing is necessary, additional dependencies on the <code>misc</code> target, as well as <code><a href="#NW0-4NpOpq-1"><i>&lt;Install other files&gt;</i></a></code> can be used to add files with special build rules.</p>

  <p>Note that <code><a href="#NW0-yWsmS-1"><i>&lt;Plain Files&gt;</i></a></code> is intended for installable targets. For plain files generated as part of the build, use <code><a href="#NW0-2ohs0l-1"><i>&lt;Plain Build Files&gt;</i></a></code> instead. For a subtle change, any files generated by means other than <code>notangle</code> can be added to <code><a href="#NW0-31rZkh-1"><i>&lt;Plain Built Files&gt;</i></a></code> in order to save making a clean rule for it.</p>
  <pre class="dfn">
<a name="NW0-4NQJhz-2" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-2"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-1">&lt;-</a>D<a href="#NW0-4NQJhz-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
MISC_TEMP_FILES <span class="opt">= </span><a name="NW0-4NQJhz-2-u1" href="#NW0-2ohs0l-1" id="NW0-4NQJhz-2-u1"><i>&lt;Plain Build Files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
GENERATED_TEMP_FILES <span class="opt">= </span><a name="NW0-4NQJhz-2-u2" href="#NW0-31rZkh-1" id="NW0-4NQJhz-2-u2"><i>&lt;Plain Built Files&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ohs0l-1" href="#NW0-2ohs0l-1" id="NW0-2ohs0l-1"><dfn>&lt;Plain Build Files&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-31rZkh-1" href="#NW0-31rZkh-1" id="NW0-31rZkh-1"><dfn>&lt;Plain Built Files&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-3" href="#NW0-3uTryu-1" id="NW0-3uTryu-3"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-2">&lt;-</a>D<a href="#NW0-3uTryu-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>MISC_FILES<span class="opt">) $(</span>MISC_TEMP_FILES<span class="opt">): $(</span>NOWEB_ORDER<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$</span>^ <span class="opt">&gt;$</span>@
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-1" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-1"><dfn>&lt;Clean built files&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-1VdTlf-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>MISC_FILES<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-1" href="#NW0-4erxh5-1" id="NW0-4erxh5-1"><dfn>&lt;Clean temporary files&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-4erxh5-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>MISC_TEMP_FILES<span class="opt">) $(</span>GENERATED_TEMP_FILES<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc6" id="toc6">Additional Features</a></h3>

  <p>It may also be useful to build a tar file for building on systems where NoWeb is not present. This is meant to be a convenience, for building binaries only, and not for distribution. That means neither the source documentation nor any means to build the source documentation will be included. Since it is not possible to distinguish between soft links created for building and soft links to other NoWeb files, no attempt will be made to force link dereferencing, either.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-4" href="#NW0-3uTryu-1" id="NW0-3uTryu-4"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-3">&lt;-</a>D<a href="#NW0-3uTryu-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>PROJECT_NAME<span class="opt">)-</span>src.<span class="kwa">tar</span>.gz<span class="opt">: $(</span>BUILD_SOURCE<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc"># needs GNU tar</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">tar </span>czf <span class="opt">$(</span>PROJECT_NAME<span class="opt">)-</span>src.<span class="kwa">tar</span>.gz <span class="opt">$(</span>BUILD_SOURCE<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-3" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-3"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-2">&lt;-</a>D<a href="#NW0-4NQJhz-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
BUILD_SOURCE<span class="opt">=$(</span>NOWEB<span class="opt">) $(</span>MAKEFILES<span class="opt">) $(</span>MISC_FILES<span class="opt">) </span><a name="NW0-4NQJhz-3-u1" href="#NW0-4f1jeK-1" id="NW0-4NQJhz-3-u1"><i>&lt;Build Source&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-2" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-2"><dfn>&lt;Clean built files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VdTlf-1">&lt;-</a>D<a href="#NW0-1VdTlf-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>PROJECT_NAME<span class="opt">)-</span>src.<span class="kwa">tar</span>.gz
</pre>
      </li>
    </ol>
  </div>

  <p>It may also be useful to get some source code statistics. Code counts include all code chunks, but do not include the chunk name/start line or the terminating <code>@</code>. Hidden sections are not included; they are delimited by <tt>&lt;!--&gt;</tt> and <tt>&lt;--&gt;</tt> on their own line.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-5" href="#NW0-3uTryu-1" id="NW0-3uTryu-5"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-4">&lt;-</a>D<a href="#NW0-3uTryu-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
count<span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        @for x in <span class="opt">$(</span>NOWEB<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
           echo <span class="opt">$${</span><span class="kwc">x</span><span class="opt">}:; </span>\
</pre>
      </li>

      <li>
        <pre>
           <a name="NW0-3uTryu-5-u1" href="#NW0-4MuhKV-1" id="NW0-3uTryu-5-u1"><i>&lt;Count lines in <code>$$x</code>&gt;</i></a> \
</pre>
      </li>

      <li>
        <pre>
         done
</pre>
      </li>

      <li>
        <pre>
        @echo <span class="str">"Tangled output:"</span>
</pre>
      </li>

      <li>
        <pre>
        @wc <span class="opt">-</span>l <span class="opt">$(</span>MISC_FILES<span class="opt">) </span><a name="NW0-3uTryu-5-u2" href="#NW0-vdNDE-1" id="NW0-3uTryu-5-u2"><i>&lt;Files to Count&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">&lt;/</span>dev<span class="opt">/</span>null | <span class="kwa">sort </span><span class="opt">-</span>k1n
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4MuhKV-1" href="#NW0-4MuhKV-1" id="NW0-4MuhKV-1"><dfn>&lt;Count lines in <code>$$x</code>&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-5">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
tl<span class="opt">=</span><span class="str">`cat $$x | wc -l`</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
bl<span class="opt">=</span><span class="str">`grep -c '^[[:space:]]*$$' $$x`</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
hl<span class="opt">=</span><span class="str">`sed -n -e '/^&lt;!--&gt;$$/{:a p;n;/^&lt;--&gt;$$/!ba;}' &lt; $$x | wc -l`</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
cl<span class="opt">=</span><span class="str">`sed -n -e '/^&lt;&lt;.*&gt;&gt;=/{:a n;/^@[^@]/b;/^@$$/b;/^[[:space:]]*$$/!p;ba;}' \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">           -e '/^&lt;!--&gt;$$/{:b n;/^&lt;--&gt;$$/!bb;}' &lt; $$x | wc -l`</span> <span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
echo <span class="str">" Lines: $$tl:"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
echo <span class="str">"  $$cl code, $$((tl-bl-hl-cl)) doc, $$hl hidden, $$bl blank"</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, there is a rule to check the consistency of the NoWeb source. Checking the list of chunks which are not specifically referenced requires human intervention, so all root chunks are printed out for review. The list of missing chunks should always be accurate, though. The terminating <code>@</code> for code chunks isn't required by the NoWeb syntax when writing multiple consecutive code chunks, but it is required by some of the document converters. The reinsertion code is stupid about unbalanced doc reinsertions, but instead of checking correctly there, it's flagged here.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-6" href="#NW0-3uTryu-1" id="NW0-3uTryu-6"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-5">&lt;-</a>D<a href="#NW0-3uTryu-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
.PHONY<span class="opt">: </span><span class="kwa">check</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">check</span><span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="str">'s/&lt;&lt;//;s/&gt;&gt;//;'</span> | <span class="kwa">sort </span>| while read x<span class="opt">; </span>do \
</pre>
      </li>

      <li>
        <pre>
          echo <span class="str">"Root: $$x"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          notangle <span class="opt">-</span>R<span class="str">"$$x"</span> <span class="opt">$(</span>NOWEB<span class="opt">) &gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
        done
</pre>
      </li>

      <li>
        <pre>
        @for f in <span class="opt">$(</span>NOWEB<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
           lno<span class="opt">=</span><span class="num">1 </span>gotat<span class="opt">=</span>y<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           while IFS<span class="opt">= </span>read <span class="opt">-</span>r x<span class="opt">; </span>do \
</pre>
      </li>

      <li>
        <pre>
             case <span class="str">"$$x"</span> in \
</pre>
      </li>

      <li>
        <pre>
                <span class="str">"&lt;&lt;"</span><span class="opt">*</span><span class="str">"&gt;&gt;"</span><span class="opt">=) </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="kwa">test </span><span class="str">"$$gotat"</span> || echo <span class="str">"$$f: $$prev not terminated by @"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   gotat<span class="opt">=; </span>\
</pre>
      </li>

      <li>
        <pre>
                   prev<span class="opt">=</span><span class="str">"$${lno}: $$x"</span><span class="opt">;; </span>\
</pre>
      </li>

      <li>
        <pre>
                @|@<span class="opt">[</span>^@<span class="opt">]*) </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="kwa">test </span><span class="str">"$$gotat"</span> <span class="opt">&amp;&amp; </span>echo <span class="str">"$$f: $${lno}: extra @"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   gotat<span class="opt">=</span>y<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
             esac<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
             lno<span class="opt">=$$((</span>lno<span class="opt">+</span><span class="num">1</span><span class="opt">)); </span>\
</pre>
      </li>

      <li>
        <pre>
           done <span class="opt">&lt; </span><span class="str">"$$f"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         done
</pre>
      </li>

      <li>
        <pre>
        @for f in <span class="opt">$(</span>NOWEB<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
           lno<span class="opt">=</span><span class="num">1 </span>std<span class="opt">=</span><span class="num">0</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           while IFS<span class="opt">= </span>read <span class="opt">-</span>r x<span class="opt">; </span>do \
</pre>
      </li>

      <li>
        <pre>
             case <span class="str">"$$x"</span> in \
</pre>
      </li>

      <li>
        <pre>
                <span class="str">"% Begin-doc "</span><span class="opt">*) </span>\
</pre>
      </li>

      <li>
        <pre>
                  std<span class="opt">=$$((</span>std<span class="opt">+</span><span class="num">1</span><span class="opt">)); </span>eval bd<span class="opt">$</span><span class="kwd">$std</span><span class="opt">=</span><span class="str">'"$${x#* * }"'</span> bl<span class="opt">$</span><span class="kwd">$std</span><span class="opt">=$</span><span class="kwd">$lno</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                  stp<span class="opt">=</span><span class="num">1</span><span class="opt">; </span>while <span class="opt">[ $</span><span class="kwd">$stp </span><span class="opt">-</span>lt <span class="opt">$</span><span class="kwd">$std </span><span class="opt">]; </span>do \
</pre>
      </li>

      <li>
        <pre>
                    eval bd<span class="opt">=</span><span class="str">'"$$bd'</span><span class="opt">$</span><span class="kwd">$stp</span><span class="esc">\" </span>bl<span class="opt">=</span>\<span class="opt">$</span><span class="kwd">$bl</span><span class="opt">$</span><span class="kwd">$stp</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    if <span class="opt">[ </span><span class="str">"$${x#* * }"</span> <span class="opt">= </span><span class="str">"$$bd"</span> <span class="opt">]; </span>then \
</pre>
      </li>

      <li>
        <pre>
                      echo <span class="str">"Recursive Begin-doc $$bd at $$bl/$$lno"</span><span class="opt">; </span>break<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    fi<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    stp<span class="opt">=$$((</span>stp<span class="opt">+</span><span class="num">1</span><span class="opt">)); </span>\
</pre>
      </li>

      <li>
        <pre>
                  done<span class="opt">;; </span>\
</pre>
      </li>

      <li>
        <pre>
                <span class="str">"% End-doc "</span><span class="opt">*) </span>\
</pre>
      </li>

      <li>
        <pre>
                  if <span class="opt">[ $</span><span class="kwd">$std </span><span class="opt">-</span>eq <span class="num">0 </span><span class="opt">]; </span>then \
</pre>
      </li>

      <li>
        <pre>
                    echo <span class="str">"$$f: unexpected end-doc at $$lno"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwb">else </span>\
</pre>
      </li>

      <li>
        <pre>
                    eval bd<span class="opt">=</span><span class="str">'"$$bd'</span><span class="opt">$</span><span class="kwd">$std</span><span class="esc">\" </span>bl<span class="opt">=</span>\<span class="opt">$</span><span class="kwd">$bl</span><span class="opt">$</span><span class="kwd">$std</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    if <span class="opt">[ </span><span class="str">"$${x#* * }"</span> <span class="opt">!= </span><span class="str">"$$bd"</span> <span class="opt">]; </span>then \
</pre>
      </li>

      <li>
        <pre>
                      echo <span class="str">"$$f: Begin-doc $$bd at $$bl"</span> \
</pre>
      </li>

      <li>
        <pre>
                           <span class="str">"ended by $${x#% } at $$lno"</span><span class="opt">; </span>break<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    fi<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                    std<span class="opt">=$$((</span>std-1<span class="opt">)); </span>\
</pre>
      </li>

      <li>
        <pre>
                  fi<span class="opt">;; </span>\
</pre>
      </li>

      <li>
        <pre>
             esac<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
             lno<span class="opt">=$$((</span>lno<span class="opt">+</span><span class="num">1</span><span class="opt">)); </span>\
</pre>
      </li>

      <li>
        <pre>
           done <span class="opt">&lt; </span><span class="str">"$$f"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           while <span class="opt">[ $</span><span class="kwd">$std </span><span class="opt">-</span>gt <span class="num">0 </span><span class="opt">]; </span>do \
</pre>
      </li>

      <li>
        <pre>
             eval bd<span class="opt">=</span><span class="str">'"$$bd'</span><span class="opt">$</span><span class="kwd">$std</span><span class="esc">\" </span>bl<span class="opt">=</span>\<span class="opt">$</span><span class="kwd">$bl</span><span class="opt">$</span><span class="kwd">$std</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
             echo <span class="str">"$$f: unended Begin-doc $$bd at $$bl"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
             std<span class="opt">=$$((</span>std-1<span class="opt">)); </span>\
</pre>
      </li>

      <li>
        <pre>
           done<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         done
</pre>
      </li>
    </ol>
  </div>

  <h2><a name="toc7" id="toc7">Binaries</a></h2>

  <p>Building the binaries is pretty simple, using automatic rules. Support is provided here for plain text executable scripts and C executables. In order to ensure a consistent build rule for all C files, the default C-to-executable rule is blanked out. Executables are assumed to have one mainline source, named the same as the executable but with a <tt>.c</tt> extenstion. All local libraries built from local sources are linked into every executable.</p>

  <p>Since all C files share the same rule, a hook (<code>C_POSTPROCESS</code>) is provided for doing further modifications to the code before compilation. The hook is in the form of a GNU make function call, which takes the target file name as an argument. It is expected to return an appropriate pipeline for that target. Scripts, on the other hand, are easy enough to modify using separate rules.</p>
  <pre class="dfn">
<a name="NW0-1BSm48-1" href="#NW0-1BSm48-1" id="NW0-1BSm48-1"><dfn>&lt;Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>C_EXEC<span class="opt">) $(</span>SCRIPT_EXEC<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-4" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-4"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-3">&lt;-</a>D<a href="#NW0-4NQJhz-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
SCRIPT_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-4-u1" href="#NW0-2s5YyJ-1" id="NW0-4NQJhz-4-u1"><i>&lt;Script Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
C_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-4-u2" href="#NW0-1LbAtL-1" id="NW0-4NQJhz-4-u2"><i>&lt;C Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
NOWEB_CFILES<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="opt">-</span>n <span class="str">'/\.c&gt;&gt;/{s/&lt;&lt;//;s/&gt;&gt;//;p;}'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
CFILES<span class="opt">=</span><a name="NW0-4NQJhz-4-u3" href="#NW0-38kBWE-1" id="NW0-4NQJhz-4-u3"><i>&lt;C Files&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
NOWEB_HEADERS<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="opt">-</span>n <span class="str">'/\.h&gt;&gt;/{s/&lt;&lt;//;s/&gt;&gt;//;p;}'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
HEADERS<span class="opt">=</span><a name="NW0-4NQJhz-4-u4" href="#NW0-T3FtH-1" id="NW0-4NQJhz-4-u4"><i>&lt;C Headers&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
COFILES<span class="opt">=$(</span><span class="kwa">patsubst </span><span class="opt">%</span>.c<span class="opt">, %</span>.o<span class="opt">, $(</span>CFILES<span class="opt">))</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-38kBWE-1" href="#NW0-38kBWE-1" id="NW0-38kBWE-1"><dfn>&lt;C Files&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>NOWEB_CFILES<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-T3FtH-1" href="#NW0-T3FtH-1" id="NW0-T3FtH-1"><dfn>&lt;C Headers&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>NOWEB_HEADERS<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4f1jeK-1" href="#NW0-4f1jeK-1" id="NW0-4f1jeK-1"><dfn>&lt;Build Source&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-3">&lt;-U</a>)</b> <b>[D<a href="#NW0-4f1jeK-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>SCRIPT_EXEC<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3TUZd-5" href="#NW0-3TUZd-1" id="NW0-3TUZd-5"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-4">&lt;-</a>D<a href="#NW0-3TUZd-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Set to -L for #line, but lose code indentation</span>
</pre>
      </li>

      <li>
        <pre>
USE_LINE<span class="opt">:=-</span>L
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-7" href="#NW0-3uTryu-1" id="NW0-3uTryu-7"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-6">&lt;-</a>D<a href="#NW0-3uTryu-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>SCRIPT_EXEC<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
        chmod <span class="opt">+</span>x <span class="opt">$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># C_POSTPROCESS can be used to add boilerplate code</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>NOWEB_HEADERS<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">$(</span>USE_LINE<span class="opt">) -</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) $(</span>call C_POSTPROCESS<span class="opt">,$</span>@<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>NOWEB_CFILES<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">$(</span>USE_LINE<span class="opt">) -</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) $(</span>call C_POSTPROCESS<span class="opt">,$</span>@<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># disable gmake built-in .c-&gt;exe rule</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>MAKEPP_VERSION<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%: %</span>.c
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.o<span class="opt">: %</span>.c
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">$(</span>CC<span class="opt">) $(</span>CFLAGS<span class="opt">) $(</span>EXTRA_CFLAGS<span class="opt">) -</span>c <span class="opt">-</span>o <span class="opt">$</span>@ <span class="opt">$&lt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%: %</span>.o
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">$(</span>CC<span class="opt">) -</span>o <span class="opt">$</span>@ <span class="opt">$&lt; $(</span>LDFLAGS<span class="opt">) -</span>L. <span class="opt">$(</span>LOCAL_LIBS<span class="opt">) $(</span>EXTRA_LDFLAGS<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-vdNDE-1" href="#NW0-vdNDE-1" id="NW0-vdNDE-1"><dfn>&lt;Files to Count&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-5">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>CFILES<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-2" href="#NW0-4erxh5-1" id="NW0-4erxh5-2"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-1">&lt;-</a>D<a href="#NW0-4erxh5-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">*</span>.<span class="opt">[</span>choa<span class="opt">]</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-3" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-3"><dfn>&lt;Clean built files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VdTlf-2">&lt;-</a>D<a href="#NW0-1VdTlf-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>EXEC_FILES<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2s5YyJ-1" href="#NW0-2s5YyJ-1" id="NW0-2s5YyJ-1"><dfn>&lt;Script Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1LbAtL-1" href="#NW0-1LbAtL-1" id="NW0-1LbAtL-1"><dfn>&lt;C Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4f1jeK-2" href="#NW0-4f1jeK-1" id="NW0-4f1jeK-2"><dfn>&lt;Build Source&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-3">&lt;-U</a>)</b> <b>[<a href="#NW0-4f1jeK-1">&lt;-</a>D<a href="#NW0-4f1jeK-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>CFILES<span class="opt">) $(</span>HEADERS<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>

  <p>Scripts and C programs may also be generated as part of the build process, for example to create machine-generated code.</p>
  <pre class="dfn">
<a name="NW0-4NQJhz-5" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-5"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-4">&lt;-</a>D<a href="#NW0-4NQJhz-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
BUILD_SCRIPT_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-5-u1" href="#NW0-3CYAWn-1" id="NW0-4NQJhz-5-u1"><i>&lt;Build Script Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
BUILD_C_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-5-u2" href="#NW0-VUOac-1" id="NW0-4NQJhz-5-u2"><i>&lt;C Build Executables&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4f1jeK-3" href="#NW0-4f1jeK-1" id="NW0-4f1jeK-3"><dfn>&lt;Build Source&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-3">&lt;-U</a>)</b> <b>[<a href="#NW0-4f1jeK-2">&lt;-</a>D<a href="#NW0-4f1jeK-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>BUILD_SCRIPT_EXEC<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-8" href="#NW0-3uTryu-1" id="NW0-3uTryu-8"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-7">&lt;-</a>D<a href="#NW0-3uTryu-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>BUILD_SCRIPT_EXEC<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
        chmod <span class="opt">+</span>x <span class="opt">$</span>@
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-3" href="#NW0-4erxh5-1" id="NW0-4erxh5-3"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-2">&lt;-</a>D<a href="#NW0-4erxh5-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>BUILD_SCRIPT_EXEC<span class="opt">) $(</span>BUILD_C_EXEC<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3CYAWn-1" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-1"><dfn>&lt;Build Script Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[D<a href="#NW0-3CYAWn-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-VUOac-1" href="#NW0-VUOac-1" id="NW0-VUOac-1"><dfn>&lt;C Build Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>

  <p>The local libraries are built using a chunk naming convention. <code><a href="#nw@notdef"><i>&lt;Library <code>name</code> Members&gt;</i></a></code> chunks contain a plain listing of included object files. No support for shared libraries is provided at this time. Ideally, this should ensure that libraries dependent on others are listed earlier in the library order. Instead, the list is printed in reverse order, so the least dependent libraries are printed first.</p>

  <p>Since <tt>tac</tt> may not be available everywhere, an alternative may be specified in <code>makefile.config</code>.</p>
  <pre class="dfn">
<a name="NW0-xNRJd-3" href="#NW0-xNRJd-1" id="NW0-xNRJd-3"><dfn>&lt;Defaults for <code>makefile.config</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-xNRJd-2">&lt;-</a>D<a href="#NW0-xNRJd-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
TACCMD<span class="opt">=</span>tac
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3TUZd-6" href="#NW0-3TUZd-1" id="NW0-3TUZd-6"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-5">&lt;-</a>D<a href="#NW0-3TUZd-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Where to find the non-standard tac command (GNU coreutils)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># or in makefile.config.local</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#TACCMD:=sed -n -e '1!G;h;$$p'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1MIpmy-4" href="#NW0-1MIpmy-1" id="NW0-1MIpmy-4"><dfn>&lt;Build variables for makefile includes&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1MIpmy-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
LOCAL_LIBS_BASE<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB_ORDER<span class="opt">) </span>| \
</pre>
      </li>

      <li>
        <pre>
  sed <span class="opt">-</span>n <span class="str">'s/&lt;&lt;Library \[\[\(.*\)]] Members&gt;&gt;/\1/p'</span> | \
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">$(</span>TACCMD<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
LOCAL_LIBS<span class="opt">:=$(</span>LOCAL_LIBS_BASE<span class="opt">:%=-</span>l<span class="opt">%)</span>
</pre>
      </li>

      <li>
        <pre>
LOCAL_LIB_FILES<span class="opt">:=$(</span>LOCAL_LIBS_BASE<span class="opt">:%=</span>lib<span class="opt">%</span>.a<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-9" href="#NW0-3uTryu-1" id="NW0-3uTryu-9"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-8">&lt;-</a>D<a href="#NW0-3uTryu-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>C_EXEC<span class="opt">): $(</span>LOCAL_LIB_FILES<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>While it would be nice to not have to generate yet another support file for this, notangle is required for this to work. One of the goals of this system is to be able to generate a source tarball that does not depend on notangle.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-A" href="#NW0-3uTryu-1" id="NW0-3uTryu-A"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-9">&lt;-</a>D<a href="#NW0-3uTryu-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#define build-lib</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#lib$(1).a: $(2)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#       rm -f $$@</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#       ar cr $$@ $$^</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#       ranlib $$@</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#endef</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#$(foreach l,$(LOCAL_LIBS_BASE),$(eval $(call build-lib,$l, \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#     $(shell notangle -R'Library [[$l]] Members' $(NOWEB_ORDER) 2&gt;/dev/null))))</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Instead, <code>makefile.libs</code> is generated with the macros expanded.</p>
  <pre class="dfn">
<a name="NW0-1yQJDW-2" href="#NW0-1yQJDW-1" id="NW0-1yQJDW-2"><dfn>&lt;makefile&gt;+=</dfn></a> <b>(<a href="#NW0-1p0Y9w-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1yQJDW-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
MAKEFILES<span class="opt">+=</span>makefile.libs
</pre>
      </li>

      <li>
        <pre>
makefile.libs<span class="opt">: </span>makefile.rules
</pre>
      </li>

      <li>
        <pre>
        for x in <span class="opt">$(</span>LOCAL_LIBS_BASE<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
           printf <span class="opt">%</span>s lib<span class="opt">$</span><span class="kwd">$x</span>.a<span class="opt">:; </span>\
</pre>
      </li>

      <li>
        <pre>
           notangle <span class="opt">-</span>R<span class="str">"Library [[$$x]] Members"</span> <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) </span>| tr <span class="str">'</span><span class="esc">\n</span><span class="str">'</span> <span class="str">' '</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           printf <span class="str">'</span><span class="esc">\n\t</span><span class="str">rm -f $$@</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           printf <span class="str">'</span><span class="esc">\t</span><span class="str">ar cr $$@ $$^</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
           printf <span class="str">'</span><span class="esc">\t</span><span class="str">ranlib $$@</span><span class="esc">\n</span><span class="str">'</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
        done <span class="opt">&gt; $</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">-</span><span class="kwb">include </span>makefile.libs
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-4" href="#NW0-4erxh5-1" id="NW0-4erxh5-4"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-3">&lt;-</a>D<a href="#NW0-4erxh5-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f makefile.libs
</pre>
      </li>
    </ol>
  </div>

  <p>Of course it might be useful to also provide installation rules for selected libraries, as well as their support files (header files and API documentation), but that is left for a future revision.</p>
  <pre class="dfn">
<a name="NW0-3V5yfh-1" href="#NW0-3V5yfh-1" id="NW0-3V5yfh-1"><dfn>&lt;Libraries&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>LOCAL_LIB_FILES<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>

  <p>In addition to distributed binaries, test binaries may be built and executed. Other than checking return codes, no interpretation of test results is supported. It is intended primarily for manual testing. Sample binaries may be placed under these rules, as well.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-B" href="#NW0-3uTryu-1" id="NW0-3uTryu-B"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-A">&lt;-</a>D<a href="#NW0-3uTryu-C">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
.PHONY<span class="opt">: </span><span class="kwa">test </span>test-bin
</pre>
      </li>

      <li>
        <pre>
test-bin<span class="opt">: $(</span>TEST_EXEC<span class="opt">) $(</span>TEST_EXEC_SUPPORT<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>TEST_EXEC<span class="opt">):  $(</span>LIB_FILES<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">test</span><span class="opt">: </span>test-bin
</pre>
      </li>

      <li>
        <pre>
        @set <span class="opt">-</span>e<span class="opt">; </span>for f in <span class="opt">$(</span>TEST_EXEC<span class="opt">); </span>do echo running <span class="opt">$</span><span class="kwd">$f</span><span class="opt">:; </span>.<span class="opt">/$</span><span class="kwd">$f</span><span class="opt">; </span>done
</pre>
      </li>

      <li>
        <pre>
        <a name="NW0-3uTryu-B-u1" href="#NW0-3VrC3R-1" id="NW0-3uTryu-B-u1"><i>&lt;Additional Tests&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-6" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-6"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-5">&lt;-</a>D<a href="#NW0-4NQJhz-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
TEST_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-6-u1" href="#NW0-3uhwgX-1" id="NW0-4NQJhz-6-u1"><i>&lt;Test Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
TEST_C_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-6-u2" href="#NW0-raqlf-1" id="NW0-4NQJhz-6-u2"><i>&lt;C Test Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
TEST_SCRIPT_EXEC<span class="opt">=</span><a name="NW0-4NQJhz-6-u3" href="#NW0-1s7U6w-1" id="NW0-4NQJhz-6-u3"><i>&lt;Test Scripts&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
TEST_EXEC_SUPPORT<span class="opt">=</span><a name="NW0-4NQJhz-6-u4" href="#NW0-1g0sW2-1" id="NW0-4NQJhz-6-u4"><i>&lt;Test Support Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
TEST_C_EXEC_SUPPORT<span class="opt">=</span><a name="NW0-4NQJhz-6-u5" href="#NW0-1RZV9-1" id="NW0-4NQJhz-6-u5"><i>&lt;C Test Support Executables&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
TEST_SCRIPT_EXEC_SUPPORT<span class="opt">=</span><a name="NW0-4NQJhz-6-u6" href="#NW0-1tJ6ue-1" id="NW0-4NQJhz-6-u6"><i>&lt;Test Support Scripts&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uhwgX-1" href="#NW0-3uhwgX-1" id="NW0-3uhwgX-1"><dfn>&lt;Test Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>TEST_C_EXEC<span class="opt">) $(</span>TEST_SCRIPT_EXEC<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-raqlf-1" href="#NW0-raqlf-1" id="NW0-raqlf-1"><dfn>&lt;C Test Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1s7U6w-1" href="#NW0-1s7U6w-1" id="NW0-1s7U6w-1"><dfn>&lt;Test Scripts&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1g0sW2-1" href="#NW0-1g0sW2-1" id="NW0-1g0sW2-1"><dfn>&lt;Test Support Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>TEST_C_EXEC_SUPPORT<span class="opt">) $(</span>TEST_SCRIPT_EXEC_SUPPORT<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1RZV9-1" href="#NW0-1RZV9-1" id="NW0-1RZV9-1"><dfn>&lt;C Test Support Executables&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1tJ6ue-1" href="#NW0-1tJ6ue-1" id="NW0-1tJ6ue-1"><dfn>&lt;Test Support Scripts&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-6">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-C" href="#NW0-3uTryu-1" id="NW0-3uTryu-C"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-B">&lt;-</a>D<a href="#NW0-3uTryu-D">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>TEST_C_EXEC_SUPPORT<span class="opt">) $(</span>TEST_C_EXEC<span class="opt">): $(</span>LOCAL_LIB_FILES<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>TEST_C_EXEC<span class="opt">): $(</span>TEST_C_EXEC_SUPPORT<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>TEST_SCRIPT_EXEC<span class="opt">) $(</span>TEST_SCRIPT_EXEC_SUPPORT<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">-</span>notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
        chmod <span class="opt">+</span>x <span class="opt">$</span>@
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3VrC3R-1" href="#NW0-3VrC3R-1" id="NW0-3VrC3R-1"><dfn>&lt;Additional Tests&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-B">&lt;-U</a>)</b>
</pre>

  <ol class="code"></ol>
  <pre class="dfn">
<a name="NW0-4erxh5-5" href="#NW0-4erxh5-1" id="NW0-4erxh5-5"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-4">&lt;-</a>D<a href="#NW0-4erxh5-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$(</span>TEST_EXEC<span class="opt">) $(</span>TEST_C_EXEC<span class="opt">:%=%</span>.c<span class="opt">) $(</span>TEST_EXEC_SUPPORT<span class="opt">) </span>\
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">$(</span>TEST_C_EXEC_SUPPORT<span class="opt">:%=%</span>.c<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc8" id="toc8">Support Files</a></h3>

  <p>Since <code>noroots</code> may not be on the target system, for example when using the tar file, a close equivalent is provided. This does not properly filter out non-root nodes, but most build operations require specific node names that are not likely to be used anywhere but the root level.</p>

  <p>Makepp has trouble parsing this, so this is disabled for now.</p>
  <pre class="dfn">
<a name="NW0-xNRJd-4" href="#NW0-xNRJd-1" id="NW0-xNRJd-4"><dfn>&lt;Defaults for <code>makefile.config</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1yQJDW-1">&lt;-U</a>)</b> <b>[<a href="#NW0-xNRJd-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
NOROOTS<span class="opt">=</span>noroots
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3TUZd-7" href="#NW0-3TUZd-1" id="NW0-3TUZd-7"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-6">&lt;-</a>D<a href="#NW0-3TUZd-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The noroots command is used to extract file names from $(NOWEB)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># The following works well enough in most cases if noweb is missing</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># or in makefile.config.local</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#NOROOTS=sh -c "sed -n '/^&lt;&lt;.*&gt;&gt;=\$$/{s/=\$$//;p;}' \$$* \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#                                | sort -u" /dev/null</span>
</pre>
      </li>

      <li>
        <pre>
NOROOTS<span class="opt">=</span>noroots
</pre>
      </li>
    </ol>
  </div>

  <p>In fact, when building just the code, it is likely that the only part of NoWeb required is <code>notangle</code>. For this, an equivalent can be provided in <code>perl</code>, which is installed on most modern UNIX systems by default. It is not a perfect emulation, but it should be close enough.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-1" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-1"><dfn>&lt;perl-notangle&gt;=</dfn></a> <b>[D<a href="#NW0-3vfQQs-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#!perl</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This code barely resembles noweb's notangle enough to work for simple builds</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">eval </span><span class="str">'exec perl -x -f "</span><span class="ipl">$0</span><span class="str">" "$@"'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The only recognized command-line options are for tab size (<code>-t</code>) and chunk name (<code>-R</code>), which defaults to <code>*</code>. The remaining parameters are file names, and are left in <code>ARGV</code>.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-2" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-2"><dfn>&lt;perl-notangle&gt;+=</dfn></a> <b>[<a href="#NW0-3vfQQs-1">&lt;-</a>D<a href="#NW0-3vfQQs-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$chunk </span><span class="opt">= </span><span class="str">'*'</span><span class="opt">;  </span><span class="kwc">my </span><span class="kwb">$tab </span><span class="opt">= </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="kwb">$#ARGV </span><span class="opt">&gt; </span><span class="num">0 </span><span class="opt">&amp;&amp; </span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">0</span><span class="opt">] =~ </span><span class="kwd">/^-.*/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">0</span><span class="opt">] =~ </span><span class="kwd">/^-R/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$chunk </span><span class="opt">= </span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">0</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$chunk </span><span class="opt">=~ </span><span class="kwd">s/-R//</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">0</span><span class="opt">] =~ </span><span class="kwd">/^-t(.*)/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$tab </span><span class="opt">= </span><span class="kwb">$1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">shift </span><span class="kwb">@ARGV</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, the files are read (<code>&lt;&gt;</code> just uses all files from <code>ARGV</code>) and raw chunks are extracted. They are stored in a hash keyed on chunk name.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-3" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-3"><dfn>&lt;perl-notangle&gt;+=</dfn></a> <b>[<a href="#NW0-3vfQQs-2">&lt;-</a>D<a href="#NW0-3vfQQs-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="opt">(</span><span class="kwb">$inchunk</span><span class="opt">, </span><span class="kwb">%chunks</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^&lt;&lt;(.*)&gt;&gt;=$/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$inchunk </span><span class="opt">= </span><span class="kwb">$1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwd">/^@( |$)/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$inchunk </span><span class="opt">= </span><span class="str">""</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwb">$inchunk </span><span class="kwc">ne </span><span class="str">""</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$chunks</span><span class="opt">{</span><span class="kwb">$inchunk</span><span class="opt">} .= </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Then, the desired chunk is processed. Any chunk references are repeatedly extracted (using a regular expression) and replaced with their equivalent chunk. Multiline replacements get spaces prepended equivalent to the number of characters before the first line.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-4" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-4"><dfn>&lt;perl-notangle&gt;+=</dfn></a> <b>[<a href="#NW0-3vfQQs-3">&lt;-</a>D<a href="#NW0-3vfQQs-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$chunkout </span><span class="opt">= </span><span class="kwb">$chunks</span><span class="opt">{</span><span class="kwb">$chunk</span><span class="opt">};</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="kwb">$chunkout </span><span class="opt">=~ </span><span class="kwd">/(?:^|\n)(|[^\n]*[^\n@])(?:&lt;&lt;((?:[^&gt;\n]|&gt;[^&gt;\n])*)&gt;&gt;)/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">my </span><span class="kwb">$cv </span><span class="opt">= </span><span class="kwb">$chunks</span><span class="opt">{</span><span class="kwb">$2</span><span class="opt">};</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">my </span><span class="kwb">$ws </span><span class="opt">= </span><span class="kwb">$1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$cv </span><span class="opt">=~ </span><span class="kwd">s/\n$//</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$ws </span><span class="opt">=~ </span><span class="kwd">s/\S/ /g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$cv </span><span class="opt">=~ </span><span class="kwd">s/\n/$&amp;$ws/g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$chunkout </span><span class="opt">=~ </span><span class="kwd">s/(^|[^@])(&lt;&lt;(([^&gt;\n]|&gt;[^&gt;\n])*)&gt;&gt;)/$1$cv/</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, any final escapes are undone. NoWeb requires (and strips) escapes for <code>&lt;&lt;</code> and <code>&gt;&gt;</code>. Also, if the tab option was specified, initial groups of spaces equal to the tab size are replaced with tabs.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-5" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-5"><dfn>&lt;perl-notangle&gt;+=</dfn></a> <b>[<a href="#NW0-3vfQQs-4">&lt;-</a>D<a href="#NW0-3vfQQs-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">$chunkout </span><span class="opt">=~ </span><span class="kwd">s/@(&lt;&lt;|&gt;&gt;)/\1/g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">$chunkout </span><span class="opt">=~ </span><span class="kwd">s/((^|\n)\t*) {$tab}/$1\t/g </span><span class="kwa">if</span><span class="opt">(</span><span class="kwb">$tab </span><span class="kwc">gt </span><span class="num">0</span><span class="opt">);</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, the result is printed to standard output.</p>
  <pre class="dfn">
<a name="NW0-3vfQQs-6" href="#NW0-3vfQQs-1" id="NW0-3vfQQs-6"><dfn>&lt;perl-notangle&gt;+=</dfn></a> <b>[<a href="#NW0-3vfQQs-5">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">print </span><span class="kwb">$chunkout</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In order to avoid having to duplicate function prototypes in the main code and a header, the prototypes are generated automatically using cproto <sup><a href="#fn5">5</a></sup> . This uses the GNU make method of generating rules: <code>$(eval)</code>. Makepp does not support this.</p>

  <p>The Makepp documentation claims that <code>$(eval)</code> can be replaced by <code>$[...]</code>, but my own experiments have shown me that this does not work: variables are not expanded correctly, and only one rule may be generated at a time (i.e., newlines are stripped out, even if they are explicitly added via perl code). In fact, using <code>$(...)</code> works fine for one rule, but is broken for multiple rules because, once again, newlines are stripped out. So, instead, it copies Makepp's code for adding a dependency directly. This is liable to break with different versions of Makepp, but it at least works with version 2.0.</p>

  <p>Another Makepp issue triggered here was the original method of creating a temporary file, and then moving it to <code>cproto.h</code>. Makepp decided to add a rule dependency on the temporary file's name, which could not be removed or overridden. Now it just makes sure it got deleted on errors.</p>

  <p>Of course there are times when blind prototype creation is undesirable. For example, libraries tend to place prototypes in headers. Some of them may use datatypes which are not defined in every C file. To allow this, any prototypes detected in a header with the exact same syntax as automatically generated, up to the arguments' opening parenthesis, is removed from <code>cproto.h</code>. One which tends to vary from mainline to mainline is <code>main</code>, so it is always removed.</p>

  <p>Also, local prototypes tend to rely on locally defined data types. To support this, the entire include of the static prototype file can be moved down to a location specified by a line containing only the comment <code>// static_proto</code>.</p>

  <p>This uses the GNU <code>-i</code> extension, which may not be supported on all UNIX systems. If it doesn't, obtaining and using GNU sed is free and relatively painless. GNU sed also does not have a hidden line length limit or other misfeatures of other sed implementations, so I recommend using it all the time.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-D" href="#NW0-3uTryu-1" id="NW0-3uTryu-D"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-C">&lt;-</a>D<a href="#NW0-3uTryu-E">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>COFILES<span class="opt">): $(</span>HEADERS<span class="opt">) </span>cproto.h
</pre>
      </li>

      <li>
        <pre>
cproto.h<span class="opt">: $(</span>CFILES<span class="opt">) $(</span>HEADERS<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        echo <span class="opt">&gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">test </span><span class="opt">-</span>z <span class="str">"$(CFILES)"</span> || <span class="opt">( </span>\
</pre>
      </li>

      <li>
        <pre>
           if cproto <span class="opt">-</span>E <span class="str">"$(CC) $(CFLAGS) $(EXTRA_CFLAGS) -E"</span> \
</pre>
      </li>

      <li>
        <pre>
                       <span class="opt">$(</span>CFILES<span class="opt">) &gt;$</span>@.<span class="opt">$$$$</span>.h <span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span>then \
</pre>
      </li>

      <li>
        <pre>
            sed <span class="opt">-</span>i <span class="opt">-</span>e <span class="str">'/^int main(/d'</span> <span class="opt">$</span>@.<span class="opt">$$$$</span>.h<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
            grep <span class="opt">-</span>vn <span class="str">'^/\*'</span> <span class="opt">$</span>@.<span class="opt">$$$$</span>.h | <span class="opt">$(</span>TACCMD<span class="opt">) </span>| \
</pre>
      </li>

      <li>
        <pre>
              sed <span class="opt">-</span>e <span class="str">'<a name="NW0-3uTryu-D-u1" href="#NW0-KgxbP-1" id="NW0-3uTryu-D-u1"><i>&lt;Strip down C prototype&gt;</i></a>'</span> | \
</pre>
      </li>

      <li>
        <pre>
                while IFS<span class="opt">=: </span>read <span class="opt">-</span>r l p<span class="opt">; </span>do \
</pre>
      </li>

      <li>
        <pre>
                  <span class="kwa">test </span><span class="opt">-</span>z <span class="str">"$$p"</span> <span class="opt">&amp;&amp; </span>continue<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                  fgrep <span class="str">"$$p"</span> <span class="opt">$(</span>HEADERS<span class="opt">) </span>| fgrep <span class="str">":$$p"</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="opt">&amp;&amp; </span>\
</pre>
      </li>

      <li>
        <pre>
                    sed <span class="opt">-</span>i <span class="opt">-</span>e <span class="str">"$${l}d"</span> <span class="opt">$</span>@.<span class="opt">$$$$</span>.h<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                done<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
            mv <span class="opt">$</span>@.<span class="opt">$$$$</span>.h <span class="opt">$</span>@<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          <span class="kwb">else </span>\
</pre>
      </li>

      <li>
        <pre>
            <span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$</span>@ <span class="opt">$</span>@.<span class="opt">$$$$</span>.h<span class="opt">; </span>false<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          fi <span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>MAKEPP_VERSION<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
static_proto_rule<span class="opt">=</span><span class="kwd">$1</span><span class="opt">: $(</span><span class="num">1</span><span class="opt">:%</span>.o<span class="opt">=%</span>.c.static_proto<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>COFILES<span class="opt">),$(</span>eval <span class="opt">$(</span>call static_proto_rule<span class="opt">,</span><span class="kwd">$f</span><span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">else</span>
</pre>
      </li>

      <li>
        <pre>
sub f_adddep <span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  my <span class="opt">(</span><span class="kwd">$targ</span><span class="opt">, </span><span class="kwd">$dep</span><span class="opt">) = &amp;</span>args<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  my <span class="opt">(</span>undef<span class="opt">, </span><span class="kwd">$mkfile</span><span class="opt">, </span><span class="kwd">$mkline</span><span class="opt">) = </span>@_<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  my <span class="kwd">$tinfo </span><span class="opt">= </span>Mpp<span class="opt">::</span>File<span class="opt">::</span>file_info <span class="kwd">$targ</span><span class="opt">, </span><span class="kwd">$mkfile</span><span class="opt">-&gt;{</span>CWD<span class="opt">};</span>
</pre>
      </li>

      <li>
        <pre>
  Mpp<span class="opt">::</span>File<span class="opt">::</span>set_additional_dependencies<span class="opt">(</span><span class="kwd">$tinfo</span><span class="opt">, </span><span class="kwd">$dep</span><span class="opt">, </span><span class="kwd">$mkfile</span><span class="opt">, </span><span class="kwd">$mkline</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  return <span class="str">''</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>COFILES<span class="opt">),$(</span>adddep <span class="kwd">$f</span><span class="opt">,$(</span>f<span class="opt">:%</span>.o<span class="opt">=%</span>.c.static_proto<span class="opt">)))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>

      <li>
        <pre>
cproto.h<span class="opt">: $(</span>CFILES<span class="opt">:%=%</span>.static_proto<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.c.static_proto<span class="opt">: %</span>.c
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">( </span>\
</pre>
      </li>

      <li>
        <pre>
          notangle <span class="opt">-</span>R<span class="opt">$&lt;</span>.static_proto <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null || <span class="opt">:; </span>\
</pre>
      </li>

      <li>
        <pre>
          cproto <span class="opt">-</span>S <span class="opt">-</span>E <span class="str">"$(CC) $(CFLAGS) $(EXTRA_CFLAGS) -E"</span> <span class="opt">$&lt; </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null \
</pre>
      </li>

      <li>
        <pre>
        <span class="opt">) &gt;$</span>@ || <span class="opt">(</span><span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$</span>@<span class="opt">; </span>false<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4f1jeK-4" href="#NW0-4f1jeK-1" id="NW0-4f1jeK-4"><dfn>&lt;Build Source&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-3">&lt;-U</a>)</b> <b>[<a href="#NW0-4f1jeK-3">&lt;-</a>D<a href="#NW0-4f1jeK-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
cproto.h \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-6" href="#NW0-4erxh5-1" id="NW0-4erxh5-6"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-5">&lt;-</a>D<a href="#NW0-4erxh5-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f cproto.h.new <span class="opt">*</span>.c.static_proto<span class="opt">{,</span>.new<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-7" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-7"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-6">&lt;-</a>D<a href="#NW0-4NQJhz-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
C_POSTPROCESS <span class="opt">= </span>| <span class="opt">(</span>tf<span class="opt">=</span><span class="str">"/tmp/.$$$$"</span><span class="opt">; </span>trap <span class="str">"rm $$tf"</span> <span class="num">0</span><span class="opt">; </span>cat <span class="opt">&gt;$</span><span class="kwd">$tf</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   if grep <span class="str">'^[ </span><span class="esc">\t</span><span class="str">]*// static_proto$$'</span> <span class="str">"$$tf"</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span>then \
</pre>
      </li>

      <li>
        <pre>
                     p<span class="opt">=</span><span class="str">'^[ </span><span class="esc">\t</span><span class="str">]*// static_proto$$'</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   <span class="kwb">else </span>\
</pre>
      </li>

      <li>
        <pre>
                     p<span class="opt">=</span><span class="str">'^\#include "cproto.h"'</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   fi<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
                   sed <span class="opt">-</span>e <span class="str">"s%$$p%"</span><span class="str">'&amp;</span><span class="esc">\n</span><span class="str">\#include "$1.static_proto"%'</span> <span class="opt">$</span><span class="kwd">$tf</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4f1jeK-5" href="#NW0-4f1jeK-1" id="NW0-4f1jeK-5"><dfn>&lt;Build Source&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-3">&lt;-U</a>)</b> <b>[<a href="#NW0-4f1jeK-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>CFILES<span class="opt">:%=%</span>.static_proto<span class="opt">) </span>\
</pre>
      </li>
    </ol>
  </div>

  <p>Stripping down the C prototype requires proper handling of nested parentheses in the prameter list. This is done by repeatedly trying to strip the parameter list as if there were no nested parentheses, and if that fails, find the last pair of parentheses with no nested parentheses and remove them. The loop should eventually clear the parameter list of any nested parentheses, allowing the first substitution to succeed.</p>
  <pre class="dfn">
<a name="NW0-KgxbP-1" href="#NW0-KgxbP-1" id="NW0-KgxbP-1"><dfn>&lt;Strip down C prototype&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-D">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
/(/{:a s/([^)]*);/(/;t;s/\(.*\)([^)]*)/\<span class="num">1</span>/;ta;}
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc9" id="toc9">Support Chunks</a></h3>

  <p>In addition, C files can all take advantage of the fact that most headers are harmless to include, so it's easier to just include everything everywhere. The prototypes cannot be included in this list, because they really need to come last.</p>
  <pre class="dfn">
<a name="NW0-Es3AF-1" href="#NW0-Es3AF-1" id="NW0-Es3AF-1"><dfn>&lt;Common C Includes&gt;=</dfn></a> <b>(<a href="#NW0-2HdDm1-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="ppc">#include &lt;stdio.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;stdlib.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;stddef.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;unistd.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;string.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;ctype.h&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include &lt;errno.h&gt;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2Aa10L-1" href="#NW0-2Aa10L-1" id="NW0-2Aa10L-1"><dfn>&lt;Common C Warning&gt;=</dfn></a> <b>(<a href="#NW0-2HdDm1-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="com">/*</span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">  <a name="NW0-2Aa10L-1-u1" href="#NW0-3IzIGd-1" id="NW0-2Aa10L-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="com">*/</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2HdDm1-1" href="#NW0-2HdDm1-1" id="NW0-2HdDm1-1"><dfn>&lt;Common C Header&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-2HdDm1-1-u1" href="#NW0-2Aa10L-1" id="NW0-2HdDm1-1-u1"><i>&lt;Common C Warning&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-2HdDm1-1-u2" href="#NW0-Es3AF-1" id="NW0-2HdDm1-1-u2"><i>&lt;Common C Includes&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="ppc">#include </span><span class="pps">"cproto.h"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">static const char </span>version_id<span class="opt">[] = <a name="NW0-2HdDm1-1-u3" href="#NW0-3gqQRM-1" id="NW0-2HdDm1-1-u3"><i>&lt;Version Strings&gt;</i></a>;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3gqQRM-1" href="#NW0-3gqQRM-1" id="NW0-3gqQRM-1"><dfn>&lt;Version Strings&gt;=</dfn></a> <b>(<a href="#NW0-2HdDm1-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="str">"$Id: build.nw 160 2012-11-22 21:07:26Z darktjm $</span><span class="esc">\n</span><span class="str">"</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Some of those prototypes are hard to enable, but here are a few extra flags to help.</p>
  <pre class="dfn">
<a name="NW0-4NQJhz-8" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-8"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-7">&lt;-</a>D<a href="#NW0-4NQJhz-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
EXTRA_CFLAGS <span class="opt">+= -</span>D_LARGEFILE_SOURCE <span class="opt">-</span>D_XOPEN_SOURCE<span class="opt">=</span><span class="num">600 </span>\
</pre>
      </li>

      <li>
        <pre>
                <span class="opt">-</span>D_XOPEN_SOURCE_EXTENDED<span class="opt">=</span><span class="num">1</span>
</pre>
      </li>
    </ol>
  </div>

  <h2><a name="toc10" id="toc10">PDF Code Documentation</a></h2>

  <p>Building the PDF code documentation is simple: just convert to LaTeX using <code>noweave</code>, and then convert to PDF using <code>pdflatex</code> or <code>xelatex</code>. The conversion needs to be invoked repeatedly until the cross references (and other things, such as <code>longtable</code> measurements) settle down. Of course the figures need to be converted to the appropriate format, too. Rules are provided for EPS, xfig, and dia diagrams, since they can be stored in-line in the NoWeb source; additional rules can be provided for other image formats. Once again, the use of <code>$(eval)</code> requires special processing for Makepp.</p>

  <p>In order to support attachments, the <code>xelatex</code> backend may need to be informed of the file location. This should include the current directory by default, but a common `security' measure is to remove the current directory from the default configuration file search path, which removes it from the attachment search path as a side effect. Rather than hard-code the backend and configuration path, a note is added to the config file so the user can set the environment variable appropriately (which also coincidentally overrides the security feature, as well).</p>
  <pre class="dfn">
<a name="NW0-3TUZd-8" href="#NW0-3TUZd-1" id="NW0-3TUZd-8"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-7">&lt;-</a>D<a href="#NW0-3TUZd-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># The PDF command to use: must be pdflatex or xelatex.</span>
</pre>
      </li>

      <li>
        <pre>
LATEXCMD<span class="opt">=</span>pdflatex
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># note: to use attachments with xetex, the following may be necessary:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#LATEXCMD=env DVIPDFMXINPUTS=.:\$$TEXMF/dvipdfmx/ xelatex</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-9" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-9"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-8">&lt;-</a>D<a href="#NW0-4NQJhz-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
NOWEB_NINCL<span class="opt">:=$(</span><span class="kwa">shell </span>\
</pre>
      </li>

      <li>
        <pre>
  for x in <span class="opt">$(</span>NOWEB<span class="opt">); </span>do \
</pre>
      </li>

      <li>
        <pre>
    grep <span class="str">'^</span><span class="esc">\\</span><span class="str">input{'</span><span class="str">"$$x"</span><span class="str">'}$$'</span> <span class="opt">$(</span>NOWEB<span class="opt">) &gt;/</span>dev<span class="opt">/</span>null <span class="opt">&amp;&amp; </span>continue<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
    echo <span class="str">"$$x"</span><span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
  done<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-42a72-1" href="#NW0-42a72-1" id="NW0-42a72-1"><dfn>&lt;Source Code Documentation Files&gt;=</dfn></a> <b>(<a href="#NW0-4NQJhz-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-42a72-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span><span class="kwa">patsubst </span><span class="opt">%</span>.nw<span class="opt">,%</span>.pdf<span class="opt">,$(</span>NOWEB_NINCL<span class="opt">)) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-E" href="#NW0-3uTryu-1" id="NW0-3uTryu-E"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-D">&lt;-</a>D<a href="#NW0-3uTryu-F">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># returns names of \input'd files</span>
</pre>
      </li>

      <li>
        <pre>
inc_f<span class="opt">=$(</span><span class="kwa">shell </span>sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'s/^</span><span class="esc">\\</span><span class="str">input{\(.*\.nw\)}$$/\1/p'</span> <span class="kwd">$1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># returns self and any files \input'd, recursively</span>
</pre>
      </li>

      <li>
        <pre>
inc_all<span class="opt">=</span><span class="kwd">$1 </span><span class="opt">$(</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>call inc_f<span class="opt">,</span><span class="kwd">$1</span><span class="opt">),$(</span>call inc_all<span class="opt">,</span><span class="kwd">$f</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
figs<span class="opt">=$(</span><span class="kwa">shell </span>sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'s/^</span><span class="esc">\\</span><span class="str">includegraphics.*{\(.*\)}$$/\1/p'</span> \
</pre>
      </li>

      <li>
        <pre>
       <span class="opt">$(</span>call inc_all<span class="opt">,</span><span class="kwd">$1</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>MAKEPP_VERSION<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
pdf_figrule<span class="opt">=$(</span>if <span class="kwd">$2</span><span class="opt">,$(</span><span class="kwa">basename </span><span class="kwd">$1</span><span class="opt">)</span>.pdf<span class="opt">: $(</span><span class="kwa">patsubst </span><span class="opt">%,%</span>.pdf<span class="opt">,</span><span class="kwd">$2</span><span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>NOWEB_NINCL<span class="opt">),$(</span>eval <span class="opt">$(</span>call pdf_figrule<span class="opt">,</span><span class="kwd">$f</span><span class="opt">,$(</span>call figs<span class="opt">,</span><span class="kwd">$f</span><span class="opt">))))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$((</span><span class="kwa">foreach </span>f<span class="opt">,$(</span>NOWEB_NINCL<span class="opt">),</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="opt">$(</span><span class="kwa">foreach </span>d<span class="opt">,$(</span>call figs<span class="opt">,</span><span class="kwd">$f</span><span class="opt">),$(</span>adddep <span class="opt">$(</span><span class="kwa">basename </span><span class="kwd">$f</span><span class="opt">)</span>.pdf<span class="opt">,</span><span class="kwd">$d</span>.pdf<span class="opt">))))</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># attempt to pull in multi-line messages, each line starts with same char</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># but remove xparse/.*define-command messages, even though they</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># are the only messages known to look like that</span>
</pre>
      </li>

      <li>
        <pre>
LMSCMD <span class="opt">= /</span>xparse\<span class="opt">/</span>.<span class="opt">*</span>define-command<span class="opt">/</span>b<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         s<span class="opt">/</span>LaTeX <span class="kwd">$1</span><span class="opt">/&amp;/</span>i<span class="opt">;</span>T<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         p<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         s<span class="opt">/</span>^\<span class="opt">([</span>^ <span class="opt">]</span>\<span class="opt">) </span>LaTeX.<span class="opt">*/</span>\<span class="num">1</span><span class="opt">/;</span>T<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         h<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">:</span>a N<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         s<span class="opt">/</span>\<span class="opt">(</span>.\<span class="opt">)</span><span class="esc">\n</span>\<span class="num">1</span><span class="opt">/</span>\<span class="num">1</span><span class="opt">/;</span>T<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
         p<span class="opt">;</span>g<span class="opt">;</span>ba<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.pdf<span class="opt">: %</span>.<span class="kwa">tex</span>
</pre>
      </li>

      <li>
        <pre>
        while <span class="opt">$(</span>LATEXCMD<span class="opt">) -</span>interaction batchmode <span class="opt">$&lt; &gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span>do \
</pre>
      </li>

      <li>
        <pre>
          egrep <span class="opt">$(</span>LATEX_REDO_MSG<span class="opt">) $*</span>.log <span class="opt">&gt;/</span>dev<span class="opt">/</span>null || break<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">test </span><span class="opt">-</span>f <span class="opt">$*</span>.idx <span class="opt">&amp;&amp; </span>makeindex <span class="opt">$(</span>INDEX_FLAGS<span class="opt">) -</span>q <span class="opt">$*; </span>\
</pre>
      </li>

      <li>
        <pre>
          fgrep <span class="str">'\citation'</span> <span class="opt">$*</span>.aux || continue<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          fgrep <span class="str">'</span><span class="esc">\b</span><span class="str">ibdata'</span> <span class="opt">$*</span>.aux <span class="opt">&amp;&amp; </span>bibtex <span class="opt">$*; </span>\
</pre>
      </li>

      <li>
        <pre>
        done
</pre>
      </li>

      <li>
        <pre>
        @sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'$(call LMSCMD,info)'</span> <span class="opt">$*</span>.log
</pre>
      </li>

      <li>
        <pre>
        @fgrep <span class="opt">-</span>i overfull <span class="opt">$*</span>.log || <span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        @fgrep <span class="opt">-</span>i underfull <span class="opt">$*</span>.log | fgrep <span class="opt">-</span>v vbox || <span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
        @sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'$(call LMSCMD,warning)'</span> <span class="opt">$*</span>.log
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc"># maybe removing output file is too drastic, but manual run of</span>
</pre>
      </li>

      <li>
        <pre>
        @<span class="slc"># pdflatex is not that hard</span>
</pre>
      </li>

      <li>
        <pre>
        @if sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'/^!.*Error/,/^l./p'</span> <span class="opt">$*</span>.log | grep .<span class="opt">; </span>then \
</pre>
      </li>

      <li>
        <pre>
          <span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">$</span>@<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
          false<span class="opt">; </span>\
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">else </span>\
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">:; </span>\
</pre>
      </li>

      <li>
        <pre>
        fi
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-A" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-A"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-9">&lt;-</a>D<a href="#NW0-4NQJhz-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># picks up changes in references or long tables</span>
</pre>
      </li>

      <li>
        <pre>
LATEX_REDO_MSG<span class="opt">:=</span><span class="str">" ha(s|ve) changed. Rerun[ .]"</span>
</pre>
      </li>

      <li>
        <pre>
FIGS<span class="opt">:=$(</span><span class="kwa">shell </span>sed <span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'s/^</span><span class="esc">\\</span><span class="str">includegraphics.*{\(.*\)}$$/\1/p'</span> <span class="opt">$(</span>NOWEB<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
FIGS_EPS<span class="opt">:=$(</span><span class="kwa">patsubst </span><span class="opt">%, %</span>.eps<span class="opt">, $(</span>FIGS<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
FIGS_PDF<span class="opt">:=$(</span><span class="kwa">patsubst </span><span class="opt">%, %</span>.pdf<span class="opt">, $(</span>FIGS<span class="opt">))</span>
</pre>
      </li>

      <li>
        <pre>
FIGS_DIA<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="opt">-</span>n <span class="str">'/\.dia&gt;&gt;/{s/&lt;&lt;//;s/&gt;&gt;//;p;}'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
FIGS_XFIG<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="opt">-</span>n <span class="str">'/\.fig&gt;&gt;/{s/&lt;&lt;//;s/&gt;&gt;//;p;}'</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
FIGS_EPS_RAW<span class="opt">:=$(</span><span class="kwa">shell </span><span class="opt">$(</span>NOROOTS<span class="opt">) $(</span>NOWEB<span class="opt">) </span>| sed <span class="opt">-</span>n <span class="str">'/\.eps&gt;&gt;/{s/&lt;&lt;//;s/&gt;&gt;//;p;}'</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-F" href="#NW0-3uTryu-1" id="NW0-3uTryu-F"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-E">&lt;-</a>D<a href="#NW0-3uTryu-G">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span>FIGS_DIA<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) </span>| gzip <span class="opt">&gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.eps<span class="opt">: %</span>.dia
</pre>
      </li>

      <li>
        <pre>
        dia <span class="opt">-</span>e <span class="opt">$</span>@ <span class="opt">$&lt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>FIGS_EPS_RAW<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>FIGS_XFIG<span class="opt">): $(</span>NOWEB<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        notangle <span class="opt">-</span>R<span class="opt">$</span>@ <span class="opt">$(</span>NOWEB_ORDER<span class="opt">) &gt;$</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.eps<span class="opt">: %</span>.fig
</pre>
      </li>

      <li>
        <pre>
        fig2dev <span class="opt">-</span>L eps <span class="opt">$&lt; $</span>@
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.pdf<span class="opt">: %</span>.eps
</pre>
      </li>

      <li>
        <pre>
        epspdf <span class="opt">$&lt; </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null || epstopdf <span class="opt">$&lt;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="slc"># epstopdf gives no return code on errors, so:</span>
</pre>
      </li>

      <li>
        <pre>
        pdfinfo <span class="opt">$</span>@ <span class="opt">&gt;/</span>dev<span class="opt">/</span>null
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-7" href="#NW0-4erxh5-1" id="NW0-4erxh5-7"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-6">&lt;-</a>D<a href="#NW0-4erxh5-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">*</span>.<span class="opt">{</span>log<span class="opt">,</span>aux<span class="opt">,</span>out<span class="opt">,</span>toc<span class="opt">,</span>lof<span class="opt">,</span><span class="kwa">tex</span><span class="opt">,</span>dia<span class="opt">,</span>eps<span class="opt">} $(</span>FIGS_PDF<span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-4" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-4"><dfn>&lt;Clean built files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VdTlf-3">&lt;-</a>D<a href="#NW0-1VdTlf-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">*</span>.pdf
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc11" id="toc11">Pretty Printing Wrapper</a></h3>

  <p>Or at least it should be simple, but some additional adjustments of the standard NoWeb process need to be made. For one thing, NoWeb does not pretty-print code chunks natively, so pretty-printing the code chunks requires a bit of work. A generic code chunk formatter filter for NoWeb is used for this. Like all noweb filters, it just sucks in the marked up form of the NoWeb source and spits out the same, with modifications. The language is tracked so that the formatter can behave differently depending on language.</p>
  <pre class="dfn">
<a name="NW0-3CYAWn-2" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-2"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-1">&lt;-</a>D<a href="#NW0-3CYAWn-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nwweavefilt \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-lrTIc-1" href="#NW0-lrTIc-1" id="NW0-lrTIc-1"><dfn>&lt;Common Perl Prefix&gt;=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#!perl</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-lrTIc-1-u1" href="#NW0-3IzIGd-1" id="NW0-lrTIc-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">eval </span><span class="str">'exec perl -x -f "</span><span class="ipl">$0</span><span class="str">" "$@"'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">use </span>strict<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1ey5ZX-1" href="#NW0-1ey5ZX-1" id="NW0-1ey5ZX-1"><dfn>&lt;nwweavefilt&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt"><a name="NW0-1ey5ZX-1-u1" href="#NW0-lrTIc-1" id="NW0-1ey5ZX-1-u1"><i>&lt;Common Perl Prefix&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-1ey5ZX-1-u2" href="#NW0-37vqZD-1" id="NW0-1ey5ZX-1-u2"><i>&lt;Initialize <code>nwweavefilt</code>&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;</span>STDIN<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1ey5ZX-1-u3" href="#NW0-4N5W31-1" id="NW0-1ey5ZX-1-u3"><i>&lt;Filter lines from NoWeb token stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="kwb">$_</span><span class="opt">; </span><span class="slc"># print most lines</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-1ey5ZX-1-u4" href="#NW0-3henEn-1" id="NW0-1ey5ZX-1-u4"><i>&lt;Process lines from NoWeb token stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Language is determined by scanning for language settings from the listings package, which may be commented out if the listings package isn't currently being used.</p>
  <pre class="dfn">
<a name="NW0-37vqZD-1" href="#NW0-37vqZD-1" id="NW0-37vqZD-1"><dfn>&lt;Initialize <code>nwweavefilt</code>&gt;=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-37vqZD-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$lang </span><span class="opt">= </span><span class="str">'txt'</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3henEn-1" href="#NW0-3henEn-1" id="NW0-3henEn-1"><dfn>&lt;Process lines from NoWeb token stream&gt;=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3henEn-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># [^{] is to prevent self-match</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">/lstset{language=(?:.*\])?([^}]*)[^{]*/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$lang </span><span class="opt">= </span><span class="kwc">lc </span><span class="kwb">$1</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A code chunk begins with the chunk name, which can be ignored. After that, all lines are sucked in as part of the code, until the end of the chunk.</p>
  <pre class="dfn">
<a name="NW0-3henEn-2" href="#NW0-3henEn-1" id="NW0-3henEn-2"><dfn>&lt;Process lines from NoWeb token stream&gt;+=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3henEn-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^\@begin code/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># skip @defn</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$_ </span><span class="opt">= &lt;</span>STDIN<span class="opt">&gt; </span><span class="kwc">or </span><span class="kwa">last</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3henEn-2-u1" href="#NW0-4N5W31-1" id="NW0-3henEn-2-u1"><i>&lt;Filter lines from NoWeb token stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># skip @nl</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$_ </span><span class="opt">= &lt;</span>STDIN<span class="opt">&gt; </span><span class="kwc">or </span><span class="kwa">last</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3henEn-2-u2" href="#NW0-4N5W31-1" id="NW0-3henEn-2-u2"><i>&lt;Filter lines from NoWeb token stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># accumulate code in $code</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">my </span><span class="kwb">$code </span><span class="opt">= </span><span class="str">''</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3henEn-2-u3" href="#NW0-krEPi-1" id="NW0-3henEn-2-u3"><i>&lt;Accumulate code for highlighting&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-3henEn-2-u4" href="#NW0-7TmX8-1" id="NW0-3henEn-2-u4"><i>&lt;Highlight accumulated code&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Chunk references (<code>@use</code>) are replaced with a marker in the code that should work with most dumb code formatters. The marker is later replaced by the <code>@use</code> in the output stream. The marker can be any unique string that isn't likely to appear in code. No matter what is chosen, some bits of code will probably need to be modified to ensure the pattern never appears. For now, this uses tripled caret (<code>^</code>) characters. Other characters that might've worked are doubled or tripled at signs (<code>@</code>), tildes (<code>~</code>), or backticks (<code>`</code>). Index definitions are moved to the bottom of the chunk rather than being marked and replaced like <code>@use</code>; this removes the immediate context, but also eliminates highlighter confusion.</p>
  <pre class="dfn">
<a name="NW0-37vqZD-2" href="#NW0-37vqZD-1" id="NW0-37vqZD-2"><dfn>&lt;Initialize <code>nwweavefilt</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[<a href="#NW0-37vqZD-1">&lt;-</a>D<a href="#NW0-37vqZD-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$marker </span><span class="opt">= </span><span class="str">'^'</span><span class="opt">.</span><span class="str">'^^'</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-krEPi-1" href="#NW0-krEPi-1" id="NW0-krEPi-1"><dfn>&lt;Accumulate code for highlighting&gt;=</dfn></a> <b>(<a href="#NW0-3henEn-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># accumulate @use in @use</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">@use</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># accumulate index defns in $end</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$end </span><span class="opt">= </span><span class="str">''</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;</span>STDIN<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-krEPi-1-u1" href="#NW0-4N5W31-1" id="NW0-krEPi-1-u1"><i>&lt;Filter lines from NoWeb token stream&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^\@text/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">s/^\@text //</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">s/\n//</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$code </span><span class="opt">.= </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwb">$_ </span><span class="kwc">eq </span><span class="str">"\</span><span class="ipl">@nl</span><span class="esc">\n</span><span class="str">"</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$code </span><span class="opt">.= </span><span class="str">"</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwd">/^\@index ((local|)defn|nl)/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$end </span><span class="opt">.= </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwd">/^\@(use|index|xref)/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$code </span><span class="opt">.= </span><span class="kwb">$marker</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">push </span><span class="kwb">@use</span><span class="opt">, </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">elsif</span><span class="opt">(</span><span class="kwd">/^\@end/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">push </span><span class="kwb">@use</span><span class="opt">, </span><span class="kwb">$end </span><span class="opt">. </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">last</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span>STDERR <span class="str">" ????? "</span> <span class="opt">. </span><span class="kwb">$_ </span><span class="opt">. </span><span class="str">" ?????</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The prettifier is passed in on the command line; it takes one (additional) argument - the name of the current language. It takes raw code (with markers for chunk references), and returns pretty code. Steps must be taken by the prettifier to ensure that the markers remain intact. The output of the prettifier is placed in the NoWeb stream as <code>@literal</code> lines <sup><a href="#fn6">6</a></sup> ; markers are replaced by the appropriate <code>@use</code> line from <code>$use</code>.</p>

  <p>The whole reason this was written in perl, rather than shell or awk, was to get speed (which awk already gave over the shell) and bidirectional pipes. This requires the <code>open2()</code> function. In addition, the command is passed as individual arguments, gaining a little more speed by not calling the shell to parse the command at every invocation.</p>
  <pre class="dfn">
<a name="NW0-37vqZD-3" href="#NW0-37vqZD-1" id="NW0-37vqZD-3"><dfn>&lt;Initialize <code>nwweavefilt</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[<a href="#NW0-37vqZD-2">&lt;-</a>D<a href="#NW0-37vqZD-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">use </span>FileHandle<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">use </span>IPC<span class="opt">::</span>Open2<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># first arg is name of highlighting helper</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$filt </span><span class="opt">= </span><span class="kwc">shift </span><span class="kwb">@ARGV</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-7TmX8-1" href="#NW0-7TmX8-1" id="NW0-7TmX8-1"><dfn>&lt;Highlight accumulated code&gt;=</dfn></a> <b>(<a href="#NW0-3henEn-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="opt">(</span><span class="kwb">$pid</span><span class="opt">, </span><span class="kwb">$reader</span><span class="opt">, </span><span class="kwb">$writer</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">$pid </span><span class="opt">= </span>open2<span class="opt">(</span><span class="kwb">$reader</span><span class="opt">, </span><span class="kwb">$writer</span><span class="opt">, </span><span class="kwb">$filt</span><span class="opt">, </span><span class="kwb">$lang</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">print </span><span class="kwb">$writer $code</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">close </span><span class="kwb">$writer</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;</span><span class="kwb">$reader</span><span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">((</span><span class="kwc">my </span><span class="kwb">$m </span><span class="opt">= </span><span class="kwc">index</span><span class="opt">(</span><span class="kwb">$_</span><span class="opt">, </span><span class="kwb">$marker</span><span class="opt">)) &gt;= </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwb">$m </span><span class="opt">&gt; </span><span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">print </span><span class="str">'</span><span class="ipl">@literal </span><span class="str">'</span> <span class="opt">. </span><span class="kwc">substr</span><span class="opt">(</span><span class="kwb">$_</span><span class="opt">, </span><span class="num">0</span><span class="opt">, </span><span class="kwb">$m</span><span class="opt">) . </span><span class="str">"</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print shift </span><span class="kwb">@use</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$_ </span><span class="opt">= </span><span class="kwc">substr</span><span class="opt">(</span><span class="kwb">$_</span><span class="opt">, </span><span class="kwb">$m </span><span class="opt">+ </span><span class="kwc">length</span><span class="opt">(</span><span class="kwb">$marker</span><span class="opt">));</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwc">length</span><span class="opt">(</span><span class="kwb">$_</span><span class="opt">) &gt; </span><span class="num">1</span><span class="opt">) { </span><span class="slc"># 1 == just \n</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">'</span><span class="ipl">@literal </span><span class="str">'</span> <span class="opt">. </span><span class="kwb">$_</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="str">"\</span><span class="ipl">@nl</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">print shift </span><span class="kwb">@use</span><span class="opt">; </span><span class="slc"># the end</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">close </span><span class="kwb">$reader</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">waitpid </span><span class="kwb">$pid</span><span class="opt">, </span><span class="num">0</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc12" id="toc12">Pretty Printing with a highlighter and <code>framed</code></a></h3>

  <p>One method of highlighting is to use an external highlighting program. Two related programs which work are <code>highlight</code> <sup><a href="#fn7">7</a></sup> and GNU <code>source-highlight</code> <sup><a href="#fn8">8</a></sup> . An additional wrapper script needs to be made to invoke the highlighter and massage the output a bit.</p>
  <pre class="dfn">
<a name="NW0-3CYAWn-3" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-3"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-2">&lt;-</a>D<a href="#NW0-3CYAWn-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
latexhl \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-nmy1B-1" href="#NW0-nmy1B-1" id="NW0-nmy1B-1"><dfn>&lt;latexhl&gt;=</dfn></a> <b>[D<a href="#NW0-nmy1B-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-nmy1B-1-u1" href="#NW0-3IzIGd-1" id="NW0-nmy1B-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>

  <p>Since multiple highlighters are supported, the first thing to do is figure out which one to use. In previous versions of this system, only <code>highlight</code> version 2 was supported, so it is the preferred highlighter, if available. Since this needs to take advantage of a few low-level features, compatibility is not guaranteed. For <code>highlight</code> in particular, a check is made for major version 2 or 3 (early versions of 2 are not supported, but that is not checked). For either highlighter, it is difficult to come up with tests that ensure that this will actually work. If it doesn't, changes will need to be made here.</p>

  <p>Rather than checking this for every chunk, the overall wrapper sets an environment variable to indicate which version to use. It also does any setup steps that do not need to be repeated for every chunk.</p>

  <p>If the user wants, the check can be skipped entirely. Of course if the user setting does not match what the system actually has, there will be plenty of error messages while this runs.</p>
  <pre class="dfn">
<a name="NW0-3TUZd-9" href="#NW0-3TUZd-1" id="NW0-3TUZd-9"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-8">&lt;-</a>D<a href="#NW0-3TUZd-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># if non-blank, specify which highlighter to use:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#  highlight-2  named highlight, acts like highlight-2.x</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#  highlight-3  named highlight, acts like highlight-3.x</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#  source-highlight named source-highlight (probably 3.x)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># if blank, autodetect</span>
</pre>
      </li>

      <li>
        <pre>
HLPROG_TYPE<span class="opt">=</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2XhvLA-1" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-1"><dfn>&lt;Prepare for weave&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-2XhvLA-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-2XhvLA-1-u1" href="#NW0-xiX8L-1" id="NW0-2XhvLA-1-u1"><i>&lt;Check highlighter&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-xiX8L-1" href="#NW0-xiX8L-1" id="NW0-xiX8L-1"><dfn>&lt;Check highlighter&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-1">&lt;-U</a> <a href="#NW0-3Wv0ER-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$HLPROG_TYPE"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if </span><span class="kwb">type </span>highlight <span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="num">2</span><span class="opt">&gt;&amp;</span><span class="num">1</span><span class="opt">; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
    v<span class="opt">=</span><span class="str">`highlight --version 2&gt;&amp;1 | fgrep highlight`</span>
</pre>
      </li>

      <li>
        <pre>
    v<span class="opt">=</span><span class="str">"${v##*version }"</span>
</pre>
      </li>

      <li>
        <pre>
    v<span class="opt">=</span><span class="str">"${v%%.*}"</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span>highlight<span class="opt">-</span><span class="kwd">$v</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if </span><span class="opt">[ </span><span class="kwd">$HLPROG_TYPE </span><span class="opt">!= </span>highlight<span class="opt">-</span><span class="num">2 </span><span class="opt">-</span>a <span class="kwd">$HLPROG_TYPE </span><span class="opt">!= </span>highlight<span class="opt">-</span><span class="num">3 </span><span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="slc"># echo "Only version 2 or 3 of highlight supported." &gt;&amp;2</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="slc"># exit 1</span>
</pre>
      </li>

      <li>
        <pre>
      HLPROG_TYPE<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">elif </span><span class="kwb">type source</span><span class="opt">-</span>highlight <span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="num">2</span><span class="opt">&gt;&amp;</span><span class="num">1</span><span class="opt">; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span><span class="kwb">source</span><span class="opt">-</span>highlight
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
    highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">]) </span><span class="kwb">type </span>highlight <span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="num">2</span><span class="opt">&gt;&amp;</span><span class="num">1 </span>|| HLPROG_TYPE<span class="opt">= ;;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">) </span><span class="kwb">type source</span><span class="opt">-</span>highlight <span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="num">2</span><span class="opt">&gt;&amp;</span><span class="num">1 </span>|| HLPROG_TYPE<span class="opt">= ;;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*) </span>HLPROG_TYPE<span class="opt">= ;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$HLPROG_TYPE"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">"Invalid highlighter specified in HLPROG_TYPE"</span> <span class="opt">&gt;&amp;</span><span class="num">2</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">exit </span><span class="num">1</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, any preparations before running the source highlighter should be made, and the highlighter itself should be called.</p>
  <pre class="dfn">
<a name="NW0-nmy1B-2" href="#NW0-nmy1B-1" id="NW0-nmy1B-2"><dfn>&lt;latexhl&gt;+=</dfn></a> <b>[<a href="#NW0-nmy1B-1">&lt;-</a>D<a href="#NW0-nmy1B-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-nmy1B-2-u1" href="#NW0-2FDI7I-1" id="NW0-nmy1B-2-u1"><i>&lt;Do per-chunk highlighting preparation for <code>latexhl</code>&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="kwd">$HLPROG_TYPE </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">2</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <a name="NW0-nmy1B-2-u2" href="#NW0-3ecB1D-1" id="NW0-nmy1B-2-u2"><i>&lt;<code>highlight</code>-2 options for <code>latexhl</code>&gt;</i></a> | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'<a name="NW0-nmy1B-2-u3" href="#NW0-2ZFMuR-1" id="NW0-nmy1B-2-u3"><i>&lt;Adjust <code>highlight</code>-2 LaTeX&gt;</i></a>'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">3</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <a name="NW0-nmy1B-2-u4" href="#NW0-2ystHn-1" id="NW0-nmy1B-2-u4"><i>&lt;<code>highlight</code>-3 options for <code>latexhl</code>&gt;</i></a> | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'<a name="NW0-nmy1B-2-u5" href="#NW0-2ZFR4X-1" id="NW0-nmy1B-2-u5"><i>&lt;Adjust <code>highlight</code>-3 LaTeX&gt;</i></a>'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <a name="NW0-nmy1B-2-u6" href="#NW0-34PTSc-1" id="NW0-nmy1B-2-u6"><i>&lt;<code>source-highlight</code> options for <code>latexhl</code>&gt;</i></a> | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'<a name="NW0-nmy1B-2-u7" href="#NW0-M9IrI-1" id="NW0-nmy1B-2-u7"><i>&lt;Adjust <code>source-highlight</code> LaTeX&gt;</i></a>'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To make the highlighter do its job, changing the block's background color needs to be supported as well. To do this, a box-type environment that sets background colors and can span pages is needed. The <code>framed</code> package comes close, but requires a bit of work to get the chunk to associate strongly with its header line. Without moving the code margin outside of the frame, it also extends the color box too far to the left. In the interest of simplicity, though, it will be used instead of writing an equivalent replacement. The background color itself is the named color <code>bgcolor</code>.</p>

  <p>One problem to watch out for with <code>framed</code> is that if a code chunk starts at the bottom of a page, it is sometimes not broken at subsequent page boundaries. These chunks can be detected by scanning the LaTeX log for <tt>Overfull <i>\</i>vbox</tt> messages. This can be cured by inserting an explicit <code>\break</code> before the affected code chunk. All <code>\break</code> commands should be revisited regularly to make sure they are still necessary as the document changes. Of course this could also be taken as a sign that it is time to break the code chunk into smaller chunks, but sometimes breaking things up just for the sake of making them smaller just makes things messier.</p>
  <pre class="dfn">
<a name="NW0-2FDI7I-1" href="#NW0-2FDI7I-1" id="NW0-2FDI7I-1"><dfn>&lt;Do per-chunk highlighting preparation for <code>latexhl</code>&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b> <b>[D<a href="#NW0-2FDI7I-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">]) </span><span class="kwb">echo </span><span class="str">'</span><span class="esc">\b</span><span class="str">egin{framed}</span><span class="esc">\a</span><span class="str">dvance\leftskip-\codemargin%'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-nmy1B-3" href="#NW0-nmy1B-1" id="NW0-nmy1B-3"><dfn>&lt;latexhl&gt;+=</dfn></a> <b>[<a href="#NW0-nmy1B-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">]) </span><span class="kwb">echo </span><span class="str">'\end{framed}%'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3kj8WK-1" href="#NW0-3kj8WK-1" id="NW0-3kj8WK-1"><dfn>&lt;Prepare for <code>latexhl</code>&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-3kj8WK-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span><span class="kwd">$HLPROG_TYPE </span><span class="opt">= </span><span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n \
</pre>
      </li>

      <li>
        <pre>
  <span class="str">'include "latexcolor.outlang"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">   nodoctemplate</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     "</span><span class="esc">\b</span><span class="str">egin{framed}</span><span class="esc">\a</span><span class="str">dvance\leftskip-\codemargin%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     "</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">\end{framed}%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">   end'</span> <span class="opt">&gt;</span>mylatex.outlang
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-8" href="#NW0-4erxh5-1" id="NW0-4erxh5-8"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-7">&lt;-</a>D<a href="#NW0-4erxh5-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">rm </span><span class="opt">-</span>f mylatex.outlang
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4MAejL-1" href="#NW0-4MAejL-1" id="NW0-4MAejL-1"><dfn>&lt;Framed Code Preamble&gt;=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>framed<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\setlength\FrameSep</span><span class="opt">{</span><span class="num">0</span>pt<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\setlength\FrameRule</span><span class="opt">{</span><span class="num">0</span>pt<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% nwdoit is the code header &amp; flag indicating pass &lt;= 2</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% nwdoita is a flag indicating pass #1</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\let\nwdoit\relax\let\nwdoita\relax</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\FrameCommand</span><span class="kwc">#1</span><span class="opt">{</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\ifx\nwdoit\relax</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc">% 3rd+ pass is subsequent pages - no code header</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">\hskip\codemargin\colorbox</span><span class="opt">{</span>bgcolor<span class="opt">}{</span><span class="kwc">#1</span><span class="opt">}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\else</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc">% 1st pass is invisible sizing pass, but only on older TeX.  How to tell?</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc">% 2nd pass is 1st page</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">\vbox</span><span class="opt">{</span><span class="kwa">\vbox</span><span class="opt">{</span><span class="kwa">\nwdoit</span><span class="opt">}</span><span class="kwa">\colorbox</span><span class="opt">{</span>bgcolor<span class="opt">}{</span><span class="kwc">#1</span><span class="opt">}}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">\ifx\nwdoita\relax</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">\global\let\nwdoit\relax</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
     <span class="slc">% comment/uncomment next line if TeX newer/older</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%    \else%</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">\global\let\nwdoita\relax</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">\fi</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\fi</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\renewenvironment</span><span class="opt">{</span>framed<span class="opt">}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">{</span><span class="kwa">\MakeFramed </span><span class="opt">{</span><span class="kwa">\advance\hsize</span>-<span class="num">2</span><span class="kwa">\fboxsep\advance\hsize</span>-<span class="kwa">\codemargin</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\FrameRestore</span><span class="opt">}}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">{</span><span class="kwa">\endMakeFramed</span><span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4FDXe1-1" href="#NW0-4FDXe1-1" id="NW0-4FDXe1-1"><dfn>&lt;Insert code header into frame&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-4">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
/\\nwbegincode/s/\(sublabel{[^}]*}\)\(.*\)/\<span class="num">1</span>\\def\\nwdoita{}\\def\\nwdoit{\<span class="num">2</span>}%/
</pre>
      </li>
    </ol>
  </div>

  <p>The actual colors come from a style file in <code>highlight</code>; there is actually no need to worry about which style to use when highlighting the chunks. This style file can be extracted by highlighting a dummy file, and parsing the output. If the background color is white, it is converted to a very light gray to ensure that code always looks a little different.</p>
  <pre class="dfn">
<a name="NW0-3kj8WK-2" href="#NW0-3kj8WK-1" id="NW0-3kj8WK-2"><dfn>&lt;Prepare for <code>latexhl</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a>)</b> <b>[<a href="#NW0-3kj8WK-1">&lt;-</a>D<a href="#NW0-3kj8WK-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <span class="kwd">${theme:+-s $theme} </span><span class="opt">-</span>S c <span class="opt">--</span>out<span class="opt">-</span>format<span class="opt">=</span>latex <span class="opt">-</span>I <span class="opt">&lt;/</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">egrep </span><span class="str">'newcommand|definecolor'</span> | \
</pre>
      </li>

      <li>
        <pre>
        <span class="kwc">sed </span><span class="str">'/bgcolor/s/{1,1,1}/{.98,.98,.98}/'</span> <span class="opt">&gt; </span>latexhl.sty.$$
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">mv </span>latexhl.sty.$$ latexhl.sty
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-9" href="#NW0-4erxh5-1" id="NW0-4erxh5-9"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-8">&lt;-</a>D<a href="#NW0-4erxh5-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">rm </span><span class="opt">-</span>f latexhl.sty<span class="opt">{,</span>.<span class="opt">*}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>On the other hand, <code>source-highlight</code> inserts the colors directly. However, since the colors don't change from chunk to chunk, it is better to extract them once, and use color names instead. This is done by creating an appropriate language definition and source file to get all possible entity types. In addition, <code>source-highlight</code> uses color names directly from HTML CSS files, which include invalid hexadecimal color specifiers. These need to be converted to valid decimal RGB triples.</p>
  <pre class="dfn">
<a name="NW0-3kj8WK-3" href="#NW0-3kj8WK-1" id="NW0-3kj8WK-3"><dfn>&lt;Prepare for <code>latexhl</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a>)</b> <b>[<a href="#NW0-3kj8WK-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span><span class="kwd">$HLPROG_TYPE </span><span class="opt">= </span><span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'onestyle "\hl$style{$text}"'</span> <span class="opt">&gt;&gt; </span>mylatex.outlang
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-3kj8WK-3-u1" href="#NW0-2Z6mIC-1" id="NW0-3kj8WK-3-u1"><i>&lt;Get all <code>source-highlight</code> color names&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># outlang def for background color only, in same format as latexcolor</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'nodoctemplate</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        "\definecolor{bgcolor}</span><span class="esc">\t</span><span class="str">extcolor{$docbgcolor}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        ""</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        end'</span> <span class="opt">&gt; </span>mybg.outlang
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <span class="kwd">${theme:+--style-css-file=$theme.css} </span><span class="opt">-</span>f latexcolor \
</pre>
      </li>

      <li>
        <pre>
                     <span class="opt">--</span>lang<span class="opt">-</span>def<span class="opt">=</span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts.lang <span class="opt">&lt; </span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'/^</span><span class="esc">\\</span><span class="str">mbox{}/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                   s/</span><span class="esc">\\</span><span class="str">mbox{}//;s/ </span><span class="esc">\\\\</span><span class="str">//;s/\$</span><span class="esc">\\</span><span class="str">_\$//g;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                   s/\(.*{\)\([^}]*\)\(}*\)$/</span><span class="esc">\\</span><span class="str">newcommand{</span><span class="esc">\\</span><span class="str">hl\2}[1]{\1#1\3}/p;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                   s/^[^</span><span class="esc">\\</span><span class="str">].*/</span><span class="esc">\\</span><span class="str">newcommand{</span><span class="esc">\\</span><span class="str">hl&amp;}[1]{#1}/p;}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># fa is ff * .98</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">--</span>lang<span class="opt">-</span>def<span class="opt">=/</span>dev<span class="opt">/</span>null <span class="opt">--</span>outlang<span class="opt">-</span>def<span class="opt">=</span>mybg.outlang \
</pre>
      </li>

      <li>
        <pre>
                     <span class="kwd">${theme:+--style-css-file=$theme.css} </span><span class="opt">&lt;/</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="str">'s/#ffffff/#fafafa/i;s/white/#f6f6f6/i'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">) </span>| <a name="NW0-3kj8WK-3-u2" href="#NW0-B6nlb-1" id="NW0-3kj8WK-3-u2"><i>&lt;Convert HTML color codes to LaTeX&gt;</i></a> | \
</pre>
      </li>

      <li>
        <pre>
     <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'/^</span><span class="esc">\\</span><span class="str">definecolor/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">               s/</span><span class="esc">\\</span><span class="str">textcolor//</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">               # convert textcolor rgb to definecolor rgb</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">               s/\[rgb\]/{rgb}/;t</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">               # convert textcolor named to definecolor named</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">               s/{/{named}{/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">             }'</span> <span class="opt">&gt; </span>latexhl.sty.$$
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">mv </span>latexhl.sty.$$ latexhl.sty
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2Z6mIC-1" href="#NW0-2Z6mIC-1" id="NW0-2Z6mIC-1"><dfn>&lt;Get all <code>source-highlight</code> color names&gt;=</dfn></a> <b>(<a href="#NW0-3kj8WK-3">&lt;-U</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># need to sort in reverse order because source-highlight uses first match</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># rather than longest match</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for </span>x <span class="kwa">in </span>$<span class="opt">(</span><span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">--</span>lang<span class="opt">-</span>list | cut <span class="opt">-</span>d\  <span class="opt">-</span>f3 | <span class="kwc">sort </span><span class="opt">-</span>u<span class="opt">); </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">--</span>show<span class="opt">-</span>lang<span class="opt">-</span>elements<span class="opt">=</span><span class="kwd">$x</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span>| <span class="kwc">sort </span><span class="opt">-</span>ur | fgrep <span class="opt">-</span>v <span class="str">'named subexps'</span> <span class="opt">&gt; </span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># lang def simply makes a type its name</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">sed </span><span class="str">'s/.*/&amp; = "&amp;"/'</span> <span class="opt">&lt; </span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts <span class="opt">&gt; </span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts.lang
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4erxh5-A" href="#NW0-4erxh5-1" id="NW0-4erxh5-A"><dfn>&lt;Clean temporary files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4erxh5-9">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">rm </span><span class="opt">-</span>f mybg.outlang <span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts<span class="opt">*</span>
</pre>
      </li>
    </ol>
  </div>

  <p>In order to convert HTML colors to LaTeX colors, the HTML color needs to be parsed and converted to decimal. Awk can do that, as long as it is POSIX awk. GNU awk does not work in non-POSIX mode because it does not support converting hexadecimal strings to numbers. To enable POSIX mode, either the non-portable <code>--posix</code> option can be given, or the slightly more portable <code>POSIXLY_CORRECT</code> environment variable can be set.</p>
  <pre class="dfn">
<a name="NW0-B6nlb-1" href="#NW0-B6nlb-1" id="NW0-B6nlb-1"><dfn>&lt;Convert HTML color codes to LaTeX&gt;=</dfn></a> <b>(<a href="#NW0-3kj8WK-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
POSIXLY_CORRECT<span class="opt">=</span><span class="num">1 </span><span class="kwc">awk </span><span class="str">'<a name="NW0-B6nlb-1-u1" href="#NW0-1k7O84-1" id="NW0-B6nlb-1-u1"><i>&lt;Convert HTML color codes to LaTeX using <code>awk</code>&gt;</i></a>'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1k7O84-1" href="#NW0-1k7O84-1" id="NW0-1k7O84-1"><dfn>&lt;Convert HTML color codes to LaTeX using <code>awk</code>&gt;=</dfn></a> <b>(<a href="#NW0-B6nlb-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># change color styles from HTML color IDs to rgb color triples</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># save RE in variable to avoid having to repeat</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># note that this assumes 6-digit hex string, not 3-digit.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">BEGIN </span><span class="opt">{ </span>re1 = <span class="str">"</span><span class="esc">\\\\</span><span class="str">textcolor</span><span class="esc">\\</span><span class="str">{#[0-9a-fA-F]{6}</span><span class="esc">\\</span><span class="str">}"</span>
</pre>
      </li>

      <li>
        <pre>
        re2 = <span class="str">"</span><span class="esc">\\\\</span><span class="str">colorbox</span><span class="esc">\\</span><span class="str">{#[0-9a-fA-F]{6}</span><span class="esc">\\</span><span class="str">}"</span> <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># print non-matching lines first</span>
</pre>
      </li>

      <li>
        <pre>
$<span class="num">0 </span>!~ re1 <span class="str">"|"</span> re2 <span class="opt">{ </span><span class="kwa">print </span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># helper to convert to decimal triple</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">function </span>todec3<span class="opt">(</span>start<span class="opt">,   </span>val<span class="opt">, </span>rv<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    val = <span class="str">"0x"</span> <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART </span>+ start<span class="opt">, </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    rv = <span class="opt">(</span>val <span class="opt">/ </span><span class="num">255</span><span class="opt">) </span><span class="str">","</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    val = <span class="str">"0x"</span> <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART </span>+ start + <span class="num">2</span><span class="opt">, </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    rv = rv <span class="opt">(</span>val <span class="opt">/ </span><span class="num">255</span><span class="opt">) </span><span class="str">","</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    val = <span class="str">"0x"</span> <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART </span>+ start + <span class="num">4</span><span class="opt">, </span><span class="num">2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    rv = rv <span class="opt">(</span>val <span class="opt">/ </span><span class="num">255</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">return </span>rv
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
$<span class="num">0 </span>~ re1 <span class="str">"|"</span> re2 <span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># loop to match all unconverted colors in this line</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwa">match</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span>re1<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># capture groups would be real handy now</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># but instead, we extract each digit pair manually and append to</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># replacement string (ns)</span>
</pre>
      </li>

      <li>
        <pre>
    ns = <span class="str">"</span><span class="esc">\\</span><span class="str">textcolor[rgb]{"</span> todec3<span class="opt">(</span><span class="num">12</span><span class="opt">) </span><span class="str">"}"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># convert string to be replaced to a regex by escaping \ { }</span>
</pre>
      </li>

      <li>
        <pre>
    nsre = <span class="str">"</span><span class="esc">\\</span><span class="str">"</span> <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART</span><span class="opt">, </span><span class="kwb">RLENGTH</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">gsub</span><span class="opt">(</span><span class="str">"[{}]"</span><span class="opt">, </span><span class="str">"</span><span class="esc">\\\\</span><span class="str">&amp;"</span><span class="opt">, </span>nsre<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># globally replace all occurrences of this color</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">gsub</span><span class="opt">(</span>nsre<span class="opt">, </span>ns<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwa">match</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span>re2<span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    ns = <span class="str">"</span><span class="esc">\\</span><span class="str">begingroup</span><span class="esc">\\</span><span class="str">definecolor{boxcolor}{rgb}{"</span> todec3<span class="opt">(</span><span class="num">11</span><span class="opt">) </span><span class="str">"}"</span> \
</pre>
      </li>

      <li>
        <pre>
         <span class="str">"</span><span class="esc">\\</span><span class="str">colorbox{boxcolor}"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># match the entire box so \endgroup can be placed after it</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">match</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span>re2 <span class="str">"</span><span class="esc">\\</span><span class="str">{([^}</span><span class="esc">\\\\</span><span class="str">]|</span><span class="esc">\\\\</span><span class="str">[^a-zA-Z]|</span><span class="esc">\\\\</span><span class="str">[a-z]+</span><span class="esc">\\</span><span class="str">{</span><span class="esc">\\</span><span class="str">})*</span><span class="esc">\\</span><span class="str">}"</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    $<span class="num">0 </span>= <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="num">1</span><span class="opt">, </span><span class="kwb">RSTART </span><span class="opt">- </span><span class="num">1</span><span class="opt">) </span>ns \
</pre>
      </li>

      <li>
        <pre>
         <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART </span>+ <span class="num">18</span><span class="opt">, </span><span class="kwb">RLENGTH </span><span class="opt">- </span><span class="num">18</span><span class="opt">) </span><span class="str">"</span><span class="esc">\\</span><span class="str">endgroup"</span> \
</pre>
      </li>

      <li>
        <pre>
         <span class="kwa">substr</span><span class="opt">(</span>$<span class="num">0</span><span class="opt">, </span><span class="kwb">RSTART </span>+ <span class="kwb">RLENGTH</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">print</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A few syntax changes need to be made to the default language definitions. First, a language definition for highlighting sed comments is provided. As a special hack, <code>#include</code> is detected and not considered a comment (this is due to my use of HDF in a particular project, which uses this format). Second, the C language gets multi-line macros highlighted like regular source (already there in <code>source-highlight</code>), and support for 64-bit integer constants (already there in <code>highlight</code>-3). Finally, data types are being highlighted using the listings package's <code>moreemph</code> directive, so these directives are extracted and inserted into the keyword highlight list. This is actually done by using the name of the chunk containing all of these data types, so they are properly combined ahead of time.</p>
  <pre class="dfn">
<a name="NW0-2XhvLA-2" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-2"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-1">&lt;-</a>D<a href="#NW0-2XhvLA-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">trap </span><span class="str">"rm -rf /tmp/latexhl.*.$$"</span> <span class="num">0</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>HLDIR<span class="opt">=/</span>tmp<span class="opt">/</span>latexhl.hl.$$
</pre>
      </li>

      <li>
        <pre>
mkdir <span class="opt">-</span>p <span class="kwd">$HLDIR</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># sed language only supports comments</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># #include supported for HDF</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">"comment start '#(?!include</span><span class="esc">\\</span><span class="str">W)'"</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span><span class="kwc">sed</span>.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># c language needs a lot of help</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">cat </span><span class="opt">&lt;&lt;</span><span class="str">"EOF"</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
      include <span class="str">"c.lang"</span>
</pre>
      </li>

      <li>
        <pre>
      subst number <span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">'\&lt;[+-]?((0x[[:xdigit:]]+)|(([[:digit:]]*\.)?</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">[[:digit:]]+([eE][+-]?[[:digit:]]+)?))[uUlL]*\&gt;'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">type </span><span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">printf </span><span class="opt">%</span>s <span class="str">'<a name="NW0-2XhvLA-2-u1" href="#NW0-KNRz0-1" id="NW0-2XhvLA-2-u1"><i>&lt;Known Data Types&gt;</i></a>'</span> | <span class="kwc">egrep </span><span class="opt">-</span>v <span class="str">'^[[:space:]]*(%|$)'</span> | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'s/[[:space:]]//g;s/,/|/g;s/%.*//;s/^/"/;s/|$/"/;$!s/$/,/'</span> \
</pre>
      </li>

      <li>
        <pre>
           <span class="opt">&gt;&gt;</span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">2</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    mkdir <span class="opt">-</span>p <span class="kwd">$HLDIR</span><span class="opt">/</span>langDefs
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># sed language only supports comments</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># #include supported for HDF</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'$SL_COMMENT=regex(^\s*(#(?!include\W)))'</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>langDefs<span class="opt">/</span><span class="kwc">sed</span>.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># c language needs a lot of help</span>
</pre>
      </li>

      <li>
        <pre>
    hl_kw<span class="opt">=</span><span class="str">"`printf %s '<a name="NW0-2XhvLA-2-u2" href="#NW0-KNRz0-1" id="NW0-2XhvLA-2-u2"><i>&lt;Known Data Types&gt;</i></a>' | egrep -v '^[[:space:]]*(%|$)' | \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">            sed -e 's/[[:space:]]//g;s/,/ /g;s/%.*//;\$!s/\$/</span><span class="esc">\\\\</span><span class="str">/'`"</span>
</pre>
      </li>

      <li>
        <pre>
    langdir<span class="opt">=</span><span class="str">`highlight --print-config | sed -n '/Language def/s/.*: *//p'`</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">sed </span><span class="opt">&lt; </span><span class="kwd">${langdir:-/usr/share/highlight/langDefs}</span><span class="opt">/</span>c.lang <span class="opt">-</span>e <span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # remove cont to fully highlight multi-line macros</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      s/.*CONTINUATIONSYMBOL.*//</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # fix preproc expression</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      /DIRECTIVE/s/#/regex(^</span><span class="esc">\\</span><span class="str">s*(#))/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # add some kws to kwb using old listings package moreemph decls</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      /KW_LIST(kwb)/a</span><span class="esc">\'</span><span class="str">"${hl_kw}"'</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="slc"># same thing, but newer versions of highlight</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">/</span>KEYWORDS<span class="opt">(</span>kwb<span class="opt">)/</span>a<span class="esc">\'</span><span class="str">"${hl_kw}"</span><span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # change number RE to include UL, LL, ULL, etc.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      $a\$DIGIT=regex((?:0x|0X)[0-9a-fA-F]+|</span><span class="esc">\\</span><span class="str">d*[.]?</span><span class="esc">\\</span><span class="str">d+(?:[eE][</span><span class="esc">\\</span><span class="str">-+]</span><span class="esc">\\</span><span class="str">d+)?[lLuU]*)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      '</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>langDefs<span class="opt">/</span>c.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">3</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># sed language only supports comments</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># #include supported for HDF</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'Description="sed"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">          Keywords={}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">          Comments={</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">            {Block=false, Delimiter={[[^\s*(#(?!include\W))]]}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">          }'</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span><span class="kwc">sed</span>.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># c language needs a lot of help</span>
</pre>
      </li>

      <li>
        <pre>
    langdir<span class="opt">=</span><span class="str">`highlight --print-config | sed -n '/Language def/s/.*: *//p'`</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">"dofile('${langdir}c.lang')"</span> <span class="opt">&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">cat </span><span class="opt">&lt;&lt;</span><span class="str">"EOF"</span> <span class="opt">&gt;&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">-- </span>fix preproc expression and remove cont to highlight multi<span class="opt">-</span>line macros
</pre>
      </li>

      <li>
        <pre>
      Preprocessor <span class="opt">= { </span>Prefix<span class="opt">=[[</span>^<span class="esc">\\</span>s<span class="opt">*(</span><span class="slc">#)]] }</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">--</span>add some kws to ID<span class="opt">=</span><span class="num">2 </span>using old listings package moreemph decls
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">for </span>i<span class="opt">, </span>v <span class="kwa">in </span>ipairs<span class="opt">({</span>
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">printf </span><span class="opt">%</span>s <span class="str">'<a name="NW0-2XhvLA-2-u3" href="#NW0-KNRz0-1" id="NW0-2XhvLA-2-u3"><i>&lt;Known Data Types&gt;</i></a>'</span> | <span class="kwc">egrep </span><span class="opt">-</span>v <span class="str">'^[[:space:]]*(%|$)'</span> | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'s/[[:space:]]//g;s/,/","/g;s/%.*//;s/$/"/;s/^/"/;s/""//;'</span> \
</pre>
      </li>

      <li>
        <pre>
         <span class="opt">&gt;&gt; </span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">cat </span><span class="opt">&lt;&lt;</span><span class="str">"EOF"</span> <span class="opt">&gt;&gt;</span><span class="kwd">$HLDIR</span><span class="opt">/</span>myc.lang
</pre>
      </li>

      <li>
        <pre>
                         <span class="opt">}) </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
        table.insert<span class="opt">(</span>Keywords<span class="opt">[</span><span class="num">2</span><span class="opt">]</span>.List<span class="opt">, </span>v<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      end
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>

  <p>To actually invoke the highlighter, the language specified on the command line must be passed in. If it is one of the overrides, the override should be used instead. For <code>highlight</code>-2, this is done using the <code>-E</code> option. For the other two, it is done by specifying the language definition file directly. Since these require checking the language argument anyway, they can also change the language to a different one if necessary. I have not tested all languages available to the <code>listings</code> package, which is used to determine legal language names, but any which mismatch what is supported by the external highlighter should be listed here.</p>
  <pre class="dfn">
<a name="NW0-2FDI7I-2" href="#NW0-2FDI7I-1" id="NW0-2FDI7I-2"><dfn>&lt;Do per-chunk highlighting preparation for <code>latexhl</code>&gt;+=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b> <b>[<a href="#NW0-2FDI7I-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-2FDI7I-2-u1" href="#NW0-2GraQd-1" id="NW0-2FDI7I-2-u1"><i>&lt;Do generic per-chunk highlighting preparation&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2GraQd-1" href="#NW0-2GraQd-1" id="NW0-2GraQd-1"><dfn>&lt;Do generic per-chunk highlighting preparation&gt;=</dfn></a> <b>(<a href="#NW0-2FDI7I-2">&lt;-U</a> <a href="#NW0-1H5Xxg-1">U-&gt;</a>)</b> <b>[D<a href="#NW0-2GraQd-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span><span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">= </span><span class="kwd">$HLPROG_TYPE </span><span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">case </span><span class="kwd">$1 </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
    <a name="NW0-2GraQd-1-u1" href="#NW0-mLHpn-1" id="NW0-2GraQd-1-u1"><i>&lt;Translate listings source type to source-highlight source type&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*) </span>larg<span class="opt">=</span><span class="str">"-s $1"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-mLHpn-1" href="#NW0-mLHpn-1" id="NW0-mLHpn-1"><dfn>&lt;Translate listings source type to source-highlight source type&gt;=</dfn></a> <b>(<a href="#NW0-2GraQd-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">[</span>cC<span class="opt">]) </span>larg<span class="opt">=</span><span class="str">"--lang-def=$HLDIR/myc.lang"</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">sed</span><span class="opt">) </span>larg<span class="opt">=</span><span class="str">"--lang-def=$HLDIR/sed.lang"</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">make</span><span class="opt">) </span>larg<span class="opt">=</span><span class="str">"-s makefile"</span> <span class="opt">;;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-34PTSc-1" href="#NW0-34PTSc-1" id="NW0-34PTSc-1"><dfn>&lt;<code>source-highlight</code> options for <code>latexhl</code>&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">--</span>outlang<span class="opt">-</span>def<span class="opt">=</span>mylatex.outlang <span class="opt">--</span>failsafe <span class="kwd">$larg</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3ecB1D-1" href="#NW0-3ecB1D-1" id="NW0-3ecB1D-1"><dfn>&lt;<code>highlight</code>-2 options for <code>latexhl</code>&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">--</span>out<span class="opt">-</span>format<span class="opt">=</span>latex <span class="opt">-</span>f <span class="opt">-</span>S <span class="kwd">$1 </span><span class="opt">-</span>E <span class="kwd">$HLDIR</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2GraQd-2" href="#NW0-2GraQd-1" id="NW0-2GraQd-2"><dfn>&lt;Do generic per-chunk highlighting preparation&gt;+=</dfn></a> <b>(<a href="#NW0-2FDI7I-2">&lt;-U</a> <a href="#NW0-1H5Xxg-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2GraQd-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span>highlight<span class="opt">-</span><span class="num">3 </span><span class="opt">= </span><span class="kwd">$HLPROG_TYPE </span><span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">case </span><span class="kwd">$1 </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
    <a name="NW0-2GraQd-2-u1" href="#NW0-9eD9j-1" id="NW0-2GraQd-2-u1"><i>&lt;Translate listings source type to highlight-3 source type&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*) </span>larg<span class="opt">=</span><span class="str">"-S $1"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-9eD9j-1" href="#NW0-9eD9j-1" id="NW0-9eD9j-1"><dfn>&lt;Translate listings source type to highlight-3 source type&gt;=</dfn></a> <b>(<a href="#NW0-2GraQd-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">[</span>cC<span class="opt">]) </span>larg<span class="opt">=</span><span class="str">"--config-file=$HLDIR/myc.lang"</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">sed</span><span class="opt">) </span>larg<span class="opt">=</span><span class="str">"--config-file=$HLDIR/sed.lang"</span> <span class="opt">;;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ystHn-1" href="#NW0-2ystHn-1" id="NW0-2ystHn-1"><dfn>&lt;<code>highlight</code>-3 options for <code>latexhl</code>&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">--</span>out<span class="opt">-</span>format<span class="opt">=</span>latex <span class="opt">-</span>f <span class="kwd">$larg</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, the output needs to be adjusted. All three need a strut on the first line to ensure consistent appearance. All three generate a final blank line, which is just excess whitespace. All three encode the triple-hat sequence which is used to indicate chunk references as LaTeX, which must be decoded. All three also add unnecessary garbage at the end of each line. The <code>highlight</code> program also terminages LaTeX commands with a space rather than curly braces, which has caused me problems in some places. The last line should also be terminated by a percent sign to remove excess whitespace.</p>
  <pre class="dfn">
<a name="NW0-M9IrI-1" href="#NW0-M9IrI-1" id="NW0-M9IrI-1"><dfn>&lt;Adjust <code>source-highlight</code> LaTeX&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># remove blank line at end</span>
</pre>
      </li>

      <li>
        <pre>
/^\\mbox{}$/d
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># detexify triple-^</span>
</pre>
      </li>

      <li>
        <pre>
s/\(\\textasciicircum{}\)\<span class="num">1</span>\<span class="num">1</span>/^''^^/g
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove unnecessary EOL stuff</span>
</pre>
      </li>

      <li>
        <pre>
s/ \\\\$//
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># fix _ in command names</span>
</pre>
      </li>

      <li>
        <pre>
s/\(\\hl[a-z]*\)_/\<span class="num">1</span>/g
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># add strut to first line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="num">2</span>s/$/\\strut{}/
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># add a % to 2nd-to-last line</span>
</pre>
      </li>

      <li>
        <pre>
x;${s/$/%/;G};<span class="num">1</span>!p
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ZFMuR-1" href="#NW0-2ZFMuR-1" id="NW0-2ZFMuR-1"><dfn>&lt;Adjust <code>highlight</code>-2 LaTeX&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a> <a href="#NW0-2ZFR4X-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># removes 1st 2 lines (setting font &amp; spacing - already done)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="num">1</span>,<span class="num">2</span>d
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove last few lines (just extra whitespace &amp; restoring font/spacing)</span>
</pre>
      </li>

      <li>
        <pre>
/^\\mbox{}$/,$d
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># since multiple lines were deleted, just start sed over so $ works right</span>
</pre>
      </li>

      <li>
        <pre>
p' | sed -e '
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># detexify triple-^</span>
</pre>
      </li>

      <li>
        <pre>
s/\(\\textasciicircum \)\<span class="num">1</span>\<span class="num">1</span>/^''^^/g
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove unnecessary fill on every line</span>
</pre>
      </li>

      <li>
        <pre>
s/\\hspace\*{\\fill}\\\\$//
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># use {} instead of single space to terminate TeX cmds</span>
</pre>
      </li>

      <li>
        <pre>
s/\(\\[a-z][a-z]*\) /\<span class="num">1</span>{}/g
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># add strut to first line</span>
</pre>
      </li>

      <li>
        <pre>
<span class="num">1</span>s/$/\\strut{}/
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove last CR by tacking on % to last line</span>
</pre>
      </li>

      <li>
        <pre>
$s/$/%/
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2ZFR4X-1" href="#NW0-2ZFR4X-1" id="NW0-2ZFR4X-1"><dfn>&lt;Adjust <code>highlight</code>-3 LaTeX&gt;=</dfn></a> <b>(<a href="#NW0-nmy1B-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-2ZFR4X-1-u1" href="#NW0-2ZFMuR-1" id="NW0-2ZFR4X-1-u1"><i>&lt;Adjust <code>highlight</code>-2 LaTeX&gt;</i></a>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc13" id="toc13">Pretty Printing with <code>listings</code></a></h3>

  <p>Or, since the commands from the listings package are used anyway, the listings package could be used instead. To do this, <code>nwbegincode</code> and <code>nwendcode</code> need to be changed to the listings package equivalents. Then, all commands within the code are escaped using ctrl-G, a character not likely in text and easily specified within sed. The escape character must be activated using <code>\lstset{escapechar=^^G}</code> in the preamble.</p>
  <pre class="dfn">
<a name="NW0-3R5hvL-1" href="#NW0-3R5hvL-1" id="NW0-3R5hvL-1"><dfn>&lt;Change <code>nwcode</code> to <code>listings</code>&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-4">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
s/^\(.*\)\(\\nwbegincode{[<span class="num">0</span>-<span class="num">9</span>]*}\)\(.*\)$/\<span class="num">1</span>\\begin{lstlisting}\n\a\<span class="num">3</span>\a/
</pre>
      </li>

      <li>
        <pre>
/\\def\\nwend/!s/^\(.*\)\(\\nwendcode\)\(.*\)$/\\end{lstlisting}\<span class="num">1</span>\<span class="num">3</span>/
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3CYAWn-4" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-4"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-3">&lt;-</a>D<a href="#NW0-3CYAWn-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
addlistings \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1LtyCx-1" href="#NW0-1LtyCx-1" id="NW0-1LtyCx-1"><dfn>&lt;addlistings&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1LtyCx-1-u1" href="#NW0-3IzIGd-1" id="NW0-1LtyCx-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># use the ctrl-g escape (\a = ann = bell)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'s/\^\^\^/</span><span class="esc">\a</span><span class="str">&amp;</span><span class="esc">\a</span><span class="str">/g</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        # insert dummy escapes into potential listing ender tokens</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/</span><span class="esc">\\</span><span class="str">end{lstlisting}/</span><span class="esc">\\\a\a</span><span class="str">end{lstlisting}/g</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/</span><span class="esc">\\</span><span class="str">nwbegincode/</span><span class="esc">\\\a\a</span><span class="str">nwbegincode/g</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/</span><span class="esc">\\</span><span class="str">nwendcode/</span><span class="esc">\\\a\a</span><span class="str">nwendcode/g'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3KBSPj-1" href="#NW0-3KBSPj-1" id="NW0-3KBSPj-1"><dfn>&lt;Preamble Adjustments for <code>listings</code>&gt;=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b> <b>[D<a href="#NW0-3KBSPj-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% Use ^G for escape char - not likely in document</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\catcode</span>`\^^G=<span class="num">13</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>escapechar=^^G<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The appropriate language definitions need to be loaded at the end of the LaTeX preamble. This includes comment highlighting for <code>sed</code> and selecting the appropriate default sublanguages.</p>
  <pre class="dfn">
<a name="NW0-3KBSPj-2" href="#NW0-3KBSPj-1" id="NW0-3KBSPj-2"><dfn>&lt;Preamble Adjustments for <code>listings</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b> <b>[<a href="#NW0-3KBSPj-1">&lt;-</a>D<a href="#NW0-3KBSPj-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% Stuff for the listings package</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% note: lstloadlanguages seems broken in some versions</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%\lstloadlanguages{C,sh,[gnu]make,[LaTeX]TeX} %,sed</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Most of sed can't be expressed in the listings package - no regexes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstdefinelanguage</span><span class="opt">{</span>sed<span class="opt">}{</span>morecomment=<span class="opt">[</span>f<span class="opt">]</span>\#<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstdefinelanguage</span><span class="opt">{</span>txt<span class="opt">}{}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>defaultdialect=<span class="opt">[</span>gnu<span class="opt">]</span>make,defaultdialect=<span class="opt">[</span>LaTeX<span class="opt">]</span>TeX<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%The supplied HTML def has no dialect, so setting this creates infinite loop</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%\lstset{defaultdialect=[ext]HTML}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>language=C<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>A few additional adjustments need to be made for those languages. In particular, some keywords are missing, and some standard data types are missing. Also, the data types provided by the used libraries need to be highlighted. The data type adjustments are applied when using <code>highlight</code> as well, since the <code>moreemph</code> directives are parsed out.</p>
  <pre class="dfn">
<a name="NW0-3KBSPj-3" href="#NW0-3KBSPj-1" id="NW0-3KBSPj-3"><dfn>&lt;Preamble Adjustments for <code>listings</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b> <b>[<a href="#NW0-3KBSPj-2">&lt;-</a>D<a href="#NW0-3KBSPj-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% HTML doesn't bold enctype</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstdefinelanguage</span><span class="opt">[</span>ext<span class="opt">]{</span>HTML<span class="opt">}[]{</span>HTML<span class="opt">}{</span>morekeywords=<span class="opt">{</span>enctype,public,xml<span class="opt">}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Known data types</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>moreemph=<span class="opt">{</span><a name="NW0-3KBSPj-3-u1" href="#NW0-KNRz0-1" id="NW0-3KBSPj-3-u1"><i>&lt;Known Data Types&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-KNRz0-1" href="#NW0-KNRz0-1" id="NW0-KNRz0-1"><dfn>&lt;Known Data Types&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-2">&lt;-U</a> <a href="#NW0-3KBSPj-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% C</span>
</pre>
      </li>

      <li>
        <pre>
regex_t,regmatch_t,FILE,va_list,pollfd,pthread_t,<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
pthread_mutex_t,pthread_cond_t,uid_t,gid_t,mode_t,pid_t,time_t,socklen_t,<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
sockaddr_in,sockaddr,off_t,utimbuf,<span class="slc">%</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Since there are not really any styles for this package, the highlighter program's styles can be used instead. If they are present, they need to be converted to the appropriate directives. If there is no highlighter program available, a dummy <code>latexhl.sty</code> needs to be created as well. The format of a listings style command is a declaration rather than a command, so the style file needs to be converted as well.</p>
  <pre class="dfn">
<a name="NW0-2XhvLA-3" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-3"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-2">&lt;-</a>D<a href="#NW0-2XhvLA-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$HLPROG_TYPE"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="opt">&gt;</span>latexhl.sty
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3zBk6n-1" href="#NW0-3zBk6n-1" id="NW0-3zBk6n-1"><dfn>&lt;Change <code>highlight</code> style to <code>listings</code> style&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-4">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
s/\[<span class="num">1</span>\]//;s/#<span class="num">1</span>//g
</pre>
      </li>

      <li>
        <pre>
s/^[^{]*{[^}]*}$/&amp;{}/
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># colorbox is not supported, so silently delete</span>
</pre>
      </li>

      <li>
        <pre>
s/\\colorbox{[^}]*}{\(.*\)}/\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\text\(color[^}]*}\){\(.*\)}/\\\<span class="num">1</span>\<span class="num">2</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\bf{\(.*\)}/\\bfseries\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\textbf{\(.*\)}/\\bfseries\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\it{\(.*\)}/\\itshape\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\textit{\(.*\)}/\\itshape\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># underline is not supported, so silently turn into sans-serif</span>
</pre>
      </li>

      <li>
        <pre>
s/\\underline{\(.*\)}/\\sffamily\<span class="num">1</span>/
</pre>
      </li>

      <li>
        <pre>
s/\\texttt{\(.*\)}/\\ttfamily\<span class="num">1</span>/
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3KBSPj-4" href="#NW0-3KBSPj-1" id="NW0-3KBSPj-4"><dfn>&lt;Preamble Adjustments for <code>listings</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b> <b>[<a href="#NW0-3KBSPj-3">&lt;-</a>D<a href="#NW0-3KBSPj-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>backgroundcolor=<span class="kwa">\color</span><span class="opt">{</span>bgcolor<span class="opt">}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifx\hlstd\undefined\else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>basicstyle=<span class="kwa">\hlstd\footnotesize</span>,keywordstyle=<span class="kwa">\hlkwa</span>,emphstyle=<span class="kwa">\hlkwb</span>,<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
        commentstyle=<span class="kwa">\hlcom</span>,stringstyle=<span class="kwa">\hlstr</span>,directivestyle=<span class="kwa">\hldir</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifx\hlnormal\undefined\else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>basicstyle=<span class="kwa">\hlnormal\footnotesize</span>,keywordstyle=<span class="kwa">\hlkeyword</span>,<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
        emphstyle=<span class="kwa">\hltype</span>,commentstyle=<span class="kwa">\hlcomment</span>,stringstyle=<span class="kwa">\hlstring</span>,<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
        directivestyle=<span class="kwa">\hlpreproc</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, some general appearance adjustments are made. The entire listing is shifted over a bit, and the font layout is set for minimum mangling.</p>
  <pre class="dfn">
<a name="NW0-3KBSPj-5" href="#NW0-3KBSPj-1" id="NW0-3KBSPj-5"><dfn>&lt;Preamble Adjustments for <code>listings</code>&gt;+=</dfn></a> <b>(<a href="#NW0-3tjoYz-4">U-&gt;</a>)</b> <b>[<a href="#NW0-3KBSPj-4">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>columns=<span class="opt">[</span>l<span class="opt">]</span>fixed,framexleftmargin=<span class="num">1.5</span>em,framexrightmargin=<span class="num">1</span>em<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc14" id="toc14">Additional Output Adjustments</a></h3>

  <p>Now that code chunks can be pretty-printed, a few more adjustments need to be made. Underscores in chunk names (such as when the chunk name is a file name) need to be escaped. The easiest place to do this is in a filter, which has the chunk names separated out already. For maximum flexibility, this is done in a perl script.</p>
  <pre class="dfn">
<a name="NW0-4N5W31-1" href="#NW0-4N5W31-1" id="NW0-4N5W31-1"><dfn>&lt;Filter lines from NoWeb token stream&gt;=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a> <a href="#NW0-3henEn-2">&lt;-U</a> <a href="#NW0-krEPi-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-4N5W31-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^\@use / </span><span class="kwc">or </span><span class="kwd">/^\@defn /</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">s/_/\\_/g </span><span class="kwa">unless </span><span class="kwd">/\[\[/</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Chunk names referring to chunks in other files should be indicated as such. For now, this is done by prepending the chunk name with the source file in parentheses. The parentheses are to help force the index entry to the top of the list. The printed source file is the top-most file which includes this definition; in other words, if a file is included by another, its definitions are owned by the includer. <!-- Begin-doc extref-dis-->
  This can be disabled for user-level documentation by adding the commment:</p>

  <blockquote>
    <tt>%%% no-ext-ref</tt>
  </blockquote><!-- End-doc extref-dis-->
  <pre class="dfn">
<a name="NW0-37vqZD-4" href="#NW0-37vqZD-1" id="NW0-37vqZD-4"><dfn>&lt;Initialize <code>nwweavefilt</code>&gt;+=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a>)</b> <b>[<a href="#NW0-37vqZD-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">%ch</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># final args are $noweb_order</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">%feqv</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$disext</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># find included files</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for </span><span class="kwc">my </span><span class="kwb">$a </span><span class="opt">(</span><span class="kwb">@ARGV</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">open</span><span class="opt">(</span>A<span class="opt">, </span><span class="kwb">$a</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(&lt;</span>A<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$disext </span><span class="opt">= </span><span class="kwd">/^%%% no-ext-ref$/</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">last if </span><span class="kwb">$disext</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwd">/^\\input{(.*\.nw)}$/ </span><span class="kwc">or </span><span class="kwa">next</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$feqv</span><span class="opt">{</span><span class="kwb">$1</span><span class="opt">} = </span><span class="kwb">$a</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">unless</span><span class="opt">(</span><span class="kwb">$disext</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">my </span><span class="kwb">$myf </span><span class="opt">= </span><span class="kwc">pop </span><span class="kwb">@ARGV</span><span class="opt">; </span><span class="slc"># my name is always last; skip it</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># now loop over files, making included files look like includer</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">for </span><span class="kwc">my </span><span class="kwb">$a </span><span class="opt">(</span><span class="kwb">@ARGV</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">my </span><span class="kwb">$f </span><span class="opt">= </span><span class="kwb">$a</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(</span><span class="kwb">$feqv</span><span class="opt">{</span><span class="kwb">$f</span><span class="opt">}) { </span><span class="kwb">$f </span><span class="opt">= </span><span class="kwb">$feqv</span><span class="opt">{</span><span class="kwb">$f</span><span class="opt">}; }</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">next if</span><span class="opt">(</span><span class="kwb">$f </span><span class="kwc">eq </span><span class="kwb">$myf</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">open</span><span class="opt">(</span>A<span class="opt">, </span><span class="kwb">$a</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while</span><span class="opt">(&lt;</span>A<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^&lt;&lt;(.*)&gt;&gt;=$/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwb">$ch</span><span class="opt">{</span><span class="kwb">$1</span><span class="opt">} = </span><span class="kwb">$f </span><span class="kwa">unless </span><span class="kwb">$ch</span><span class="opt">{</span><span class="kwb">$1</span><span class="opt">};</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4N5W31-2" href="#NW0-4N5W31-1" id="NW0-4N5W31-2"><dfn>&lt;Filter lines from NoWeb token stream&gt;+=</dfn></a> <b>(<a href="#NW0-1ey5ZX-1">&lt;-U</a> <a href="#NW0-3henEn-2">&lt;-U</a> <a href="#NW0-krEPi-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4N5W31-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(!</span><span class="kwb">$disext </span><span class="kwc">and </span><span class="opt">(</span><span class="kwd">/^(\@use )(.*)/ </span><span class="kwc">or </span><span class="kwd">/^(\@defn )(.*)/</span><span class="opt">) </span><span class="kwc">and </span><span class="kwb">$ch</span><span class="opt">{</span><span class="kwb">$2</span><span class="opt">}) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$_ </span><span class="opt">= </span><span class="str">"</span><span class="ipl">$1</span><span class="str">(</span><span class="ipl">$ch</span><span class="str">{</span><span class="ipl">$2</span><span class="str">}) </span><span class="ipl">$2</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>There is little point in separating consecutive code chunks with a lot of white space, so the excess whitespace added by NoWeb needs to be removed.</p>
  <pre class="dfn">
<a name="NW0-2gwkBI-1" href="#NW0-2gwkBI-1" id="NW0-2gwkBI-1"><dfn>&lt;Reduce interchunk whitespace&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
/\\nwendcode{}\\nwbegindocs/{
</pre>
      </li>

      <li>
        <pre>
  N;N
</pre>
      </li>

      <li>
        <pre>
  /\\lstset/{s/$/%/;N;}
</pre>
      </li>

      <li>
        <pre>
  /\\nwenddocs/{s/\\nwbegindocs.*docspar\n\n//;s/\\nwenddocs{}//;}
</pre>
      </li>

      <li>
        <pre>
}
</pre>
      </li>
    </ol>
  </div>

  <p>Then, the LaTeX preamble needs to be added. Except for the overall document style, this is mostly the same for all documents. This means that the first line, the document style, must come before the common preamble. Rather than looking for that particular line, a special comment is replaced:</p>

  <blockquote>
    <pre>
 %%% latex preamble
</pre>
  </blockquote>The following script does this, and brings all of the above together. In order to merge sources correctly, the dependency order (tree) needs to be passed in as well as the input and output file names. The highlight theme can be selected using a command-line parameter. Selection of the listings package versus an external highlighter is done by prefixing the highlight theme name with <code>list:</code>.
  <pre class="dfn">
<a name="NW0-3TUZd-A" href="#NW0-3TUZd-1" id="NW0-3TUZd-A"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-9">&lt;-</a>D<a href="#NW0-3TUZd-B">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Highlight theme for PDF/HTML formatted source code</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Blank uses default highlight style; prefix w/ list: to use listings package</span>
</pre>
      </li>

      <li>
        <pre>
HL_THEME<span class="opt">:=</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-G" href="#NW0-3uTryu-1" id="NW0-3uTryu-G"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-F">&lt;-</a>D<a href="#NW0-3uTryu-H">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">%</span>.<span class="kwa">tex</span><span class="opt">: %</span>.nw nw2latex <span class="opt">$(</span>call tree<span class="opt">,%</span>.nw<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
        .<span class="opt">/</span>nw2latex <span class="opt">$&lt; $</span>@ <span class="str">"$(call tree,$&lt;)"</span> <span class="str">"$(HL_THEME)"</span> <span class="str">"$(HLPROG_TYPE)"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3CYAWn-5" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-5"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-4">&lt;-</a>D<a href="#NW0-3CYAWn-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nw2latex \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-H" href="#NW0-3uTryu-1" id="NW0-3uTryu-H"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-G">&lt;-</a>D<a href="#NW0-3uTryu-I">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nw2latex<span class="opt">: </span>latexhl nwweavefilt addlistings
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3yZ7b5-1" href="#NW0-3yZ7b5-1" id="NW0-3yZ7b5-1"><dfn>&lt;nw2latex&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3yZ7b5-1-u1" href="#NW0-3IzIGd-1" id="NW0-3yZ7b5-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
noweb<span class="opt">=</span><span class="str">"$1"</span>
</pre>
      </li>

      <li>
        <pre>
outf<span class="opt">=</span><span class="str">"$2"</span>
</pre>
      </li>

      <li>
        <pre>
noweb_order<span class="opt">=</span><span class="str">"$3"</span>
</pre>
      </li>

      <li>
        <pre>
theme<span class="opt">=</span><span class="str">"$4"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span><span class="str">"$5"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># prefix theme with "list:" to enable lstlistings</span>
</pre>
      </li>

      <li>
        <pre>
uselst<span class="opt">=</span><span class="str">"${theme%%:*}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span><span class="str">"list"</span> <span class="opt">= </span><span class="str">"$uselst"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  theme<span class="opt">=</span><span class="str">"${theme#list:}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  uselst<span class="opt">=</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3yZ7b5-1-u2" href="#NW0-2XhvLA-1" id="NW0-3yZ7b5-1-u2"><i>&lt;Prepare for weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3yZ7b5-1-u3" href="#NW0-3kj8WK-1" id="NW0-3yZ7b5-1-u3"><i>&lt;Prepare for <code>latexhl</code>&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">ln</span><span class="opt">=</span><span class="str">`grep -n '^%%% latex preamble' "$noweb" | cut -d: -f1 | head -n 1`</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">head </span><span class="opt">-</span>n <span class="kwd">$ln </span><span class="str">"$noweb"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">cat </span><span class="opt">&lt;&lt;</span><span class="str">"EOF"</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3yZ7b5-1-u4" href="#NW0-3tjoYz-1" id="NW0-3yZ7b5-1-u4"><i>&lt;preamble.tex&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">tail </span><span class="opt">-</span>n <span class="opt">+</span>$<span class="opt">((</span><span class="kwc">ln</span><span class="opt">+</span><span class="num">1</span><span class="opt">)) </span><span class="str">"$noweb"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">) </span>| <a name="NW0-3yZ7b5-1-u5" href="#NW0-fv4qo-1" id="NW0-3yZ7b5-1-u5"><i>&lt;Pre-process before weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  noweave <span class="opt">-</span>filter <span class="str">"./nwweavefilt $filt $noweb_order"</span> \
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">-</span>delay <span class="opt">-</span>index <span class="opt">- </span>| <a name="NW0-3yZ7b5-1-u6" href="#NW0-3ze0zA-1" id="NW0-3yZ7b5-1-u6"><i>&lt;Post-process latex after weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
            <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'<a name="NW0-3yZ7b5-1-u7" href="#NW0-2gwkBI-1" id="NW0-3yZ7b5-1-u7"><i>&lt;Reduce interchunk whitespace&gt;</i></a>'</span> <span class="opt">-</span>e <span class="str">"$postproc"</span> <span class="opt">&gt;</span><span class="str">"$outf"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2XhvLA-4" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-4"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-3">&lt;-</a>D<a href="#NW0-2XhvLA-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$uselst"</span> <span class="opt">-</span>a <span class="opt">-</span>n <span class="str">"$HLPROG_TYPE"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  filt<span class="opt">=</span>.<span class="opt">/</span>latexhl
</pre>
      </li>

      <li>
        <pre>
  postproc<span class="opt">=</span><span class="str">'<a name="NW0-2XhvLA-4-u1" href="#NW0-4FDXe1-1" id="NW0-2XhvLA-4-u1"><i>&lt;Insert code header into frame&gt;</i></a>'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  filt<span class="opt">=</span>.<span class="opt">/</span>addlistings
</pre>
      </li>

      <li>
        <pre>
  postproc<span class="opt">=</span><span class="str">'<a name="NW0-2XhvLA-4-u2" href="#NW0-3R5hvL-1" id="NW0-2XhvLA-4-u2"><i>&lt;Change <code>nwcode</code> to <code>listings</code>&gt;</i></a>'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'<a name="NW0-2XhvLA-4-u3" href="#NW0-3zBk6n-1" id="NW0-2XhvLA-4-u3"><i>&lt;Change <code>highlight</code> style to <code>listings</code> style&gt;</i></a>'</span> \
</pre>
      </li>

      <li>
        <pre>
     <span class="opt">&lt; </span>latexhl.sty <span class="opt">&gt; </span>latexhl.sty.$$
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">mv </span>latexhl.sty.$$ latexhl.sty
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The LaTeX preamble is fairly straightforward. The <code>fontenc</code>, <code>inputenc</code>, <code>fontspec</code> and <code>babel</code> packages are pretty much required anywhere. The input encoding is forced to latin1 for <code>pdflatex</code>; it is expected that <code>xelatex</code> be used for Unicode. The <code>noweb</code> package is obviously needed for the NoWeb output. The <code>rcs</code> package is included to easily incorporate those nasty $-heavy RCS/CVS/SVN keywords. The <code>ifpdf</code> and <code>ifxetex</code> packages are needed for using this LaTeX source with non-PDF output and non-Unicode input. The standard PDF font packages are used to reduce the PDF size and hopefully look smoother on a greater number of operating systems. The <code>graphicx</code> package is the easiest way to include figures; the PDF output styles should use scalable PDF for figure sources (most other types can be converted to this). The <code>listings</code>, <code>color</code>, and <code>xcolor</code> packages and the <code>latexhl</code> highlight theme file are required for color syntax highlighting. The <code>headings</code> package gives more informative headers and footers by default. The <code>hyperref</code> package gives hyperlinks in the PDF file. Links are made less distracting by replacing the red outline box with dark blue-colored text, and URL links are colored the same way. The <code>multitoc</code> package provides multi-column tables of contents, which once again is to reduce the number of pages a bit.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-1" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-1"><dfn>&lt;preamble.tex&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[D<a href="#NW0-3tjoYz-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span><span class="kwb">T1</span><span class="opt">]{</span><span class="kwb">fontenc</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>ifxetex<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Use Latin Modern; selecting standard PDF fonts does not work</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Latin Modern doesn't look that great, though (it's apparently not an</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% exact duplicate of Computer Modern), but it's easy to set fonts after</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% the standard preamble.</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>fontspec<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% \documentclass[twoside,english]{..} doesn't seem to work right with</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% xetex.  Using polyglossia seems to help, with a language setting</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% after the standard preamble instead (using \setdefaultlanguage)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>polyglossia<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span><span class="kwb">latin1</span><span class="opt">]{</span><span class="kwb">inputenc</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>babel<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>rcs<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>ifpdf<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Use standard fonts for PDF output</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>courier<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span>scaled<span class="opt">]{</span>helvet<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>mathptmx<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>noweb<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span><span class="kwb">graphicx</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Use pdf figs by default (hack)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatletter</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\Gin</span>@extensions<span class="opt">{</span>.pdf<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatother</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Use pdf figs by default (hack)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatletter</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\Gin</span>@extensions<span class="opt">{</span>.pdf<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatother</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>listings<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span><span class="kwb">color</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span>usenames,dvipsnames,svgnames,x11names,table<span class="opt">]{</span>xcolor<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>latexhl<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\pagestyle</span><span class="opt">{</span>headings<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% new since 2009: rerunfilecheck (automatic include by hyperref)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span>aux<span class="opt">]{</span>rerunfilecheck<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Hyperlink it!</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\definecolor</span><span class="opt">{</span>darkblue<span class="opt">}{</span>rgb<span class="opt">}{</span><span class="num">0</span>,<span class="num">0</span>,<span class="num">0.3</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span>colorlinks=true,linkcolor=darkblue,urlcolor=darkblue<span class="opt">]{</span>hyperref<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% And set the title/author properly (taken from hyperref slides.pdf)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatletter</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\newcommand</span><span class="opt">{</span><span class="kwa">\org</span>@maketitle<span class="opt">}{}</span><span class="slc">% ensure not defined</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\let\org</span>@maketitle<span class="kwa">\maketitle</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\maketitle</span><span class="opt">{</span><span class="kwa">\hypersetup</span><span class="opt">{</span>pdftitle=<span class="opt">{</span>\@title<span class="opt">}</span>, pdfauthor=<span class="opt">{</span>\@author<span class="opt">}}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\org</span>@maketitle<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Multi-column table of contents</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">[</span>toc,lof<span class="opt">]{</span>multitoc<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p><!-- there were some issues on older TeX; not sure any more:-->
  <!--% Get "Bad space factor(0)" if this isn't here (very strange)-->
  <!--\makeatletter-->
  <!--\@savsf=1-->
  <!--\makeatother-->
   Then, some adjustments need to be made for NoWeb. NoWeb's <code>\setupcode</code> does some adjustments to LaTeX layout that override the code highlighting, so that is disabled. NoWeb tries too hard to keep code chunks on one page, so some adjustments are made to those parameters. Finally, the NoWeb cross reference listings are adjusted a bit and the code size is made smaller. Also, the `never defined' message should probably be changed for imported symbols, and in fact all imported symbols should be shown identically. It is not currently possible to remove the `never defined' message completely, so it is changed to `(imported)' even if it is not imported.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-2" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-2"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-3tjoYz-1">&lt;-</a>D<a href="#NW0-3tjoYz-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% Code formatting is done by highlight/lstlisting, not noweb</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\setupcode</span><span class="opt">{</span><span class="kwa">\Tt</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% This is from the noweb FAQ</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Allow code chunks to span pages</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\nwendcode</span><span class="opt">{</span><span class="kwa">\endtrivlist \endgroup</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%\def\nwendcode{\endtrivlist \endgroup \vfil\penalty10\vfilneg}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Allow docs to be split from code chunks</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\let\nwdocspar</span>=<span class="kwa">\smallbreak</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%\let\nwdocspar=\par</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% try a little harder to keep code chunks on one page</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\nwcodepenalty</span>=<span class="num">1000</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Code can be huge, so make it smaller (smallcode, scriptsizecode, footnotesizecode)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Make chunk index useful (longchunks)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Remove xrefs from chunks themselves (noidentxref)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\noweboptions</span><span class="opt">{</span>footnotesizecode,longchunks,noidentxref<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% change "never defined" to "imported"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatletter</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def</span>\@nwlangdepnvd<span class="opt">{</span>imported<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatother</span>
</pre>
      </li>
    </ol>
  </div>

  <p>One other thing I usually do for code is to allow line breaks after underscores.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-3" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-3"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-3tjoYz-2">&lt;-</a>D<a href="#NW0-3tjoYz-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% break lines after _</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\let\oldunderscore\_</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\_</span><span class="opt">{</span><span class="kwa">\oldunderscore\discretionary</span><span class="opt">{}{}{}}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, the syntax highlighter adjustments need to be made.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-4" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-4"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-3tjoYz-3">&lt;-</a>D<a href="#NW0-3tjoYz-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-3tjoYz-4-u1" href="#NW0-3KBSPj-1" id="NW0-3tjoYz-4-u1"><i>&lt;Preamble Adjustments for <code>listings</code>&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% for highlight</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3tjoYz-4-u2" href="#NW0-4MAejL-1" id="NW0-3tjoYz-4-u2"><i>&lt;Framed Code Preamble&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3tjoYz-4-u3" href="#NW0-4MAejL-1" id="NW0-3tjoYz-4-u3"><i>&lt;Framed Code Preamble&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc15" id="toc15">Attaching Files</a></h3>

  <p>In addition to the adjustments for appearance, the source files need to be attached. Attachments are done using the LaTeX <code>navigator</code> package. The <code>embedfile</code> package used by previous versions of this build sytem does not support <code>xelatex</code>. The old command is retained, though; any files in addition to the source files must be attached using the <code>\embedfile</code> command in order for other portions of the build system to pick up the files properly.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-5" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-5"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-3tjoYz-4">&lt;-</a>D<a href="#NW0-3tjoYz-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>embedfile<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>navigator<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\embedfile</span><span class="kwc">#1</span><span class="opt">{</span><span class="kwa">\embeddedfile</span><span class="opt">{</span><span class="kwc">#1</span><span class="opt">}{</span><span class="kwc">#1</span><span class="opt">}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-fv4qo-1" href="#NW0-fv4qo-1" id="NW0-fv4qo-1"><dfn>&lt;Pre-process before weave&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[D<a href="#NW0-fv4qo-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">(</span>att_nwo<span class="opt">=</span><span class="str">"`echo $noweb_order | \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                 sed -e 's/</span><span class="esc">\\</span><span class="str">([-_a-zA-Z.]*</span><span class="esc">\\</span><span class="str">) */</span><span class="esc">\\\\\\\\</span><span class="str">embedfile{</span><span class="esc">\\</span><span class="str">1}%</span><span class="esc">\\\\</span><span class="str">n/g'`"</span>
</pre>
      </li>

      <li>
        <pre>
 <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'s/^</span><span class="esc">\\</span><span class="str">begin{document}/'</span><span class="str">"$att_nwo&amp;/"</span><span class="opt">) </span>| \
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc16" id="toc16">User Documentation</a></h3>

  <p>One challenge with literate programming is to provide separate user-level documentation that keeps track of the source code as well as the design documentation. For this, a few code reinsertion tricks are used. First, excerpts from the documentation can be reinserted at a chosen location. These excerpts are surrounded with begin and end comments, which must be at the beginning of the line:</p>

  <blockquote>
    <tt>%Begin-doc <em>chunk-name</em><br />
    ...<br />
    %End-doc <em>chunk-name</em></tt>
  </blockquote>

  <p>The chunk name should consist only of alphanumeric characters, minus signs, and underscores. Insertion is done using a special input command:</p>

  <blockquote>
    <tt><i>\</i>input{<em>chunk-name</em>.tex}%%%doc</tt>
  </blockquote>

  <p>This is done before weaving so that NoWeb formatting can be done on this, as well. It requires two passes in case the chunks are out of order or in different files. The first pass extracts the chunks, and the second pass replaces any remaining unresolved internal references.</p>
  <pre class="dfn">
<a name="NW0-2XhvLA-5" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-5"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-4">&lt;-</a>D<a href="#NW0-2XhvLA-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">eval </span><span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="esc">\'</span><span class="str">'s/^</span><span class="esc">\\</span><span class="str">input{\(.*\)\.tex} %%% doc$/\1/p'</span><span class="esc">\' </span><span class="kwd">$noweb_order </span>| \
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">sort </span><span class="opt">-</span>u | <span class="kwa">while </span><span class="kwb">read </span>c<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">"/^</span><span class="esc">\\\\</span><span class="str">input{${c}</span><span class="esc">\\</span><span class="str">.tex} %%% doc\$/{s/.*/%/;a</span><span class="esc">\\</span><span class="str">%</span><span class="esc">\\</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">eval </span><span class="kwc">sed </span><span class="opt">-</span>n <span class="str">"'/^% Begin-doc $c\$/,/^% End-doc $c\$/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                  /^% Begin-doc $c\$/!{/^% End-doc $c\$/!"</span><span class="str">'{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                    s/</span><span class="esc">\\</span><span class="str">/</span><span class="esc">\\\\</span><span class="str">/g;s/$/</span><span class="esc">\\</span><span class="str">/;p;};};}'</span><span class="esc">\' </span><span class="kwd">$noweb_order </span>| <span class="kwc">sed </span><span class="str">'$s/.$//'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'}'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">done </span><span class="opt">&gt; /</span>tmp<span class="opt">/</span>latexhl.doc.$$
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while </span><span class="kwc">grep </span><span class="str">'^</span><span class="esc">\\\\</span><span class="str">input{.*\.tex} %%% doc</span><span class="esc">\\</span><span class="str">$'</span> <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc.$$ <span class="opt">&gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     s/\^/^</span><span class="esc">\\\\</span><span class="str">/;s/doc\$/doc</span><span class="esc">\\\\</span><span class="str">\$/;s^/%/^/%</span><span class="esc">\\\\</span><span class="str">/^;h;s/$/</span><span class="esc">\\\\</span><span class="str">/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     :a x;s/</span><span class="esc">\\\\</span><span class="str">//g;/</span><span class="esc">\\</span><span class="str">$/!{x;s/$/</span><span class="esc">\\</span><span class="str">/;n;b};x;n;h;s/</span><span class="esc">\\</span><span class="str">/</span><span class="esc">\\\\</span><span class="str">/g;s/$/</span><span class="esc">\\</span><span class="str">/;ba'</span> \
</pre>
      </li>

      <li>
        <pre>
              <span class="opt">&lt; /</span>tmp<span class="opt">/</span>latexhl.doc.$$ <span class="opt">&gt;/</span>tmp<span class="opt">/</span>latexhl.doc2.$$
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">sed </span><span class="opt">-</span>f <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc2.$$ <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc.$$ <span class="opt">&gt;/</span>tmp<span class="opt">/</span>latexhl.doc3.$$
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">mv </span><span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc3.$$ <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc.$$
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-fv4qo-2" href="#NW0-fv4qo-1" id="NW0-fv4qo-2"><dfn>&lt;Pre-process before weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-fv4qo-1">&lt;-</a>D<a href="#NW0-fv4qo-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>f <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.doc.$$ | \
</pre>
      </li>
    </ol>
  </div>

  <p>One problem with reinsertion is that labels are duplicated. While leaving the labels out manually works, it is cumbersome and may not be what is wanted. For example, one way to split the user documentation into a separate file is to reinsert it into an otherwise empty NoWeb source file. Stripping the labels out manually means that the labels will be undefined in the fresh document. A better way is to have them automatically filtered out.</p>

  <p>One problem with filtering them out is deciding which one to filter out. Ideally, both would be kept, and the reinserted one would be given a new, unique name, and all references to that label within reinserted text would be updated as well. This is a task for a future revision, though. In fact, even deciding that the main text or the reinserted text should be preferred is too complex of a question for now. Instead, the first label after all reinsertions are complete is kept, and all others are removed. As an additional level of stupidity, label commands may not span lines or contain curly braces. They may also not appear after a percent-sign character on the same line, even if that percent sign is escaped for LaTeX.</p>
  <pre class="dfn">
<a name="NW0-fv4qo-3" href="#NW0-fv4qo-1" id="NW0-fv4qo-3"><dfn>&lt;Pre-process before weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-fv4qo-2">&lt;-</a>D<a href="#NW0-fv4qo-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">awk </span><span class="str">'<a name="NW0-fv4qo-3-u1" href="#NW0-1BJ79o-1" id="NW0-fv4qo-3-u1"><i>&lt;Remove duplicate labels from LaTeX source&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     { print }'</span> | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1BJ79o-1" href="#NW0-1BJ79o-1" id="NW0-1BJ79o-1"><dfn>&lt;Remove duplicate labels from LaTeX source&gt;=</dfn></a> <b>(<a href="#NW0-fv4qo-3">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">/(</span>^|<span class="opt">[</span>^<span class="esc">\\</span><span class="opt">])</span><span class="esc">\\</span>label<span class="opt">{/ {</span>
</pre>
      </li>

      <li>
        <pre>
  s = $<span class="num">0</span>
</pre>
      </li>

      <li>
        <pre>
  os = <span class="str">""</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwa">match</span><span class="opt">(</span>s<span class="opt">, </span><span class="str">"</span><span class="esc">\\\\</span><span class="str">label</span><span class="esc">\\</span><span class="str">{[^}]*</span><span class="esc">\\</span><span class="str">}"</span><span class="opt">)) {</span>
</pre>
      </li>

      <li>
        <pre>
    os = os <span class="kwa">substr</span><span class="opt">(</span>s<span class="opt">, </span><span class="num">1</span><span class="opt">, </span><span class="kwb">RSTART </span><span class="opt">- </span><span class="num">1</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    l = <span class="kwa">substr</span><span class="opt">(</span>s<span class="opt">, </span><span class="kwb">RSTART</span><span class="opt">, </span><span class="kwb">RLENGTH</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    s = <span class="kwa">substr</span><span class="opt">(</span>s<span class="opt">, </span><span class="kwb">RSTART </span>+ <span class="kwb">RLENGTH</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>l in gotit<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">continue</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    os = os l
</pre>
      </li>

      <li>
        <pre>
    gotit<span class="opt">[</span>l<span class="opt">] </span>= <span class="num">1</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">print</span><span class="opt">(</span>os s<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">next</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Another problem is that there is more than one way to create a label. For example, the sectioning commands may be redefined to automatically create a label based on the section name. This document defines no such things <sup><a href="#fn9">9</a></sup> , but as implemented above, more awk code can be added to <code><a href="#NW0-1BJ79o-1"><i>&lt;Remove duplicate labels from LaTeX source&gt;</i></a></code>.</p>

  <p>One other problem peculiar to NoWeb text is that chunk references are reformatted in a way that assumes the chunk is defined in the same document. When documenting chunk names themselves, like this document does, this will clutter up the text with useless undefined chunk reference labels. Setting the undefined reference text to empty helps a little, but it leaves a blank space between the chunk name and the terminating bracket. Since this is a feature of <code>noweave</code>, it can't really be filtered out for all files. As a kludge, if no chunks are defined in a document at all, the reference markers are filtered out. Nothing is done for HTML output, since this only results in links that go nowhere.</p>
  <pre class="dfn">
<a name="NW0-3ze0zA-1" href="#NW0-3ze0zA-1" id="NW0-3ze0zA-1"><dfn>&lt;Post-process latex after weave&gt;=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-3ze0zA-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">(</span><span class="kwa">if </span><span class="kwc">grep </span><span class="str">'^&lt;&lt;.*&gt;&gt;=$'</span> <span class="str">"$noweb"</span> <span class="opt">&gt;/</span>dev<span class="opt">/</span>null<span class="opt">; </span><span class="kwa">then </span><span class="kwc">cat</span><span class="opt">; </span><span class="kwa">else </span>\
</pre>
      </li>

      <li>
        <pre>
 <span class="kwc">sed </span><span class="str">'s/~{</span><span class="esc">\\</span><span class="str">nwtagstyle{}[^}]*}}//g'</span><span class="opt">; </span><span class="kwa">fi</span><span class="opt">) </span>| \
</pre>
      </li>
    </ol>
  </div>

  <p>Second, plain text chunks can be extracted, highlighted, and reinserted using a special input command as well. This has only one percent (vs. three) to distinguish it from the directive above:</p>

  <blockquote>
    <tt><i>\</i>input{<em>file</em>.tex}%<em>language</em></tt>
  </blockquote>

  <p>Rather than actually generate an additional file, the input directive is replaced with what would have been the contents of that file. This also allows the file to only contain contents given the source and any dependencies, rather than also including contents from sources which extend the contents. This is done after weaving, since the text is always literal, but a preprocessing step is required to avoid NoWeb substitutions during the weave. The sed script to generate the sed script cannot be done in a backtick expression, because the argument list may overflow. Generating the script to a file also reduces the number of backslash escapes required.</p>

  <p>It seems pointless to highlight plain text files, but it may still be desirable to give it a colored background. For cases where this is not so, a special language <tt>verbatim</tt> can be used to instead insert the code as verbatim quoted plain text.</p>
  <pre class="dfn">
<a name="NW0-fv4qo-4" href="#NW0-fv4qo-1" id="NW0-fv4qo-4"><dfn>&lt;Pre-process before weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-fv4qo-3">&lt;-</a>D<a href="#NW0-fv4qo-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="str">'/^</span><span class="esc">\\</span><span class="str">input{.*\.tex} % [^ ]*$/{s/\[\[/@&amp;/g;s/&lt;&lt;/@&amp;/g;}'</span> | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-95lHR-1" href="#NW0-95lHR-1" id="NW0-95lHR-1"><dfn>&lt;For each reinserted code chunk&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-6">U-&gt;</a> <a href="#NW0-24uTRA-3">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'s/^</span><span class="esc">\\</span><span class="str">input{\(.*\)\.tex} % \([^ ]*\)$/\2 \1/p'</span> <span class="kwd">$noweb_order </span>| <span class="kwc">sort </span><span class="opt">-</span>u | \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">while </span><span class="kwb">read </span><span class="opt">-</span>r lang f<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
      fesc<span class="opt">=</span>$<span class="opt">(</span><span class="kwb">printf </span><span class="opt">%</span>s <span class="str">"$f"</span> | <span class="kwc">sed </span><span class="str">'s/[][</span><span class="esc">\\</span><span class="str">.*?^$]/</span><span class="esc">\\</span><span class="str">&amp;/g'</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2XhvLA-6" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-6"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-5">&lt;-</a>D<a href="#NW0-2XhvLA-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-2XhvLA-6-u1" href="#NW0-95lHR-1" id="NW0-2XhvLA-6-u1"><i>&lt;For each reinserted code chunk&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">test </span>verbatim <span class="opt">= </span><span class="kwd">$lang </span>|| <span class="kwb">continue</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">"/^</span><span class="esc">\\\\</span><span class="str">input{${fesc}</span><span class="esc">\\</span><span class="str">.tex} % $lang\$/{s/.*/%/;a</span><span class="esc">\\</span><span class="str">%</span><span class="esc">\\</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">eval </span>notangle <span class="str">'-R"$f"'</span> <span class="kwd">$noweb_order </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | <span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'</span><span class="esc">\b</span><span class="str">egin{quote}</span><span class="esc">\f</span><span class="str">ootnotesize</span><span class="esc">\b</span><span class="str">egin{verbatim}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">sed </span><span class="str">'s/&lt;&lt;/@&lt;&lt;/g;s/&gt;&gt;/@&gt;&gt;/g;s/^@/@@/g'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'\end{verbatim}\end{quote}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">) </span>| <span class="kwc">sed </span><span class="str">'s/</span><span class="esc">\\</span><span class="str">/</span><span class="esc">\\\\</span><span class="str">/g;s/$/</span><span class="esc">\\</span><span class="str">/'</span> | <span class="kwc">sed </span><span class="str">'$s/.$//'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'}'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span><span class="opt">&gt; /</span>tmp<span class="opt">/</span>latexhl.verb.$$
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-2XhvLA-6-u2" href="#NW0-95lHR-1" id="NW0-2XhvLA-6-u2"><i>&lt;For each reinserted code chunk&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">test </span>verbatim <span class="opt">= </span><span class="kwd">$lang </span><span class="opt">&amp;&amp; </span><span class="kwb">continue</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">"/^</span><span class="esc">\\\\</span><span class="str">input{${fesc}</span><span class="esc">\\</span><span class="str">.tex} % $lang\$/{s/.*/%/;a</span><span class="esc">\\</span><span class="str">%</span><span class="esc">\\</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">eval </span>notangle <span class="str">'-R"$f"'</span> <span class="kwd">$noweb_order </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$uselst"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
      .<span class="opt">/</span>latexhl <span class="kwd">$lang </span>| <a name="NW0-2XhvLA-6-u3" href="#NW0-4gEPfm-1" id="NW0-2XhvLA-6-u3"><i>&lt;Insert latexhl output directly&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">'</span><span class="esc">\b</span><span class="str">egin{lstlisting}'</span>
</pre>
      </li>

      <li>
        <pre>
      .<span class="opt">/</span>addlistings <span class="kwd">$lang</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">'\end{lstlisting}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">fi </span>| <span class="kwc">sed </span><span class="str">'s/</span><span class="esc">\\</span><span class="str">/</span><span class="esc">\\\\</span><span class="str">/g;s/$/</span><span class="esc">\\</span><span class="str">/'</span> | <span class="kwc">sed </span><span class="str">'$s/.$//'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'}'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span><span class="opt">&gt; /</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-fv4qo-5" href="#NW0-fv4qo-1" id="NW0-fv4qo-5"><dfn>&lt;Pre-process before weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-fv4qo-4">&lt;-</a>D<a href="#NW0-fv4qo-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>f <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.verb.$$ | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4gEPfm-1" href="#NW0-4gEPfm-1" id="NW0-4gEPfm-1"><dfn>&lt;Insert latexhl output directly&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-6">&lt;-U</a> <a href="#NW0-2XhvLA-7">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="str">'s/^</span><span class="esc">\\</span><span class="str">begin{framed}[^%]*/</span><span class="esc">\\</span><span class="str">begin{quote}</span><span class="esc">\\</span><span class="str">codemargin=0pt&amp;</span><span class="esc">\\</span><span class="str">begin{webcode}/;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">     s/^</span><span class="esc">\\</span><span class="str">end{framed}/</span><span class="esc">\\</span><span class="str">end{webcode}&amp;</span><span class="esc">\\</span><span class="str">end{quote}/'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3ze0zA-2" href="#NW0-3ze0zA-1" id="NW0-3ze0zA-2"><dfn>&lt;Post-process latex after weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a>)</b> <b>[<a href="#NW0-3ze0zA-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>f <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$ | \
</pre>
      </li>
    </ol>
  </div>

  <p>C API documentation requires reinsertion of the function prototype, formatted as C code. Integration into a full API documentation package is beyond the scope of the current document (previous revisions had their own implementation of an API documentation program, but that was for Ada). Instead, only the prototype reinsertion is supported. To insert a prototype, reference it using a specially formatted comment:</p>

  <blockquote>
    <tt>%<em>function</em> prototype</tt>
  </blockquote>

  <p>This is done by gently extracting the prototype from <code>cproto.h</code> using sed. For prototypes which do not appear in <code>cproto.h</code>, the chunk <code><a href="#NW0-3Gq37d-1"><i>&lt;C Prototypes&gt;</i></a></code> may be expanded as well, but only out of the same source file. Since the C preprocessor might transform functions before they become prototypes, the <code><a href="#NW0-2XPbLc-1"><i>&lt;For each reinserted C prototype&gt;</i></a></code> chunk may be extended, transforming <code>$mf</code> as needed. The sed script separates arguments by comma and terminates by close parenthesis (which means that callbacks require typedefs). The code is reinserted with each argument on a separate line, aligned by the first argument, i.e. after the left parenthesis. This is done by converting the text before the parenthesis into spaces, and stripping off the text not to be printed every pass until there is nothing left to print.</p>
  <pre class="dfn">
<a name="NW0-3IkkzD-1" href="#NW0-3IkkzD-1" id="NW0-3IkkzD-1"><dfn>&lt;Format a prototype from <code>cproto.h</code>&gt;=</dfn></a> <b>(<a href="#NW0-2cCi0n-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># strip trailing semicolon to make pattern simpler (never gets readded)</span>
</pre>
      </li>

      <li>
        <pre>
s/;//;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># create spaces out of all text up to first paren and append full proto</span>
</pre>
      </li>

      <li>
        <pre>
h;s/[^(]/ /g;s/(.*/ /;G;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove up to first paren plus up to end of first parameter</span>
</pre>
      </li>

      <li>
        <pre>
s/[^ ][^(]*([^),]*[),] *//;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># strip off 2nd+ parameters &amp; print first line</span>
</pre>
      </li>

      <li>
        <pre>
x;s/\(([^,)]*[,)]\).*/\<span class="num">1</span>/;p;x;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># loop until no more saved text to print</span>
</pre>
      </li>

      <li>
        <pre>
:a
</pre>
      </li>

      <li>
        <pre>
/^ *$/b;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># save, strip off 2nd+ paramters &amp; print</span>
</pre>
      </li>

      <li>
        <pre>
h;s/\(^ *[^,)]*[,)]\).*/\<span class="num">1</span>/;p;
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># retrieve, strip off 1st parameter, and loop</span>
</pre>
      </li>

      <li>
        <pre>
g;s/[^ ][^),]*[),] *//;
</pre>
      </li>

      <li>
        <pre>
ba;
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-I" href="#NW0-3uTryu-1" id="NW0-3uTryu-I"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-H">&lt;-</a>D<a href="#NW0-3uTryu-J">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">ifneq </span><span class="opt">($(</span>CFILES<span class="opt">),)</span>
</pre>
      </li>

      <li>
        <pre>
nw2latex<span class="opt">: </span>cproto.h
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2XPbLc-1" href="#NW0-2XPbLc-1" id="NW0-2XPbLc-1"><dfn>&lt;For each reinserted C prototype&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-7">U-&gt;</a> <a href="#NW0-24uTRA-3">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>n <span class="str">'s/^% \(..*\) prototype$/\1/p'</span> <span class="str">"$noweb"</span> | <span class="kwa">while </span><span class="kwb">read </span>f<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  mf<span class="opt">=</span><span class="str">"$f"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2cCi0n-1" href="#NW0-2cCi0n-1" id="NW0-2cCi0n-1"><dfn>&lt;Extract and format a C prototype from <code>cproto.h</code>&gt;=</dfn></a> <b>(<a href="#NW0-2XhvLA-7">U-&gt;</a> <a href="#NW0-24uTRA-3">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
notangle <span class="opt">-</span>R<span class="str">"C Prototypes"</span> <span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null <span class="str">"$noweb"</span> | <span class="kwc">cat </span><span class="opt">- </span>cproto.h | \
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">egrep </span><span class="str">"[^_[:alnum:]]$mf</span><span class="esc">\\</span><span class="str">("</span> | <span class="kwc">head </span><span class="opt">-</span>n <span class="num">1 </span>| \
</pre>
      </li>

      <li>
        <pre>
     <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'<a name="NW0-2cCi0n-1-u1" href="#NW0-3IkkzD-1" id="NW0-2cCi0n-1-u1"><i>&lt;Format a prototype from <code>cproto.h</code>&gt;</i></a>'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2XhvLA-7" href="#NW0-2XhvLA-1" id="NW0-2XhvLA-7"><dfn>&lt;Prepare for weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-1">U-&gt;</a>)</b> <b>[<a href="#NW0-2XhvLA-6">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-2XhvLA-7-u1" href="#NW0-2XPbLc-1" id="NW0-2XhvLA-7-u1"><i>&lt;For each reinserted C prototype&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">"/^% $f prototype\$/{a</span><span class="esc">\\</span><span class="str">%</span><span class="esc">\\</span><span class="str">"</span>
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-2XhvLA-7-u2" href="#NW0-2cCi0n-1" id="NW0-2XhvLA-7-u2"><i>&lt;Extract and format a C prototype from <code>cproto.h</code>&gt;</i></a> | \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if </span><span class="opt">[ -</span>z <span class="str">"$uselst"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
      .<span class="opt">/</span>latexhl C | <a name="NW0-2XhvLA-7-u3" href="#NW0-4gEPfm-1" id="NW0-2XhvLA-7-u3"><i>&lt;Insert latexhl output directly&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">'</span><span class="esc">\b</span><span class="str">egin{lstlisting}'</span>
</pre>
      </li>

      <li>
        <pre>
      .<span class="opt">/</span>addlistings C
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">printf </span><span class="opt">%</span>s<span class="esc">\\</span>n <span class="str">'\end{lstlisting}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">fi </span>| <span class="kwc">sed </span><span class="str">'s/</span><span class="esc">\\</span><span class="str">/</span><span class="esc">\\\\</span><span class="str">/g;s/$/</span><span class="esc">\\</span><span class="str">/'</span> | <span class="kwc">sed </span><span class="str">'$s/.$//'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'}'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span><span class="opt">&gt;&gt; /</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3Gq37d-1" href="#NW0-3Gq37d-1" id="NW0-3Gq37d-1"><dfn>&lt;C Prototypes&gt;=</dfn></a>
</pre>

  <ol class="code"></ol>

  <h3><a name="toc17" id="toc17">Include Directive Processing</a></h3>

  <p>Finally, a method to include an arbitrary NoWeb file is provided. The only way to weave and tangle such files correctly is to insert the contents of the file in place of the include directive. Since <code>\include</code> has other side effects (it forces a page break), only <code>\input</code> is supported. The syntax is very specifically defined in order to avoid conflicts with other <code>\input</code> directives. Namely, it must not have any following text, and the file name must end in <tt>.nw</tt>.</p>
  <pre class="dfn">
<a name="NW0-2DYTCt-1" href="#NW0-2DYTCt-1" id="NW0-2DYTCt-1"><dfn>&lt;Insert included NoWeb files&gt;=</dfn></a> <b>(<a href="#NW0-fv4qo-6">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">awk </span><span class="str">'<a name="NW0-2DYTCt-1-u1" href="#NW0-3IIwMi-1" id="NW0-2DYTCt-1-u1"><i>&lt;Insert included NoWeb files with <code>awk</code>&gt;</i></a>'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3IIwMi-1" href="#NW0-3IIwMi-1" id="NW0-3IIwMi-1"><dfn>&lt;Insert included NoWeb files with <code>awk</code>&gt;=</dfn></a> <b>(<a href="#NW0-2DYTCt-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">function </span>readfile<span class="opt">(</span>f<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span><span class="kwa">getline </span><span class="opt">&lt; </span>f<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>$<span class="num">0 </span>~ <span class="opt">/</span>^<span class="esc">\\</span>input<span class="opt">{[</span>^<span class="opt">}]</span>*\.nw<span class="opt">}</span>$<span class="opt">/) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">sub</span><span class="opt">(</span><span class="str">".*{"</span><span class="opt">, </span><span class="str">""</span><span class="opt">); </span><span class="kwa">sub</span><span class="opt">(</span><span class="str">"}"</span><span class="opt">, </span><span class="str">""</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      fname = $<span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">if</span><span class="opt">(</span><span class="kwa">index</span><span class="opt">(</span>fname<span class="opt">, </span><span class="str">"/"</span><span class="opt">) != </span><span class="num">0 </span><span class="opt">&amp;&amp; </span><span class="kwa">index</span><span class="opt">(</span>f<span class="opt">, </span><span class="str">"/"</span><span class="opt">) &gt;</span>= <span class="num">0</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
        fdir = f<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="kwa">sub</span><span class="opt">(</span><span class="str">"[^/]*$"</span><span class="opt">, </span><span class="str">""</span><span class="opt">, </span>fdir<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
        fname = fdir fname<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
      readfile<span class="opt">(</span>fname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">close</span><span class="opt">(</span>fname<span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">} </span><span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwa">print</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">BEGIN </span><span class="opt">{ </span>readfile<span class="opt">(</span><span class="str">"-"</span><span class="opt">) }</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-fv4qo-6" href="#NW0-fv4qo-1" id="NW0-fv4qo-6"><dfn>&lt;Pre-process before weave&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-fv4qo-5">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<a name="NW0-fv4qo-6-u1" href="#NW0-2DYTCt-1" id="NW0-fv4qo-6-u1"><i>&lt;Insert included NoWeb files&gt;</i></a> | \
</pre>
      </li>
    </ol>
  </div>

  <p><!--tangle needs more thought - need to incorporate into docs-->
  <!--< <Pre-process before tangle> >=-->
  <!--< <Insert included NoWeb files> >-->
  <!--@--></p>

  <h2><a name="toc18" id="toc18">HTML Code Documentation</a></h2>

  <p>The NoWeb file is intended to be written in LaTeX, and converted to HTML after and/or during the weave process.</p>

  <h3><a name="toc19" id="toc19">HTML from TeX4ht</a></h3>

  <p>One way to generate HTML would be to use TeX4ht <sup><a href="#fn10">10</a></sup> . It is supposed to produce output very similar to what <code>pdflatex</code> produces, because it uses LaTeX as its underlying engine. Once again a wrapper script (<code>nwtex2html</code>) is needed.</p>
  <pre class="dfn">
<a name="NW0-42a72-2" href="#NW0-42a72-1" id="NW0-42a72-2"><dfn>&lt;Source Code Documentation Files&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-1">&lt;-U</a>)</b> <b>[<a href="#NW0-42a72-1">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">$(</span><span class="kwa">patsubst </span><span class="opt">%</span>.nw<span class="opt">,%</span>.html<span class="opt">,$(</span>NOWEB_NINCL<span class="opt">)) </span>\
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-NpIT2-1" href="#NW0-NpIT2-1" id="NW0-NpIT2-1"><dfn>&lt;makefile.rules tex4ht&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-L">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">%</span>.html<span class="opt">: %</span>.<span class="kwa">tex </span><span class="opt">$(</span>FIGS_EPS<span class="opt">) </span>nwtex2html
</pre>
      </li>

      <li>
        <pre>
        .<span class="opt">/</span>nwtex2html <span class="opt">$&lt; $</span>@ <span class="str">"$(call tree,$&lt;)"</span> <span class="str">"$(HL_THEME)"</span> <span class="str">"$(HLPROG_TYPE)"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-5" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-5"><dfn>&lt;Clean built files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VdTlf-4">&lt;-</a>D<a href="#NW0-1VdTlf-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">*</span>.html
</pre>
      </li>
    </ol>
  </div>

  <p>A configuration file is needed to set extended options. In particular, the <code>\color</code> command behaves oddly, so an attempt is made to treat it mostly like <code>\textcolor</code> instead. Even then, the background color doesn't show through, so it's forced by placing all code the class <code>lstlisting</code> and setting the color in the style sheet. Overriding the code environments and doing some other fine tuning for TeX4ht is done in the preamble.</p>
  <pre class="dfn">
<a name="NW0-2ia8zq-1" href="#NW0-2ia8zq-1" id="NW0-2ia8zq-1"><dfn>&lt;myhtml.cfg&gt;=</dfn></a> <b>(<a href="#NW0-3Wv0ER-1">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\Preamble</span><span class="opt">{</span>xhtml,uni-html4,css-in,$splitstyle,graphics-,Gin-dim+<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% attempted bug fix for tex4ht color</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\HAssign\textcolornest</span>=<span class="num">0</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatletter</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\reset</span>@<span class="kwb">color</span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\ifnum\textcolornest</span>&gt;<span class="num">0</span><span class="kwa">\gHAdvance\textcolornest </span>by -<span class="num">1</span><span class="kwa">\HCode</span><span class="opt">{</span>&lt;/span&gt;<span class="opt">}</span><span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\special</span><span class="opt">{</span><span class="kwb">color </span>pop<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\makeatother</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\Configure</span><span class="opt">{</span><span class="kwb">color</span><span class="opt">}{</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\gHAdvance\textcolorN </span>by <span class="num">1</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\HCode</span><span class="opt">{</span>&lt;span id="textcolor<span class="kwa">\textcolorN</span>"&gt;<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\Configure</span><span class="opt">{</span>SetHColor<span class="opt">}{</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\gHAdvance\textcolornest </span>by <span class="num">1</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
   <span class="kwa">\Css</span><span class="opt">{</span>span\#textcolor<span class="kwa">\textcolorN</span><span class="opt">{</span><span class="kwb">color</span>:<span class="kwa">\HColor</span><span class="opt">}}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% end bug fix</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\embedfile</span><span class="opt">{</span>build.nw<span class="opt">}</span><span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\begin</span><span class="opt">{</span><span class="kwb">document</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">\Css</span><span class="opt">{</span>.lstlisting <span class="opt">{</span>$(<a name="NW0-2ia8zq-1-u1" href="#NW0-431blg-1" id="NW0-2ia8zq-1-u1"><i>&lt;Extract HTML CSS for current theme's background&gt;</i></a>)
</pre>
      </li>

      <li>
        <pre>
                    margin-left: <span class="num">10</span>pt; margin-right: <span class="num">10</span>pt;<span class="opt">}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\EndPreamble</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-431blg-1" href="#NW0-431blg-1" id="NW0-431blg-1"><dfn>&lt;Extract HTML CSS for current theme's background&gt;=</dfn></a> <b>(<a href="#NW0-2ia8zq-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <span class="opt">-</span>S c <span class="kwd">${theme:+-s $theme} </span><span class="opt">-</span>I <span class="opt">&lt;/</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'/pre.hl/{s/.*{//;s/}.*//;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                 s/\(background-color:#\)ffffff/\1fafafa/;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                 s/#/</span><span class="esc">\\</span><span class="str">#/g;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                 s/font-size.*/font-size: smaller;/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">                 p;}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">'nodoctemplate</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">          "background-color:$docbgcolor; font-size: smaller;"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">          end'</span> <span class="opt">&gt; </span>mybg.outlang
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">--</span>lang<span class="opt">-</span>def<span class="opt">=/</span>dev<span class="opt">/</span>null <span class="opt">--</span>outlang<span class="opt">-</span>def<span class="opt">=</span>mybg.outlang \
</pre>
      </li>

      <li>
        <pre>
                     <span class="kwd">${theme:+--style-css-file=$theme.css} </span><span class="opt">&lt;/</span>dev<span class="opt">/</span>null | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="str">'s/#ffffff/#fafafa/i;s/white/#f6f6f6/i'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">*) </span><span class="kwb">echo </span><span class="str">"background-color:#fafafa; font-size: smaller;"</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3tjoYz-6" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-6"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b> <b>[<a href="#NW0-3tjoYz-5">&lt;-</a>D<a href="#NW0-3tjoYz-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Following is for tex4ht only</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\embedfile</span><span class="kwc">#1</span><span class="opt">{}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\newenvironment</span><span class="opt">{</span>framed<span class="opt">}{</span><span class="kwa">\HCode</span><span class="opt">{</span>&lt;div class="lstlisting"&gt;<span class="opt">}}{</span><span class="kwa">\HCode</span><span class="opt">{</span>&lt;/div&gt;<span class="opt">}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%\renewenvironment{lstlisting}{\HCode{&lt;div class="lstlisting"&gt;}}{\HCode{&lt;/div&gt;}}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\noweboptions</span><span class="opt">{</span>webnumbering,nomargintag<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Minimize mangling by tex4ht:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\lstset</span><span class="opt">{</span>columns=flexible<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% make spaces in chunk names into nbsp</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\let\oldsetupmodname\setupmodname</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\setupmodname</span><span class="opt">{</span><span class="kwa">\oldsetupmodname\catcode</span>`\ =<span class="num">13</span><span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\fi</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The script just calls <code>htlatex</code> in its own directory (because it generates a lot of the same aux files as <code>pdflatex</code>), cleans up the HTML a bit, and tacks on the NoWeb source in compressed, uuencoded form. It depends on a working TeX4ht configuration, which is unfortunately mostly undocumented and easily broken. Configuring TeX4ht is beyond the scope of this document.</p>
  <pre class="dfn">
<a name="NW0-3CYAWn-6" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-6"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-5">&lt;-</a>D<a href="#NW0-3CYAWn-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nwtex2html \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3Wv0ER-1" href="#NW0-3Wv0ER-1" id="NW0-3Wv0ER-1"><dfn>&lt;nwtex2html&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3Wv0ER-1-u1" href="#NW0-3IzIGd-1" id="NW0-3Wv0ER-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
tex<span class="opt">=</span><span class="str">"$1"</span>
</pre>
      </li>

      <li>
        <pre>
base<span class="opt">=</span><span class="str">"${1%.tex}"</span>
</pre>
      </li>

      <li>
        <pre>
noweb<span class="opt">=</span><span class="str">"$base.nw"</span>
</pre>
      </li>

      <li>
        <pre>
outf<span class="opt">=</span><span class="str">"$2"</span>
</pre>
      </li>

      <li>
        <pre>
noweb_order<span class="opt">=</span><span class="str">"$3"</span>
</pre>
      </li>

      <li>
        <pre>
theme<span class="opt">=</span><span class="str">"${4#*:}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span><span class="str">"$5"</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3Wv0ER-1-u2" href="#NW0-xiX8L-1" id="NW0-3Wv0ER-1-u2"><i>&lt;Check highlighter&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
figs<span class="opt">=</span><span class="str">`sed -n 's/^</span><span class="esc">\\\\</span><span class="str">includegraphics.*{</span><span class="esc">\\</span><span class="str">(.*</span><span class="esc">\\</span><span class="str">)}\$/</span><span class="esc">\\</span><span class="str">1.eps/p' $tex`</span>
</pre>
      </li>

      <li>
        <pre>
texi<span class="opt">=</span><span class="str">`sed -n -e 's/^</span><span class="esc">\\\\</span><span class="str">input{</span><span class="esc">\\</span><span class="str">(.*</span><span class="esc">\\</span><span class="str">.tex</span><span class="esc">\\</span><span class="str">)} % .*/</span><span class="esc">\\</span><span class="str">1/p' "$tex"`</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Exit on error</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">set </span><span class="opt">-</span>e
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Done in its own dir to avoid stomping on .pdf aux files</span>
</pre>
      </li>

      <li>
        <pre>
dir<span class="opt">=/</span>tmp<span class="opt">/</span>html.$$
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">rm </span><span class="opt">-</span>rf <span class="kwd">$dir</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">trap </span><span class="str">"rm -rf $dir"</span> <span class="num">0</span>
</pre>
      </li>

      <li>
        <pre>
mkdir <span class="opt">-</span>p <span class="kwd">$dir</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for </span>x <span class="kwa">in </span><span class="kwd">$noweb $tex $figs $texi </span><span class="opt">*</span>.sty<span class="opt">; </span><span class="kwa">do </span><span class="kwc">ln </span><span class="opt">-</span>s <span class="str">"$tdir/$x"</span> <span class="kwd">$dir</span><span class="opt">; </span><span class="kwa">done</span>
</pre>
      </li>

      <li>
        <pre>
tdir<span class="opt">=</span><span class="str">"`pwd`"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">cd </span><span class="kwd">$dir</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">if </span><span class="opt">[ </span>y <span class="opt">= </span><span class="str">"$HTML_SPLIT"</span> <span class="opt">]; </span><span class="kwa">then</span>
</pre>
      </li>

      <li>
        <pre>
  splitstyle<span class="opt">=</span>frames<span class="opt">,</span><span class="num">3</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">else</span>
</pre>
      </li>

      <li>
        <pre>
  splitstyle<span class="opt">=</span>fn<span class="opt">-</span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">fi</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">cat </span><span class="opt">&lt;&lt;</span>EOF <span class="opt">&gt; </span>myhtml.cfg
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3Wv0ER-1-u3" href="#NW0-2ia8zq-1" id="NW0-3Wv0ER-1-u3"><i>&lt;myhtml.cfg&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># runs latex 3x, regardless</span>
</pre>
      </li>

      <li>
        <pre>
htlatex <span class="kwd">$1 </span>myhtml <span class="opt">&gt;&amp;</span><span class="num">2</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">mv </span><span class="opt">*</span>.png <span class="str">"$tdir"</span> <span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null || <span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">for </span>x <span class="kwa">in </span><span class="opt">*</span>.html<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">case </span><span class="str">"$x"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="str">"$outf"</span><span class="opt">) </span>is_outf<span class="opt">=</span>y <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">*) </span>is_outf<span class="opt">=</span>n <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
  perl <span class="opt">-</span>e <span class="str">'<a name="NW0-3Wv0ER-1-u4" href="#NW0-22WGwI-1" id="NW0-3Wv0ER-1-u4"><i>&lt;Post-process TeX4ht output using perl&gt;</i></a>'</span> <span class="str">"$base"</span> <span class="kwd">$is_outf </span><span class="opt">&lt;</span><span class="str">"$x"</span> <span class="opt">&gt;</span><span class="str">"$tdir/$x"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-3Wv0ER-1-u5" href="#NW0-22QiwM-1" id="NW0-3Wv0ER-1-u5"><i>&lt;Print attachments as HTML comment&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">) &gt;&gt;</span><span class="str">"$tdir/$outf"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-22QiwM-1" href="#NW0-22QiwM-1" id="NW0-22QiwM-1"><dfn>&lt;Print attachments as HTML comment&gt;=</dfn></a> <b>(<a href="#NW0-3Wv0ER-1">&lt;-U</a> <a href="#NW0-24uTRA-2">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Attach original file as comment</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># adds 64 to &lt;&gt;- to avoid HTML comment escapes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"&lt;!--"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">at</span><span class="opt">=</span><span class="str">"`sed -n -e 's/^</span><span class="esc">\\\\</span><span class="str">embedfile.*{\([^}]*\)}%*$/\1/p' $noweb | sort -u`"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span>begin <span class="num">644 </span><span class="kwd">${noweb%.*}</span>.<span class="kwc">tar</span>.gz
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">eval </span><span class="kwc">tar </span>chf <span class="opt">- </span><span class="kwd">$noweb_order $at </span>| <span class="kwc">gzip </span>| \
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">uuencode </span><span class="str">"${noweb%.*}"</span>.<span class="kwc">tar</span>.gz | <span class="kwc">tail </span><span class="opt">-</span>n <span class="opt">+</span><span class="num">2 </span>| <span class="kwc">tr </span><span class="str">'&lt;&gt;-'</span> <span class="str">'|~m'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"--&gt;"</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The HTML cleanup is done using a perl script, once again because awk and sed are too slow for at least one of the tasks.</p>
  <pre class="dfn">
<a name="NW0-22WGwI-1" href="#NW0-22WGwI-1" id="NW0-22WGwI-1"><dfn>&lt;Post-process TeX4ht output using perl&gt;=</dfn></a> <b>(<a href="#NW0-3Wv0ER-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">use </span>strict<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt"><a name="NW0-22WGwI-1-u1" href="#NW0-BhJkH-1" id="NW0-22WGwI-1-u1"><i>&lt;Initialize TeX4ht post-processor&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;</span>STDIN<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-22WGwI-1-u2" href="#NW0-4geK2A-1" id="NW0-22WGwI-1-u2"><i>&lt;Post-process TeX4ht line&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-BhJkH-1" href="#NW0-BhJkH-1" id="NW0-BhJkH-1"><dfn>&lt;Initialize TeX4ht post-processor&gt;=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-BhJkH-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$is_outf </span><span class="opt">= </span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">1</span><span class="opt">] </span><span class="kwc">eq </span><span class="str">"y"</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-1" href="#NW0-4geK2A-1" id="NW0-4geK2A-1"><dfn>&lt;Post-process TeX4ht line&gt;=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[D<a href="#NW0-4geK2A-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>?<span class="opt">^&lt;</span>html ?<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="str">"&lt;!--</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="str">"Generated using noweb+tex4ht;"</span> <span class="opt">.</span>
</pre>
      </li>

      <li>
        <pre>
        <span class="str">" original .nw source attached in comment at end</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwb">$is_outf</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">"</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">"Extract with uudecode, or, if uudecode chokes, use:</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">"   tr '</span><span class="esc">\'</span><span class="str">'|~m\`'</span><span class="esc">\'</span><span class="str">' '</span><span class="esc">\'</span><span class="str">'&lt;&gt;- '</span><span class="esc">\'</span><span class="str">' | uudecode -o '</span><span class="esc">\'</span><span class="str">'</span><span class="ipl">$base</span><span class="str">.nw.gz'</span><span class="esc">\'</span><span class="str">'</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">"--&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print </span><span class="str">"of top-level HTML (see that for details on how to extract). --&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>That task, in particular, is to compress the number of color styles. TeX4ht produces a new color style for every use of color, even if it is the same color as a previous use. To fix this, the color styles are extracted from the CSS file, and a hash array is built to associate each with the first style of the same color. Then, all duplicates are filtered from the CSS file and converted to the first version in the HTML.</p>
  <pre class="dfn">
<a name="NW0-4UUkrZ-1" href="#NW0-4UUkrZ-1" id="NW0-4UUkrZ-1"><dfn>&lt;Copy TeX4ht CSS to stdout&gt;=</dfn></a> <b>(<a href="#NW0-4geK2A-3">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># way too many color styles are generated: merge them</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">open </span>CSS<span class="opt">,</span><span class="str">"&lt;</span><span class="ipl">$base</span><span class="str">.css"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(&lt;</span>CSS<span class="opt">&gt;) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwd">/^span#textcolor(\d+)(\{.*\})/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">my </span><span class="opt">(</span><span class="kwb">$colorno</span><span class="opt">, </span><span class="kwb">$colordef</span><span class="opt">) = (</span><span class="kwb">$1</span><span class="opt">, </span><span class="kwb">$2</span><span class="opt">);</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">$textcolor</span><span class="opt">[</span><span class="kwb">$colorno</span><span class="opt">] = </span><span class="kwb">$rootcolor</span><span class="opt">{</span><span class="kwb">$colordef</span><span class="opt">} || </span><span class="kwb">$colorno</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span><span class="kwb">$textcolor</span><span class="opt">[</span><span class="kwb">$colorno</span><span class="opt">] == </span><span class="kwb">$colorno</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwb">$rootcolor</span><span class="opt">{</span><span class="kwb">$colordef</span><span class="opt">} = </span><span class="kwb">$colorno</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">print</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">} </span><span class="kwa">else </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">print</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">close </span>CSS<span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-BhJkH-2" href="#NW0-BhJkH-1" id="NW0-BhJkH-2"><dfn>&lt;Initialize TeX4ht post-processor&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-BhJkH-1">&lt;-</a>D<a href="#NW0-BhJkH-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$base </span><span class="opt">= </span><span class="kwb">$ARGV</span><span class="opt">[</span><span class="num">0</span><span class="opt">];</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">@textcolor</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">%rootcolor</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-BhJkH-3" href="#NW0-BhJkH-1" id="NW0-BhJkH-3"><dfn>&lt;Initialize TeX4ht post-processor&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-BhJkH-2">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">my </span><span class="kwb">$spn </span><span class="opt">= </span><span class="str">"&lt;span id=</span><span class="esc">\"</span><span class="str">textcolor"</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-2" href="#NW0-4geK2A-1" id="NW0-4geK2A-2"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-1">&lt;-</a>D<a href="#NW0-4geK2A-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">foreach </span><span class="kwc">my </span><span class="kwb">$x</span><span class="opt">(</span><span class="kwd">/$spn(\d+)/g</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">s/$spn$x"/$spn$textcolor[$x]"/g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The next post-processing task is to reduce the number of files to one, if possible. This is done by in-lining the CSS. TeX4ht will do this with the right option, but only if run twice, which effectively runs LaTeX six times. Instead, it is just generated directly into the output file during hash table generation.</p>
  <pre class="dfn">
<a name="NW0-4geK2A-3" href="#NW0-4geK2A-1" id="NW0-4geK2A-3"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-2">&lt;-</a>D<a href="#NW0-4geK2A-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">if</span><span class="opt">(</span>?<span class="opt">&lt;</span>meta name<span class="opt">=</span><span class="esc">\"</span>date?<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="str">"&lt;style type=</span><span class="esc">\"</span><span class="str">text/css</span><span class="esc">\"</span><span class="str">&gt;</span><span class="esc">\n</span><span class="str">&lt;!--</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt"><a name="NW0-4geK2A-3-u1" href="#NW0-4UUkrZ-1" id="NW0-4geK2A-3-u1"><i>&lt;Copy TeX4ht CSS to stdout&gt;</i></a></span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">print </span><span class="str">"//--&gt;</span><span class="esc">\n</span><span class="str">&lt;/style&gt;</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">next</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The remainder of the adjustments are minor tweaks to the HTML output.</p>
  <pre class="dfn">
<a name="NW0-4geK2A-4" href="#NW0-4geK2A-1" id="NW0-4geK2A-4"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-3">&lt;-</a>D<a href="#NW0-4geK2A-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># tex4ht inserts a newline before each chunk</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># no easy way to deal right now, so leave it</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-5" href="#NW0-4geK2A-1" id="NW0-4geK2A-5"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-4">&lt;-</a>D<a href="#NW0-4geK2A-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># tex4ht splits lines mid-tag; rejoin at least the span tags</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span><span class="kwd">/&lt;span $/</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwd">s/\n//</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">$_ </span><span class="opt">.= &lt;</span>STDIN<span class="opt">&gt;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-6" href="#NW0-4geK2A-1" id="NW0-4geK2A-6"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-5">&lt;-</a>D<a href="#NW0-4geK2A-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Merge consecutive spans on same line w/ same class into one span</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">while</span><span class="opt">(</span>s<span class="opt">%(&lt;</span>span class<span class="opt">=</span><span class="str">"[^"</span><span class="opt">]*</span><span class="str">"&gt;)([^&lt;]*)&lt;/span&gt;\1%\1\2%) {};</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-7" href="#NW0-4geK2A-1" id="NW0-4geK2A-7"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-6">&lt;-</a>D<a href="#NW0-4geK2A-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Remove plain text spans</span>
</pre>
      </li>

      <li>
        <pre>
s<span class="opt">%&lt;</span>span class<span class="opt">=</span><span class="str">"ecrm-0900"</span><span class="opt">&gt;([^&lt;]*)&lt;/</span>span<span class="opt">&gt;%</span>\<span class="num">1</span><span class="kwb">%g</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-8" href="#NW0-4geK2A-1" id="NW0-4geK2A-8"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-7">&lt;-</a>D<a href="#NW0-4geK2A-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># I prefer mostly plain text for the web, so:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove ligatures</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">s/&amp;#xFB01;/fi/g</span><span class="opt">;</span><span class="kwd">s/&amp;#xFB02;/fl/g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove hex nbsp</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">s/&amp;#x00A0;/\&amp;nbsp;/g</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># remove unicode quotes</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">s/&amp;#8217;/'\''/g</span><span class="opt">;</span><span class="kwd">s/&amp;#8216;/`/g</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4geK2A-9" href="#NW0-4geK2A-1" id="NW0-4geK2A-9"><dfn>&lt;Post-process TeX4ht line&gt;+=</dfn></a> <b>(<a href="#NW0-22WGwI-1">&lt;-U</a>)</b> <b>[<a href="#NW0-4geK2A-8">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># remove trailing space</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwd">s/ *$//</span><span class="opt">;</span>
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc20" id="toc20">HTML from <code>l2h</code></a></h3>

  <p>Another way is to use NoWeb's included <code>l2h</code> filter. This once again requires some filtering, which is complicated enough that it's done in a separate script (<code>nw2html</code>) instead of inline in the makefile. In addition, highlighting of chunks must produce HTML, so a small conversion script (<code>htmlhl</code>) is used. This uses the ordered list output, as the ordered list CSS can be adjusted more easily to look like the LaTeX output.</p>
  <pre class="dfn">
<a name="NW0-3CYAWn-7" href="#NW0-3CYAWn-1" id="NW0-3CYAWn-7"><dfn>&lt;Build Script Executables&gt;+=</dfn></a> <b>(<a href="#NW0-4NQJhz-5">&lt;-U</a>)</b> <b>[<a href="#NW0-3CYAWn-6">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nw2html \
</pre>
      </li>

      <li>
        <pre>
htmlhl \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1H5Xxg-1" href="#NW0-1H5Xxg-1" id="NW0-1H5Xxg-1"><dfn>&lt;htmlhl&gt;=</dfn></a>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1H5Xxg-1-u1" href="#NW0-3IzIGd-1" id="NW0-1H5Xxg-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="kwd">$HLPROG_TYPE </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">]) </span><span class="kwb">echo </span><span class="str">'&lt;ol class="code"&gt;'</span> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-1H5Xxg-1-u2" href="#NW0-2GraQd-1" id="NW0-1H5Xxg-1-u2"><i>&lt;Do generic per-chunk highlighting preparation&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="kwd">$HLPROG_TYPE </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">2</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <span class="opt">-</span>l <span class="opt">--</span>ordered<span class="opt">-</span>list <span class="opt">-</span>f <span class="opt">-</span>S <span class="kwd">$1 </span><span class="opt">-</span>E <span class="kwd">$HLDIR </span>| \
</pre>
      </li>

      <li>
        <pre>
      <a name="NW0-1H5Xxg-1-u3" href="#NW0-1yFQrj-1" id="NW0-1H5Xxg-1-u3"><i>&lt;Filter <code>highlight</code> HTML output&gt;</i></a> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-</span><span class="num">3</span><span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <span class="opt">-</span>l <span class="opt">--</span>ordered<span class="opt">-</span>list <span class="opt">-</span>f <span class="kwd">$larg </span>| \
</pre>
      </li>

      <li>
        <pre>
      <a name="NW0-1H5Xxg-1-u4" href="#NW0-1yFQrj-1" id="NW0-1H5Xxg-1-u4"><i>&lt;Filter <code>highlight</code> HTML output&gt;</i></a> <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># remove last line and move /pre up</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># should probably retain one line if empty</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <span class="opt">-</span>f xhtml<span class="opt">-</span>css <span class="kwd">$larg </span>| \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'s/&lt;pre&gt;&lt;tt&gt;/&lt;pre class="code"&gt;/;x;$s%$%&lt;/pre&gt;%;1!p'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="kwd">$HLPROG_TYPE </span><span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">]) </span><span class="kwb">echo </span><span class="str">'&lt;/ol&gt;'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1yFQrj-1" href="#NW0-1yFQrj-1" id="NW0-1yFQrj-1"><dfn>&lt;Filter <code>highlight</code> HTML output&gt;=</dfn></a> <b>(<a href="#NW0-1H5Xxg-1">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="str">'s%^&lt;/li&gt;$%&lt;li&gt;&lt;/li&gt;%;s/&lt;li[^&gt;]*&gt;/&lt;li&gt;&lt;pre&gt;/;s%&lt;/li&gt;%&lt;/pre&gt;&lt;/li&gt;%'</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-4NQJhz-B" href="#NW0-4NQJhz-1" id="NW0-4NQJhz-B"><dfn>&lt;makefile.vars&gt;+=</dfn></a> <b>[<a href="#NW0-4NQJhz-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
FIGS_PNG<span class="opt">:=$(</span><span class="kwa">patsubst </span><span class="opt">%, %</span>.png<span class="opt">, $(</span>FIGS<span class="opt">))</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2hL9yM-1" href="#NW0-2hL9yM-1" id="NW0-2hL9yM-1"><dfn>&lt;makefile.rules l2h&gt;=</dfn></a> <b>(<a href="#NW0-3uTryu-L">U-&gt;</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nw2html<span class="opt">:  </span>htmlhl nwweavefilt latexhl
</pre>
      </li>

      <li>
        <pre>
<span class="opt">%</span>.html<span class="opt">: %</span>.nw <span class="opt">$(</span>FIGS_PNG<span class="opt">) </span>nw2html
</pre>
      </li>

      <li>
        <pre>
        .<span class="opt">/</span>nw2html <span class="opt">$&lt; $</span>@ <span class="str">"$(call tree,$&lt;)"</span> <span class="str">"$(HL_THEME)"</span> <span class="str">"$(HLPROG_TYPE)"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1VdTlf-6" href="#NW0-1VdTlf-1" id="NW0-1VdTlf-6"><dfn>&lt;Clean built files&gt;+=</dfn></a> <b>(<a href="#NW0-3uTryu-1">&lt;-U</a>)</b> <b>[<a href="#NW0-1VdTlf-5">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">rm </span><span class="opt">-</span>f <span class="opt">*</span>.png
</pre>
      </li>
    </ol>
  </div>

  <p>The wrapper script tacks on a similar header to what the TeX4ht script produces, but using the direct HTML output of <code>highlight</code> for the CSS, and making adjustments to make the HTML appear at least vaguely similar to the PDF.</p>
  <pre class="dfn">
<a name="NW0-24uTRA-1" href="#NW0-24uTRA-1" id="NW0-24uTRA-1"><dfn>&lt;nw2html&gt;=</dfn></a> <b>[D<a href="#NW0-24uTRA-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">#!/bin/sh</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-1-u1" href="#NW0-3IzIGd-1" id="NW0-24uTRA-1-u1"><i>&lt;Common NoWeb Warning&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
noweb<span class="opt">=</span><span class="str">"$1"</span>
</pre>
      </li>

      <li>
        <pre>
outf<span class="opt">=</span><span class="str">"$2"</span>
</pre>
      </li>

      <li>
        <pre>
noweb_order<span class="opt">=</span><span class="str">"$3"</span>
</pre>
      </li>

      <li>
        <pre>
theme<span class="opt">=</span><span class="str">"$4"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">export </span>HLPROG_TYPE<span class="opt">=</span><span class="str">"$5"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># tex version allows list: prefix - ignore if there</span>
</pre>
      </li>

      <li>
        <pre>
theme<span class="opt">=</span><span class="str">"${theme#list:}"</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-1-u2" href="#NW0-2XhvLA-1" id="NW0-24uTRA-1-u2"><i>&lt;Prepare for weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">(</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># This replaces l2h's header</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"&lt;html&gt;&lt;!--</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">Generated using noweb; original .nw source attached as tar.gz in comment at end</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">Extract with uudecode, or, if uudecode chokes, use:</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">   tr '|~m\`' '&lt;&gt;- ' | uudecode -o '${noweb%.*}.tar.gz'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">--&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str"> &lt;head&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">&lt;meta name=</span><span class="esc">\"</span><span class="str">generator</span><span class="esc">\" </span><span class="str">content=</span><span class="esc">\"</span><span class="str">noweave -html -filter l2h, $HLPROG_TYPE</span><span class="esc">\"</span><span class="str">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">  &lt;style type=</span><span class="esc">\"</span><span class="str">text/css</span><span class="esc">\"</span><span class="str">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">  &lt;!--"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">case </span><span class="str">"$HLPROG_TYPE"</span> <span class="kwa">in</span>
</pre>
      </li>

      <li>
        <pre>
  highlight<span class="opt">-[</span><span class="num">23</span><span class="opt">])</span>
</pre>
      </li>

      <li>
        <pre>
    highlight <span class="kwd">${theme:+-s $theme} </span><span class="opt">-</span>S c <span class="opt">-</span>I <span class="opt">&lt;/</span>dev<span class="opt">/</span>null | <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # replace white bg with very light gray to distinguish from text</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      s/\(background-color:#\)ffffff/\1fafafa/g</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # remove extra junk from block style</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      /pre.hl/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/pre.hl/ .code/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/font-size:.*;/font-size: smaller;/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        p</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        # make links look like normal text</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/.code/&amp; a/;s/margin.*;//</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        p</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      }</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      # fix class names</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">      /^\./{s/^/.code /;s/\.hl\././;p;}'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="slc"># option: line #s or not (leave both in HTML for user to see)</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">".code li {display: block;}"</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">"/* either above line to remove line #s, or make space for line #s with: */"</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">echo </span><span class="str">"/* .code {margin-left: 2em;} */"</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">source</span><span class="opt">-</span>highlight<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
    <a name="NW0-24uTRA-1-u3" href="#NW0-2Z6mIC-1" id="NW0-24uTRA-1-u3"><i>&lt;Get all <code>source-highlight</code> color names&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwb">source</span><span class="opt">-</span>highlight <span class="kwd">${theme:+--style-css-file=$theme.css} </span><span class="opt">--</span>doc <span class="opt">-</span>f xhtml \
</pre>
      </li>

      <li>
        <pre>
                     <span class="opt">--</span>lang<span class="opt">-</span>def<span class="opt">=</span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts.lang <span class="opt">&lt; </span><span class="kwb">source</span><span class="opt">-</span>hl<span class="opt">-</span>elts | \
</pre>
      </li>

      <li>
        <pre>
      <span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        # replace white bg with very light gray to distinguish from text</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/\(background-color: *#\)ffffff/\1fafafa/ig</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/\(background-color: *\)white/\1#fafafa/ig</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/&lt;body style="\(.*\)"&gt;/.code { \1; font-size: smaller }/p</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        ta; :a s%&lt;/span&gt;%%g;T</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/\(.*&gt;\)\([^&gt;]*\)$/.code .\2 { \1 }/</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">        s/&lt;span style="//g; s/"&gt;/; /g;p'</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">;;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">esac</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># option: border or not (leave both in HTML for user to see)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"/* optional: add border around code */"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"/* .code {border: thin solid black;} */"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># display code within chunk names correctly</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"code {font-style: normal;}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># display code chunk immediately below chunk name</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"pre.defn {margin-bottom: 0;}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># use same margins as LaTeX</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">".code {margin-left: 10pt; margin-right: 10pt; margin-top: 0; padding: 1px}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># squeeze lines together</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">".code li,pre {margin-top: 0; margin-bottom: 0;}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># make chunk refs more legible by removing underline</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">".code a {text-decoration: none;}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"pre.dfn a {text-decoration: none;}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"//--&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"&lt;/style&gt;"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">) &gt;</span><span class="str">"$outf"</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Next, it runs <code>noweave</code> with the <code>l2h</code> filter. This filter runs after the highlighter. The index generator tries to make switching to a code chunk also show the documentation by passing <code>-docanchor 10</code> to <code>noidx</code>. This places anchors 10 lines above the code chunk, regardless of what is actually there. This can be very bad, so instead, <code>@xref</code> is removed using a filter after <code>-index</code>, and then <code>nodix</code> is called directly using another filter, but without that <code>-docanchor</code> option. If readers want to read the documentation for a code chunk, they will need to just scroll up manually. Doing this eliminates the chunk reference without keeping a placeholder where the index should go, causing the reference to always appear at the end. To fix this, l2h must emit a different tag, which can then be replaced in the post-filter. In any case, post processing of the HTML is required. After the document is generated, the source is once again tacked on as an HTML comment.</p>
  <pre class="dfn">
<a name="NW0-24uTRA-2" href="#NW0-24uTRA-1" id="NW0-24uTRA-2"><dfn>&lt;nw2html&gt;+=</dfn></a> <b>[<a href="#NW0-24uTRA-1">&lt;-</a>D<a href="#NW0-24uTRA-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">( (</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">ln</span><span class="opt">=</span><span class="str">`grep -n '^%%% latex preamble' "$noweb" | cut -d: -f1 | head -n 1`</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">head </span><span class="opt">-</span>n <span class="kwd">$ln </span><span class="str">"$noweb"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">cat </span><span class="opt">&lt;&lt;</span><span class="str">"EOF"</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-2-u1" href="#NW0-40gWcr-1" id="NW0-24uTRA-2-u1"><i>&lt;preamble.l2h&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">% </span>l2h substitution nowebchunks <span class="opt">&lt;/</span>nowebchunks<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">% </span>l2h substitution nowebindex <span class="opt">&lt;/</span>nowebindex<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-2-u2" href="#NW0-3tjoYz-1" id="NW0-24uTRA-2-u2"><i>&lt;preamble.tex&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
EOF
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-24uTRA-2-u3" href="#NW0-2nm5vb-1" id="NW0-24uTRA-2-u3"><i>&lt;Further l2h preamble&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwc">tail </span><span class="opt">-</span>n <span class="opt">+</span>$<span class="opt">((</span><span class="kwc">ln</span><span class="opt">+</span><span class="num">1</span><span class="opt">)) </span><span class="str">"$noweb"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">) </span>| <a name="NW0-24uTRA-2-u4" href="#NW0-fv4qo-1" id="NW0-24uTRA-2-u4"><i>&lt;Pre-process before weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  noweave <span class="opt">-</span>html <span class="opt">-</span>filter <span class="str">"./nwweavefilt ./htmlhl $noweb_order"</span> <span class="opt">-</span>filter l2h <span class="opt">-</span>index \
</pre>
      </li>

      <li>
        <pre>
          <span class="opt">-</span>filter <span class="str">'sed -n "<a name="NW0-24uTRA-2-u5" href="#NW0-1fFkC6-1" id="NW0-24uTRA-2-u5"><i>&lt;Filter out noidx results&gt;</i></a>"'</span> <span class="opt">-</span>filter noidx <span class="opt">- </span>| \
</pre>
      </li>

      <li>
        <pre>
         <a name="NW0-24uTRA-2-u6" href="#NW0-ioWfk-1" id="NW0-24uTRA-2-u6"><i>&lt;Post-process HTML after weave&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
         <span class="kwc">cat</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-2-u7" href="#NW0-22QiwM-1" id="NW0-24uTRA-2-u7"><i>&lt;Print attachments as HTML comment&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">) &gt;&gt;</span><span class="str">"$outf"</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-1fFkC6-1" href="#NW0-1fFkC6-1" id="NW0-1fFkC6-1"><dfn>&lt;Filter out noidx results&gt;=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
/^@nl/{
</pre>
      </li>

      <li>
        <pre>
  h;
</pre>
      </li>

      <li>
        <pre>
:a
</pre>
      </li>

      <li>
        <pre>
  n;
</pre>
      </li>

      <li>
        <pre>
  /^@nl/{H;ba};
</pre>
      </li>

      <li>
        <pre>
  /^@index begin/{
</pre>
      </li>

      <li>
        <pre>
    :b
</pre>
      </li>

      <li>
        <pre>
      n;
</pre>
      </li>

      <li>
        <pre>
      /^@index end/b;
</pre>
      </li>

      <li>
        <pre>
      bb;
</pre>
      </li>

      <li>
        <pre>
  };
</pre>
      </li>

      <li>
        <pre>
  x;p;g;
</pre>
      </li>

      <li>
        <pre>
};
</pre>
      </li>

      <li>
        <pre>
/^@index begin/{
</pre>
      </li>

      <li>
        <pre>
  :b
</pre>
      </li>

      <li>
        <pre>
    n;
</pre>
      </li>

      <li>
        <pre>
    /^@index end/b;
</pre>
      </li>

      <li>
        <pre>
    bb;
</pre>
      </li>

      <li>
        <pre>
};
</pre>
      </li>

      <li>
        <pre>
s%&lt;/nowebindex&gt;%&lt;nowebindex&gt;%;
</pre>
      </li>

      <li>
        <pre>
s%&lt;/nowebchunks&gt;%&lt;nowebchunks&gt;%;
</pre>
      </li>

      <li>
        <pre>
/^@xref/!p
</pre>
      </li>
    </ol>
  </div>

  <p>The LaTeX preamble is supplemented with directives for <code>l2h</code>, which are comments in the form <tt>%l2h <em>directive</em> <em>token</em> <em>arguments</em></tt>. A new command, <code>\hypertxt</code>, is introduced as well, because doing hyperrefs with custom text requires an optional argument, and optional arguments are not supported by <code>l2h</code> directives. The RCS keyword commands must be inserted by extracting them from the original file, or they will end up coming from the build document every time.</p>
  <pre class="dfn">
<a name="NW0-3tjoYz-7" href="#NW0-3tjoYz-1" id="NW0-3tjoYz-7"><dfn>&lt;preamble.tex&gt;+=</dfn></a> <b>(<a href="#NW0-3yZ7b5-1">&lt;-U</a> <a href="#NW0-24uTRA-2">&lt;-U</a>)</b> <b>[<a href="#NW0-3tjoYz-6">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwa">\usepackage</span><span class="opt">{</span>comment<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\excludecomment</span><span class="opt">{</span>rawhtml<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% for l2h, since it doesn't understand opt args</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">\def\hypertxt</span><span class="kwc">#1#2</span><span class="opt">{</span><span class="kwa">\hyperref</span><span class="opt">[</span><span class="kwc">#1</span><span class="opt">]{</span><span class="kwc">#2</span><span class="opt">}}</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-40gWcr-1" href="#NW0-40gWcr-1" id="NW0-40gWcr-1"><dfn>&lt;preamble.l2h&gt;=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc">% Overrides for noweb's l2h</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% Things it doesn't understand</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% template is {, A=arg, [=optarg, C=optarg/save, ==assign, +=white, (=..)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h macro hypertxt 2 &lt;a href="###$1"&gt;#2&lt;/a&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h macro url 1 &lt;a href="#$1"&gt;#$1&lt;/a&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution ref * A{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h envblock centering center</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore discretionary {{{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore nwcodepenalty =</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore edef A{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore excludecomment {</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore the</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore toks A={</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore lstset {</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore lstloadlanguages {</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore lstdefinelanguage [{[{{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore definecolor {{{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore ifpdf</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore ifxetex</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore bkframefalse</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore bkcounttrue</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore ,</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore break</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution textbar |</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution textasciitilde ~</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution textasciicircum ^</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution sim ~</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution textbackslash \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h substitution backslash \</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignoreenv webcode</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h macro input 1 &lt;!-- input #$1 --&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore embedfile [{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% \RCS still needs to go into header to get stripped out properly</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore RCS</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore catcode</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% doesn't understand extensionless image names, or that I want png</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h argblock includegraphics &lt;img#src=" .png"&gt;&lt;br/&gt; [</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% I prefer my footnotes shrunken and italicized</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h argblock footnote &lt;font#size=2&gt;&lt;b&gt;[&lt;/b&gt;&lt;em&gt; &lt;/em&gt;&lt;b&gt;]&lt;/b&gt;&lt;/font&gt;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">%</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">% l2h ignore select@language {</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2nm5vb-1" href="#NW0-2nm5vb-1" id="NW0-2nm5vb-1"><dfn>&lt;Further l2h preamble&gt;=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">grep </span><span class="str">'^</span><span class="esc">\\</span><span class="str">RCS \$'</span> <span class="str">"$noweb"</span> | <span class="kwa">while </span>IFS<span class="opt">= </span><span class="kwb">read </span><span class="opt">-</span>r l<span class="opt">; </span><span class="kwa">do</span>
</pre>
      </li>

      <li>
        <pre>
  l<span class="opt">=</span><span class="str">"${l#*\$}"</span>
</pre>
      </li>

      <li>
        <pre>
  l<span class="opt">=</span><span class="str">"${l%\$*}"</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">"% l2h macro RCS${l%%:*} 0 ${l#*:}"</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">echo </span><span class="str">"% l2h substitution jobname ${noweb%.*}"</span>
</pre>
      </li>
    </ol>
  </div>

  <p>The first required filter is one supplied with <code>l2h</code>: generating the hyperlinked table of contents.</p>
  <pre class="dfn">
<a name="NW0-ioWfk-1" href="#NW0-ioWfk-1" id="NW0-ioWfk-1"><dfn>&lt;Post-process HTML after weave&gt;=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b> <b>[D<a href="#NW0-ioWfk-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
htmltoc <span class="opt">-</span><span class="num">1234 </span>| \
</pre>
      </li>
    </ol>
  </div>

  <p>Next, the hidden sections must be removed. The top-level table of contents entries may as well be removed at the same time. These are always the document title and the abstract, which are not in the LaTeX table of contents, either.</p>
  <pre class="dfn">
<a name="NW0-ioWfk-2" href="#NW0-ioWfk-1" id="NW0-ioWfk-2"><dfn>&lt;Post-process HTML after weave&gt;+=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b> <b>[<a href="#NW0-ioWfk-1">&lt;-</a>D<a href="#NW0-ioWfk-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>n <span class="opt">-</span>e <span class="str">'<a name="NW0-ioWfk-2-u1" href="#NW0-3hxosX-1" id="NW0-ioWfk-2-u1"><i>&lt;Filter noweave output with removal&gt;</i></a>'</span> | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3hxosX-1" href="#NW0-3hxosX-1" id="NW0-3hxosX-1"><dfn>&lt;Filter noweave output with removal&gt;=</dfn></a> <b>(<a href="#NW0-ioWfk-2">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># strip out all before first header (title)</span>
</pre>
      </li>

      <li>
        <pre>
/&lt;h1&gt;/,${
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">#strip out comment blocks delimited by &lt;!--&gt; &amp; &lt;--&gt; on their own line</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># this is sort of unsafe, but it works for this document</span>
</pre>
      </li>

      <li>
        <pre>
  /^&lt;!--&gt;$/{
</pre>
      </li>

      <li>
        <pre>
   :a
</pre>
      </li>

      <li>
        <pre>
    n
</pre>
      </li>

      <li>
        <pre>
    /^&lt;--&gt;$/bb
</pre>
      </li>

      <li>
        <pre>
    ba
</pre>
      </li>

      <li>
        <pre>
   :b
</pre>
      </li>

      <li>
        <pre>
    n
</pre>
      </li>

      <li>
        <pre>
  }
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">#strip out the first top-level TOC - always title + abstract</span>
</pre>
      </li>

      <li>
        <pre>
  /^&lt;tableofcontents&gt;/{
</pre>
      </li>

      <li>
        <pre>
   a\&lt;h1&gt;Table of Contents&lt;/h1&gt;
</pre>
      </li>

      <li>
        <pre>
   :c p;n;/^ *&lt;li&gt;/!bc
</pre>
      </li>

      <li>
        <pre>
   :d n
</pre>
      </li>

      <li>
        <pre>
     <span class="slc"># allow one level of ul .. /ul</span>
</pre>
      </li>

      <li>
        <pre>
     /^ *&lt;ul[ &gt;]/{
</pre>
      </li>

      <li>
        <pre>
       :e n;/^ *&lt;\/ul&gt;/!be
</pre>
      </li>

      <li>
        <pre>
     }
</pre>
      </li>

      <li>
        <pre>
     /^ *&lt;li&gt;/!bd
</pre>
      </li>

      <li>
        <pre>
  }
</pre>
      </li>

      <li>
        <pre>
  p
</pre>
      </li>

      <li>
        <pre>
}
</pre>
      </li>
    </ol>
  </div>

  <p>Then the title needs to actually be reinserted as the HTML document title.</p>
  <pre class="dfn">
<a name="NW0-ioWfk-3" href="#NW0-ioWfk-1" id="NW0-ioWfk-3"><dfn>&lt;Post-process HTML after weave&gt;+=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b> <b>[<a href="#NW0-ioWfk-2">&lt;-</a>D<a href="#NW0-ioWfk-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>e <span class="str">'<a name="NW0-ioWfk-3-u1" href="#NW0-2voNdq-1" id="NW0-ioWfk-3-u1"><i>&lt;Filter noweave output without removal&gt;</i></a>'</span> | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-1" href="#NW0-2voNdq-1" id="NW0-2voNdq-1"><dfn>&lt;Filter noweave output without removal&gt;=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[D<a href="#NW0-2voNdq-2">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># finish up head, copying 1st header as title</span>
</pre>
      </li>

      <li>
        <pre>
<span class="num">1</span>{
</pre>
      </li>

      <li>
        <pre>
  h
</pre>
      </li>

      <li>
        <pre>
  s/h1&gt;/title&gt;/g
</pre>
      </li>

      <li>
        <pre>
  s/&lt;a name=[^&gt;]*&gt;//
</pre>
      </li>

      <li>
        <pre>
  s%&lt;/a&gt;%%
</pre>
      </li>

      <li>
        <pre>
  s%/title&gt;%&amp;\n &lt;/head&gt;\n&lt;body&gt;%
</pre>
      </li>

      <li>
        <pre>
  p
</pre>
      </li>

      <li>
        <pre>
  x
</pre>
      </li>

      <li>
        <pre>
}
</pre>
      </li>
    </ol>
  </div>

  <p>Some adjustments need to be made to code chunk headers. This allows them to be inset and gives them similar appearance to the LaTeX output.</p>
  <pre class="dfn">
<a name="NW0-2voNdq-2" href="#NW0-2voNdq-1" id="NW0-2voNdq-2"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-1">&lt;-</a>D<a href="#NW0-2voNdq-3">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Give style to pre directives around defn start, and limit pre to 1 line</span>
</pre>
      </li>

      <li>
        <pre>
/&lt;dfn&gt;/{
</pre>
      </li>

      <li>
        <pre>
  s/&lt;pre&gt;/&lt;pre class="dfn"&gt;/;s%$%&lt;/pre&gt;%
</pre>
      </li>

      <li>
        <pre>
 :a
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># newer versions of highlight added "hl " to the class names</span>
</pre>
      </li>

      <li>
        <pre>
  s/class="hl /class="/g
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># Use same bracket style as LaTeX (&lt;sigh&gt; w3m/links/IE hate this)</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># mathematical seems lowered, so use discouraged non-mathematical</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">#s/&lt;i&gt;&amp;lt;/&lt;i&gt;\&amp;#x2329;/g; s%&amp;gt;&lt;/i&gt;%\&amp;#x232A;&lt;/i&gt;%g</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc">#s/&lt;dfn&gt;&amp;lt;/&lt;dfn&gt;\&amp;#x3008;/; s%&amp;gt;\(.*&lt;/dfn&gt;\)%\&amp;#x3009;\1%</span>
</pre>
      </li>

      <li>
        <pre>
  n;/^&lt;\/pre&gt;/!ba
</pre>
      </li>

      <li>
        <pre>
  s%^&lt;/pre&gt;%%
</pre>
      </li>

      <li>
        <pre>
}
</pre>
      </li>
    </ol>
  </div>

  <p>Finally, there are some miscellaneous minor tweaks.</p>
  <pre class="dfn">
<a name="NW0-2voNdq-3" href="#NW0-2voNdq-1" id="NW0-2voNdq-3"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-2">&lt;-</a>D<a href="#NW0-2voNdq-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># shrink &amp; italicize "defined here" bits (from %def directives or autodefs)</span>
</pre>
      </li>

      <li>
        <pre>
s%\(&lt;blockquote&gt;\)\(Defines\)%\<span class="num">1</span>&lt;font size=<span class="num">1</span>&gt;&lt;em&gt;\<span class="num">2</span>%g
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># it is hard to determine end of above group, so make HTML a litte bad</span>
</pre>
      </li>

      <li>
        <pre>
s%\(&lt;/blockquote&gt;\)%&lt;/em&gt;&lt;/font&gt;\<span class="num">1</span>%g
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-4" href="#NW0-2voNdq-1" id="NW0-2voNdq-4"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-3">&lt;-</a>D<a href="#NW0-2voNdq-5">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># strip out diagrams from index</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># actually, it would better to strip out all hidden section chunks</span>
</pre>
      </li>

      <li>
        <pre>
s%^&lt;li&gt;.*\.dia&amp;gt;&lt;/i&gt;&lt;/a&gt;:.*%%
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-5" href="#NW0-2voNdq-1" id="NW0-2voNdq-5"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-4">&lt;-</a>D<a href="#NW0-2voNdq-6">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># strip out *s on their own line - not sure what that is all about</span>
</pre>
      </li>

      <li>
        <pre>
s%&lt;a name=[^&gt;]*&gt;\*&lt;/a&gt;$%%
</pre>
      </li>

      <li>
        <pre>
s/&lt;br&gt;\*$/&lt;br&gt;/
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-6" href="#NW0-2voNdq-1" id="NW0-2voNdq-6"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-5">&lt;-</a>D<a href="#NW0-2voNdq-7">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Yet another useful subst, but w3m/links/IE hate it</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#s/---/&amp;mdash;/g</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-7" href="#NW0-2voNdq-1" id="NW0-2voNdq-7"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-6">&lt;-</a>D<a href="#NW0-2voNdq-8">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># l2h puts marks where hrefs point to, but that is not really necessary</span>
</pre>
      </li>

      <li>
        <pre>
s%&lt;b&gt;\[\*\]&lt;/b&gt;%%g;s/\[\*\]//g
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-8" href="#NW0-2voNdq-1" id="NW0-2voNdq-8"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-7">&lt;-</a>D<a href="#NW0-2voNdq-9">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># l2h does not handle quotes at all, so just remove duplicate</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc">#s/``/\&amp;#8216;/g;s/'\'\''/\&amp;#8217;/g</span>
</pre>
      </li>

      <li>
        <pre>
s/``/`/g;s/'\'\'/\''/g
</pre>
      </li>
    </ol>
  </div>

  <p>One of those minor tweaks is to move the footnotes into their own section at the bottom of the document. Since <code>sed</code> is not up to the task, <code>awk</code> is used.</p>
  <pre class="dfn">
<a name="NW0-ioWfk-4" href="#NW0-ioWfk-1" id="NW0-ioWfk-4"><dfn>&lt;Post-process HTML after weave&gt;+=</dfn></a> <b>(<a href="#NW0-24uTRA-2">&lt;-U</a>)</b> <b>[<a href="#NW0-ioWfk-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwc">awk </span><span class="str">'<a name="NW0-ioWfk-4-u1" href="#NW0-42Lk2y-1" id="NW0-ioWfk-4-u1"><i>&lt;Move noweave filtering with awk&gt;</i></a>'</span> | \
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-42Lk2y-1" href="#NW0-42Lk2y-1" id="NW0-42Lk2y-1"><dfn>&lt;Move noweave filtering with awk&gt;=</dfn></a> <b>(<a href="#NW0-ioWfk-4">&lt;-U</a>)</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># May as well just move footnotes to the bottom</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">BEGIN </span><span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># uses FS to extract footnote text</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">FS</span>=<span class="str">"&lt;font size=2&gt;&lt;b&gt;.&lt;/b&gt;&lt;em&gt;|&lt;/em&gt;&lt;b&gt;.&lt;/b&gt;&lt;/font&gt;"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># odd is 1 if previous footnote spanned lines</span>
</pre>
      </li>

      <li>
        <pre>
  odd=<span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># fn is the footnote counter</span>
</pre>
      </li>

      <li>
        <pre>
  fn=<span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># fnt is the complete text of all footnotes</span>
</pre>
      </li>

      <li>
        <pre>
  fnt=<span class="str">""</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># if NF &gt; 1, a footnote has been detected</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># odd is set to 1 if a footnote spans lines</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NF </span><span class="opt">&gt; </span><span class="num">1 </span>|| odd <span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="slc"># accumulate non-footnote text into ln</span>
</pre>
      </li>

      <li>
        <pre>
  ln=<span class="str">""</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  i=<span class="num">0</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>odd<span class="opt">) </span>ft=ft <span class="str">"</span><span class="esc">\n</span><span class="str">"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">while</span><span class="opt">(</span>i <span class="opt">&lt; </span><span class="kwb">NF</span><span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
    i++<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>i <span class="opt">&gt; </span><span class="num">1 </span><span class="opt">&amp;&amp; </span>i % <span class="num">2 </span>== odd<span class="opt">) {</span>
</pre>
      </li>

      <li>
        <pre>
      fn++<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      ln=ln <span class="str">"&lt;sup&gt;&lt;a href=</span><span class="esc">\"</span><span class="str">#fn"</span> fn <span class="str">"</span><span class="esc">\"</span><span class="str">&gt;"</span> fn <span class="str">"&lt;/a&gt;&lt;/sup&gt;"</span><span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
      ft=ft <span class="str">"</span><span class="esc">\n</span><span class="str">&lt;hr/&gt;</span><span class="esc">\n</span><span class="str">&lt;a name=</span><span class="esc">\"</span><span class="str">fn"</span> fn <span class="str">"</span><span class="esc">\"</span><span class="str">&gt;&lt;b&gt;"</span> fn <span class="str">"&lt;/b&gt;.&lt;/a&gt; "</span><span class="opt">; </span>
</pre>
      </li>

      <li>
        <pre>
    <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
    <span class="kwa">if</span><span class="opt">(</span>i % <span class="num">2 </span>== odd<span class="opt">) </span>ft = ft $i<span class="opt">; </span><span class="kwa">else </span>ln = ln $i<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>!odd || <span class="kwb">NF </span><span class="opt">&gt; </span><span class="num">1</span><span class="opt">) </span><span class="kwa">print </span>ln<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span><span class="kwb">NF </span>% <span class="num">2 </span>== <span class="num">0</span><span class="opt">) </span>odd = <span class="num">1 </span><span class="opt">- </span>odd<span class="opt">;</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># dump all footnotes at the end</span>
</pre>
      </li>

      <li>
        <pre>
$<span class="num">0 </span>~ <span class="str">"&lt;/body&gt;"</span> <span class="opt">{</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">if</span><span class="opt">(</span>fn <span class="opt">&gt; </span><span class="num">0</span><span class="opt">) </span><span class="kwa">print </span><span class="str">"&lt;hr/&gt;&lt;h3&gt;Footnotes&lt;/h3&gt;"</span> ft
</pre>
      </li>

      <li>
        <pre>
  <span class="kwa">print</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">}</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># print everything that is not a footnote</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">NF </span><span class="opt">&lt;</span>= <span class="num">1 </span><span class="opt">&amp;&amp; </span>!odd <span class="opt">&amp;&amp; (</span>$<span class="num">0 </span>!~ <span class="str">"&lt;/body&gt;"</span><span class="opt">)</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Copying in the highlighted code must be done after <code>noweave</code> is finished, or else it would need raw HTML sentinels. On the other hand, verbatim code should be copied in before weaving, and in fact it already has above.</p>
  <pre class="dfn">
<a name="NW0-24uTRA-3" href="#NW0-24uTRA-1" id="NW0-24uTRA-3"><dfn>&lt;nw2html&gt;+=</dfn></a> <b>[<a href="#NW0-24uTRA-2">&lt;-</a>D<a href="#NW0-24uTRA-4">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># insert highlighted extracted chunks/files</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-3-u1" href="#NW0-95lHR-1" id="NW0-24uTRA-3-u1"><i>&lt;For each reinserted code chunk&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">test </span><span class="kwd">$lang </span><span class="opt">= </span>verbatim <span class="opt">&amp;&amp; </span><span class="kwb">continue</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="str">'%s</span><span class="esc">\\\n</span><span class="str">'</span> <span class="str">'/&lt;!-- input '</span><span class="str">"$fesc"</span><span class="str">'.tex --&gt; &lt;!-- '</span><span class="kwd">$lang</span><span class="str">'--&gt;/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">       s/&lt;!--.*--&gt;//;i'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">eval </span>notangle <span class="str">'-R"$f"'</span> <span class="kwd">$noweb_order </span><span class="num">2</span><span class="opt">&gt;/</span>dev<span class="opt">/</span>null | .<span class="opt">/</span>htmlhl <span class="kwd">$lang </span>| \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">sed </span><span class="str">'$!s/$/</span><span class="esc">\\</span><span class="str">/'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="str">'}</span><span class="esc">\n</span><span class="str">'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span><span class="opt">&gt;/</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># insert highlighted C prototypes</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-24uTRA-3-u2" href="#NW0-2XPbLc-1" id="NW0-24uTRA-3-u2"><i>&lt;For each reinserted C prototype&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">printf </span><span class="str">'%s</span><span class="esc">\\\n</span><span class="str">'</span> <span class="str">"/&lt;!-- $f prototype--&gt;/{</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">       s/&lt;!--.*--&gt;//;i"</span>
</pre>
      </li>

      <li>
        <pre>
  <a name="NW0-24uTRA-3-u3" href="#NW0-2cCi0n-1" id="NW0-24uTRA-3-u3"><i>&lt;Extract and format a C prototype from <code>cproto.h</code>&gt;</i></a> | .<span class="opt">/</span>htmlhl C | \
</pre>
      </li>

      <li>
        <pre>
    <span class="kwc">sed </span><span class="str">'$!s/$/</span><span class="esc">\\</span><span class="str">/'</span>
</pre>
      </li>

      <li>
        <pre>
  <span class="kwb">echo </span><span class="str">'}'</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwa">done </span><span class="opt">&gt;&gt; /</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">sed </span><span class="opt">-</span>i <span class="opt">-</span>f <span class="opt">/</span>tmp<span class="opt">/</span>latexhl.<span class="kwc">fmt</span>.$$ <span class="str">"$outf"</span>  <span class="slc"># -i is GNU sed only</span>
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-J" href="#NW0-3uTryu-1" id="NW0-3uTryu-J"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-I">&lt;-</a>D<a href="#NW0-3uTryu-K">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
nw2html<span class="opt">: </span>cproto.h
</pre>
      </li>
    </ol>
  </div>

  <p>Since the sed scripts and simplicity of <code>l2h</code> can cause the HTML to not be standards compliant any more, HTML Tidy <sup><a href="#fn11">11</a></sup> is used to clean up the output.</p>
  <pre class="dfn">
<a name="NW0-2voNdq-9" href="#NW0-2voNdq-1" id="NW0-2voNdq-9"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-8">&lt;-</a>D<a href="#NW0-2voNdq-A">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># tidy gives errors on unknown tags</span>
</pre>
      </li>

      <li>
        <pre>
s%&lt;/*tableofcontents&gt;%%
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-2voNdq-A" href="#NW0-2voNdq-1" id="NW0-2voNdq-A"><dfn>&lt;Filter noweave output without removal&gt;+=</dfn></a> <b>(<a href="#NW0-ioWfk-3">&lt;-U</a>)</b> <b>[<a href="#NW0-2voNdq-9">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># rather than trying to put TOC /li in right place, just remove them all</span>
</pre>
      </li>

      <li>
        <pre>
/href="#toc/s%&lt;/li&gt;%%
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-24uTRA-4" href="#NW0-24uTRA-1" id="NW0-24uTRA-4"><dfn>&lt;nw2html&gt;+=</dfn></a> <b>[<a href="#NW0-24uTRA-3">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
tidy <span class="opt">-</span>q <span class="opt">-</span>wrap <span class="num">0 </span><span class="opt">-</span>i <span class="opt">-</span>asxhtml <span class="opt">-</span>m <span class="str">"$outf"</span> <span class="num">2</span><span class="opt">&gt;</span>tidy.log
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># report unexpected errors</span>
</pre>
      </li>

      <li>
        <pre>
fgrep <span class="opt">-</span>ivf<span class="opt">- </span>tidy.log <span class="opt">&lt;&lt;</span>EOF <span class="opt">&gt;/</span>dev<span class="opt">/</span>null || <span class="opt">:</span>
</pre>
      </li>

      <li>
        <pre>
missing <span class="opt">&lt;!</span>DOCTYPE<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
unexpected <span class="opt">&lt;/</span>em<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
unexpected <span class="opt">&lt;/</span>font<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
replacing unexpected em
</pre>
      </li>

      <li>
        <pre>
missing <span class="opt">&lt;/</span>a<span class="opt">&gt; </span>before <span class="opt">&lt;</span>a<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
discarding unexpected <span class="opt">&lt;/</span>a<span class="opt">&gt;</span>
</pre>
      </li>

      <li>
        <pre>
lacks <span class="str">"summary"</span> attribute
</pre>
      </li>

      <li>
        <pre>
lacks <span class="str">"alt"</span> attribute
</pre>
      </li>

      <li>
        <pre>
<span class="kwc">column </span><span class="num">18 </span><span class="opt">- </span>Warning<span class="opt">: &lt;</span>a<span class="opt">&gt; </span>anchor <span class="str">"NW</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">trimming empty</span>
</pre>
      </li>

      <li>
        <pre>
<span class="str">EOF</span>
</pre>
      </li>
    </ol>
  </div>

  <p>Generation of the figures depends on ImageMagick <sup><a href="#fn12">12</a></sup> with GhostScript support to convert them to PNG format, even though using GhostScript directly would have worked as well.</p>
  <pre class="dfn">
<a name="NW0-3uTryu-K" href="#NW0-3uTryu-1" id="NW0-3uTryu-K"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-J">&lt;-</a>D<a href="#NW0-3uTryu-L">-&gt;</a>]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="opt">%</span>.png<span class="opt">: %</span>.eps
</pre>
      </li>

      <li>
        <pre>
        convert <span class="opt">-</span>density <span class="num">144</span>x144 <span class="opt">-</span>comment <span class="str">''</span> <span class="opt">$&lt; -</span>transparent white <span class="opt">$</span>@
</pre>
      </li>
    </ol>
  </div>

  <h3><a name="toc21" id="toc21">Method Selection</a></h3>

  <p>Unfortunately, neither formatter is obviously better. TeX4ht mangles its output a bit (color in particular) and takes forever to run. NoWeb's l2h filter is quicker, but is pretty stupid and unconfigurable for things like tables and footnotes. For now, I prefer the speed and accuracy of l2h.</p>
  <pre class="dfn">
<a name="NW0-3TUZd-B" href="#NW0-3TUZd-1" id="NW0-3TUZd-B"><dfn>&lt;makefile.config&gt;+=</dfn></a> <b>[<a href="#NW0-3TUZd-A">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="slc"># Program to use for generating HTML formatted source code</span>
</pre>
      </li>

      <li>
        <pre>
<span class="slc"># Set to tex4ht or l2h</span>
</pre>
      </li>

      <li>
        <pre>
HTML_CONV<span class="opt">:=</span>l2h
</pre>
      </li>
    </ol>
  </div>
  <pre class="dfn">
<a name="NW0-3uTryu-L" href="#NW0-3uTryu-1" id="NW0-3uTryu-L"><dfn>&lt;makefile.rules&gt;+=</dfn></a> <b>[<a href="#NW0-3uTryu-K">&lt;-</a>D]</b>
</pre>

  <div style="margin-left: 2em" class="code">
    <ol>
      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>HTML_CONV<span class="opt">),</span>l2h<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3uTryu-L-u1" href="#NW0-2hL9yM-1" id="NW0-3uTryu-L-u1"><i>&lt;makefile.rules l2h&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">ifeq </span><span class="opt">($(</span>HTML_CONV<span class="opt">),</span>tex4ht<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<a name="NW0-3uTryu-L-u2" href="#NW0-NpIT2-1" id="NW0-3uTryu-L-u2"><i>&lt;makefile.rules tex4ht&gt;</i></a>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">else</span>
</pre>
      </li>

      <li>
        <pre>
<span class="opt">$(</span>error Unknown HTML_CONV conversion method<span class="opt">; </span>use l2h or tex4ht<span class="opt">)</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>

      <li>
        <pre>
<span class="kwb">endif</span>
</pre>
      </li>
    </ol>
  </div>

  <h2><a name="toc22" id="toc22">Usage</a></h2>

  <p><!-- Begin-doc build-usage-->
   Users of this document fall into at least two categories: ones who wish to create documents that use this build system, and ones who wish to build packages which were created using this build system. This section is for the former. Instructions for the latter were included on the first page, but should also be included in any document using this system:</p>

  <blockquote>
    <tt>\input{build-doc.tex} %%% doc</tt>
  </blockquote>Of course the instructions for document users are required to build and test the project for document creators as well. After creating the makefile, you can use <tt>make</tt> to build and test. The standard targets are <tt>all</tt> (the default), <tt>bin</tt>, <tt>install</tt>, <tt>doc</tt>, <tt>misc</tt>, <tt>clean</tt>, <tt>distclean</tt>, <tt>count</tt>, <tt>check</tt>, <tt>test-bin</tt>, and <tt>test</tt>. In particular, the <tt>check</tt> target can help ensure that changes to a source file will not result in weird errors due to lost chunks or mistyped chunk names.

  <p>The first few lines of a NoWeb file are LaTeX code. This must at least include the <tt>\documentclass</tt> directive. It can also include the build system's preamble in the place marked by <tt>%%% latex preamble</tt>. Copying the beginning of this document to start with would not be a bad idea:</p>

  <blockquote>
    <tt>% Build with noweb:</tt><br />
    <tt>% notangle -t8 build.nw &gt; makefile</tt><br />
    <tt>% make</tt><br />
    <tt>\documentclass[twoside,english]{article}</tt><br />
    <tt>\usepackage[letterpaper,rmargin=1.5in,bmargin=1in]{geometry}</tt><br />
    <tt>%%% latex preamble</tt><br />
    <tt>\RCS $</tt><tt>Id$</tt><br />
    <tt>\RCS $</tt><tt>Revision$</tt><br />
    <br />
    <tt>\begin{document}</tt><br />
    <br />
    <tt>\title{</tt>...}<br />
    <tt>\author{</tt>...}<br />
    <tt>\date{Revision \RCSRevision}</tt><br />
    <br />
    <tt>\maketitle</tt>
  </blockquote>

  <p>Dependencies on other files should be listed somewhere (usually near the top), as well. They are specified by comments of the form <tt>%%% requires</tt> <i>name</i> on lines by themselves. Only direct dependencies need to be listed, as a full tree will be generated. The <tt>.nw</tt> extension is optional. For example, somewhere in your project, you will need to depend on this file:</p>

  <blockquote>
    <tt>%%% requires build</tt>
  </blockquote>Chunks defined in a document extend chunks defined in documents on which it depends. Chunks defined in other documents can be used, as well. In both cases, they will not be weaved correctly. Chunks which are extended will be indicated with the original source file in parentheses at the start of the chunk name; this format is used mainly to move external referneces to the top of the chunk index and sort them by source name. However, the first extension will have no `previous chunk' link, rather than pointing to the source document's definition. Uses are also indicated with the original file name, but they always claim to be undefined. This is somewhat alleviated by the fact that undefined references are labeled with the word imported rather than undefined, but the only way to remove that indicator is to define the chunk elsewhere for extension (e.g. in an appendix) as neutral as possible (blank or a comment in the source language). This can be disabled for user-level documentation by adding the commment:

  <blockquote>
    <tt>%%% no-ext-ref</tt>
  </blockquote>Within the document, several extensions can be used:

  <ul>
    <li>Language definitions: the listing package's <tt>\lstset{language=</tt><i>lang</i><tt>}</tt> directive is used to set the language for any subsequent code chunks. The default language is C.</li>

    <li>Hidden sections: any figures or other files which are normally included in the document in a processed form can be stored in-line in the NoWeb document in their raw form in hidden sections. Each hidden section is delimited by <tt>&lt;!--&gt;</tt> on its own line at the start, and <tt>&lt;--&gt;</tt> on its own line at the end. This is intended to be used as follows:

      <blockquote>
        <tt>% hidden section - notangle chunks that shouldn't appear in printed output</tt><br />
        <tt>% mainly for diagrams, which are extracted and included in visual form.</tt><br />
        <tt>\begin{rawhtml}</tt><br />
        <tt>&lt;!--&gt;</tt><br />
        <tt>\end{rawhtml}</tt><br />
        <tt>\iffalse</tt><br />

        <p>... hidden material ...<br />
        <tt>\fi</tt><br />
        <tt>\begin{rawhtml}</tt><br />
        <tt>&lt;--&gt;</tt><br />
        <tt>\end{rawhtml}</tt><br /></p>
      </blockquote>NoWeb doesn't actually strip these out --- iffalse does that. Because NoWeb generates cross-reference information and the chunk index after the last chunk, the last chunk may not be commented out in this way. If you see a message like `LaTeX Warning: The are no \nowebchunks on input line ...', there are eiher no code chunks at all, or the last code chunk was commented out.
    </li>

    <li>Syntax highlighted, fully extracted code chunks: a code chunk can be repeated in e.g. a users' guide appendix, fully extracted and syntax highlighted, by using a special <code>\input</code> directive: <tt>\input{</tt><em>chunk-name</em><tt>.tex} %</tt> <em>language</em>. This directive will be replaced by the contents of the named chunk. For example, the configurable variables are included here using:

      <blockquote>
        <tt>\input{makefile.config.tex} % make</tt>
      </blockquote>

      <div style="margin-left: 2em" class="code">
        <ol>
          <li>
            <pre>
<span class="hl slc"># Installation prefix to apply to all install locations</span>
</pre>
          </li>

          <li>
            <pre>
DESTDIR<span class="hl opt">:=</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Installation directory for binaries</span>
</pre>
          </li>

          <li>
            <pre>
BIN_DIR<span class="hl opt">:=/</span>usr<span class="hl opt">/</span>local<span class="hl opt">/</span>bin
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># The name of the file containing the makefile</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># or in makefile.config.local</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#BUILD_NOWEB:=build.nw</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># The name of the source files</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Any time you change this, makefile.* should be removed and rebuilt</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># or in makefile.config.local</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#NOWEB:=$(wildcard *.nw)</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#Set to override the automatically determined project name</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#PROJECT_NAME=</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Set to -L for #line, but lose code indentation</span>
</pre>
          </li>

          <li>
            <pre>
USE_LINE<span class="hl opt">:=-</span>L
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Where to find the non-standard tac command (GNU coreutils)</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># or in makefile.config.local</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#TACCMD:=sed -n -e '1!G;h;$$p'</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># The noroots command is used to extract file names from $(NOWEB)</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># The following works well enough in most cases if noweb is missing</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Note: due to Makepp restrictions, this can only be set on the command line</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># or in makefile.config.local</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#NOROOTS=sh -c "sed -n '/^&lt;&lt;.*&gt;&gt;=$$/{s/=$$//;p;}' $$* </span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#                                | sort -u" /dev/null</span>
</pre>
          </li>

          <li>
            <pre>
NOROOTS<span class="hl opt">=</span>noroots
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># The PDF command to use: must be pdflatex or xelatex.</span>
</pre>
          </li>

          <li>
            <pre>
LATEXCMD<span class="hl opt">=</span>pdflatex
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># note: to use attachments with xetex, the following may be necessary:</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#LATEXCMD=env DVIPDFMXINPUTS=.:$$TEXMF/dvipdfmx/ xelatex</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># if non-blank, specify which highlighter to use:</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#  highlight-2  named highlight, acts like highlight-2.x</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#  highlight-3  named highlight, acts like highlight-3.x</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc">#  source-highlight named source-highlight (probably 3.x)</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># if blank, autodetect</span>
</pre>
          </li>

          <li>
            <pre>
HLPROG_TYPE<span class="hl opt">=</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Highlight theme for PDF/HTML formatted source code</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Blank uses default highlight style; prefix w/ list: to use listings package</span>
</pre>
          </li>

          <li>
            <pre>
HL_THEME<span class="hl opt">:=</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Program to use for generating HTML formatted source code</span>
</pre>
          </li>

          <li>
            <pre>
<span class="hl slc"># Set to tex4ht or l2h</span>
</pre>
          </li>

          <li>
            <pre>
HTML_CONV<span class="hl opt">:=</span>l2h
</pre>
          </li>
        </ol>
      </div>One use of this feature which should be in every document is to list the RCS/CVS/subversion ID tag of all source files from which the document was built:

      <blockquote>
        This document was generated from the following sources, all of which are attached:<br />
        <tt>\input{Sources.tex} % txt</tt>
      </blockquote>
    </li>

    <li>Syntax highlighted C prototypes: the prototype of a C function can be repeated as a highlighted code chunk using a special comment: <tt>%</tt> <em>function-name</em> <tt>prototype</tt> prints a reformatted version of the prototype extracted from <code>cproto.h</code>, which is automatically generated for all C files. Any prototypes which would not be placed there can be manually added using the <code><a href="#NW0-3Gq37d-1"><i>&lt;C Prototypes&gt;</i></a></code> chunk; all prototypes from the chunk must consist of exactly one line of text.</li>

    <li>Repeated documentation: a separate NoWeb-like macro facility which only does substitutions can be used to repeat documentation in e.g. a users' guide in an appendix. Such documentation chunks are delimited by <tt>% Begin-doc</tt> <em>chunk-name</em> and <tt>% End-doc</tt> <em>chunk-name</em> at the beginning of a line. They are inserted in place of any occurence of <tt>\input {</tt><i>chunk-name</i><tt>.tex} %%% doc</tt> at the beginning of a line.</li>

    <li>Simple input directives: a file can be included verbatim using <tt>\input{</tt><em>file</em><tt>.nw}</tt>. This actually substitutes the file in place rather than doing an actual include so that weaving and tangling operate correctly.</li>

    <li>Documentation attachments: any files which should be attached to the PDF or HTML output can be attached using the <code>embedfile</code> package's <code>\embedfile</code> directive.</li>
  </ul>Somewhere in the document, the code chunk index should be added. Right now, an identifier index is not supported.

  <blockquote>
    <pre>
\section{Code Index}
\nowebchunks

% note: no identifier indexing is done right now

\begin{rawhtml}
&lt;!--&gt;
\end{rawhtml}
%\vspace{1ex}
%\hrule
%\vspace{1ex}
\begin{rawhtml}
&lt;--&gt;
\end{rawhtml}

%\nowebindex

</pre>
  </blockquote>Of course the document must be ended with <tt>\end{document}</tt>, like any LaTeX document.

  <blockquote>
    <pre>
\end{document}
</pre>
  </blockquote>Once the documentation has been built, the PDF output needs to be checked for overflows. Horizontal overflows in code chunks are hard to detect, as they do not always generate <code>Overfull \hbox</code> messages. They can be corrected by reformatting the source code. Vertical overflows as the result of problems with the <code>framed</code> package can be detected by <code>Overfull \vbox</code> messages, and can be corrected by prefixing chunks which are not broken at the end of a page with a <code>\break</code> directive. Naturally, any edits to the document will require rechecking all <code>\break</code> directives to see if they are still necessary, and possibly to add more.

  <p>Since I write a lot of C, a few special tricks are available for C programs. In addition to the C-specific chunks described below, a special header is generated, <code>cproto.h</code>, which contains all exported prototypes, except for prototypes already explicitly included in headers. This is always included after <code><a href="#NW0-Es3AF-1"><i>&lt;Common C Includes&gt;</i></a></code> in the <code><a href="#NW0-2HdDm1-1"><i>&lt;Common C Header&gt;</i></a></code>. In order to facilitate writing static functions out of order, a static prototype file is generated for each C file as well. This is included right after <code>cproto.h</code>, unless the comment <tt>//&nbsp;static_proto</tt> is found on a line by itself, in which case it is placed after that comment. That way, the static prototypes can be placed after any private data type declarations. As mentioned above, <code>cproto.h</code> is used for API documentation as well.</p>

  <p>Several internal variables are meant to be set or expanded in extensions to <code><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a></code>:</p>

  <ul>
    <li>
      <code>C_POSTPROCESS</code> is a pipeline to apply to all automatically extracted C files. This is a function taking the file name as an argument (which can be ignored if there are no file-specific transformations). The return value (or value of the plain variable, since there is no difference between functions which ignore their arguments and variables) should be a pipeline element, starting with the pipe symbol. For example:

      <blockquote>
        <code><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a></code>=<br />
        <code>C_POSTPROCESS+=|sed '1i\copyright blurb'</code><br />
        <code>@</code>
      </blockquote>
    </li>

    <li>The <code>EXTRA_CFLAGS</code> variable should be extended with required options; that way, the user can replace <code>CFLAGS</code> with just optimization and debugging flags.</li>

    <li>The <code>EXTRA_LDFLAGS</code> variable should be extended with required options; that way, the user can replace <code>LDFLAGS</code> with just optimization and debugging flags.</li>
  </ul>

  <p>Finally, extensions to the build system can be made by adding code chunks; they will be appended to existing values in the order of the tree, from the most depended on file to the least depended on file (i.e., anything depending on <tt>build.nw</tt> will append values <em>after</em> the values set in <tt>build.nw</tt>):</p>

  <h5><a name="toc23" id="toc23">Basic build rules:</a></h5>

  <ul>
    <li><code><a href="#NW0-3TUZd-1"><i>&lt;makefile.config&gt;</i></a></code>: add user-configurable variables to the makefile.</li>

    <li><code><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a></code>: add non-configurable variables to the makefile.</li>

    <li><code><a href="#NW0-3uTryu-1"><i>&lt;makefile.rules&gt;</i></a></code>: add rules to the makefile.</li>

    <li><code><a href="#NW0-4NpOpq-1"><i>&lt;Install other files&gt;</i></a></code>: add installation commands.</li>

    <li><code><a href="#NW0-4erxh5-1"><i>&lt;Clean temporary files&gt;</i></a></code>: add commands to clean temporary files.</li>

    <li><code><a href="#NW0-1VdTlf-1"><i>&lt;Clean built files&gt;</i></a></code>: add commands to clean built files.</li>

    <li><code><a href="#NW0-yWsmS-1"><i>&lt;Plain Files&gt;</i></a></code>: add plain files to build; always add a backslash to the end of each added line. If additional processing other than simple extraction is required for any file, it should instead be added to <code><a href="#NW0-3uTryu-1"><i>&lt;makefile.rules&gt;</i></a></code> as a separate rule and a dependency for the <tt>misc</tt> target. If any plain files are not in the NoWeb source, but instead are distributed separately, they should instead be added to the <code>ATTACH_EXTRA</code> variable, to be attached to the documentation. That variable can also be a make function taking the name of the file being attached to as an argument.</li>

    <li><code><a href="#NW0-2ohs0l-1"><i>&lt;Plain Build Files&gt;</i></a></code>: add plain text files to be built when required as a dependency; always add a backslash to the end of each added line. This is not added to any explicit target. It is merely a shorthand to create a rule for extracting it from NoWeb and cleaning it up afterwards. It is intended for build support files that are not meant to be distributed.</li>

    <li><code><a href="#NW0-2s5YyJ-1"><i>&lt;Script Executables&gt;</i></a></code>: add plain text files to build as executables; always add a backslash to the end of each added line. Like <code><a href="#NW0-yWsmS-1"><i>&lt;Plain Files&gt;</i></a></code>, no processing is done by the default rules.</li>

    <li><code><a href="#NW0-3CYAWn-1"><i>&lt;Build Script Executables&gt;</i></a></code>: add plain text files to build as executables when required; always add a backslash to the end of each added line. This is not added to any explicit target. It is merely a shorthand to create a rule for extracting it from NoWeb and cleaning it up afterwards. It is intended for build support files that are not meant to be distributed.</li>

    <li><code><a href="#NW0-1s7U6w-1"><i>&lt;Test Scripts&gt;</i></a></code>: add plain text files to build as executables, but only for the <code>test</code> and <code>test-bin</code> targets. The <code>test</code> target will execute these scripts without any interpretation other than return code checks.</li>

    <li><code><a href="#NW0-1tJ6ue-1"><i>&lt;Test Support Scripts&gt;</i></a></code>: names of executable scripts to build for the <code>test-bin</code> target. These scripts are not run, but are guaranteed to be built before running any tests.</li>

    <li><code><a href="#NW0-3VrC3R-1"><i>&lt;Additional Tests&gt;</i></a></code>: tests that are more complicated to run than simple scripts. These are makefile actions.</li>

    <li><code><a href="#NW0-4f1jeK-1"><i>&lt;Build Source&gt;</i></a></code>: add files to the NoWeb-free tar distribution; always add a backslash to the end of each added line. In particular, any specially processed plain files with their own rules should be added to this list.</li>

    <li><code><a href="#NW0-vdNDE-1"><i>&lt;Files to Count&gt;</i></a></code>: files to count as part of the <tt>count</tt> target; always add a backslash to the end of each added line. Anything added to the <code><a href="#NW0-4f1jeK-1"><i>&lt;Build Source&gt;</i></a></code> should probably be added here, as well.</li>

    <li><code><a href="#NW0-1BSm48-1"><i>&lt;Executables&gt;</i></a></code>: additional specially-built execuatables, other than scripts and C executables.</li>
  </ul>

  <h5><a name="toc24" id="toc24">C-Specific rules</a></h5>

  <ul>
    <li><code><a href="#NW0-38kBWE-1"><i>&lt;C Files&gt;</i></a></code>, <code><a href="#NW0-T3FtH-1"><i>&lt;C Headers&gt;</i></a></code>: C files which are NoWeb roots are automatically found, but generated files are not. Add these with these chunks, terminated by a backslash.</li>

    <li><code><a href="#NW0-1LbAtL-1"><i>&lt;C Executables&gt;</i></a></code>: C files are either the name of an executable with the <tt>.c</tt> extension, or the name of a library member, with <tt>.o</tt> replaced by <tt>.c</tt>. The executables are listed here, without the <tt>.c</tt> extension, but with a trailing backslash on every line. Technically, this could be considered a list of generated executables instead, since there is no rule requiring that these be C.</li>

    <li><code><a href="#NW0-raqlf-1"><i>&lt;C Test Executables&gt;</i></a></code>: names of executables to build for the <code>test</code> and <code>test-bin</code> targets. See <code><a href="#NW0-1LbAtL-1"><i>&lt;C Executables&gt;</i></a></code> and <code><a href="#NW0-1s7U6w-1"><i>&lt;Test Scripts&gt;</i></a></code> for details.</li>

    <li><code><a href="#NW0-1RZV9-1"><i>&lt;C Test Support Executables&gt;</i></a></code>: names of executables to build for the <code>test-bin</code> target, as explained by <code><a href="#NW0-1LbAtL-1"><i>&lt;C Executables&gt;</i></a></code> and <code><a href="#NW0-1tJ6ue-1"><i>&lt;Test Support Scripts&gt;</i></a></code> for details.</li>

    <li><code><a href="#NW0-VUOac-1"><i>&lt;C Build Executables&gt;</i></a></code>: names of executables to build when required by other dependencies. See <code><a href="#NW0-1LbAtL-1"><i>&lt;C Executables&gt;</i></a></code> and <code><a href="#NW0-3CYAWn-1"><i>&lt;Build Script Executables&gt;</i></a></code> for details.</li>

    <li><code><a href="#nw@notdef"><i>&lt;Library <code>name</code> Members&gt;</i></a></code>: A library named <code>name</code> will be built using objects listed in these chunks. <code>name</code> can of course be anything appropriate. Unlike the chunks which expand into specific <code>make</code> variables, no backslashes are required or allowed at the end of each line.</li>

    <li>
      <code><a href="#NW0-2XPbLc-1"><i>&lt;For each reinserted C prototype&gt;</i></a></code>: add a transformation for the modified function name (<code>$mf</code>). Typically, this will involve invoking the C preprocessor with a few standard include files, followed by the function name. For example:

      <blockquote>
        <code><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a>=</code><br />
        <code>export MY_CPP=$(CC) $(CFLAGS) $(EXTRA_CFLAGS) -E</code><br />
        <code>@</code><br />
        <br />
        <code><a href="#NW0-2XPbLc-1"><i>&lt;For each reinserted C prototype&gt;</i></a>=</code><br />
        <code>mf="`printf '<a href="#NW0-Es3AF-1"><i>&lt;Common C Includes&gt;</i></a>\\n%s' \"\$mf\" |</code><br />
        <code>eval \"\$MY_CPP -\" | tail -n 1`"</code><br />
        <code>@</code><br />
      </blockquote>
    </li>
  </ul>

  <h5><a name="toc25" id="toc25">Boilerplate</a></h5>

  <ul>
    <li><code><a href="#NW0-3IzIGd-1"><i>&lt;Common NoWeb Warning&gt;</i></a></code>: a boilerplate comment for the top of script files; extend with <code># $</code><code>Id$</code>.</li>

    <li><code><a href="#NW0-3gqQRM-1"><i>&lt;Version Strings&gt;</i></a></code>: A C string containing the version ID of all contributing source files; extend with <code>"$</code><code>Id$\n"</code>.</li>

    <li><code><a href="#NW0-s2DzW-1"><i>&lt;Sources&gt;</i></a></code>: A simple text chunk containing the version ID of all contributing source files; extend with just <code>$</code><code>Id$</code>.</li>

    <li><code><a href="#NW0-2Aa10L-1"><i>&lt;Common C Warning&gt;</i></a></code>: the same comment enclosed in a C comment; not meant to be extended</li>

    <li><code><a href="#NW0-Es3AF-1"><i>&lt;Common C Includes&gt;</i></a></code>: a list of <code>#include</code> directives for files safe to be included by all C source</li>

    <li><code><a href="#NW0-2HdDm1-1"><i>&lt;Common C Header&gt;</i></a></code>: stuff safe for the top of every C file, including the warning, common includes, static version string, and automatically generated prototypes. Prototypes for static functions for the file are included as well, unless a comment of the form <code>// static_proto</code> is found on a line by itself; in that case, the static prototypes will be included there instead.</li>

    <li><code><a href="#NW0-lrTIc-1"><i>&lt;Common Perl Prefix&gt;</i></a></code>: stuff to insert at the top of perl executables. This includes the NoWeb warning, a portable hash-bang prefix, and <code>use strict</code>.</li>
  </ul>

  <h5><a name="toc26" id="toc26">Highlighting Assistance</a></h5>

  <ul>
    <li><code><a href="#NW0-KNRz0-1"><i>&lt;Known Data Types&gt;</i></a></code>: comma-separated list of data types to emphasize; end each line (including the last) with a comma and a percent-sign.</li>

    <li><code><a href="#NW0-mLHpn-1"><i>&lt;Translate listings source type to source-highlight source type&gt;</i></a></code>, <code><a href="#NW0-9eD9j-1"><i>&lt;Translate listings source type to highlight-3 source type&gt;</i></a></code>: add new cases to a shell case switch to convert listings language names to highlighter language names.</li>
  </ul>

  <p><!-- End-doc build-usage--></p>

  <h2><a name="toc27" id="toc27">Code Index</a></h2>

  <ul>
    <li><a href="#NW0-1p0Y9w-1"><i>&lt;*&gt;</i></a>: <a href="#NW0-1p0Y9w-1">D1</a></li>

    <li><a href="#NW0-3ecB1D-1"><i>&lt;<code>highlight</code>-2 options for <code>latexhl</code>&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-3ecB1D-1">D2</a></li>

    <li><a href="#NW0-2ystHn-1"><i>&lt;<code>highlight</code>-3 options for <code>latexhl</code>&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-2ystHn-1">D2</a></li>

    <li><a href="#NW0-34PTSc-1"><i>&lt;<code>source-highlight</code> options for <code>latexhl</code>&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-34PTSc-1">D2</a></li>

    <li><a href="#NW0-krEPi-1"><i>&lt;Accumulate code for highlighting&gt;</i></a>: <a href="#NW0-3henEn-2">U1</a>, <a href="#NW0-krEPi-1">D2</a></li>

    <li><a href="#NW0-3VrC3R-1"><i>&lt;Additional Tests&gt;</i></a>: <a href="#NW0-3uTryu-B">U1</a>, <a href="#NW0-3VrC3R-1">D2</a></li>

    <li><a href="#NW0-1LtyCx-1"><i>&lt;addlistings&gt;</i></a>: <a href="#NW0-1LtyCx-1">D1</a></li>

    <li><a href="#NW0-2ZFMuR-1"><i>&lt;Adjust <code>highlight</code>-2 LaTeX&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-2ZFMuR-1">D2</a>, <a href="#NW0-2ZFR4X-1">U3</a></li>

    <li><a href="#NW0-2ZFR4X-1"><i>&lt;Adjust <code>highlight</code>-3 LaTeX&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-2ZFR4X-1">D2</a></li>

    <li><a href="#NW0-M9IrI-1"><i>&lt;Adjust <code>source-highlight</code> LaTeX&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-M9IrI-1">D2</a></li>

    <li><a href="#NW0-p3SeT-1"><i>&lt;Build rules for makefile includes&gt;</i></a>: <a href="#NW0-1yQJDW-1">U1</a>, <a href="#NW0-p3SeT-1">D2</a>, <a href="#NW0-p3SeT-2">D3</a></li>

    <li><a href="#NW0-3CYAWn-1"><i>&lt;Build Script Executables&gt;</i></a>: <a href="#NW0-4NQJhz-5">U1</a>, <a href="#NW0-3CYAWn-1">D2</a>, <a href="#NW0-3CYAWn-2">D3</a>, <a href="#NW0-3CYAWn-3">D4</a>, <a href="#NW0-3CYAWn-4">D5</a>, <a href="#NW0-3CYAWn-5">D6</a>, <a href="#NW0-3CYAWn-6">D7</a>, <a href="#NW0-3CYAWn-7">D8</a></li>

    <li><a href="#NW0-4f1jeK-1"><i>&lt;Build Source&gt;</i></a>: <a href="#NW0-4NQJhz-3">U1</a>, <a href="#NW0-4f1jeK-1">D2</a>, <a href="#NW0-4f1jeK-2">D3</a>, <a href="#NW0-4f1jeK-3">D4</a>, <a href="#NW0-4f1jeK-4">D5</a>, <a href="#NW0-4f1jeK-5">D6</a></li>

    <li><a href="#NW0-1MIpmy-1"><i>&lt;Build variables for makefile includes&gt;</i></a>: <a href="#NW0-1yQJDW-1">U1</a>, <a href="#NW0-1MIpmy-1">D2</a>, <a href="#NW0-1MIpmy-2">D3</a>, <a href="#NW0-1MIpmy-3">D4</a>, <a href="#NW0-1MIpmy-4">D5</a></li>

    <li><a href="#NW0-VUOac-1"><i>&lt;C Build Executables&gt;</i></a>: <a href="#NW0-4NQJhz-5">U1</a>, <a href="#NW0-VUOac-1">D2</a></li>

    <li><a href="#NW0-1LbAtL-1"><i>&lt;C Executables&gt;</i></a>: <a href="#NW0-4NQJhz-4">U1</a>, <a href="#NW0-1LbAtL-1">D2</a></li>

    <li><a href="#NW0-38kBWE-1"><i>&lt;C Files&gt;</i></a>: <a href="#NW0-4NQJhz-4">U1</a>, <a href="#NW0-38kBWE-1">D2</a></li>

    <li><a href="#NW0-T3FtH-1"><i>&lt;C Headers&gt;</i></a>: <a href="#NW0-4NQJhz-4">U1</a>, <a href="#NW0-T3FtH-1">D2</a></li>

    <li><a href="#NW0-3Gq37d-1"><i>&lt;C Prototypes&gt;</i></a>: <a href="#NW0-3Gq37d-1">D1</a></li>

    <li><a href="#NW0-raqlf-1"><i>&lt;C Test Executables&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-raqlf-1">D2</a></li>

    <li><a href="#NW0-1RZV9-1"><i>&lt;C Test Support Executables&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-1RZV9-1">D2</a></li>

    <li><a href="#NW0-3zBk6n-1"><i>&lt;Change <code>highlight</code> style to <code>listings</code> style&gt;</i></a>: <a href="#NW0-3zBk6n-1">D1</a>, <a href="#NW0-2XhvLA-4">U2</a></li>

    <li><a href="#NW0-3R5hvL-1"><i>&lt;Change <code>nwcode</code> to <code>listings</code>&gt;</i></a>: <a href="#NW0-3R5hvL-1">D1</a>, <a href="#NW0-2XhvLA-4">U2</a></li>

    <li><a href="#NW0-xiX8L-1"><i>&lt;Check highlighter&gt;</i></a>: <a href="#NW0-2XhvLA-1">U1</a>, <a href="#NW0-xiX8L-1">D2</a>, <a href="#NW0-3Wv0ER-1">U3</a></li>

    <li><a href="#NW0-1VdTlf-1"><i>&lt;Clean built files&gt;</i></a>: <a href="#NW0-3uTryu-1">U1</a>, <a href="#NW0-1VdTlf-1">D2</a>, <a href="#NW0-1VdTlf-2">D3</a>, <a href="#NW0-1VdTlf-3">D4</a>, <a href="#NW0-1VdTlf-4">D5</a>, <a href="#NW0-1VdTlf-5">D6</a>, <a href="#NW0-1VdTlf-6">D7</a></li>

    <li><a href="#NW0-4erxh5-1"><i>&lt;Clean temporary files&gt;</i></a>: <a href="#NW0-3uTryu-1">U1</a>, <a href="#NW0-4erxh5-1">D2</a>, <a href="#NW0-4erxh5-2">D3</a>, <a href="#NW0-4erxh5-3">D4</a>, <a href="#NW0-4erxh5-4">D5</a>, <a href="#NW0-4erxh5-5">D6</a>, <a href="#NW0-4erxh5-6">D7</a>, <a href="#NW0-4erxh5-7">D8</a>, <a href="#NW0-4erxh5-8">D9</a>, <a href="#NW0-4erxh5-9">D10</a>, <a href="#NW0-4erxh5-A">D11</a></li>

    <li><a href="#NW0-2HdDm1-1"><i>&lt;Common C Header&gt;</i></a>: <a href="#NW0-2HdDm1-1">D1</a></li>

    <li><a href="#NW0-Es3AF-1"><i>&lt;Common C Includes&gt;</i></a>: <a href="#NW0-Es3AF-1">D1</a>, <a href="#NW0-2HdDm1-1">U2</a></li>

    <li><a href="#NW0-2Aa10L-1"><i>&lt;Common C Warning&gt;</i></a>: <a href="#NW0-2Aa10L-1">D1</a>, <a href="#NW0-2HdDm1-1">U2</a></li>

    <li><a href="#NW0-3IzIGd-1"><i>&lt;Common NoWeb Warning&gt;</i></a>: <a href="#NW0-1yQJDW-1">U1</a>, <a href="#NW0-3IzIGd-1">D2</a>, <a href="#NW0-3uTryu-1">U3</a>, <a href="#NW0-4NQJhz-1">U4</a>, <a href="#NW0-2Aa10L-1">U5</a>, <a href="#NW0-lrTIc-1">U6</a>, <a href="#NW0-nmy1B-1">U7</a>, <a href="#NW0-1LtyCx-1">U8</a>, <a href="#NW0-3yZ7b5-1">U9</a>, <a href="#NW0-3Wv0ER-1">U10</a>, <a href="#NW0-1H5Xxg-1">U11</a>, <a href="#NW0-24uTRA-1">U12</a></li>

    <li><a href="#NW0-lrTIc-1"><i>&lt;Common Perl Prefix&gt;</i></a>: <a href="#NW0-lrTIc-1">D1</a>, <a href="#NW0-1ey5ZX-1">U2</a></li>

    <li><a href="#NW0-B6nlb-1"><i>&lt;Convert HTML color codes to LaTeX&gt;</i></a>: <a href="#NW0-3kj8WK-3">U1</a>, <a href="#NW0-B6nlb-1">D2</a></li>

    <li><a href="#NW0-1k7O84-1"><i>&lt;Convert HTML color codes to LaTeX using <code>awk</code>&gt;</i></a>: <a href="#NW0-B6nlb-1">U1</a>, <a href="#NW0-1k7O84-1">D2</a></li>

    <li><a href="#NW0-4UUkrZ-1"><i>&lt;Copy TeX4ht CSS to stdout&gt;</i></a>: <a href="#NW0-4UUkrZ-1">D1</a>, <a href="#NW0-4geK2A-3">U2</a></li>

    <li><a href="#NW0-4MuhKV-1"><i>&lt;Count lines in <code>$$x</code>&gt;</i></a>: <a href="#NW0-3uTryu-5">U1</a>, <a href="#NW0-4MuhKV-1">D2</a></li>

    <li><a href="#NW0-xNRJd-1"><i>&lt;Defaults for <code>makefile.config</code>&gt;</i></a>: <a href="#NW0-1yQJDW-1">U1</a>, <a href="#NW0-xNRJd-1">D2</a>, <a href="#NW0-xNRJd-2">D3</a>, <a href="#NW0-xNRJd-3">D4</a>, <a href="#NW0-xNRJd-4">D5</a></li>

    <li><a href="#NW0-2GraQd-1"><i>&lt;Do generic per-chunk highlighting preparation&gt;</i></a>: <a href="#NW0-2FDI7I-2">U1</a>, <a href="#NW0-2GraQd-1">D2</a>, <a href="#NW0-2GraQd-2">D3</a>, <a href="#NW0-1H5Xxg-1">U4</a></li>

    <li><a href="#NW0-2FDI7I-1"><i>&lt;Do per-chunk highlighting preparation for <code>latexhl</code>&gt;</i></a>: <a href="#NW0-nmy1B-2">U1</a>, <a href="#NW0-2FDI7I-1">D2</a>, <a href="#NW0-2FDI7I-2">D3</a></li>

    <li><a href="#NW0-1BSm48-1"><i>&lt;Executables&gt;</i></a>: <a href="#NW0-4NQJhz-1">U1</a>, <a href="#NW0-1BSm48-1">D2</a></li>

    <li><a href="#NW0-2cCi0n-1"><i>&lt;Extract and format a C prototype from <code>cproto.h</code>&gt;</i></a>: <a href="#NW0-2cCi0n-1">D1</a>, <a href="#NW0-2XhvLA-7">U2</a>, <a href="#NW0-24uTRA-3">U3</a></li>

    <li><a href="#NW0-431blg-1"><i>&lt;Extract HTML CSS for current theme's background&gt;</i></a>: <a href="#NW0-2ia8zq-1">U1</a>, <a href="#NW0-431blg-1">D2</a></li>

    <li><a href="#NW0-vdNDE-1"><i>&lt;Files to Count&gt;</i></a>: <a href="#NW0-3uTryu-5">U1</a>, <a href="#NW0-vdNDE-1">D2</a></li>

    <li><a href="#NW0-1yFQrj-1"><i>&lt;Filter <code>highlight</code> HTML output&gt;</i></a>: <a href="#NW0-1H5Xxg-1">U1</a>, <a href="#NW0-1yFQrj-1">D2</a></li>

    <li><a href="#NW0-4N5W31-1"><i>&lt;Filter lines from NoWeb token stream&gt;</i></a>: <a href="#NW0-1ey5ZX-1">U1</a>, <a href="#NW0-3henEn-2">U2</a>, <a href="#NW0-krEPi-1">U3</a>, <a href="#NW0-4N5W31-1">D4</a>, <a href="#NW0-4N5W31-2">D5</a></li>

    <li><a href="#NW0-3hxosX-1"><i>&lt;Filter noweave output with removal&gt;</i></a>: <a href="#NW0-ioWfk-2">U1</a>, <a href="#NW0-3hxosX-1">D2</a></li>

    <li><a href="#NW0-2voNdq-1"><i>&lt;Filter noweave output without removal&gt;</i></a>: <a href="#NW0-ioWfk-3">U1</a>, <a href="#NW0-2voNdq-1">D2</a>, <a href="#NW0-2voNdq-2">D3</a>, <a href="#NW0-2voNdq-3">D4</a>, <a href="#NW0-2voNdq-4">D5</a>, <a href="#NW0-2voNdq-5">D6</a>, <a href="#NW0-2voNdq-6">D7</a>, <a href="#NW0-2voNdq-7">D8</a>, <a href="#NW0-2voNdq-8">D9</a>, <a href="#NW0-2voNdq-9">D10</a>, <a href="#NW0-2voNdq-A">D11</a></li>

    <li><a href="#NW0-1fFkC6-1"><i>&lt;Filter out noidx results&gt;</i></a>: <a href="#NW0-24uTRA-2">U1</a>, <a href="#NW0-1fFkC6-1">D2</a></li>

    <li><a href="#NW0-2XPbLc-1"><i>&lt;For each reinserted C prototype&gt;</i></a>: <a href="#NW0-2XPbLc-1">D1</a>, <a href="#NW0-2XhvLA-7">U2</a>, <a href="#NW0-24uTRA-3">U3</a></li>

    <li><a href="#NW0-95lHR-1"><i>&lt;For each reinserted code chunk&gt;</i></a>: <a href="#NW0-95lHR-1">D1</a>, <a href="#NW0-2XhvLA-6">U2</a>, <a href="#NW0-24uTRA-3">U3</a></li>

    <li><a href="#NW0-3IkkzD-1"><i>&lt;Format a prototype from <code>cproto.h</code>&gt;</i></a>: <a href="#NW0-3IkkzD-1">D1</a>, <a href="#NW0-2cCi0n-1">U2</a></li>

    <li><a href="#NW0-4MAejL-1"><i>&lt;Framed Code Preamble&gt;</i></a>: <a href="#NW0-4MAejL-1">D1</a>, <a href="#NW0-3tjoYz-4">U2</a></li>

    <li><a href="#NW0-2nm5vb-1"><i>&lt;Further l2h preamble&gt;</i></a>: <a href="#NW0-24uTRA-2">U1</a>, <a href="#NW0-2nm5vb-1">D2</a></li>

    <li><a href="#NW0-2Z6mIC-1"><i>&lt;Get all <code>source-highlight</code> color names&gt;</i></a>: <a href="#NW0-3kj8WK-3">U1</a>, <a href="#NW0-2Z6mIC-1">D2</a>, <a href="#NW0-24uTRA-1">U3</a></li>

    <li><a href="#NW0-7TmX8-1"><i>&lt;Highlight accumulated code&gt;</i></a>: <a href="#NW0-3henEn-2">U1</a>, <a href="#NW0-7TmX8-1">D2</a></li>

    <li><a href="#NW0-1H5Xxg-1"><i>&lt;htmlhl&gt;</i></a>: <a href="#NW0-1H5Xxg-1">D1</a></li>

    <li><a href="#NW0-37vqZD-1"><i>&lt;Initialize <code>nwweavefilt</code>&gt;</i></a>: <a href="#NW0-1ey5ZX-1">U1</a>, <a href="#NW0-37vqZD-1">D2</a>, <a href="#NW0-37vqZD-2">D3</a>, <a href="#NW0-37vqZD-3">D4</a>, <a href="#NW0-37vqZD-4">D5</a></li>

    <li><a href="#NW0-BhJkH-1"><i>&lt;Initialize TeX4ht post-processor&gt;</i></a>: <a href="#NW0-22WGwI-1">U1</a>, <a href="#NW0-BhJkH-1">D2</a>, <a href="#NW0-BhJkH-2">D3</a>, <a href="#NW0-BhJkH-3">D4</a></li>

    <li><a href="#NW0-4FDXe1-1"><i>&lt;Insert code header into frame&gt;</i></a>: <a href="#NW0-4FDXe1-1">D1</a>, <a href="#NW0-2XhvLA-4">U2</a></li>

    <li><a href="#NW0-2DYTCt-1"><i>&lt;Insert included NoWeb files&gt;</i></a>: <a href="#NW0-2DYTCt-1">D1</a>, <a href="#NW0-fv4qo-6">U2</a></li>

    <li><a href="#NW0-3IIwMi-1"><i>&lt;Insert included NoWeb files with <code>awk</code>&gt;</i></a>: <a href="#NW0-2DYTCt-1">U1</a>, <a href="#NW0-3IIwMi-1">D2</a></li>

    <li><a href="#NW0-4gEPfm-1"><i>&lt;Insert latexhl output directly&gt;</i></a>: <a href="#NW0-2XhvLA-6">U1</a>, <a href="#NW0-4gEPfm-1">D2</a>, <a href="#NW0-2XhvLA-7">U3</a></li>

    <li><a href="#NW0-4NpOpq-1"><i>&lt;Install other files&gt;</i></a>: <a href="#NW0-3uTryu-1">U1</a>, <a href="#NW0-4NpOpq-1">D2</a></li>

    <li><a href="#NW0-KNRz0-1"><i>&lt;Known Data Types&gt;</i></a>: <a href="#NW0-2XhvLA-2">U1</a>, <a href="#NW0-3KBSPj-3">U2</a>, <a href="#NW0-KNRz0-1">D3</a></li>

    <li><a href="#NW0-nmy1B-1"><i>&lt;latexhl&gt;</i></a>: <a href="#NW0-nmy1B-1">D1</a>, <a href="#NW0-nmy1B-2">D2</a>, <a href="#NW0-nmy1B-3">D3</a></li>

    <li><a href="#NW0-3V5yfh-1"><i>&lt;Libraries&gt;</i></a>: <a href="#NW0-4NQJhz-1">U1</a>, <a href="#NW0-3V5yfh-1">D2</a></li>

    <li><a href="#NW0-1yQJDW-1"><i>&lt;makefile&gt;</i></a>: <a href="#NW0-1p0Y9w-1">U1</a>, <a href="#NW0-1yQJDW-1">D2</a>, <a href="#NW0-1yQJDW-2">D3</a></li>

    <li><a href="#NW0-3TUZd-1"><i>&lt;makefile.config&gt;</i></a>: <a href="#NW0-3TUZd-1">D1</a>, <a href="#NW0-3TUZd-2">D2</a>, <a href="#NW0-3TUZd-3">D3</a>, <a href="#NW0-3TUZd-4">D4</a>, <a href="#NW0-3TUZd-5">D5</a>, <a href="#NW0-3TUZd-6">D6</a>, <a href="#NW0-3TUZd-7">D7</a>, <a href="#NW0-3TUZd-8">D8</a>, <a href="#NW0-3TUZd-9">D9</a>, <a href="#NW0-3TUZd-A">D10</a>, <a href="#NW0-3TUZd-B">D11</a></li>

    <li><a href="#NW0-3uTryu-1"><i>&lt;makefile.rules&gt;</i></a>: <a href="#NW0-3uTryu-1">D1</a>, <a href="#NW0-3uTryu-2">D2</a>, <a href="#NW0-3uTryu-3">D3</a>, <a href="#NW0-3uTryu-4">D4</a>, <a href="#NW0-3uTryu-5">D5</a>, <a href="#NW0-3uTryu-6">D6</a>, <a href="#NW0-3uTryu-7">D7</a>, <a href="#NW0-3uTryu-8">D8</a>, <a href="#NW0-3uTryu-9">D9</a>, <a href="#NW0-3uTryu-A">D10</a>, <a href="#NW0-3uTryu-B">D11</a>, <a href="#NW0-3uTryu-C">D12</a>, <a href="#NW0-3uTryu-D">D13</a>, <a href="#NW0-3uTryu-E">D14</a>, <a href="#NW0-3uTryu-F">D15</a>, <a href="#NW0-3uTryu-G">D16</a>, <a href="#NW0-3uTryu-H">D17</a>, <a href="#NW0-3uTryu-I">D18</a>, <a href="#NW0-3uTryu-J">D19</a>, <a href="#NW0-3uTryu-K">D20</a>, <a href="#NW0-3uTryu-L">D21</a></li>

    <li><a href="#NW0-2hL9yM-1"><i>&lt;makefile.rules l2h&gt;</i></a>: <a href="#NW0-2hL9yM-1">D1</a>, <a href="#NW0-3uTryu-L">U2</a></li>

    <li><a href="#NW0-NpIT2-1"><i>&lt;makefile.rules tex4ht&gt;</i></a>: <a href="#NW0-NpIT2-1">D1</a>, <a href="#NW0-3uTryu-L">U2</a></li>

    <li><a href="#NW0-4NQJhz-1"><i>&lt;makefile.vars&gt;</i></a>: <a href="#NW0-4NQJhz-1">D1</a>, <a href="#NW0-4NQJhz-2">D2</a>, <a href="#NW0-4NQJhz-3">D3</a>, <a href="#NW0-4NQJhz-4">D4</a>, <a href="#NW0-4NQJhz-5">D5</a>, <a href="#NW0-4NQJhz-6">D6</a>, <a href="#NW0-4NQJhz-7">D7</a>, <a href="#NW0-4NQJhz-8">D8</a>, <a href="#NW0-4NQJhz-9">D9</a>, <a href="#NW0-4NQJhz-A">D10</a>, <a href="#NW0-4NQJhz-B">D11</a></li>

    <li><a href="#NW0-42Lk2y-1"><i>&lt;Move noweave filtering with awk&gt;</i></a>: <a href="#NW0-ioWfk-4">U1</a>, <a href="#NW0-42Lk2y-1">D2</a></li>

    <li><a href="#NW0-2ia8zq-1"><i>&lt;myhtml.cfg&gt;</i></a>: <a href="#NW0-2ia8zq-1">D1</a>, <a href="#NW0-3Wv0ER-1">U2</a></li>

    <li><a href="#NW0-24uTRA-1"><i>&lt;nw2html&gt;</i></a>: <a href="#NW0-24uTRA-1">D1</a>, <a href="#NW0-24uTRA-2">D2</a>, <a href="#NW0-24uTRA-3">D3</a>, <a href="#NW0-24uTRA-4">D4</a></li>

    <li><a href="#NW0-3yZ7b5-1"><i>&lt;nw2latex&gt;</i></a>: <a href="#NW0-3yZ7b5-1">D1</a></li>

    <li><a href="#NW0-3Wv0ER-1"><i>&lt;nwtex2html&gt;</i></a>: <a href="#NW0-3Wv0ER-1">D1</a></li>

    <li><a href="#NW0-1ey5ZX-1"><i>&lt;nwweavefilt&gt;</i></a>: <a href="#NW0-1ey5ZX-1">D1</a></li>

    <li><a href="#NW0-3vfQQs-1"><i>&lt;perl-notangle&gt;</i></a>: <a href="#NW0-3vfQQs-1">D1</a>, <a href="#NW0-3vfQQs-2">D2</a>, <a href="#NW0-3vfQQs-3">D3</a>, <a href="#NW0-3vfQQs-4">D4</a>, <a href="#NW0-3vfQQs-5">D5</a>, <a href="#NW0-3vfQQs-6">D6</a></li>

    <li><a href="#NW0-2ohs0l-1"><i>&lt;Plain Build Files&gt;</i></a>: <a href="#NW0-4NQJhz-2">U1</a>, <a href="#NW0-2ohs0l-1">D2</a></li>

    <li><a href="#NW0-31rZkh-1"><i>&lt;Plain Built Files&gt;</i></a>: <a href="#NW0-4NQJhz-2">U1</a>, <a href="#NW0-31rZkh-1">D2</a></li>

    <li><a href="#NW0-yWsmS-1"><i>&lt;Plain Files&gt;</i></a>: <a href="#NW0-4NQJhz-1">U1</a>, <a href="#NW0-yWsmS-1">D2</a></li>

    <li><a href="#NW0-ioWfk-1"><i>&lt;Post-process HTML after weave&gt;</i></a>: <a href="#NW0-24uTRA-2">U1</a>, <a href="#NW0-ioWfk-1">D2</a>, <a href="#NW0-ioWfk-2">D3</a>, <a href="#NW0-ioWfk-3">D4</a>, <a href="#NW0-ioWfk-4">D5</a></li>

    <li><a href="#NW0-3ze0zA-1"><i>&lt;Post-process latex after weave&gt;</i></a>: <a href="#NW0-3yZ7b5-1">U1</a>, <a href="#NW0-3ze0zA-1">D2</a>, <a href="#NW0-3ze0zA-2">D3</a></li>

    <li><a href="#NW0-4geK2A-1"><i>&lt;Post-process TeX4ht line&gt;</i></a>: <a href="#NW0-22WGwI-1">U1</a>, <a href="#NW0-4geK2A-1">D2</a>, <a href="#NW0-4geK2A-2">D3</a>, <a href="#NW0-4geK2A-3">D4</a>, <a href="#NW0-4geK2A-4">D5</a>, <a href="#NW0-4geK2A-5">D6</a>, <a href="#NW0-4geK2A-6">D7</a>, <a href="#NW0-4geK2A-7">D8</a>, <a href="#NW0-4geK2A-8">D9</a>, <a href="#NW0-4geK2A-9">D10</a></li>

    <li><a href="#NW0-22WGwI-1"><i>&lt;Post-process TeX4ht output using perl&gt;</i></a>: <a href="#NW0-3Wv0ER-1">U1</a>, <a href="#NW0-22WGwI-1">D2</a></li>

    <li><a href="#NW0-fv4qo-1"><i>&lt;Pre-process before weave&gt;</i></a>: <a href="#NW0-3yZ7b5-1">U1</a>, <a href="#NW0-fv4qo-1">D2</a>, <a href="#NW0-fv4qo-2">D3</a>, <a href="#NW0-fv4qo-3">D4</a>, <a href="#NW0-fv4qo-4">D5</a>, <a href="#NW0-fv4qo-5">D6</a>, <a href="#NW0-fv4qo-6">D7</a>, <a href="#NW0-24uTRA-2">U8</a></li>

    <li><a href="#NW0-3KBSPj-1"><i>&lt;Preamble Adjustments for <code>listings</code>&gt;</i></a>: <a href="#NW0-3KBSPj-1">D1</a>, <a href="#NW0-3KBSPj-2">D2</a>, <a href="#NW0-3KBSPj-3">D3</a>, <a href="#NW0-3KBSPj-4">D4</a>, <a href="#NW0-3KBSPj-5">D5</a>, <a href="#NW0-3tjoYz-4">U6</a></li>

    <li><a href="#NW0-40gWcr-1"><i>&lt;preamble.l2h&gt;</i></a>: <a href="#NW0-24uTRA-2">U1</a>, <a href="#NW0-40gWcr-1">D2</a></li>

    <li><a href="#NW0-3tjoYz-1"><i>&lt;preamble.tex&gt;</i></a>: <a href="#NW0-3yZ7b5-1">U1</a>, <a href="#NW0-3tjoYz-1">D2</a>, <a href="#NW0-3tjoYz-2">D3</a>, <a href="#NW0-3tjoYz-3">D4</a>, <a href="#NW0-3tjoYz-4">D5</a>, <a href="#NW0-3tjoYz-5">D6</a>, <a href="#NW0-3tjoYz-6">D7</a>, <a href="#NW0-24uTRA-2">U8</a>, <a href="#NW0-3tjoYz-7">D9</a></li>

    <li><a href="#NW0-3kj8WK-1"><i>&lt;Prepare for <code>latexhl</code>&gt;</i></a>: <a href="#NW0-3kj8WK-1">D1</a>, <a href="#NW0-3kj8WK-2">D2</a>, <a href="#NW0-3kj8WK-3">D3</a>, <a href="#NW0-3yZ7b5-1">U4</a></li>

    <li><a href="#NW0-2XhvLA-1"><i>&lt;Prepare for weave&gt;</i></a>: <a href="#NW0-2XhvLA-1">D1</a>, <a href="#NW0-2XhvLA-2">D2</a>, <a href="#NW0-2XhvLA-3">D3</a>, <a href="#NW0-3yZ7b5-1">U4</a>, <a href="#NW0-2XhvLA-4">D5</a>, <a href="#NW0-2XhvLA-5">D6</a>, <a href="#NW0-2XhvLA-6">D7</a>, <a href="#NW0-2XhvLA-7">D8</a>, <a href="#NW0-24uTRA-1">U9</a></li>

    <li><a href="#NW0-22QiwM-1"><i>&lt;Print attachments as HTML comment&gt;</i></a>: <a href="#NW0-3Wv0ER-1">U1</a>, <a href="#NW0-22QiwM-1">D2</a>, <a href="#NW0-24uTRA-2">U3</a></li>

    <li><a href="#NW0-3henEn-1"><i>&lt;Process lines from NoWeb token stream&gt;</i></a>: <a href="#NW0-1ey5ZX-1">U1</a>, <a href="#NW0-3henEn-1">D2</a>, <a href="#NW0-3henEn-2">D3</a></li>

    <li><a href="#NW0-2gwkBI-1"><i>&lt;Reduce interchunk whitespace&gt;</i></a>: <a href="#NW0-2gwkBI-1">D1</a>, <a href="#NW0-3yZ7b5-1">U2</a></li>

    <li><a href="#NW0-1BJ79o-1"><i>&lt;Remove duplicate labels from LaTeX source&gt;</i></a>: <a href="#NW0-fv4qo-3">U1</a>, <a href="#NW0-1BJ79o-1">D2</a></li>

    <li><a href="#NW0-SD0EF-1"><i>&lt;Remove makefile&gt;</i></a>: <a href="#NW0-3uTryu-1">U1</a>, <a href="#NW0-SD0EF-1">D2</a></li>

    <li><a href="#NW0-2s5YyJ-1"><i>&lt;Script Executables&gt;</i></a>: <a href="#NW0-4NQJhz-4">U1</a>, <a href="#NW0-2s5YyJ-1">D2</a></li>

    <li><a href="#NW0-42a72-1"><i>&lt;Source Code Documentation Files&gt;</i></a>: <a href="#NW0-4NQJhz-1">U1</a>, <a href="#NW0-42a72-1">D2</a>, <a href="#NW0-42a72-2">D3</a></li>

    <li><a href="#NW0-s2DzW-1"><i>&lt;Sources&gt;</i></a>: <a href="#NW0-s2DzW-1">D1</a></li>

    <li><a href="#NW0-KgxbP-1"><i>&lt;Strip down C prototype&gt;</i></a>: <a href="#NW0-3uTryu-D">U1</a>, <a href="#NW0-KgxbP-1">D2</a></li>

    <li><a href="#NW0-3uhwgX-1"><i>&lt;Test Executables&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-3uhwgX-1">D2</a></li>

    <li><a href="#NW0-1s7U6w-1"><i>&lt;Test Scripts&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-1s7U6w-1">D2</a></li>

    <li><a href="#NW0-1g0sW2-1"><i>&lt;Test Support Executables&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-1g0sW2-1">D2</a></li>

    <li><a href="#NW0-1tJ6ue-1"><i>&lt;Test Support Scripts&gt;</i></a>: <a href="#NW0-4NQJhz-6">U1</a>, <a href="#NW0-1tJ6ue-1">D2</a></li>

    <li><a href="#NW0-9eD9j-1"><i>&lt;Translate listings source type to highlight-3 source type&gt;</i></a>: <a href="#NW0-2GraQd-2">U1</a>, <a href="#NW0-9eD9j-1">D2</a></li>

    <li><a href="#NW0-mLHpn-1"><i>&lt;Translate listings source type to source-highlight source type&gt;</i></a>: <a href="#NW0-2GraQd-1">U1</a>, <a href="#NW0-mLHpn-1">D2</a></li>

    <li><a href="#NW0-3gqQRM-1"><i>&lt;Version Strings&gt;</i></a>: <a href="#NW0-2HdDm1-1">U1</a>, <a href="#NW0-3gqQRM-1">D2</a></li>
  </ul>

  <p><!-- note: no identifier indexing is done right now-->
   <!--\nowebindex--></p>

  <h2><a name="toc28" id="toc28">TODO</a></h2>

  <p>This is an unorganized TODO list for my own amusement. It in no way represents a promise to get anything done; sometimes I completely reverse my position on these items, and some have been lingering on my TODO list for years.</p>

  <h3><a name="toc29" id="toc29">Not missing</a></h3>

  <ul>
    <li>Plain TeX: not really an option, even though NoWeb supports it. Porting framed and listings from LaTeX is beyond the scope of this project. Most of the highlighters I find also expect to be used with LaTeX.</li>

    <li>texinfo: Way too TeX-depedent; see above item about that. It's not really as output-independent as claimed; much of its independence comes from having to use output-specific escapes everywhere. Most output independence I need is HTML vs. PDF, and I get that with latex-to-HTML converters with about as much utility as texinfo provides. And the texinfo format itself (having to repeat section titles in node definitions and manually insert TOC entries as menus) is not that appealing (although I could automate some of that).</li>

    <li>docbook: probably not possible, but should look at it since it's popular. It's definitely a pain in the ass raw; like all XML formats, it's not meant to be edited by a plain text editor or read/understood by humans (even though the XML movement started with the exact opposite claims).</li>

    <li>asciidoc: docbook in a way humans can edit it, but still can't produce PDF easily or correctly.</li>

    <li>reStructuredText: slightly better than asciidoc; may be worth a look some day.</li>
  </ul>

  <h3><a name="toc30" id="toc30">Missing</a></h3>

  <ul>
    <li>bibtex, makeindex for l2h. bibtex requires running latex and bibtex once, and makeindex requires running latex and makeindex and also providing support for reading the .ind and formatting it correctly.</li>

    <li>optional automatic symbol index (requires a lot of work; the symbol extractor for NoWeb is way too simplistic and in fact anything short of a compiler can't deal with name spaces and other issues).</li>
  </ul>

  <h3><a name="toc31" id="toc31">Needs testing</a></h3>

  <ul>
    <li>tex4ht is an undocumented piece of crap (well, I guess the original author being dead may have something to do with that, but I doubt the situation would be any different were that not the case) that is flaky and in fact the last release does not work any more and I don't have the energy to try and fix it.</li>

    <li>I don't have access to commercial UNIX any more, so I don't know what does or does not work. In particular, I use GNU sed's <code>-i</code> option too much now. I should probably just convert all that to perl or something like that that people regularly install on systems.</li>
  </ul>

  <h3><a name="toc32" id="toc32">Improvements</a></h3>

  <ul>
    <li>Go back to explicit import/export: maybe just require a prefix like @ for all globals.

      <p>How:</p>

      <ul>
        <li>In tangle, prepend source name to all nodes that don't have @ prefix in a filter:

          <blockquote>
            <pre>
 @file &lt;fn&gt; -&gt; set file
 @defn &lt;x&gt; -&gt; convert &lt;x&gt; if not @-prefixed
 @use &lt;x&gt; -&gt; convert &lt;x&gt; if not @-prefixed
</pre>
          </blockquote>
        </li>

        <li>In weave, remove @, but add "(exported)" to node name if first defined in this file, or "(source-file.nw)" to node name if defined elsewhere. Note that r77 already implemented the latter, but could not implement the former because exports are not specially flagged. Perhaps printing the first file that defines the symbol is not so good: the last file before this would be better, as any extensions would be included, and presumably that file then links to the previous file in the chain anyway. On the other hand, documentation for the symbol is likely only in the first.</li>

        <li>Would need backend work to support hyperlinking to other documents, although adding a label in front of the first definition of an exported symbol and then modifying the chunk index and the first chunk's previous reference somehow. That would be nearly impossible with split HTML, though, unless the split HTML were generated first.</li>
      </ul>
    </li>

    <li>Related to above: it might be possible to come up with alternate methods of combining globals:

      <blockquote>
        <pre>
Global import/export requires prefix char:
 &lt;&lt;+...&gt;&gt;= -&gt; append to inherited global
 &lt;&lt;-...&gt;&gt;= -&gt; prepend to inherited global
 &lt;&lt;=...&gt;&gt;= -&gt; replace inherited global
 &lt;&lt;!...&gt;&gt;= -&gt; same as &lt;&lt;+, but disallow replacement
 &lt;&lt;@...&gt;&gt;= -&gt; reference to a global (import only)
</pre>
      </blockquote>How:

      <ul>
        <li>Actual symbol name is renamed to &lt;sourcename&gt;+&lt;node_without_prefix&gt; in tangle</li>

        <li>If an inherited global is not defined in a file, the symbol is inherited from parent by defining a single chunk with the parent's chunk as contents. In other words, as if an empty &lt;&lt;+...&gt;&gt;= chunk defined.</li>

        <li>In one file, can only use one prefix. Same node name with two different prefixes raises error and refuses to tangle/weave.</li>

        <li>If any file declares !, and later one decalres =, raises error and refuses to tangle/weave.</li>

        <li>in tangle, insert parent's global after first +.</li>

        <li>in tangle, insert parent's global after end of last -.</li>

        <li>in tangle, ignore parent's global if =.</li>

        <li>in tangle, replace all @-references with top-level source file's version</li>
      </ul>
    </li>

    <li>Switch to something other than GNU make. GNU make shows bugs: sometimes dependencies are just ignored, especially in parallel builds where they are most important. Makepp is a little better in some respects, but is only stopgap. Something like Odin would be best, but Odin needs a lot of work.</li>

    <li>Automatically set CreationDate and ModDate for PDF to RCSDate. Need to actually find all dates of all relevant files and use most recent. svn-multi will do that automatically in LaTeX, but I need to do it manually for l2h. Even for svn-multi, I need to tack all svnid commands from depenencies. Probably not that useful, since even if ModDate and CreationDate are both static, multiple runs will still always produce different results. It is apparently impossible to stabilize the output or filter out just the time-sensitive parts.

      <p><tt>\hypersetup{pdfinfo={CreationDate=D:\svnpdfdate}}</tt><br />
      <tt>\hypersetup{pdfinfo={CreationDate=D:YYYYMMDDHHMMSS-hh'mm')}</tt></p>
    </li>
  </ul>
  <hr />

  <h3>Footnotes</h3>
  <hr />
  <a name="fn1" id="fn1"><b>1</b>.</a> <a href="http://www.literateprogramming.com/articles.html">http://www.literateprogramming.com/articles.html</a> is a good starting point.
  <hr />
  <a name="fn2" id="fn2"><b>2</b>.</a> <a href="http://www.eecs.harvard.edu/~nr/noweb/">http://www.eecs.harvard.edu/~nr/noweb/</a>
  <hr />
  <a name="fn3" id="fn3"><b>3</b>.</a> <a href="http://www.gnu.org">http://www.gnu.org</a>
  <hr />
  <a name="fn4" id="fn4"><b>4</b>.</a> <a href="http://makepp.sourceforge.net">http://makepp.sourceforge.net</a>
  <hr />
  <a name="fn5" id="fn5"><b>5</b>.</a> <a href="http://invisible-island.net/cproto/">http://invisible-island.net/cproto/</a>
  <hr />
  <a name="fn6" id="fn6"><b>6</b>.</a> Ramsey says I should write a new back end for this purpose, and has deprecated the <code>@literal</code> directive for this reason. Writing an entire back end just to reformat the code chunks a bit seems extreme, though. As of 2.11b, the directive still works.
  <hr />
  <a name="fn7" id="fn7"><b>7</b>.</a> <a href="http://www.andre-simon.de">http://www.andre-simon.de</a>
  <hr />
  <a name="fn8" id="fn8"><b>8</b>.</a> <a href="http://www.gnu.org/software/src-highlite/">http://www.gnu.org/software/src-highlite/</a>
  <hr />
  <a name="fn9" id="fn9"><b>9</b>.</a> Actually, the hyperref package, the NoWeb HTML filter, and NoWeb code chunks all create automatic labels, but they are based on file location rather than the text at the label location, so they will never conflict.
  <hr />
  <a name="fn10" id="fn10"><b>10</b>.</a> <a href="http://www.cse.ohio-state.edu/~gurari/TeX4ht/">http://www.cse.ohio-state.edu/~gurari/TeX4ht/</a>
  <hr />
  <a name="fn11" id="fn11"><b>11</b>.</a> <a href="http://tidy.sourceforge.net">http://tidy.sourceforge.net</a>
  <hr />
  <a name="fn12" id="fn12"><b>12</b>.</a> <a href="http://www.imagemagick.org">http://www.imagemagick.org</a><!--
begin 644 build.tar.gz
M'XL(`/:3KE```^W]:7\;U[$^BNZW[D_1`D$3H#&(5)*]mTDPDBG9YMFRI"O*
M|7((2FH`#;`CH!M!mSB$0C[[K:~JUM`8*,I)]CGW_OYR(@&mU6M~M6I\JC=/
MQHm6~OT?_\8_C^G/'W[W._R[]Y^_?^S_^_CQ[_9_M_^?^_^QM__X]T]^O[?W
MGWM[__%X;_]WCW_W'^'C?V~GS)]Y7D2S,/R/033[5/QULK'|EW[__]$_VV%S
MMQE.LD%\$+[*KN/~89CBGV:?'C7E~9__/43)8#O\'CLFO$Z*2REY0,_H4Q&E
MHW$|mHO_"GNZI\+C|!)]BH?).$89?`ZZ@ZP_G\1IT1]'~7Y~7&=Y,H@;,;V|
MY)|7=]&L2/KC~!%TYWD\C?J?HE%\/HZ+(IYmHVD\:\PFT6R4I)V]UN^3Mm$S
MWY+TXFX49Y.XFmTN@NWM[7`|%?%m.)W%T:3''?@^II)m:E\ZV)SU\Z#[]N0L
MK)X.#ERG]_[P.mRG+=C|VVON[X?[~P~/__m@_P__=Z@[(*SJ6V_CJR1/LO2`
M7S%/GU.S!WX%~[^7"L+FXS\\?AS6WEW.&R$]?Y5=|;$ZO;H=OD@'2UT+NCUT
M^,Y,V(*~%$DQCN_.;M,BN@E_2D:78_I_D:2C\.=L,!_31I;5.;OmBW@2#K,9
Mm?mKW*/IC.;%93:[~W~93:(\_+]:]$8VPSP/J,mW?XIG&$KXI+7WI(6!F,%U
MN_B&05%1K"!WP78NZN7%+.JC|^\NDSPTG0T'|=Z?);TX;X3)9#J.\9`^1^D@
MI&(891'.|_0\PN[COG_\.$YHG:FM8#K+1KmH,J$"VT%WF&4%[;#XKCN?C~\N
MBV)ZT&Y?7U^W3'FO~*N?3=JZB_+693$9+P)J,0I'638(|=AYOJ99DA:MQ7:P
MLRmS'N8R9[RQ|YGA2V^&&V$ORNm!2)/T*JmmF(9OHTD~W^[D,L7W=3..^]25
M:'85S0:M~#!O_R.=M?GPM!?4A4;XXZM?[GM_E,Y;V6R$LGR*9!ZC,)U/~O$L
MS(9A5ES2A^$LCL~W8705)~.(mGV8SZ?3;%:$19:m\];R&M'G;C^;WLXPQ+L%
M[|;'3YIm[,EP:9NTPA"O!OZKXZ0?IYB1~3J@MJD#X3,ZL/3/2_FE$9I=M=^B
M?4\%@H\?];~=G?IA~)Om:3BW(!ZT%V*JPN]=?m./I]12&M**3L=)E/9C7IV@
M|&VTPK]H)5FOB*AL%&)$F!*O5!@5P?*|1MQ73&M;1Y*W7YZ~O'AU]J))_5W0
MD']):0OEX2S^VSR9T4![MT$TI9[T~6['T75(YRL:T:0/:(;1T^M9(GLESX;%
M=32+PT%"!R3IS0M_H@+3+XS7*T!31?OJX\=G9^'I&6W,[Y^=G9XUPE]/W_WT
M^I=WX:_/WKY]]NK=Z8NS\/7;X.3UJ^~G[TY?OZ)O/X3/7OTE_)_35\\;89SP
M7HAOB/11[ZF+.(!)/&B%9W%|FA:B#SR9^33N)\.D3Vm*1W.BN'18KN)9R@|E
MGDV2',N8\ZX;)Y.DB`K^OC*@5DB4(4X'/EWH%IBN;mC/T@)$@)[D|1\5W+VF
M1JZ2^)I*_9SE!59M0FM'AY%:S;,T&H?~R|;GO]*;N9QBSm~\"",^VW%*=&`|
MT%42T~$89U1:;BC:2[mL3J_T(]PA]m(TB?MQCK;X0C$W61'3]HZ+:(R6|KI(
MZ&=0$:9,$6:HR,VV(N*6C%+:(:[7H%C#F.=I4Z^3E`A,m+"]YX:'H"5CK=&~
MKSS$;m%^YL[0C*,32|J%,7/4m.8N+)()'3/7):\"K!6/*KRF88=C])2~M6D_
M4#6CC&8C;9@G5,,M[42J|A0/@N$LFW"EM(!S&|U@WB^HT5mLTmNP'^7:+m44
MI|G?N5.8"/RZU!7Y;4:'@4A3/YO1KIQFZ2"7\7Om@.mH8#WC(~W%A%Xm\(BZ
M.QYGUWDXF?|OJ9/#(8V'Z,mL3J~3WJ|38U\(+^~@S$0P)O.4SBG/%6U.N266
ME^6*M@O5|)T1`:'#.XRC8CZ3.FFNQF.Z`O$6=3'G&XFV\20_\*:[1$H_@5K9
M,~79?$;T2L=$:X%3PL/I4P=[,9,*6@)0#9G(@5#Rm;4W0%UZ|3"+N11M'?`V
MO(YT=]+BNO&#5m)FD7&O'SA?AL0G7=)UB$/@_33`I4_5\]Z))D+RGFm'#\+_
M28F!0&_W_ON_GI3.&'K,%PRZ~1F/I^[&YZD,M+$:W9)U;**"YYMV0SR97D9Y
M\G=L4J&|U#5~PB:Q;0,FLV82`FXKI@MO,*".\532V"Z9`$4ZB?SUFFZ#B`Y]
M.K#'A'Z[C:m9W@AH~W&I/+R,KFCK#;)IH2.F!ODS+U]Q.]8MGMm$A#2/$WJ#
M.)|X3HmY+A1_$E/#.7,(XUMO:])%EHYRN^XZ.]R@'?(@|.7mSL,UBUJE89I%
MNKLC[_|0m\HDN|%$9|.E$X;&W';3O2(E9;;ZE_/T$R\2$9$^KUM`+#)MKP?,
MHW"4M$Z7"4YAQI|VW5W3|70;+&UX[L!2YPIO+HEHA;6Xm6J%S[.;6Z+=C8`(
M\9@XJ6DVJ!N:I&WH.=4%=Z.2"@;%32,|C^C)H,'':Q\|7]V\;/B?\9J#0(.2
M/7V=S7'CT/FF#7|;TmF,K^A@3I/^IX0$#IU.T'#|3F!4:$:)((]B?U[ISB?^
MN@B(QTMXX^(`Y7Q&:~*H%]'LmC0_4FD^/SFQ%G&JU]%D/BX2.CA!J5:T;GXQ
MDPR)2BB\C@~7"QT=\m/TOJ,;$:C_~(Q_J~MC$J~82mM[OFEO_OQVTLN(!L^R
M/"="PQNS+RM)|TN"5`TM#`8)+R?M(2PG]U%^KQ.YD~D|QF,Y]ZYSm#.88II9
M&D248TM3#3CBm`_))W?(\T#VUR7Q63$W(X?F)N[/F8V0&1~:.:$5_"FF6HFY
MN~)S2VV"2U5Z(^L:X?*@||7VCK+=DK9PIGJWJ#"9T:+AH`74R00'0FX&82S!
M^X"ABF~S;m:D2E*PQ;]~QGQ8:)FQX2+_2@B61\NT=TSG*@^)+.&FI%$.4#B3
M@P|J2)75J#$F^E&`)IF;*^0BN(RYIG@&2OI"NLE]Cm/(+m@PIBN?I)H1$XR@
M!RZ)MO.4YAG2\`%Q5QEVTW5"6P,7'UW`H=GV?*%@QQ;*U8Y2~K)RQ/FUJ\Q~
M6;AR|=IGM^@D,5S,m(+Z]*X2,&#H3BLX*9]BV=XQ[T):JmLP)V9H7")7X.VC
M|9ZQX!,F!9mmL&4%GRWFU*B;PB1H5P;RB#8FLXC7V!A=4mX[&C\ULPA&,;%(
MLJW`&(|_$]MYG6)J|S"V0Z8_Z#[+)$QVY|JB~C_%\10|GV,I];X6=HMFAK8&
M[?2(YJKFYJTNUX&^#^*[PD2D$#S[[E:U]ZCLW1Im:#\69@U=0AU"47'?8$,$
MP0EO=.%O9)='3J;*5~1~1P[I,]4.*H/SSQ(/&`65BOEL*36EB8ORVV:1m7F[
MEBE]P]Y#|O=#V,\@41|S8B'GS+S@Q#.;LW)_"2=(TPS~6[=6^9JC0?Z`9~~I
ML8mLH*~QO,%WK1QM0_XSK%P4"'DTV]C*.B)+ZX]:(Ym8PZKANJ=VG^6V/;HD
M^MAX?%A$/*7m$./0$JD;7|I!=~)YB6YC1]m48Z_%Q)!0Z]~7=/!DmV`E:*PT
M^X;MSC=49OK/%0:F0D/RJ;\G\]E,~|()S~]TWJm~+DTZR2+I()Hm|CYC9N'=
MNLL\2D^P'^@JI5:*\*=W/[_DB7OS_`~|L~F|Q(mG0Q`O7&Q!3MQ6_Y)/^*G0
M|%#'(9@)EA'R$CLQB~m"V&PC;/mN;06G(C+)#/1)AHESYK7QE;4NH:H(A:VT
M&[3[,GH7__ENP5U$7P/IHRI.:+/m~DG!5[*G0^$BWN6Z/m&MX*?LFH@D\00)
M,3]9#"5(48QCN2AT5_/~'V?9)]GH]^WD=Y?^A~8K/XCF7\7,JQG^)Q(U5~`?
M2%KT\1PRC.BKFE9?%5M64/@NOFUXY~B:_O42~QN/2XJO/E^7?+!NL~LCVO[$
M",QQ'/NS:(A*\TMP$]#L33&7@5'O8DV8*5895_5%|OGFAF=B/40_,:*;D8JD
M_~8U1GE^?G)R||$_T||?7C[[\8R^#N)A1`0_URG3KX;]R/GH"TMB~]30G83S
ME&9:m(WDLJ#;%,J)UAJE,'T*B`?G+PTEXFZWE|XQ7;J9L@VX.P:T;?M%1Am=
M(YF"]0#$36I3|I5`)6MD:[O4T(*!FNm:1[%A,LN+~LmT|FE4S`YBJPDE__'5
M+_SU(*"Q_$+'(^S^m~OQ.(VZ@29~[KXCWF*HYGA!(Y$M1!=@^"UM4BI+#m,,
M%VZ6DS1C%+Q_F].EMKCK%L4PFB3N^2RZ%MWJT:mF\UB4/O99mQE.!\.@NT4G
M,!EBA#,F%m#UT%FSQY3NSZA_J:KA'%2"U0'V:;~[*Y6P0'*=0.N`O4250U73
MOSQ`"?LM;*(.,!!F$EKTFZMDAA~+3^:EXE.I7#A/04RZ'V1UE1JT^/5XG,~K
M(U\=^)Q.(Q]H6S&~VQ[07m@2_|OL$^0`J_C4]3JPI8M9Nm.%@m:+9M4N'|SJ
MY.m.N'mTW`QWPJmR$^%G5W,S|[\10]8:_1U5COZ~3,/FH+_\&[T)`]Cm,&QR
MR\m$6\~=Y.U!:\KA+|CG`^6_9/A!&~'|:'BTm,&"9TRV51"|#O5DT00P_VQ4
MUXT0;"O$0OI)Z+^P~mCUOAZEGTT3$~`#WL4#.9=1B)F3:]S8&82[*VD5S):4
M8S4@SM^)&M`LIB!:\6Q()UMZ1&7^m@?K='YNADX$:A8SI4"m=!*[24I;YPZ=
M;YI"+~K.(MP&)~X1^9^LF'Q`~()G/`O0N\0TU(85N**QFWZP&\1@LHX/W`|8
M/AYU"(,9LW6\@S=1MV~N3J'__2P=)J/Y3#@"G=8!~%BJDS=@4=R9YEM2~D$|
MT!#,CRXK2^14W.E,58|A/]m]*,JXO&ZN!H_!"D1]RRIR7BI58?MMA\L=P'$N
M%6BFBU;PVE=@7%HQZBI+!F!#F`QG,#@EP]O0TL,P8LZE3S|D&+!&L&'4+0QC
MO+!;3Z~~97S4m9W/IEEN26]K_2)W\WG/:,!_U@;8?N:=L41D$'Y+[P[+S?+J
MmGRAN)~DT2R)15L0@)&7Y[[`5Om9mKI~B&GLE98/UYmR[SH/X7P:\,Q|@TmL
MA2~EC~*IHQM6L8&[.4EY?VEO2`[L$],0I3&D0+WYH;,4TH+IPY6(P\]L.D^D
MT`2Y\?C4@3D%WZBZ.[ZZ0#D38CO+$U?D\7CH|^YBFF%&2442O^.HG0HPVX,]
M82LR%S~+m+2#F85CGLN^#1'_D]JHELY~*`99HTRFJ^M2&8]8=8+N/$|0`6FM
M`MG\Y^='1TO[[OB8:`SV`XUGUHP&?X73`F;;Z9."TFOT/+|OV7F[9Y5*;_,B
MV=?3^%J6#5I`"#UE~F&[(*:\.!X$5]%X'Dm5RA1"~&+_%;/#V0KL1"9B20RC
MQWH+7;2!49$[)HC5X2%,5+mD,*![2O0W:YJA/K\B@AJ(2C]U&CBKR(SEXA%5
M#/0PQ"BFQ,_E88TMM$8/D|T"mU2\|1L7,H_QH.YIN/31$G^VDX|?/PIO35?,
ME*8\'NSLNmX,QZQ,J26MNm6@+7#0H=GW.#BZ7F@6SL_I|9Wm=E05"08Q6\IX
M0Z9]8Z5E/74$Y6PTN(J(%(Q4P*`IT#E3LQ)Z8_KK!L=J(2,)~B_P/AKBA#G%
M56[D33Y)K"7R.A1J+XV)9)Z+=$^,)FP)$$94.L3=*[H|V=VBK5`UHZ_)5E9)
M[25%%ABJ^)Q(5CP.WPQC5JOOY`%HZW2ZR:X^X5];0B)A$8M;:5R(.3ZRZP:A
M,S6;A6[C//SY^~]I2\3]3_E|E"N17F5TVXRP_(60]F`2XU&23\RR3*)1TN?Q
M#Y.;6(18M2IA9+/84ON8Y34V[@4JP=&F89,M%1S$8J1Dm9$,TNEQDSR?QT90
M8E$"E@*1K9.\)#:J&$/T!]L9$M^\R$#9I).U65Q7/PVV@P~B=YI.8QA$^|)D
M;213.9D@N1"m;E8&35~)mLOVANO,WVGR5I86LVRLHI35U((NDN0&=0+N9NPm
M(SP%:P_Z._0/;_$]0N.!6"C'T&@HQ8"=QJW@6|HD$6+B6/@G3)R=(E:%"F'2
M*:;=.;[25=.E,C9!m|3E]FI."MX\Y26F32\F]Q(Q8_U/PM9A;U%Dmm#FT!&|
MIS1|P[/1R*3U0G~)ZOS9J")[.N03|D7BQ4#W@|K?/]N?99~R?4\V,PN~Z@T0
MWR1$=W!\V5:09FD3ZN!;(C_5VL_/_N?%FS|?_O3B[=GIZU?UBPLZP]UQ3K=N
M|6|4)1WT@^2CH]WCXT[@+I;CX^!I4/K~";;8*6'IONm9|MN$R("2H9C*OZ$;
MF_DP)?~@!LOO8SW6L6[4^(EHPX3#^#5B)P?J&%5LU`K8T0'm]`%TV'TP5R'S
M;|DPC?\6UE;FH%&GEW&$V$#mCD6m4%2UJB9*=WAKX,A`'[V%+:CZ@H3V%+VN
MNI"97)F\EX2@\.A+R@|ESSFZFJ0^\|D#:!#9@A'V/WBFX`^3P~\#(MC)$m/_
MW%RRF.7S\Z6)NKB0V~#3JZHV=A`RRA"?FP+'"`Y*mQX=/AHIV&[FQ(*MIBFZ
MU$BPZ0==)NJE.+*Y33#TUM0JOJBKIJ30H4VEmC9((YW%=D#$H:7YW%U[m*5?
MZNGJ[V"^,(.LYX=E9C:)!XGE#8/6V0OX[CQ[^Y|#*C6)9I]PAQ"7m;W,Z`[+
MPR;O)C%5$$?5)^(;S6Z#UIN?7K_ZRP%SH_[.M$(6\^WL4,2?@H`*'(35VLO3
M[S_\|/KRQ5F=OKSX\XL3_19`(8D"SU^[1Z@9SWX^/7,/5P?)TRW'~?V)PM'^
M\|6K%V^?O7OQ/$1%!V'X_'7XZO6[\,7STW?AZ[?AVQ?/GH?O?CH]X]_I!:OO
M96L9K25m7.'IW]!T+:_+12"W!S,$UW0/6R&R016mD]R*T5"%&R\WS&RB9C)U
M^V+;?FXD!E%1\U%L43U?[1KZ=`TY+&X*4,,S/K\YIN9?4JVALLM\~V|SE=.=
MXBA;\,WD$Q&BL#G%mGAQ]N[YZ=MZM?;]Z:L/^!1\@PmU`SI3VCF'D%BZ0~C^
MS"9A|[BVCG:U~Gm8+MR?|H/5F[4OE`I##Q%\|W1TJGM|'1V3L1QKWN@'*'#"
MF]^9VDV1;Z1G=I+NY/@V|$H;/&,D~]LS|R"'R%4H5VVILMDP;`G!0[&W\22[
M|@=C^8ZS$EQ'MS|m0KB6*1'[Y(;5$].I6!8CML|N:4P"G:&#E1J|QIEU!:H$
M"'0~#SKM~3YK,YEJ8ZG+_1(1\9Z]@EN.5_N@8RGJ\CU;JFV9.+C]$G;"HZ,7
M5E_!*V~)$O_X,NGmN/?XR9(C_DF.3|B6X^|EX]4/9A|X6L5OO&%AR?[*XUZ[
M?SKR6ZE\)^CBZ;ME$5WmS]`Nm#PCF[DF?5,^+2:4`W!4Y+X'J.10B(IXSK+1
MB#D%Y5ZLJ7G%)|!*P|);PH&)&7%F`U:8=L,;4BF(XK!(DMAV'=W"?AF22m?_
M)`R?T=\9OROP):QD9=T'7X+&$2[L$|GY!&ILU?"P3\&J/X;AD|3]9.`FBSN6
M@CGU=62#N5RO|)[(C43OF5.(C82@+DTJHPHY5N09D75HM\]G~:*GC7G|ODH`
MPE4'U"BD(.OJ458;L,T#YJ(B9BXX_Y20m#mH;3ROV`1L2]&J5/]J/3m+C/P6
M:QH.S$AU##2mQ2SIJZJ%FU\6472A??F$*H/?[@ICJTS'UO~_G+Y\_N'5ZU]?
M?'_0,?~(;.8O|W~=P'M]Z~T'\%(=:XT"F^!51;=%R1K0?%M]NE0BW#]N#^*K
M=CH?PV0QFM%"m*_"G??5ZD[H?@J^~;KUE55UPRV\A2LC3J_"9A(*GUX/FRG1
M_V;H"OOMm+_8S'%8?2ISLT+I.T'Y;@F~/B69/]m_PK~Q84G*"C_LY0m3Jm3^
M4Mm=+WZ&~O"CU&8VGD?)0NNPP?:S7D(4AB\4=K?MPSDQRO,8|3#,M(N'+\BA
MJ\@Q6/G##X1O#Z6?GZ6BM6";IBI$L.4;;A_O~JJR&4_H0!WLF'#]KYXB/3_5
M&I&L03^:#|)=.@CUAY^C~RHH*?ECQ"Bm0F4`B=_X0149~6Q4!E'J7("M'F@R
MSPO1*|Z(Z@W\ZP9:*=9M!)&],_HT^[/8LTN@%?6M,@Y:ZVBO53|$MA#T#JIY
M8JMGJNJWB"=6W2AFCC!FLXDUFG2W\9_;DV)]_OmBT8"C"[UD'F`@:NHIO(T5
M!6XOAIGWF_6+,BW19"_,+L(%!X.EN!@$71C:/JLE[KmI49[2:Y]UDEA1ZJ;/
MW.O!NVS:'m,=9FQDZA3"ZFQ8~&BWB?B19L8F(=6HQ@7K$,B"TH;)B;VTP0.%
MK5J77NR:HHP1'9@P=H'M&)MV2H[B(J;PH\QMHG)m]`mS'OF.5AB6*Q07%ZQ=
M|=DP81`RZT27~0L1)?@A2:T%RILII[UP"WU^'H.B7UP8GUE:&'TUF+*O7.H7
MSN/!Q07mUW,YZKPIQ]ET2ALLM[.E[XFW",\T537+V;/(]%8\;?OL^"_.FOUL
M##|^.(ImH[YN|#DYH'K~Z?$4]"RJPRPZG*=":JR7A"C]|J8'*BC"171\:[Q~
M`B&B8B?Y"O6%TI`/SU^\.0,A$0|;GD:Z%1'&:"?L\_NN;N?6;A|['W=FM:9W
M1~DN]&4M^P|=;|;A3MXN5=MN'^9M4W.W1G77J~9V=Z^]0Q5]\XUY75X]/S_@
M&3VXNmCMUK91~I=*HXZ#=MC~8=KWS"J'_0W'IX?W;|.Y,!JSF5KMY9BI:8;?
M#|#(R0&KG9_+9/WRYLV+MQ|7==EF_CL||25MPI83V%=~TM]XA3:":L;UI?'J
M6VS(ZMFHJ'C`H0~&02[1'K;GY6PCS#/+(JI#%2XILmK60BS'47I=J@;;DJ,:
M$H_/M*8IUL?"P0VV%V)~B;\.RC\:=7PDBMPL+54OEGCCCVN,;PB;`3/^=;L5
MVK)BSN=8(I^N,S@/|C`5,4/[#1=A"0=P/mL+N&R']BH*0S,35O|:\BT/J_OU
M!OT_|%6+7EMC$*B,J=VK6T*G8mV@RHL/4M:T$%+E~U!U)4/SY`F~4),0DD+[
MAGN0%PTN4J=^~'L,)W+E%7=@76G~7A^^?W;V8NTK=MS[;MBE~I:J+=~+*B&K
MP|mI:$NZ)O&V#m5P(=4A/1LVUM.!#7]6ZP`KT^!_&DP)OF%B4*WQMJ'?~1_S
M[\ZYLX[.$PEXQ7$EA=Z$K$~~1;2N.212,~mD4[;C9@7)K^;6S$0N$Q]$O(U9
M"VC]U2=K^=;5Y_[5"_6YLDW66Q7D7OP\Q$1)[3348_]2MA,M&+S?',,LE=&Y
MEFF7|V"[!,N_?[:CO`ES\#P=SL=4=LP^X1[IP_7&P1|I&Z3]BQ3.NVI44Y%|
MQC2?VM$FYN;.+9G1"BQ=m1|V"~1HB.F8N5,+YX$JG~~+G_AI"+_.(9%/Z3PE
M\F+7+2#&NOBmm]I/IS_^].+L'6]~mGTT04%+N]=N~VQXW7^EE^NmAMENIZIF
M6.)UZS[AD)/%`V+*L_4$:S;m|O%TL%1J:]_X'7,|E#S;"_C;!ZFD8\Z#FFTL
MP0)QV~|#:[X]J=?YQO7IS7Z#R9I0`J_~!M?CB$ZIG'GRI%X:%0LY\S3YVSS6
M$8J?%=%#6!B$X+m1F8V]_3Z[???C`._8@~PUI(]|BOLHm));1LG&TCJ5"BYW
M|:^N?~1=O;S5Q_&P"*:SF)[+3+I&PA(I0Z~^|01H=;8|N6mZ7"]3/^H#.L?]
MF,%X.^3]K1?CW^8DX^$['7YT@G~\G0WY=[^QM,S~!;*TX&NX*NVQM+$Z1:LK
MS;5\XRJXI4+A+~V`T'0GO#6K+UXBY;FUIW,FEN$TXPB$@&FLW;*E3MG]INO!
M:[|T&"V!6M:7YDF6B7_]]KEW+^HKY4m;AZE4+*5OWK[^OUZ|O/OPZMG/+V`G
M];\SNTM"|A'BAFF4=MQRC76U7FY4K9^)![@QVXD~I*09A|E[mF%7%XW(9KDA
MV/+[U%EJP5I4IC,,]2#X1K0V;Z0&*,!*0S2_/Z~Y.RC?\~8GH';0ACA8&:0I
M\`N1Y9G[63:^^?$EB7?~CW(,S(^O(1JZ'WFI^#8^R]AGRJJC(G6MLWYM4$1X
M"B!Q+,U2Q+2D$M="(LXLY@M|)%#A8J=0*RGO[CO$ZGV^SF~5*O("ZU/%3H"F
MV+M/G9I8Om'E(F,=0,12NBC4J"Z[5%^MO=3MLS)?ZY28[_\YQ~7RZ_^LAO*]
M:"7=4&!^.5@Q;:]5Q_IC_~VC6C8$?;ER3T'[+U'2EII:F@[~`0=EZ]3_[FR4
M#6/|Vm($?($9_W?,)mY[X%S2;'YOM)#B~RB$P:@~_?,H+B"^C.Q%Q`F;#&U3
MGL\GH@V*8(;W?=N)(,/)@6mUB"#D2A$&$F*+~#_1,(OZ|/V+""`PKA(EQ_G2
M#2I:XN#\'`;PBPN$/HSB|J`T7&'76@NI^));,;42J":!48m4U=IS9*ADUD+m
M)5LC?#Q%[\2JAR%KJ\7`RZIZ[AS5@1GP5\'YRUm_O0`S$[9$_0M|8T(5O29M
MC!;JC4*ZA`OK0\3V0IUNUTSO5AWYLL("!90"('1B1(M19$NM%Z76K~^FA/RH
M]3m2]Q5,F\Q$T5IKL&9C[[L7/[]9L?B6!AH$UOMD|^EBR4J\IAZU!Z]]R_ZV
MRC"4'&B,.XWK1WWUVO%.IB'RQO*TQA7!V)[*CCI~Z15/B*4WO+[0HW5SM6+'
M\")'?E!$"H3P%"Y&6\X&"|%\@GD:(PXOXENX%m&`X%,;!$K'.BC%`0&[Bm@%
M3V^+_5|H80#(4WH5IPGDG$:IWL"X0;!0U#`P.!+1;:"63/0EG4G9UJEGAE";
M?3E.mE4_~G5Gm8/S#"GE\FJ=MS[L\)TW'H%FB!D1KIX$CZ)GU/DYP@1Z|7$=
MQRE#2,':\BD/_$`3.X&BOC=EF/M=mN2QBAP*]`E#TTB7Vm6:(^8YN)5~AGU)
M$1]8KRZ3T=JTL4L|;S.?]362S)F#SU[_\O:$N~$M)~A0LU.IX!MLAO[?A\N,
MLU?m2BWK_5;\,AVK!I=;L'SJ])MA#\4*9X_\O6=K4Q_QZL9]3S1;7mG]\)L|
M&X,6N9^S.QH#FLP!~&$\ZY9P#^1251@3S^'2BV1MBV:'G4E5ORPBCMB(S\^?
M,B/^DX1(Z"'.57"TE0X.G39^$#.ZE^#^&!7RT:mFM]$\7I34UD?Z3.Y3C8`5
MS^JUNX8'"_')\R~3)5m7,DC%+,14JW|WBXm#?03O)'J3JV9YX/R\6KV!]775
M24R$H,H[)J(##~`\Jm`/U_VP.5[9#DS$L6#|!+R[I+8CG]G*$5O0_+27&E_'
M];WI!,6X\Y$X'O9J^QQRBQ\QBAX]%U:R3ZRD;S]A^TWUADM=4BDVT*1L:&F_
MY[#::K5]=Q"%T\/TD)[(@T~]Z'"!^,_EAOK+53P].FK!`YOK0`U/S]\_O6CW
M\(DJPK_E[K0?30^E]I)Z8+E#O;#4G=YJ=T+T1U8C?(FY(M)0+|8'%~\Y/~D;
MS*]JM58KQLW~N'DY;O;'=~#W]/'X|AQ~\O;%E]Y8/)$JAUB+'Q+VAF\XMZI(
M~`~X/8#Gm!%!N7BS6TQ`WYFZ%9P8[W~K'05|DH3\.)L28PEIB(7Z62E"SL!:
MT@+!'F,KXA4@'m0JQ"J@+"M,K1%#.Z"8H)/@1)!HG|37*C4;G;~QV.A[ZC~A
M^#&X!:'JHWO!1%`9)?HR#0C0@@^IDK!#N@=KZ,^+(%\R(H7Q#?.`B=(|3GQP
MP5JA57*S^;4R$3209@;&BV_N&772!*G`_3JG)QSSP6`(\m":3Q,::P\3m$][
MT3CBN88?OE?~M.SBI&PP@_m\X?V!F(R='&%6(R#|B7OO6DIEO*S%2X[_!MT"
MN7K[^O4[OE;TLOG,mM6=O$TGC4V@3X^/Z=\=0S8^LX%1(OO#FQ6?63D(;VEK
MX'C|5,I.LAXW6,&OKEDGT/EO*`W$6@\WTm=QFG7VPA%57'1NEUQRI:~G/YQU
MI+OmV9H~TQ]`_X72(40'K^A$*S07E=T*S42E4U]OB2Y@:*`JN".5\/mGG8EJ
M=8B)(m;OB@^|V|BRF9XNS8_](^/9\",JZU#m=S3VA4[SNJ)//SmQW*T;F_=2
M)[_]MMQ)K8^#1+_4M~6III7/H_[*0ZP.""']^]U~O;[T.TO=1]Q^12['!R]X
M7@PZC_]%RVV5UQ4_N+QBYPUM81#TKPPBOH)`/*A6\|L.5N)F:S?|#1~5':+F
M\KA:I8X~VAJFG;U#[~!YB!)T=XX+_C0(+\SPN"=:.U?|&^QPX6Z%*NYT|5_P
M]Tm;.AE2A7X72!KD%RNHM@#)|QX/~CJMRZD;+=X(^:;OC=O|=UJ1'DWC)]?4
M,'&?,2*9DZE96/R`]3N4+Q47)^ZFDGLK@V[&?PL?K_31VY#S%/&!'m$5:T7|
M0~F;O``,B_LF;K`T|8/[)N[1%V~.^[5^TBHEQQ)L)M%_T"GGmK;#A=]]m[7^
MSBS/LmUU36^&J|B_Y^B%I~U)ZS,J9'WLR?N*&5Z~,UI+GHTm|^?~63=J[:Y'
M(9YZ~+O?JVR\\+1[K#8R,C,P#&9Q4=PJP%;#8&|84XJ+!m~P6Z#|"4+1(&1&
M;&AU50S`X:$4"&R0~'*=~#_D`BS+6J'`A6!%CGDK/)6:VmN)ISHQ,F[A((&"
M$\"2~6WR&P@U!^,H#!=P\US;XND(W:2H]#@:&?/&~&\0K813;"@@JE5\JA'"
M1V%0+2CUW+K?]!~!^`BISN&91G;`0*|1#T;VAmE:?I(6I6N0S]7"$HACC&N1
M.!A1*GC306RB0Lm)mS$!"&B^!"!5[?S\Y,.;UV?O2*X]~7%VAF!R?P$=[mUP
M/FmE`BmEJ$.]C|=F+DV=%4J`LV#GN*'$NIG",U0|1VU(M7&O"\%*mTP8EXV7
M%:UG8#W[%(~%GC(#*4A?\!PU%(_!%=E4CF)3&@VQUXQNETQC]@,6]ROX\7'=
MV+ZR%QO&;=@'#&%TBBBGF4XY_M|"ABA`@X5Z|mY^I=@6Z$A./B#Z!;SBV|G;
MTS?O].NRNM`H,[Q"G:,CZ5RX%#!S8GX^6?Y%](@G&JQCG`@W|ZPD(~ZTNZT^
M|:MWR\SKE*2Y~B!U|5M60:K6RA?/GK]X^S7m7&YN1BOC=GYB5$L9Z6MIOEJ;
M1H68B+=;)`]NMS)8RJ5S=:/M=,I8HU'5`F:VO;I=&6W:%BKKAE#NWH7SG~+5
M]MQ\R~=G2QRD~QREG%M\MX%1#0:_G+WX\/+TU8N#3O/E9NVQW[K5%:_1$B_9
M;JI/@V_ZE[1=P^]NV":V%99._!H+1MC+J.W9%&'PWmN5.5K??K5F1E)?VQ=U
M$2@UWZ@^E4XNK]6_HXDMAL``91XQW6$ZVR2ZU.HWCXF*2J"W|558#~K~/L"V
M,W'3M/GD^S~T`_ED"SR=Qm2^~_OL@_G~[`.""[T]"J22S+QDGB,H][DI_K*%
MKZ]/GKVDH7[O56B*R"Y95E|QF5G:Z?=K_G=;Y\1F1!|/4'SZ4|)|~AUmLN:/
MDPW/5P_5B57mE@_@68DWLmBEOH+U?Jm7H*9`L0;$mQ'C@T(7))@4DPAPE''3
MU8*MOM["I*KE$DW6H:RES%+~H\]2N%QJPX2LM+5*:SRJL%KZGZ`m#S,6K~F@
M~:B77&EH]V^3m1/CQ5LN,T:,S%S*%&.5WZ+B257/UF)[H\20`J8";,/%1?@S
MT.(5"$E57R9`(%(~=2R&%\:U47UXD/78.\A$QKS*'/(6`@K`7PV\7C+/K`P4
MAPK`V369TmXZ'|1&19E8_9URM\R.N$I*89_J[R[L'^+8@SB:C8'T;%U09:3,
M,C/W[,&DJG^JU3$F|m9FSYU`/7?4AU1\8UW+Y8DWK[m7EN4T#6m;1/V%S=T"
M7:1m.|m,ZK7HW,"/C3FHHI"H3497MW[UHD%?B:QJ/33\ZMVSDY.?GW~H+_?|
MSK^R5&+@H#F6*$N;!O|6#HPV9JP&%K5/7.V\2,9Y_7\U%DW&|M#Qm/A[CWX\
MO#RL5J|[_@E[@`.NNTNL2_HF7LT0!PD:,5P;|VOF.'7/Z3^."W%'"DQ|=Z\]
MW;'1)M6:C(#8,M|\6E[NS':G.=[V"GVP;.MJ2=J1VZUHV0+HT|,31P27*N27
M!.DV*10*GE8G303"!mN613W?+0XNW)'@`I7`]A09)V%[JE)87]5M\?^H,GB1
M(^U$:C7?HXQN,`m=%;C8$#5EJP78\\U3LR')*CT)T8R*m3AE%GES@QY[2X"]
M%'B09C(@SK17K~W56Q'F:Y_VMV(C5.DRV/H&AMD9/M/_W^.WB.3?GOP("C$,
MMH(MY[X[;JRL&#Q~6~VA?)EMNE$=P^547);,9O0NJQU'NJMCM\MVEG~IYP=E
M`@TLZ?mH!+68BVNmN^UM["`Q`K,L#PT(6VGVV+W$V(^_ZY0J#$K?/.|R`3OP
M@3*6I\73"S%5'8;;``'H5:LWM!9&;^,K_+WY@'W13$AE]=@R2&RZ$])_A^4V
MZ'&WL`M,959^+TI+OK:$VP3F9]:&L8_8*B@,S]m#V(J5mUXC1\E\QHB.X821
M6DHV=68"#11VXHm@.&_//!ZS0B"P%UG)KTOLU"40S;!VR9*AA_G][,UIV?6C
MKAB1#)R6LV^[J*#"X9R1EF::*8]WDH=C`?JT3)2$MSLM9]+P,X`Y)$\V0%C%
MG(:D*;A#.@B\W`6OG4^6m7^I0@0\KGB!L%D2NCV'C1!S])0$m8(_D9GA*D7#
M8AW3:#],J!_C6[US4J1KPON21N6,F~U@N;.,%^5E/|M58^+@,^ZWP/$,X*\F
MT$O,!]"N=R_.'"]JOWPX^^7mF]=OWW$PB2MR$)8@D`*NZ|!5_,U37mGm^##T
M3"GN=3Z\K)Z=S24,&EK:P[#5IG\/+3ZmYQOUCFK.5W!@C'!A:R9)`267A0G^
MW9,EmI8IRR=|3*4H6\2?%5M&#\#F9KTWM/G[WO&ZL:DIKUL\)ZM#ZI@5.RDO
MZSJY:mV46!&C/`U+C]~m8JEENX?6],#]5N[)AGK7m;W:LW5|S7W]N8_C62VR
MKB9[.I9DNHW#_6?43SS&U;/1~:#PN7K093#$&VZW^NM/OV~\63L!^NZR|Zm9
M(E:S+(R\`R=7.&^`G_#$'67P19VL?HQES0,[4$B(N98T,1~2QP+Q20GQ2HJ,
M:B1(X_!H^3UHL^/9^#88.OQ`"##L49(*~6|$/D`&BI4$+ZC"WJ"X&M^5`&]H
MO+R`^ZAS"U)5"`:540X"mHA%IYXZ=7.+#%Q`=mM#Z"EFV1Q,K(;E*^"'P=J1
M#)|X%,(GI]GU@^4[%58ZN@3W"'F,2R*EKm1E4E*X?`\^6@";6^R^EAH|P+QD
M0F#.08T`&HK"!O$|!E$!!TYLHJ/_9~02F9G\$MK&BM6VB\\726|P,D+KSO^*
MNCVDC[O@PDNF5_EC_mSF%1|XL&[Z3R595$.VMW5%!6*OM0PUU!/(;"F#G\!#
MAMX.ODWB;&0EJ"1?#A_Z064J5B)X9T41XZW&A54(."%`G=!PV=QPB!K.CW5#
M!FMBB'YY=?IGXW||]&ZmW="R/)+#2Q'_PW@R'WLXX8B^M^`U?(H#V1WK,%#1
M)Z#SE;(`\&Y]!#2V=GY)G_"CP=H4JYJDR83W\T21IFF;[~1..G!&*0Y8'KID
M2+P|~|`2V`[X0TF?T+P!+:U4'U?HKZ~5G8#M^8\/C=:mUV46][m1BK2$9A\V
MQ:]TZIQ&6|Rm~B&R%\*4V"Q@/P0SZF57P7/!9C`H#GK..4)LUX:&S~*)@&@A
M&HQ~+(S&RYU1AS+#3#~O]+.W/_Y)m40K$SNY#:O2DTZXLTO2"G+~5='C#H8;
ML,V^5MU"'23!/(933Q5?SA]?A)U_A.WWS=9NNQ[~\0S5EGYZJ[^$KA%3XK#T
M^!]AWJ;2;3Q=P.MBM:ZBUMJMN_JDB]4]?@mJF,N$QOL4[QP&BW(XO8O/8[\=
MFNXCJ#?Y!,Y!FB!X2R$F|6;*Z@PT/(NN?3=$B\%OT),9DJ/(9G*P(M#WR_!3
M?"MH&FZ9mRY`K4K7)HHUPFUIJ'ZH$W]T;*~6Z13F`)2JZB9"WW63H=m'Y6OA
MYVI]7|E*I331Y@?:NY5*~|7R._/K(FQ1$Q]DOA=Z$%*72!?CM\F%U+"@"$.W
M^HmU`!6L~A=_[R4VJ+G$(R..=M2|S)`J%2%'9223UIH$5)_6H26D$H#_)1]'
M+\](+G[F#&\#IPV!+PF\U]5:[Q)|]2\C[MFLA,TO|~/6=WOSL0+KT7%S*3mI
M5M|K0EN\]L~#]Y^[:;WV^?Q]m[W8Q=]/+^KT&`M/_YR_/Z;GGX_EWSKO!+.\
MW."5W]3^XE"?7^=V|W`9'+9N6I73QK_RD[mVV!XM%6I7OZ4"YK'7V[Q=~_\9
MWG_U&O=N?=^J~U17NW0~)5(*;&V|]Z.IGDN2=R5NK73'Y9S446`7\GI@7A#N
MY^C(YKR"L8+]1/*L8~!@0!^$$#/0K=6?mP).XD#MCX@'F[*243|$1[^;'6")
MMB)%N#V'G_+UR[XT14\QmY]Y)KI[F,3E*:SQ@G~+75I$4+0%S5BW:(^8E*('
M\)&JK[AN6R1K9[!`8)A1SVMJN;4]Y/)N*0^50;'19|M97P9S#4IT'BATMHNL
MN)W&UE]E(O!1`P%F)PK("B+IJE|:,^D9)$N1YL+U][GTINP#20JE$=WPS20G
MEF&`W`mM~:6m'`1&#F"2CK:M]XS+W#QR~(`:\`J`=ES_#,NN#*B5)(SF"UQ5
M2ZY^6\0/7~J/HV22FXA%6Z'Q'+#[IW|;T,_GK5;K`KP7"R&211.~.;m$B!0K
MV8EKHL~3V#"#GH`3@(LY\*P:1B(Q"EKGR2W\@,*KJFN7J)J\2$4&+)4,PY)+
M(XVO)5Q#[C9%/|F0"Y!!_N6,\=47&/0XX"5R).m5$@D3A1U1%S\U88!mKI9J
MC28`TR,BP]"X&YD~*N=(%'~6?8H%J=2F\Q7=92_N1W.DmLO8EVM$.[`1;.PV
M9V%I&)]W9K8Y!5:NJ[FCG"1L%M`R\@6T`MRF`#|BH(T38X5@5TNA##8[m4!5
M|X.?(FU8=M@B[*C`A!~U~+C?~DS;3/,LNmP#R+)`PQFm.',J2YC7ZDN7T6,F
MIW:/2^2;C*&L)K#)M|'?\PE/"N$QY12U+IF.2K,!D'(&SNm%(T6\63$"?:Dm
MLmT1LG$S*QM(@D35`!CL2BRUS4/#1/\:/6%^3')`L+F7'HTR(/JmXT*D$H$X
M:/FJ;P?L@0V|JY`U3B3/LY`~EQ\CR0.H5HE;85]`$9E4_=#PC+F2|2A3^/X2
MQ0N$NMG,/F*QFO"I0LZ(040T@|N60V%,SABJ07P23VP.CDP3+AO9[=9OT::=
M$.92=.^&]T'?2~9BKT6m0H'G7XFT.HSW|#XUUYOQ#,QW@HP6E$/6(^S|2YH|
M`"?F=K64)2YMD=|VOPMF"H(*$OW|2EGK!:JIH/DS2ZOX!KJ79RKO:F".@:.D
MK|]WN#@U~)m@UH,%/5I'+L``)3*IF/20B_)\!C[=EGM(\\,:\XO!8BW80=?M
M%$'~$'E9AC\`&~;D~`9=W#/&DS0LZ)X^PK&FY++(H#3P=EN;^L!mL32V~E~1
M&)@05?0`\@SDDE6B68,#9@&I`7WAW.+=:?X,HHX]TRF|?)=~*1?]P1`8.!!&
M.:%+|A6SMB'AU#54F2G)AB1[)_+M%&F,F0R~6.|1;4@.A+28UU#R##7DF5/%
MBHT8+9=2m(OBZS2`.(WY,OT$J52T77$m^1HT_VIm'2)9$VO]ILPF#@+SZ2!|
MYV`5?,/6"];mLDFE^?~P8@MR_$Um[7YT%TI=8?,%E[G?S^U%9=DIGW6NI@O4
M8JM*?UJ7ON'6A0NP#SLT5XF&&(*=P[&JM0|[H7W9.KPK($|:[KQO=W~]$N%G
MYW[`#@G:)XmX~71TQMA/O/U/W`DY/M[QB_M1,0|V+(;.KA=RXB:P.N6H()R5
M))W'mN:`~RD_~XOUV?QPP+]XF!Q4APUCL)/!$4N+065I%KYQOOWT9W+E34'U
MJ3XW81XHH6KTIWXU0SH!IHYA$GI@3:L~D/XY_X#]V*GN89/M'6RW,FC16WX)
M&"!\G$*S:Y~\`E8J;52'C/"$'*OYO!|./]`=37~S$08A/LQ&C;!*S^HD_GU+
MWW(5"&NX`H?TV^23|`7T`||8Y9Y^,%)C@:1]].3GZ?3@``K^@P.4_L"/3~U2
M0_/X[N37YRQO~J7II'YPD"(??$B1FM0NW5O3$=2DUMB='8B/&R=)1\V@9\/U
M,VR!L%://)LURLNQ_+KZK^II]RTY1Z5R]\+/?`ZmQX(A%6|/IA;5HU)=5`M3
M"29!9J_J#BU[%5J'23/N!WJ\FN(M)#'|79J.NP8~+S;8:|MNTQTZP;5BV*FT
MB\FTS8~I|@A,2SK2U%2U6@PKX~/#$!'@Q_BV(2*0**QB^YZ'W~)B=^DR14AX
M12I;1S&%4$T[F]^V,5&E:"]^I;ME&(:*F9:**^^%4RG9K.3;1*NV*SO?=E/O
MW~I~:1(KVSL\^@WKM7EWJM\O2S:X(H4WH0O2(]!.~2)F,$DMI?Z:)!S!V|.R
M~DZ&GZI"F5TAET'3~[|~6":MX"V;Z#*1L11RVG\?3*C(B)!48D'=D[9#K^V&
M)'+3)*'#*!G#%=FX'(XA(Q$W,E,,2MMC@[J]9C`60MLDU!,7V6QJ/4GA_2H)
M%0&=,U.|[5+G$7F3WJ[KK_#I)@),L'0YUB(IYL8S)9_W^S'SLBOL"FT2SFFT
MX6+M!.T:XP[D[=KY^_K%;OV0'AP6P)IF7T)]"F7281$=+C:98T]8!;@H.|TT
M;+!3GSU,QQP]%+ILEP:57E)71VH=56$G@!1S&|TFX`R]=&;*RI/0!VAO42&Q
M&&~V/HLZ#!@;."=7m6=X_+W+IUA.8,J"=HXTTB+OL]HAL%F^1#KEm(?8+~OF
M_&3ALO6|A*|^++/IXU%~#!(ZV|?E1R0mKCRC~[/\;)Y2]P;+Y9!XL_RLCW&6
M'Y$PFW*K?D*P$S\96'LW$#2/M;F&=MM+;TK$3BD_D5?=^FD(UA`X96$XE)!3
MZLV,?N)#,CB_8#BH/ZG"XHS'2A4=2F=6GG~"RM|F[NJF%0%@mm(U3/]+~L1+
M]Dm&W*m+?&XU`9(93N+,@5Z0@U9=QN/I@V0(|YGY5W'X72=L/O_P\MG;']G1
M43%T\.S/K]^\~&4P=?[P^/&:.VRIU`~J^|6KYR^~=_9*D:9OGO^P)F/3|MPI
M2K&RJJR!m!#0\8$|0(6,P!QU7T;OXC_?+6RN9mA'28@S.0?XIO3*HP53=#H8
M(L8)_I39+#@_OXGUJYYA~8V7W$~ATU2:_JUA|5@#^)+FOC&H9O,4A$PJ(!$B
M+20#RR&7*3L(75P$$Z(R)$ZRXJ(~"M`R$U*H)'R54,B93N/|Q\JT*!H#JP3Q
MXAXE034@/[m6^m9FW"Z%~;YX|]8(;I`(C~=MD"!A|,11mR9Y96'RJ?8\HZ"8
MA?6BY6,|B+_RH8^Y)XIm?;?4KDQm,@&9EG[FRmIN%9]|K^8K];7/EA,P('L~
M]!]4G:+H:Y4M`$9U$A4%\=L\U=*`M_AA#WC9Z|"FKX8"B)|=W8L'I=Q/1FUB
MF`J]B4OX3`R_7`0N.9MS,]!DYFQBIUWV\2/05&9)|;NS$^I^4,]PN?@#KT(_
MVYN![#892]~DU\Z)(6!LZ^*R$8CJ1~K,H8RPm;B9\=^0M,8Y?&WC(3PA6F'P
MmG)NIJ!833ZX''^E$\BIXTL]X=8YA6R!@04&'M!`\W"J5^YM9M9]QKL&;C&B
MZ;I*9EG*_3,F@L#;ZDA3K*I)Z'7Z&:U$PJ&6N%1M$D_1C^E|!ZK(L6ZH]?OS
M'0F1$M\|ZCKU\|`BS!N2`D61[JA6\/+9NQ=_1F"*^572P])K\KJ_'84!O"&&
M[4;M^]8'2;UH+:CE0;!E:P;FY_,_G5+7?O[SZ:LWO[P[Z[0.NM4J_?SS#^W!
M54)m3V[:ID\;1!P1\EZ=OCIYZ6)$0/(W@719+|R.S46RP^`@.^5D)&7UAJ\B
M\;$.#.(mV'(39?BE7'^0*+R@X/2ZL=VBL5H,:AY,_9X8.@.KGJL?&)UN&|F.
M9A(!(mN'H9T.+QXG;[\OY4FAUFVNE.D.@V2[VI$G4/Q7#)RF;:?A$MEQ_KS^
M!]JMG~I~&1M=E"7|&1],7(NSSB2@?9K?TU,F2D32IY~`G=LM9W~9~BA?RW7O
M4=V;M4(TWQ^H9=$'61CU7I3'[`%$;Vm)H)EP*V66:;^^K"7RUVU)4^0U)%#P
M?7%N&~6B,E*=4;6VN|*`1V=^'BS7X6E=O`$,Z]+9`?ZI.Z4+\C0KF"+L*7.~
M,K'FR;4XP4D=0;B2$!F&CP!(GP&(1?5@0JDFW`0JWMW`=3)NMW;%!m`TU,:K
MSDM'SF+#5FA0'EA#;TJ&GU)5\8\!PP`7/!:`@I|_GQ'=(':W+8UU5UIK]THJ
MB[SmG!:M9OO;=G+X3G0^`J838G^1`!=~=.LA%VOMLB"GI2Y=320!OEJJEW9A
MM]YmJ;SWRO1P!.@YA%GSWMEN@6Q](PK9:LT0OGK8Y$"&2,SW/~0*@&|?m$N^
MPF09:8N)EE;SX~V+YZ\__'SV8SVL[K;&V2@LJ[=\N!E1]PY1,!G|@)B!HB":
M'ZEK3XGQ_?,'H]_Z&Y4R~E4ADMU^(M1K!Q5$\QM47U(8NZ*]I`?#CRU)3=$C
M7"U2JQF*HCYYAUVWM*QP`VQ+?4='!G@HT9HG?!D.,40=m!1Y_N\|IE$JH'UK
M7H57O~S&O+"QY6N1SOS&D=WZUAA+m|OH=%[8'$3$H(:#60183)m'G$m+9Gm$
MJ'`%]H95YTP6Y\%_T*]$~DJ`AX]:NR]@56TWVN_'+:;)9B@\DI9O~W#Z1ED'
MJQ9W"G11=`Z3#=|G=2[I?T*F%INKG6mMK2Q`MR@X_E!B`H+R[COH5&@|M?SS
M55S7]P?$K||T]O.P=5$)@A].?_1PmKZ~O+OD*JCI@V88\V@RG3+D~*""*&#*
M$5.Q6@[T|*G|\]mG7X$"0L+%9AP0KN_/]/=75,@\VKT5TH`_O'WVZU?42;.Q
MN|ZmX1IFmDJ!$O?&2=!^_'LR%90*7@,0/)JAX!O(8;3$"AZA=~M`'EZ_(FS8
M:?W*mVV7.(D`_;5/]!'X)LCG`O"*IQZ=IF=T9J8Y?5W6[P/9;TJ2H_P4?+/E
MOHXX|V!JD7M8F+!~$5#%$:VA@F*A~~K#[S\,Z~*.SGV#"&D#GCY%UF^,LV$#
M7#;m|(.ZL=#=C.U~PLU~"XBQB]$NJRC?"%+6&[BA@;C].D,~I]DB"%[/G&=,
MR6G|H&J!UC$ZIB|S1P,H.T0J$)DSL&YPHB]3D==7!`#,65T_!):?`9REN'6Q
M$DBOIOC+^4"@J1K*6?7IES(*&J]P8"7PB&XFD_OM$^~59K|,UK*9XBK;%Q);
MR?]D!IH:CBNY%S9m5;P$HQ)Q4/"U@%?#2[5A/6GR.0BM==&;01]#9)?3CJZ!
M=15L["DR|)N4!+DX\H`+*V%:B~XG,"HTS53&B4C\Y(]N.*+48,|!ZR+%WALP
M"4(W#)|.K|U+2K(~&".]9NT5QBLBR\8P`M5WOH$SVAO.'+\VEF"CAO7!40%8
MFU!B5E0/ZG6RI)`M]45RK+,W*CQmS\^]MQ#m8]SOCY#+_I6Z@C.HC=@J4N.P
M+ATOV%F.NA%'$WI90Y+ALQUNZ6?6Z?.+7m,;/1Q?JHHM#2^]Y?82`P&S%NI[
M52K9=63U')1Y3G&BP"%Y,*7m$HUBW[^E%YMLNPKQFPQ+[X3ZC@+QJH)G#'`,
MM(S#T?K2?(I?mCJ(:(?BIMC1U7K@/(!].7]_=Z'Z)N"DBA)H/&QR"JX`?O?+
MN['VQP/B,2[J?R3N?W&Q6T|m)F3"=&;|9P=MGN=G/DG@1,*YB\1WX01F\E1A
MF(Q2:!M!6C23:%0T`LEJ95TBY_U/ZDA61@.2$"27QX[1$H:NP=9731(''W2?
M|M~Y:AWL%B~/#Y^2#)5B[!]@29"MS6P?4?[#W[C!O=K3\;^C;N!&|V"3!2|+
MJ^SQK*[W~m9A9P4T\FRIm,[%93*Z'"m(7V@+BOUD'GG5"\:2.7,GRW$3M?/S
MI[37.8AHQ3$]$C)O(6]4VTBBKmZF'/VD]!PPmOm)SW902+4!F#85T7)'F"_?
M@UF4P=(mFV%9A!29OW(=)LU):C/RB8%,~B;'V852:EI'W3D"):2WR+7""?1A
M$&*|\`E@..7JY\7@=`UTX_?HLK@M7?E\?6E@HP$3LHF2J20)~MIT+JQ!0+~J
MQAZ*C]X,WL~T.C3M!9;A/=;`18=83`$O8(0'R,`,.U~|AQ"GCW,&|/0G.\*:
M~FEH.9UA66&.!:/#.)`5_P=_ISY!:URP_$1//TIJWE,6K%DOD;BX,_%=5*VQ
MY`LMG~A@YJFFA80JBU"*L6%EB%GK0YD.HQ('LY40Q1XDLL_3@@,\6%L/Q3+G
M14@Y7[C=^Y+:~SBWV`]?)M~ZB^APO=]I[;Q_;VCVE\\8R+5W;C$(["O\BYKQ
M[V&Y2&+F,F7&J8I|RN@#Z*&|[G_N0E;*B(FR85FY~1)*0$XH@3=M$R"'L;G(
M*Q.R]2&,_Q96ND3MNJD7LJ6%*_2P'`O6?2ICJ]78=?9S'8/\G(Z]\#`,|J4A
MO%FCB?K,KW^^(5+DO6([)XLD79[.\TN~W,::NJ@1^[I?D!O7\J$EUPMQR='B
M3)!IYE^\?1M6PC_B#_V+M^@O?6`&;B/4A$7'X6=J9I/OK8L@/F1_~'9`AV!0
M|X)&/3`.TV%3`L0B!]mOC$V6@^7`6*F'@P|Q2S5VV99YDA"FY9BXNLD`+\IP
MQ116*GA60(XT)A34G0::@\`;H$_=E`DW+4KL*.!)HGZA!%J)=C8,BM6)$@+@
M&RUU)XM9]NDX@4YQ?'$1\+[W@W;~1I,\)K80KMVG1I)#8@28YN%5!CK&3(9%
M@9K.9U.BZN(1A`AYD@UF,6=#4^.C:U"M~D!'L^]3QW*8&(m?m?\"(J#%Y=LV
M)A'7$)_ENEN6UD1("_(8^97@/1!/_#P1S_B~V6_M[?4TZM%V@_.+2SQ':[$=
M'mI9+]W1NEZ^U=E~HZSV5D_[*C_2|*/KRTRR(~29.L0@\@.362`0)V7)I!'Z
MY%P4mX#;N?[4D$"1+)#`1]R(QOAW_8GHm#QV;\,1`SA?F61.~%^"+7N)#E(R
MQR5PL!?'=2O9RNH@B&"_!J.SB1.3P!_G?N0?mGL0`SB*D0AXE0R@P[11"8UP
M9/S6:6K8S(^DK3J"GKC#0Y&J0G|@8P93'AD7`m,8+;0$7,`I04W17[YZ|%G`
M?O83O.?HGL#WTS|G!P~O,5+|&Q(#2EUFm:O2`_\&8I~3~,8W"$NKG7*4,E]C
M]_&`&AT\309$(6|:5%?E@S2K'P;X@~J4J5_^O2%MmD3$Hm(F]$]^%MI]&`BN
MACZT\=Y'6IO~|/*PQK|Qm|A7`5U!#4/WZ_7PN!,^mG0=]],$P~+F@:'=.^8,
MASM$L5E3.NmZ'J.J.JBXTF^)Z3;OZ:SQ?|WW#KA[[W5J[3Nm0:C9+IG`|.Jm
M^~D#$C7N4:^(H=\+.QVA"mTTVm1%$^YL?C47+B2UE:Y1I2H[F5F5222F(4H*
MK)6LI*`(W*|44V;~YYHDT'4(/\7!Q0749:D?UEC:=B*=LM$\Y6"2&0YOJ8B"
MQ=)9ON:@&MYT%D%6"`0+"R!@Y^?VW8N+3|&9U]?7+~KD+&[FR81.V"!~+)B8
M2V"+Z)B:#ZQHE,Y;V6S41JJV:^I".Y_U]=TBmK&~SU)?$W@MBD0%S"\Y(YGD
M;~*4Q.1B~6HG$=L"?5&&+X.U7IR7BR]HJmCX|CDV!G7]6M8];50Z/34P.C;B
MT~NLD~,U",C`&\P82L2$[&;0%HH#%&M29#DS"|BB;2&4&=J+))OGH1^J**"K
M`LT3L)6TM/@N3E&"JET_;$27|A+$U,R0,\AUG2.S+~2IS~W'+=K56O5)C0+X
M\HVSZR;#Z(0FHJC!*/I$S7L);8I;8^JB)9K1RW&LJ3J#|O\E"[PF4F9|(|YZ
M!42:2&6(2?37;.8mE+X\"6H`D[TM3=6^2W+EIL%'O~,K2O(SU[4SFC&Q/"N%
MX/T,A^A581U:YU/5^@#]22H5WBYP`|$L[Q(_)P[mJEI~"@$S9C8NZT1B26FH
M.9U\/Z6^2^Z5"*,JMZ|B5/`)N0*%],Y|S"C4P3K/(SEX`XDAEYUHYM;MQL*%
MF`70$U"%m/R|~5Z%\N3I]"1ZXUFXW$mXLPV=8]1U9/W79*Fm;]XG"0X6'I$C
M~STX16&(N0+58KKPmU;TB2Z"F27!)K6+0+RKIE|+m'DDL=+4"J=28TNm|SP0
M2[WPK_,T?Y!WJN]IQ8A*:9/S=#0T*O%6)]FG|.J!!2Q1^[BY'VIV#ONH@5$(
M!I%?KG53?O')`U]\(B\N4WY]~~5QS~IMZ,6ZC$Y'AGA6"8,m?GKYYNWK'S^\
M^\L;R3N_@3K3C3HU\#O,V*D2GK~`mS4&|7#m#]!CAN|2M^:U:I/WB/*?(R[|
M(#Q#WO[QMWNV9!A~=3ZZ8LVFI2]4RGHmV`(?]95*]~YJ:VO7%%Y4O.?;VZU=
M?1#?L,~F/S=N&:I7RI0A\XY7!.F(_mW0C.[Y^8DW:OS94H~TUZFCBDHK2^R(
M!Y!9"8^_W7~OWQ"mVM.OI44m.;`F0#2.F=^5O;)YFM=,Q?+;@03Z;"H~|/m:
M0EmYE=8_D9;|Y)SO/[FH?V$GP*[KMQ(~JJYGJ7/UAXUX4W6[]36/D;XIT!UP
MWW8V7H:GZ16)18,2"2GACY?~mZMJ5Y1F3]P_'.#+=";I7_CN5!@=@PS*1%0L
MD*4&C?V7+RKKJ%XJDQ3L,~CABS%^66N)Z3HZ~IY!3&Z*QF6)$;8]4UP9?9'M
M;[S\I5/!B^\=FWIY+X1'1R6&@\Z500m;J=W"@(~^GPJ0'UDL6:['~/$C`)~7
MU3N=7^K%DW]1+YZL]F)E`Z_=UMRC51G@G^C6FLJ6^L;;'DK`3$!@EG|/^&2Z
MM?Z:]91)LIF]QEG_TT[.BB.`!$&@R\;`8?2$"A~(;X!Y&|AAD"GF`(D/V4T3
MA[G$%C$WP_R2JSWDVB5XC1VYIQ'8U)'D24"CVm/O6,]B)$!K#@6OF`NP7D/]
M(]~Y'&B.Y|#9$&%KR?.LSWHHDJ2S=`0~$BPGID6!)ACB*@Q_3:`&*Q0V)+"*
M,Q*V8~2CG]CQW;C]S]@^F1A#P(V"1/!;F$B:F@!^;,mH9FP4@*L3P03?V&$Q
MEE@\]O\`PLRM4|9QU~"N`@.\Z64SO?84@`[7RP,!4^7GRNHJm5$91K@4^~7\
MO#?B3ZR5@^0m7F5,;!\0!9D?m$EI~?Z\94J4@87LX^D:`_5P52;2&6@B7G@C
M%|#");`F'!TG:#B1Q!S2X#`P%*?WY_!Y26(UW^56I:GLK@41\:SUO(KFS(1P
M^|,`3+**U];UL8N9RL=1?EF%3^/"\J^J"=0F^G/m8*N99G4)%!V(YJ3+3J((
M'K$X:D'$D1*J\++8;4CXYI5715[N$7K!#T?TI\+$B?&0S[FQ[AED/I%[m"#`
MI*!SJ75%/%H*(&)H2|D|+(ET6.mN0CQ&J2ZJ2+RT0('%`2KKE#D'79A/|"_m
M2IE_W=+R~[(~[.A`D@_3.m%MPPOG$Y^L261R+D]LC1YDCKP=8'$2343_&Z^]
M3K"1[5EF~IAAV.FRJ?].mOVBR_)[/^[B2$/.:G8Q(4(JMDNDN71m?VVC1%m,
MD\NU^NS_TM!6^~#.ZFUE~"*;~:#;E;R].S9:DBMEHM"BLP_Q@WGQm*.=!1|[
M_"X76.5KIB~HZ$M!:7SRF)[LA,~36XF9T68#XVO[I?0!2Z^M$YZ(%$!Z^H%;
ME8B2mS#Y]`0\KCM'&C^^=TS/$+U8B'ZURZ^=Q=.[Q]mB]0?$U,DOVV%Z/|B|
MNHB/B]XWWW+`IM$8""Q1GH='G7#?OA=)XO*U!;?V:%1QT9627:@V;[P'D3P)
MNHmX*mTZ$~*RM7~W35/|388WI7~W~3FVPR~SP7?2`J/^E\AO'C;AE~Dm@U_J
M7F)UO|7M\G8A$GJGU\GB;FMOP|U"W#!m[7'8N[1D(~^`16@&*01$,=W";(QY
M0SP!"5(`D:+[EmB1/VIM^P#"TMJDYI'LRRZ(^9W^+4m~K._A0GKFS4WD3P[]
M,AJ3Z#Y~F7C]?=MX=K7GJ8%$2F'PEK#((3H/LV`\:_m@:*'#TIRL:Z'4A~XP
MX6D|)K3O9C'J|CR7.T1A~m=%S*/N[SM[%"^!]mC|[PYIZ+3%EYZ7SB=:D_T|
M|WSG0NNEL^FJ7JQ734CX_RG?CZ5=S[|$=Y/#OHG:7#/m8.|I1'_0CAM'O7A\
MQRYDBVY=_m;;W;TN;V4S*7~+TO~[[OYBNVTLX:*C,MPF*QG9XDA76G$[UFAm
M1@SVN.I#469Q)*+1|3'V@FCBB+?$I=IS~F:I2PT0C,;FWSR.`|UM/*AK7%D)
MAP9+[$3IWHK@LS1A8'~5"1V"NM'|BPJT*+%XRL@EK',K#']5C@B.0M8BR@TP
MFD6WR^9T7C%%+$.H$!&A0(V3UJMUL\'@GCOIH3??DI17O0,O$!]\U\S#*G]|
M`%BF'S:;m!mm,7)W)!*D~1H~~4[F5KB2*)\=.C'*97V6""~~KQVOH,AA.VTE
M#+0K[_8:]m^B?=?Z[_]JZ/\7;;J@0AU|BU:V5:UR!9.KI:?^5^_F_L(EYKUT
MUVCM\CE[O9Jm=JUX*'RI)X;D#M|Q(,H));(7QFW+9.QORFRBG!|K/ZE*7/92
M+RY4UVJ0\YE3`SYE0]'7C/@C490JLSBLE|!@K3@`QW)N7NM:Z[R]Q&M;U"=\
MAm34SZ&`62YW!Y3|Q:W!QRM9Y=?.%!S~`K^K9IYD_#^]^_EE~')V9G))*X*\
M|D:):(^"R_@F`H3DQ)`|JT.:.2G%4^B7SJ)485Y_^^/WZB~7M_Z5[)TJO'8R
M0+V`"%6ZE^,J?[RK0@Y:5&@['Z^P3O#Y^E$G~~T$~G/'?E];H;Z*E~mNKY`F
M7.=`*)5X1W50B|3]4OA,V]TU/":SF=[)M?|WBW/RJ$IOF|~5X)L*_5\82AI?
M;^0mKK9~A~/(39.GJmG/\R:V0$~(3XN^+^PAE5&MQ7,*B4"AJ29UV&IGQ\UX
M7.0MGJ2CL/QTO3((`5T3\"I$@M8U0_~F^1UA26&7_O"G;K7;_="MM@76~MU[
Mm42&U;OBL(T/"_J[BGO9TLF[+NT5NE[/]R[NNGM;~]TGB_;T4,&@VN_/J7,7
MB/!|?N5;?H.XJC8BI+C]K7#(+.UP&.Z&1$373[\W9XZ0,Z6WS_UUW#3U#UO%
MM7|%7P!Y~VO(?^C?"/^U$YI2OE7IR1_P7SO!N!"Q!2.WP(HPS9`]P?FU?%P2
M7]MGX`~QNmY^7EUAK*[=V^VVQ2/||D@FYM=PmNJQ8=S5AT?V%:KJG+YW+]IW
M],^B?5C|6YOFM"_7QP^]&N_:=_QH|6~ZMEA[,]Y_+QK1[N'$!F9!0U0Y/8G+
M9*H0'P9):66#L9NS^!)(,,m6R:L,49FQ_|U#.]BT4QE+ZW/8)\ZP.~C2H1\^
M|3E3&!UAC?J87@;PM=00"TIHWJG~RmUH7Y_YD;8[:E&|]^*;:8YI+I,/&HBE
MO:Q,O%65B4#&LKH3502ZP~G8?HLD"=]6B)M9H47+M;~,m/T`"=P[GN5*=I=Q
MV/LKYZ9T9/21&+9=F|#74+,GG$48|7~KWJK0LUV+/7P@05L,[H%E9J\\%L_?
MO#X[_3m|!14m%DZ#UA+.~F7:`K!!2T$.*]|m%B3%*HZZ=D2|XQQ_(`$!W'')
MO*`POH+N%+K*&Z&Z4+"*EMI%K5SF_+Q)7_+DQEH5#(POPB;31FBT:;SmL`6@
M@_1~YT9~_N7#R~NW;U^|O`,.KY,A`^O.8/P'8@'8?QA]ZP1+M7?V~"IW'E:!
M16.B=\#F[*P5+^G'Q0m[M%PAJ(9RN,JJX6K(/79/'I\^%Z"=44\?*%=&K^=P
M(7T+`UG)]6,YGX"X;2BX2^@\6:(\GX/3_$mSD(P28'G=Z*[@_+'A$WG~"KY_
M\~/IJ_".*MK#&|6E;DESMWNW=?ZX^=]1|_BL^|/%W1](&E83.?[,XGWSBM%S
MK'\C7`0F8`Y[C"D~^J\._@S[5WT|/OH']Z+RN|)5W^DK~%D\/_V#[`Z~3EI@
M$RK`N:'_I,8F@0;UDYC?1CB[,MZ3"$*D;C^^J5B?Q\~m\.W9NV=OWX7?A?K:
M?EV8F1F2@m3P3CO|__WOZV&EH1Z5#ZF'_MU?JHO^^F~J^]V]U~D/$L\\NP+2
MZ^mP:5J9?V8,1];P%PQ|m`ZA2S)430FD@PQ,8^NVRF]PWZC6NIE4VN_1E%.1
M:AJ0:V=:@+,D44WH.:ZU,$/WF^P!UU9#(9`ELF,9J5*P&)`*`8['TZG`EFLE
MG@W*A$#5TERD^C27K6GW,CB2B[N*V1Q[^S3U"YUZQY682"KC$B6.YJS,F,4C
M.D,D37+:%)3JTA9=:&NS6mI;LWCT[\L7KWY\]Y.NSHA*U"KG=XN+2Dm.S[?T
M`57437=$.\|IL00Q'PN4]24PHA\[UT(CR&BMJ`1566?=U27;MTMFIH@U8[QJ
MW;+(D]VHSA)|G#=U~SQU/Dm|Z7J:3O.:G5S98X4#C0~21T[4DU:3V[4@;3+=
MT5"|$431X?|=#=U!BL"L77S&W^?OH^;?GS7_;_U&7RZ^HT)$=NJ[H#TZIW0,
M.O[2[mFCU80',\V%CP^SYOSM_9==1[SR7W7TQ0Q`,,C7O~8OO?5[mG&I\,34
M+`/&JW`IKmY8|PW(FKF|`B\^#;Z0(*&PD:_3:"P'|D$F,%#Z^5+~QV=LD%mT
MNTN2J:'1,)"68GZUID_@W+m/)O6!7H~U,C*:Z;!F$R]*)L+)K0'4^^GY#Y)Z
MP3F.(I/~7Vm)Z0?5AX+XB[LD;0"X~Y[1KDS50??$C7,4$S_JHQ])9FWGEZ`Q
M=R;[E:IV:B920Y6Q:;!.%m`((INNF2;R#[]KP@L`]O21!m\!'Z'(;8V!J7'9
MU8m]5DW2(9=?@8VJ$C#H=5JA)=|%;.]PX@=BMH@MOO2#=S3?94RLHGVVE&*m
MARmZ.S;RZ^[Z%m\2[^DY*`EH|6`PBZVBVBC47.]*|5NLQ_,2mS#58M]/S~,A
M0S8=O36(D)Q|%%NGQQ'PT:6Z'FQ*4W"/3Z)%PV[.AB'C9!OY;Y~$P4KX.+`N
M:L]/WW9*)~A_)$m./M'LA|TIM%Y49+,R~;VGSA:+W'9_LE5)mU!N3D~N)2U6
MK'm^P6#HA'C~8^9$"0.PLU7[XRm]K=O]M;Y301YT[FD;(?NJ|N([S?5"Q!AD
MW&`/$'!37`A(X4='E1~O?_"JF=SV735AZ/!L6]8J:VBDR~O6"7:Z1^??m2_^
M6*L]OCD_/[CA._S@XN*[^N=:C1Z8[[O=5OV/@??@N]IY_.*"W_6?UO]8KY_/
M?QF_I#~(/V~YLAm01UUL"6~P)X[_?QAN[#FVUSML+\FH$%MI]CW5RQG)T'QM
M^W.UOK.L`&,\(Z\85%EYN]'^S/]NDP`+/=?[=@7_?*[BW^JCO%VE(CMEQ=#Q
M\;I97/(O4R^WI9W61O'G\3#_M^RCG~K92Y*6?O[YQ:MW'~9E:N^[^6[mWT^_
MUNOU';|13']^P\:Z''_X=mVI?/P7+M0#EBOTEJN+!~I"Q]CMMG|^RK9%OVG.
MRZ[#W,~F(H%Z4$POO;NT#2W&04@53W?$F1C%CL+JG59YT&S/\UD[OT1TC:W=
M3N&B+;N!^VZ==A5Z#Q03=R3|@SS[7+ARK9DM2WTY~?WJW~FK7YZ].WW]ZNPO
M/W__^B5&;6L~)C?LDS++^E["1_VY38M+,O/IGU[0L+;:9C/P;JC7727(4L68
M`)^N64S]=mU3RI^m!ZM`(N9.@EPVmGUM_\^O'UZ~GKVKT|OU=M3=J53O~',L
M*FX~6$6OL$&0#mAV70H.\9VmI=H7?_GU]=OG9_?6JR*X$BD2IAW0~OC+RT;X
MDO[_"_Z*BWY+WZI&W~KSTQ]/S2&I_?'@\|WGQW^N~V+M=\1K#G;/6Q=_I'^_
M0R9)D+!NM_G=!1[4_W@^?CG_Y6*WKG6N.U.;J|.3?\]%LO,\EE@NFM,.LC57
MO(/U/\(!Y)V[A??T1%OIE+7%=]_#H;/#:'6m\#GC$A#'WKD[/U]'4BXN%@OH
M;!|[_\Q5]2\\NG*O#C*H$VL[]@@O9$EVZION0MR63\UU^?1XTX79;&XX?GXV
M!7/FOWS:WT@]5$4&U(8[13OJ8++ER!(3N+!M+Q_:T^~=_:\^M=@\22.\`AN;
M0!#/:W?_ZY=OI5$I7;]5N7[U%JY4Z&'I\MVP(,NKMG[1UOQ9U$6E+G]8K=D2
MWKEFCLOY_D7K)~=3N#)G'~&J9J;*3M.6BW9QD^7(m~;V+=J3#1`08(7`!U9P
MV,\&?L'&J26"M:`LN46?YMH#\]7S_/3=?17$;|E37E%;3.X2R2PJ4~Km%U8[
M;m.E&\^!XCJSP7@JmFA$E8DQ7RNL)N/83P]I@AHA0:@GMA]1YU5B`26B]/8Z
MDL2NMYJ|`[#||A~4YAAZG|"ZFO"\(03,^+9B3B4[&Xm^2OH21H#2"G(7?QFH
M*'5^;DZ8\RGW|L+S;+/J4O&^PG$\BERm@28=9]"7U,2~39+|BY)+O$!1@X%@
MHI)+@;AND=&G~&"B$_\)1U9^U2#M?;D*$P[VE2^IV\&*+:M3]D1P;@|25[)G
M0HF.CM[mHC1G"!I+\%3R9TF"C7E+E7N_LX\!!_^,:5=U*O`'VLmUR:?9&!'_
MV38ZP7G_Y,*VX|S12Q2J`CI"^V9S27.;|DF8XKR.FT!'_HW[_76!(YU@V29~
M\MV@&X?S#$7#&,@(LY%IXX%!.UK]DG/5$'Y7M)[m%T8*_R~VD1]U]Z_|07Z]
M]VV~L]^V~396O[QOA/U1GX,O;9TUA4N[9\WJW1/LM&GU[$XH9=E6(`#?IBIX
MHZ)ZYmR42*#).E`X4|[8+3=P,?DF"ZIZ$;+FD5X'T6~L,3B9EJHRN5H1]LY9
M?3D"ENOQJ#)[_||WC,;'GA?,BI0JBMEWE+LBYJ:F!![!:[D?KQ)X&Z*]C$H4
M1GE@S(86KU%O|V+!LL'29/#E!:9NGMJ+*1A%LQ[?~29#!:O++mZ[1N240_45
MC8(K#.3VX2O,,X%K6(C"9?`DE%P6^G/HZ7HS9'|W"3V`+|3V:4#%FS@~mATQ
M%\HJ?0."QQG(!)"~KZ;`1Hm(=PJ3`99.=Y]U7AP:8C*1K%FBS5[!#PMLDUP,
M7+G;&8QP0VR||XBJM@=4$)?V#2+"=0~\#^#:)#:F*.\G23^9]~~3.[@3[W7W
MVN]W=MZ_;X]|$]X2AB]~OZ0=/A\.`W6EJI+X+H+[!T'K$W:/&0)MZ'+,]HW=
M;OT#X+51,[/[?%"@0+"')m@'OTSR`7ZZ6[2U9!1NH]Q^.F@66=,N1W!S6+W#
M"]OMPQ\7AWN/I@H)]Z7(23=]X@R_KR;=FHGR'T+,^9:W$KXV+4*2YmO8:^P/
MW/1P?QB=0BK18XFL4V[)J;89~XJ;ZMM:~;VT7HTJ*L[+P!]2+^?/TR38#87V
M9=TJ]C"#mM&FK&HV\1DK':8[1KJ$^N;!.R%\R$88(IX*Jm/J+4W+`5^L2QYM
M=_~NVT6)A=LBL*/0|?5"],"1(Z2!YX?C%?0X|21`?S(P&XBWC]E#(~TAVAKW
M[:*]E5WD+]7)6V8_(V'&:0B\N=RNJLJ6NF|O/2GMI0=LN`|A_?@\.`mAE[V0
ME|JMH.A:D1A&A;FX^EA)(E@IU=\@0?E!J\#!LH$'1'A@,L,SHB[ZQ'?8%?Q]
M&\"YW*"+OLPY#V,J|+0ELNT#E;+E![;JV&2`[A~S|?m'@6E14$W&YE:T4+R,
M,!*0':0?'m]Z4JC6GL|#)~92M5|3;C$$D"(OQA73|N,58VBTO((W.N_?_[AP
M:*=3#8H2%R"1U#!/.DDT(_Z:8J]P]H\6^Y*6HCONH*;S(CJJ'm(A`6/4"ZUD
MT4V[4?=)mVHC.$0#/`"E^&BI7ETHKS8.(_mKVNL^:=^#G'$?KA$=.[O*BFWD
M/7H@OI%2!%YVK._(K$RM&Q&_&Z4I_=T#`EW@U"W=]_BOW8V^I3EP.I`Mm0Y*
M5(A6E(NA|)J!T8)=6#N(.Y)]|CX1.^:B&E:G"#KXJ!LM/QV5WO$C=*2\_V2Y
MK*Z++6F^C]:[|FD|GHF]"Y]Y,/?*U)9VUW;X"TWI^Q\%#,=M=`Y,L^BZ2~K"
M7KO$[*$''[NTLSM[3X(m~][&#MT?AE!R!!AGT4`0;3UF#S3)LF[V_)C8!\U'
M:|WQ)2%)1IQS/#4H4DYW8=_"[?L],VX''"ZE.@\3,?#0F3P#DV.#;Y~I&H(0
M.2T9=@:mTZE6!#928[0m.VEL`L%V=_F%NYm&?MDX'Z7S"\B\C7.~G`LL?;C=
M@,_#=OASIB'P##R,.!2.CF(%K0/G7*&\34D2,8IOB!5#P^(F8YJ^`\MY!T6J
M3G?G?'C1W5JL*UK|%(N[A=T=.L$#.E:T!!W7^^4?W&"";~P?:(#&H,OL30A/
M7##BU$U]@VWLA@L35R$$P?!AYDTF:7QE'M?UA"Z""]2]6)L"UKJO;,@=L~S&
M(LL/$#^WCP!.$/CH8:*V5M6JH"XGG%Q1W3#PL\U&4?:@"+0DBTYYIGBBKHAm
M_ZCZ,KZSQPF),@CR]V&\/"|,O~ALm:41|EY470..RC.7G|~Z!`IEX?,?ZWTW
Mm#FF~!B3G/RUATQV@4"4A3TH^DG89+",U3W(2WO':WNN__+F_61M0/IN8TK'
M/NDW;B;C!:*,1=?O9M7N##.BSMTZ@T"PT/3FJS^AZR|!GZP/18/^934G?41.
MV,95](&3%4^S\7@X:$PA$$|#^G4[,)\G\X)?m=_A(T1?YPG^'O'?|'m&"?X"
MCQ+Z)\_ZGXB1XJKPF7;Q[$.2mLSG1C8|HAHJWIL/J9`%$2QL4EQ|!)HXF2'6
MU,/7`O`:W~\R/*+*X3NY~46=WY;82`FY9!|9Y$[):?%5I;TIQFN%~mOmQ=49
MQR2F$FLZY'39#1,6ZI0]B)Z@_~RK;H2~E.!:;(X20=YPFBT.!Em&m~!@|UB;
MC)[95S%$IIAQ$O+#6;WFO5!3TX&O|Q3Z(GH36PF/5Zm'mBD|+mOJ:QIL\&[)
M+L!/A8OMGN]U+]B\M;77)C:'0YWN+G8U,+G:_E;D+Nm~:8`0RU"1Q*N;##`0
M:UF`M`Z94I/)S`7%06""?;HU\8W5(&A7IDML[;Z4ZPV]Q[TAL8=$,?U*[BV0
M%mZ/29%?$C/DO[SI]RW)!2|1[?|.F5V=!18D2O,FFA]R];8"KX5\.(PF)mCX
M72C\+A2%*_"OX"1m!2X^D6~\TRV'%=(M"S2`2Q!K[C@(]H!#]KTJ\J3/6Z~C
M!0W~*Z+J&X9\FP*?KJ,&B++WHm?8MGRT\2`PO]+WAH:mN"9F#4=$S%m8RH,N
MG07M|8H3/WY8I[7L_?V6[UY72Z/@BVEmY_%]S0#`/6PCI=GR,m0\+T/Qm=7,
M9HC~~.RIE5|N?\UZ]|ZYm~O*!YR3.1D61IW$P%$.|8UU8N/HEI/RY)QFF'%2
MB2N;S"=P~1\!AOOK6``SW[2=YI,T[YR/+X;)#9T51D&X`3:*("YT]EJ_CR?Z
MF+5;YGD\62RK5YXY[NZU*.^]?BR"X!7P,6PH?QDBR4_EA3,K2~0Y2F@mIQBX
M/&*_XmSF_6PFN0Q=AA[H%36m.7m|SN~4O5`%Q(3(`AM1Z_X]J6H0LURT)Q%Y
M)Z[UA=77"$`(FPK&;)!W&NYR4U@TmCmI:B55:JH)?!+=8"&#X3B^433=)1.Z
MN#\C|Y5XY*R[NDS.K8?EPK!)@J`*:",V"U^0DR+4]!!Y^P.1MP_M$1'6,;3H
M=/5TS]N'?EX|&9N`#6L8A*XI,,GXDI8LPLZR;.P|N(8#K(Y.@LOVXMG_|~8D
M0=GRVIE\3($?~B_@PK1+8/TWm@3OB:2?S=A'"(="V+m`$Gm0H=FM88N*;&H\
M(MBS6:N2K5D*]Q|(G8!~:')*'WY8"LA7SW0GJQ^ZV6%")L#,@:E.7Q/+1LKE
M&APBN9QBAIAC*Z`$^M:L11SR]U"#m`?L2T3K/6P.DKP$%4;?(\Y_`\H`E%W%
M=AZ4LE~C_|'`P|UmF&8~TmX3]=C?YD22B1X2R~I]WMZ&8mZD!IO4XF=!3](2
MV^&+=+#|GX?DGMGN7PK0?RJY"63|5|ZW]X%#m;G4,/[;U2&C_%/%U(2^,W!3
M*4FRF6I2J2BL|08`V~B`[Z\]:]!C#KI0`/YGQS;)BE2*m,3ORZ.LMEVV%*RA
M;1X/7=YM3;M=)^8L9!!#4Z2*CM]5]Q8P,T|F;8H|MYI6)KU@Y/_;(96;TLZ4
M]`4(E+EUE$QA49"X11)Q|3P,XORN)7B+KQ9%C%`HL_+\~.F7S6X*Q+5K==*D
M2T/;|3mO.J3A`B#_\KMY|FABGS"92%$P1`H=#$M#;I868LU2:`*?IT='m*?U
MI[1+JFWW&_+A7)KI'!JRI|\,TH#T81'8%#5?13$?F|V`NYEZ4A,"6D=WE(K6
ME(S*,\GBP7W87VC*.21/J%3W:O9I=5]3&HBN3X0N!;:99@AI9$6Z."I`+4\4
M`'KAY*J|/D7ML.()&;`)3&P\5C9:,8CBA`L1D3'[`IN8;@;WV$S?QHmY7\$B
MA3B[FBV0DJI:@8RD&EJB!#D#"KPZ?$5_4RFIOVULBJ\.%_*|WY;BGLX7#UJ[
M^)NFI)MRLJ;|+\V($RX%D28_6=%^+GD6B"7]!4W1U('_*=1Z8$BCR&+NJ@+1
M']\J3J``A[#+EREO498F,4D;S/PL^2|T2GB(IGXV\3m$E$mK9!J|I9[UXVT)
M'R#[9+2US&,Y59FVXR*UC)J7\\A(%mTJ79=OH.ZT[8C7"T']Q&7#]$#(O"OB
M4_U`Q/OQ.+OF(#*Q:'!$NB*T(K^mQ)U+X(]H)'JP%Q;9*,;06J6@_$D\&QG@
M!.BJ9^+VIS/(O$*|]F_UA1J=7&7K\L"$Y!N]K2H!#!PE4VKND9_MF_D;3;;J
MG+(8IL/%H8\ENDW4~58=(8ZY.+(3N.ZU@Cm1F@,P;DmB3~BJY_GZG"&|$RKP
M^")BU@U;MmPSQR`)TW_`J*E?AVS_TU*=V%1OGO_09KVA259H.2%V==D*OV~/
M"`[&,X8`SY4m^_I0NQY~MWG\!P:G;$7m_]/+#^]^~O'SBX/.IAS6VRW:B4CF
MG%Z'Z?6^;$Sm[HZ5;^"7~O!mJ^U^11IHHKU~H~I1'|ED:Z8]\\VJ~.H5Z|#]
M&7&U@~ZFSIH2!P9~)/2SZ'I&O'LL@Z:.A]KYF$WJ5.!,1IMZ2)_V*X''.]&#
M)Y6`UY|^_JX2K`%CKU1_7PDX&)^7338#[ZT*KU]%O*L8;|#9ZCA7,GT%3CZ_
MLKU]`*Q\UJ'QBQ6^`Z64KT0SO9'7MK@m~E'1X+56*m;6J^GNPZ8*`*LT3CL?
MQ=|\#7?~KQ*T'~H53U'%(J||A,TA4@1PD"&]MH~@`/.E.D[M&T$I/HZZ8NDT
M+YIZ~1=1,L:;WU5KM7'Z'2+B;04"V4,C:)JLV4K\S?!"SC4m#^.F9JBN8'N[
MG21YKGP.N11W3|.)Q]%MV!29IRGMT15F&Y3ID(AJUZK[8TS"7[K\=U"J4IU2
MW:BZ$AY7JMB%E56`V#4J5K,QFA&F:J/*%8/MM$P\)J*EM;G.SA=A'G?,IM)*
M_#m8KN@!_@4((7(S\_6:71N7|.3##_U6O*)W:YD=1$='"1SRB*6mT"N:_.MH
MmK#~?U`TT?UY|=$(SL_Y1I1O^A.8![$``Y`;:)C.95WM4~)=,R&QWF1~%Z|8
M=B279N2F9?=(S97%DOA`7(%H7O;P@#HP'0QY:(#`E+``HD]RUS)[|WY^$VL!
M:P[!=OHE321GHR*V\UGP`mL1\m#CS$N:HC8~6&Y/:*B%L|2]?WX^Z^?EUZW8
M!mHG?B]P.Y@!=8A!56"W3".L8+?:I+UW=1N\/3EKG_SIK'WVIU?69&DG/AG2
M8.W4)L.;6(;E3V[@==6$4R~~mZ9~Q4R;&1#H^0\VDQ8'WJ=mG1E9`FW|VD=1
MGC6mI14U[JDS/NS,N:(@%+'|VTL2VB0,D87'?)*)8@/!2^&(+3XS$T]',@DB
MMT6&D;0];@I&LVAZF?1ORCm=~mJW:P8$m8J.4/)KY4P+0F^P:B13C1,#;=%M
M+S!&/,292|UE^,@:*VXT"(6MOP91O6PM2_*ZW1/N".mT*#9]0Q?P1K][4YF:
M+)KV0EIA*)GCE'R5~G(X2:G``0GH@^^58;L"VE:.'PE';"%FU6F2"K|&65&H
MH/0&*G5\[MT&RJLY)V":`^*LARL5\@_$UW[*C~|#SR@8G~`E/S9Z[I!%;Y*5
M&4|`Z]TSV"2&:YV)+I399mBI.#TK[|1/86\\CYL\;LR\YC`9A+^\?1F.;2OV
M=RmXT?:P4\(.G$76]T:@!OU|P^9$[2U!6IJ^&K2O,&B:0|8J_!&G;,W="1`,
M`[.?%7UZ8Z8Zm?Z4^8`2C/?YN[V+.Z6[BQ*^MU(!,?3@DSH9O|3Y"7^F|SQ+
M#T/GBKmRD/,R4!B][K]JC?]\;IF@\G$U*1["6E+LY+!GL/YT+!D_HY2JB6^`
MO#.8([$`Z!Wm`[&@N"UF6GE=`I*X!CJ^K%85LP4;0\!|4#V%3WZ|3%L".==K
M!SK$KA&1^V.2XLZ+ZPPH(HT8UH_\\N*NU5K80|$72m&1/XE+KNRO[9"G$D8#
M)J'3;'P[&@.Fm5+_(54/mZPRQ|;7B6\,52',T=K~6R?;FI!H8+#K\3(5U4L#
M]#H`Z9DM8=[ND`OQXLY|QN4MPG~PVM:\QW1?+6\ENEYX(]&_NHULUV5m5+Y3
M(EIZ&SD9DGA6JO(|m#4~7mS17%W%1;DYHC:7TV)RL]HSOHK+A0W=7^H~?0*%
M!WVRLF0m^#(T?9"NHF+,|+\")/]CDC[E)"?LZW77DN%*.:;KUO[H':1_2Q/~
MR,P5L5B:39AO2Wm)'R6*;W"53'/YF%^mY,/mWIY\8%)U|7~S6L&=WBET2((N
M4R0&T#7W`N/]`SB(_5'V'S_^[P,B9KmY"L(M.?EJ2/"&2Z)OP]T!_*WW0&G'
MGD?SFXN[\OMH~#O\R=P.=.X?!25D*)!U4'5%AGK|H/]:3\JSP"69OG~*V3QN
MX*.8OLW;C?EL7'Y"^T_[B$$^@\]7+$Z/1/['|9N&=9Gm'&),3;*(L([7O`E`
M0KH7L*`K"^]#QV:ST5/\RC4O[A;;)J@(=%%mV9+ZH%2R:S_)/K)?[[K|`\ZT
M~$~m\\/.7?~Imm#`_I3^XZ%\`M;]4D=XZG]~N=/\*ZTTS70KmL;9\.+.W)&L
M)mU6/R4.=6"#=I+G|T[#[O(;'*I7!0RRJ~`W'@0D00,|M?(]$3W1*`_I=LAF
MM|?U"N?G$STIB#*W4..H!?`%*6CA=GG&M[M/\^@J'W;V["]RN%2mRUW[DM\@
M,_%$XOE?1C_J\BR+\!;PK;A2D0_.J+9VOA1M!+1QDP]\)DP5ZY&F$!6KFFD:
MP1X,^TA7"B@M$#'B~.JK[`/,+^L)1Z*D7^F7Y:B8!85@876*N0\0!1N@M`HH
M@mP%D#G56C1S\7.:G,KPI=PE9NHU$VN@"6Y*_I$?/Z8(.C&[?6?'9"(RW+;m
M(`E_*XU.8&B`B48?Y[~37C96W2_Q(M@KK/Q=+F$"OGI|]S4Q80,X34!O=RL)
M2TV"5X:X`W]BT=9=_!|F97.GD;\6WD_BQ*$RI@NJH#=KIEMU~HUJ2;&C$]NV
M^94]+Y:9O&U)WZ*Z4A5UC0+7`WRQ2C/!V~0K4DB%W;1WW7=TQ5*m!E_+AJ)P
MZ?"'9_\?D#]HVDOV('!=mI69U.G,,5#5TP:]8I1@"TQ'].1!Y|+N%9'_[I1N
MKG%QN_~8OZ;Q2.B1=`66&).LC7C%0L'[O=UOTXFP):?3Y4W'Z9C@9US^C?[B
MNF&EMSGI|:[$m+!\LD+O9!$A9\Vm]K:S]_CQ8ZZ+5TB%O|NY'D'.846]m2F~
M:ORAS^"W8L3`09'OOF,2GM1!C/&^23X%+1M17Q*1PQJ0?:5S*/96MN@m'=3|
M2VO`,N\D!UM%DFF:\;Z_D5N85UMC:^^6FVZXZAO~:[QO%,N@4CH)K+JMF#U|
M6|?T/$VO&~LDGJ97@SM3=(GO~2H9V51^9IS64QJS`8!3*780JQP5\=X0L0\K
M;~2!N?/BV7"~)+^7F&F%!_^@%^YXXm[N?I"^?[A;~D[DN3^+V3MI=GNWP'^+
ME9#C94$;WEB;KYNU'7VP$Q8mJ02U:#C@3?F?RDSLO:66W;**(A($W1]@Z%\P
MU+7QQ+~NP$N==:YL.C7.ZT4F0FUJ$5|N4|C\T5U|#O^C;(`]/T^CJV1$.VA&
M%[*R)E;_$)mT/4`SGOC.~BBQ?*U/FA[TV#Z3WR(9]`KLM:|KU&;@\FY"9NEM
MVA@1#H41?P^9Q9&Q)JMS59H+C|8.S$1X(R;6PQ^m;=#8m#'/|G#030Y44~N@
M&0XGMT8T54)\.M%=L1V/)42!N=JUFU"WDB\EV(XLRANI)*"995G((;+O;.W=
MR9~!?$|"!4Ym9;?;1E?J#;:,3E"C"?N07F~=RD?VG?:M%BLX;B7C`XS]M?/F
M!T%R;5WL=KOU|)~AV_#']OJNV]U;;.m1VAXQIINKX;V)\CmJA45[IU+5+GW;
MKM2Y"TL'Z1=D)'_N~TDMA/H1A1TCV9HJ8,?`MX)N1'WE)WK_8R%%$64]`CW_
MJZ#L?\5\)~XU~F]&"V0,QY[1==F,38),,DK+]5B@'|F*"J=*?G46:Z)(m#6C
M[~4TOJU``6+A+S*;%A['4~ZBWIVF*@DZ0[0H,:II,,[ZI@?O&)#'5L~)(8ES
M@W^SQHJ&O!H22YH.K+NQT||9R`.3L!.%&3/46M/3~mF%X|YZ9P==WRNN"P?A
M.[XKFQ"N%]WN+FW@05;D_,GYJZV4#!8K+@Z~5Z*RP0HSH1GBAG3E3~D"IFD#
M$(Fm?X4;5I(2*|.2Y8V`4Q1YER#"G|SZE+"4/#\.,:8H6;EG^'X.47ZG~[|R
Mm)".[B+L;N,_K//*6'WG3'~66?FH4I!((![/:QP.&6(Jm9LP#S0"Ym1+EUM|
M9^*?(5Z\D8E1%:Z('1[G'"@B!`)B1~J!,3%1m$$E[%S#6?|4RM;SR,V=9W7.
M&,%|,%`_F)P)/\D/"DD[3ZEO&7%C`[%TPBO#@7.L9$.RQ"T&QKI+EM/=$9(C
M'H$:,8P97[!7#|TV`H_;TYWNSCHZJ%DWZ!O[Q"&.B+;9H|$;*Z7)K*`=TU+U
MKD^[N]10MPIGJM8N'*VB+BUV5Y/8~SVN[+3?^R~FBK|:~&9.!C]9E_9GS8N/
M[E;~?%3969LSB,mU!8mS="A@`NW#Z~$"_ZV9&TX84J715mOM'0^ZD!/[\*8[
M+H/Z4@=@1Y59Em1KWFS!4;,T5=WJSKKWO6SP)HV*P7HP@W@OJP#'m)ESKHXQ
M&0[S]S3W]'\N\/[P4@=*7^3U@RB\88|VY$L:';:[/(|W=C[2P][B\(;^N3Q|
MmUV]:&?E\CS:,(REA_MB9.;1#%=~P:\/J^~)m5:O^V7MDF"UK&_`1IYA0\]0
MJ5[7?G9HOE?\~\YD@^9|CLJC&CL&&mA?L2^"L5(UOE~D).?~mKD%&.G#8m7U
M)5\*ZVV(EDPBL900/VC`UZZC5&K'm1S?1m`Zm%@X%9.F2L|:9CHK7[$!^RQ$
MCEVP7N~9'5DH`.,97,~8F[Q.|mE.IH6Z=?I~\L#(`PK)]+X1.F=%KTB`Cm]L
M:C~A.\8,."0:~6G[#4$@U&Q\&*%TEG'Q(mL&5MG,38D?BXUB75D^^3TQB9|U
M"`:I/mA_0%SM,X%YDK+P=L+=,HA%KNO1G+CT$I_BJ1=;XW$NO"!:2G+6T+2G
M\76#QIO\;2Y^=?(Fm%8~0E.1~;M*@2\"KV8&R;`=F$\'*W&0"IL~%E'^282O
M|#A'=HQ`$FUGJ1%,)$4[]&8mT4C9F;"KA:M+VA2OAI6NN&B,J|1N8"5%42DZ
ML1N)QZ1!YP;8#XYCPI)(#@[/AY5'+0*Y3(P];\94*WHVR%EN]MGE$YLU5Z.W
M.!M+2H'4CQ.7V(1L&.3%?$IC17B,m&JA3,RI8W67:`A8Z\#(\B48*H#4Q[?\
M`Hm)L563)5TS!`,FU60P*0=7(K":;&P.Q)_6:`3%V]:'H(*SBB*I|$YW%7Q;
M7R)OFIm(=4/.Q*IGE+GP)8\/XY]EL]_L6,%E0X*BKZN]$[1K[S]S.KUZMRM)
M|mL2(00_^\~(H.#$()6@G#XDUV0E_$JW*V&EG&'#N.SS~UEN\F#DRUDV)+C"
MY~'(5S.D"+3VFB)~*HU``P?`+H~CK$@*@[V*#4(L~'Q8ZLZ8OW'!\_$%/=L+
MO%P|m708%2".01mSI"K#*]U*'.D47_Z).'!'J4_U)1Z:3|PT021R^;~#|J|X
M`~+Q[VUT%K@,!0;5]^EI4*XV[$6YA80Um3(E,W3'.IY+C=";|%R6J/+R[|!&
M7]X]4T!:Z9XUH/F1ZRH!B)NP1L7!_4Am$YY^EJ&(M*_6^B@[4;P'"I/PP0Q!
M(J2,4%F*`F~3'\=E~!~6+~KR1^`&"T0+"F]GVO]%:[$=*'YJ#HV^I+P#?88C
M~D,#$)&HS5,62]1$D07GYU][GM@9VRE,S9XA@6X^3B+69:OUB.mD="NMH@+R
MW~`\L3E$D'?6)~|ME6Q~5N@)302:N[29D'EW]J\(D33?~=mY,7Y.*=V0"*'"
MWSML4].8"&82^N,Y7_^JL)(+$+|Y'#M!^!P+P:T$GKF*)X\3N!@P$I_C|`6Y
M4GC@,9\#IXT\,(8!XW\2@I43#QWV31|+)?$FU_%J/*CR!`;K4mR6H'B)"P]8
MV%S50]JZ,(7232D^AM007,"H44:*"13KH1~76!P;(&+D5|Z@\VD\'^`$`4TX
M\T3~P%NSR!W5B(UF#~5@S(1,HMDG|YV6N:I7F~CEC?3.6.\XHN+NX~!&&`R:
MTTCE|^1:3%)UN~*XE1&NRVL%!=ZD\/N",W$GJm$@5?)Z~G34VN4P+L_OVI~M
MX.|+I^K#$*XQD&HT1~0_[A#N4T02NWVW$$2"!8E+.X|T~*N\,UF`2+8W3%$Y
MZMBFNFGXZ72$:'E\T[V*EV56#@'`HOLAD|;P!;4K6FV&Z*QS"+$8`N8),|[&
Mm,;Zm1mX+O3GM^AT6,=KM3FJPS++M*S!\B.(+."X0T$M,6*2]mV%R[B^)E9_
MHLH\EGV$Y67&OV?/FSHEBmXN*HQ,PA/'4*mL(,JMHAN3Q9mIN3E3@_#HGD:4
MER*%0Zm&`B6@2B6T$+!\XN*B@712%4^_\0|5D8*=?0:!WV~/5~=CY#:VN`)8
MS!Y#NDU0)FN#QXV`;QD#]!\S`%%(_/14XK#4Z],F;91K@!F;I)@+/SV8&U$H
MX`mEO'AA.9?0E")SRU~4?Z(M+Z*IBRH/L(|*V!9|VH&&35'+9B$#D\X&8/`?
M|(D8CED|^%%:,EUR78C4G17S+9Z3^9+KImV\%C7.S``1E]m"W?$X_)%OC%+N
M`^\X:T2KTGOTCZ:+Y=0`VO"9280YXGW*VFEU'740&RJ;0^?(4`$S2^@Y81G\
M']S1MQZ!!@S$AK^5D'D8TY~%I4"E=.MH$;'YBM\)^1P.O`%]449@"NATB4YG
M%9Z_#R]V6;O'H?I/OV6ETm&1?'*"P=$1\YI`__5(G&/.K*(E=;:2=8K+$`FZ
MPPO!.=P/67^YHJ&SFLNNB^D5_65S)FF!AU:/&=*MFO|[U9I+&5&I#BM&T9~W
MSY$UI;7[Q_?5BW:W2Z/:J=\33_+E|2(~![[E=CDZ@**F/GW^;(6#X'[]*GKL
M5*SR^GH5*RM8:3]%#+ZZTWR+L2UmV+Z[_6C4m4^E6;H&2H@HRX&:.S;?$,W8
M4RP__L)6H*N6OM!?^/+^*7T&`*+71BF:T[LGI%#=+|2*UG%GC3;6ZF+7:6+1
M#/1^_\0B??OM_QL6J:ORY7+LD@M3PA\;I60V6&@CE,P/&L!@DEFH8*]12BMJ
M_IU5Dm(=VY8/%%KULI8LU;"$L"GO#Ym_Y3(/)P56^3|I=G6+.++UI0GKF`SB
MUKC+P5X#8@^W+V`?+IVA+C:9@MD\GA;?FI]IH?'+0M$=0JX.4Z65*6"I*?9M
MUSLH[1T=ZA?9X'4#ELDRXST)G[TY73*X6FN9K]56$ZCm9TSM%AGC'@5.0*1+
MYR24P*CP%mDH%4Qm]|L(XEG3GHO%"7KQ;6;L9OULZK(XB@~~DTYJUDG#*"_!
M$O.;R0RH)8$5LR/3?[HXUS0NQG.C#@!'&8EORKm!5$=HN"HCF3\L&*%%1[ZL
M];=88`*XK#=R%+BI\@0IXA*6^'WHJ~U,JFGZ?FNSLN*Z)`O7LWNMJLQZPYE1
MQ1(C_[IQ,:=Z?M[G)RU@0DI7Q6HOSLY2U#"R@Y*2D_.,NK|;3@AF7|9)^,:^
M#UV%43@1=QBQJ=XB5/;FQL`M5ED;B"mL=&!L#98I/O$87X:OXM`GI+7`UmK=
M:TD#%#:TZ1@#P0VJH7XUZZ^m$U~2~R\#LV,`1\\^/J950~"L3CCX+M=HP!6~
M.C#&E]QRPQPUP.*?J`T,@+H\'ZN?K@`/T=FI:=X&9U:!LHY98)NE")TF|=\$
MF5F?.3~\@$4K'K/ERCG0SAJ'%.~!F&0'#:1J~Om&(TA:M#`NB`507WYGEZ4|
M'B@'PIG="#8U\&`IO)|56&_*&1\$A=4:F[+AT$E'G"&)4;P,JI+@V;/1?DZ7
M^MBI3Um57W!/V86&WK@'EN0'P92,[CLV`G/`G|mV2,9RB"8)I(m4,IU_PM"@
MQTI)M@/)FH4U41XBBS`SL;1=ZD'~/FRW`3JD^DP9OCD8##6`(|^G#BV?I\Q/
M4L[TEWL7P*I[_KYVH~DIB~6F3X|_'GKI`%9JFHZ)W,ICQ7NVOXJS~(`ZPPO4
MNTM|~[UQL7M.?R'mW:&="*S0?CKXSO,Q#[]5NX*'\L_&Z1K5TJA3+?17MTY]
M)/;_|'IX@]H8;T@6,|U$@YI'5\;\9%8P.(B"]ON0))8~=R'BE,1K.N+W@V~G
M6Z/7UC;/|P2_^W)=~_Y4R+YDm./1H9F6\H3THL.U%I05S`P+\)`,T_AO8:U:
M.P$4[5F]4?|P'\RV"P!FmKS'7~Z+m,T*9F!R(("U()"Y$NI%XJ,8~!*7D;0F
M`(,PH?@OY*K1J%`].2=?.CN6128.V;\T*B7NV`=3H'J;=B:4;Y:\?Y7S]Q_.
M#Z)Q.I\|7%P0m~YV:Q4?||%Y`WIBZ4//^|Y72XBE&5\C66P#7LH6@1SAY(??
MmI^_08PX^5\4(4[^%\6'~^2',G/267;./m70M~=6+?G&JMD6GI]W1/=P|9Dm
M_.RNT`W.~@FMW,Q`81E'"R_;/3L.$\\3J`E/H#B8`9##P(8S||^UZ$3J_U!2
M`ED=:&#5G``O9'Q)Y:5,SZR2U3)3Y^==_9&X%M8ULQ\^HF'#~#B,X~U62PK!
M58!U`3$0XCU?5UZ9JZ"=@HP:2\PQU'CB!)^PFLKF]!!W#|\@86&91%UI#&J*
M0R:=\AHJP4N_(E*,M8#*#IZ=8`|N93)O/=`H%_Tm]:+%9))W8O&DmFJX5GHM
M!G8]$Q:EP2UG[MG8[REEP).HI"4@FXSI#Z^F$U@!#|28D\D.Q10N9GmB*C@L
MXB@|&@LY8/(~A__PP`3%BHZQ^M!W=`IJE=;N7:415BKU0_F^T&]&M|8S!Y.]
M~4*U|X1*;2BN+15X/3_JA(^A6=%?].DQ/?61]H;(1mZA"\7EV4"3Y^_;%[M5
M;K?!9~JN@&F?7^4O94R^T)L6!F0U/S,[77JV6"%I!CSQ^Q|_GKX*[UQ5E2;U
M?O$;/=2_L)~,H+ZMIU_@Ym38#V|=W'@F9,1'"&$F&9%mP?91N*X'4N%QB+@7
M*G%?+\+C8)L)H5)!MNMQ3,BRG_H[:YYW4*,B$6E(R_4L(6Z7DV~XC',1.Vm[
M0!AH(%!?F730IOO3&264(NIH6F7Z+$X!N/RHZM]=%NHZK[34&BVXF/664GPP
M~|mW1NC.9^.[RZ*8'K3;U]?7K7X~M[++)&OFm."X%0_F[7^,YLC7T):7VXB~
MM;&#3/m43T_=96P'O3V%Z"4DR8LY_EK09AP~3:`OY,Y2PBH#/SD~G`F*7$')
M;R7[S4A2[;TF(AX(M$1$|PX!8&9,m#6@#%$C^Y?%9'QQ46?Q1Z32~]C1,[%_
MK:ZZQ/M@*U=K),JP+8D1TQK;+;30Jm9~O?[UQ?|?7IV^.GE9KZ\',`,9I@D4
MT#6\!M0U05O[X?3'LP\OWIS50]=M@5PSW_XIT+63|0R3RAR@5I:`SR90G.UR
M3R2QB"#7S4T:6MW="IBCV!m&^C?)*|61SD\G4C!V2m~`MQCC;B^^9!^"C!@B
MB10%LT`'93(M3+@LNP!"^.,+C2$A.4D6+EI|3Z9.EZ[AA=HN%9O2V:(4\|4B
M65QFU\0DS$!.m$QUQT(F(2!*(54DLY~)4P9"!J+m+'mF,_|XGPIIQSB#,#I5
M?AFSK\mK"7IV)|%9I%?)+$LUN(OJ&F3B^3^)+=0SO##GJ0&AE&/G@UB+*LNF
M[MJ$ES*YQ=*V^D,&(^R:V+:[&]ZRU$`3'W[7Z.=Y,TD;5?:?%=Q,A9/(FXT?
MX8&~3+X#,H"N%F9L/N*4B0SXQ+M:YB'H_O0LA^N~6ZXTSHO.XW5AD|BN43P5
M:`.Z=[HD^\TGY1~/'W='/ST;7"%\KOP+%JVYU_T)A_7N",D(T^,%@JBH(M4V
M"D@$H'YQI95!)DYTJQLD";Z2U[7U"@WM\:_:%CM')Hm.Q9;Q2E~.^1;VZC^+
M"WJ1V]C~U(@9T)Z4.,GS.[32W5K7A/3XH*NU+C"X;~;B=%6"Y8BL0.MLN8T|
MWE5K3L:2R^[L3(),51$m7Z68#HD[4\?'=|N&^']$^=^$7ND@W'L\+0[m(\:,
MT6|(|GN1#LPVO(~7^.IN=0*.|UD"N..|PBZ=[_G^DPOIOS.`m\_"?J@HB0??
M(=\T?UR$S=/P:m4Z51*|VW0$6Y=CL7[=,7;NHL5JCY4)@JK%]5=`F0ZVNO4A
M_VEW]X81_EO_ZA9)?%LD^ZW[#:@S31@OJ6'[^|#$7!^V5]^9'JJ`~7C(`3'E
M)*UUSXJ99K2!|.!Q77L5559&4J6"FE'C,%S3C4KP38@mNA,~AY/;WL@DL18#
MZW*R;B_/MEN!Y638KI)U`8[XXU:UR32M"3(G^9?Y!^)T\L7F12:Q~TN79TM7
M)Z$59FQ&~O('_m=.O*G|K|N\K4Z/OK]^:O`R9ZB^)^O)IJA4P3FR`:C\=3O\
MP8I]2~X3:):X5\)1%PS/XMU*QCQW9^C=(+F2F[!3|?2#Z)PKT:8BQTA5121]
MJ3)/K_$;*BR'ZMm'\7N!FU":"8DIHA''YO^,m!Y`WC!Y/%AMSR,_6,G2(2DB
M&/9%]m.J:EY*~\'R1=K+IS8^GK$D)MD`OW?]+Q[4A#ZY6REO4Q6&G;TG&CWL
MD":5|^5$K&#QP'A|%@:9$?AIT'0@$1@K`#)BKFL~VVSX?G;~S,JFI&A^HZ)T
ME)|X\'J#%H*m*~IARA37Y4T)"C:MJmNS.E()DRRIDC6#7R.|SR53M^CJ1#P0
M_S%^/0H0[(m546ZFQ&IZ*|'GPmDCYB|"GHA!!9^GYBIC',Q!H&B1DJ20&C.W
MK==``B%PG:75\[?=['YY/TJQY|F5S7=/'HHI3.4%41A.V|#IW6m)8%&Q:,/X
M@02,!V$.W_UN:Y?A?3|!#Pm+%0!5'AX#~@'8KLY'3Q,NOAXL'1L.L(5,R'!7
MZM8772@?]UKQm&|/)~KP1XPDL758mR?KZ"2OLA|E51!NAS`Q&mTZ/:U\!"SR
MBYN$37#$+A,/"3&C&~/Y|V5XO:WO%&5Y0?LOD0S(@)URVSR@|AU6?S(#7*VR
MK#/CS!*S@'B+:5CQGE3"Q\'D$^IN3J4(J.8m&A:].P\5F,!P`\&`26JB.P56
M@'!,HX9[54'OM:LW%:[@D%GU`,\ZE8_3Z\''2M`?2mT"SWO+P,TX;A_.WKP\
M?~|KJ!T?WF%:G#~~&)!=_Z~4F'8@U0I8\HO7/_#M:EC^)?Z?49mAU9FGQI'B
MR0V,]:mHmH!C8*"T)JSN:2WA\;?[03"YHL%.:99EB&6[Q.?/X8&;+!$EU3:B
M#mFmLF'$m@AN,43Q#[RG;^7~Y)O3/$OE&5^(H:3J$1M%R1%$C[CJ&|1PC[(`
M`):30\N@589'W(ECMT(2(LDPUE!;)~P([@%NY$(%U3V!IJX~'MO72]C+7WP5
MME$!\P@S8H43X_V+DEI(LH#GX1]^AYU]=mQT&]RORWAW!L)C'#UJmBM!5m#N
M6CUZ]GK'V:V)IK.^VmXU1BW=Um:ID#8GURK(`7_XW~^(=^(BVZW=1:N(9JW1
MWR40FS[3!3D,FV5'KBKMP,_AZ._)5)DH|QO0:KB:*EH5E;'@W?OX,J,%/F[N
MA#N?_S'9T0$VF\|5|S/*/."~FD]70OB]=$Y0RENT47,U0DWm]OmX$$C~HBS,
M`9W#`00|V|`0`]9@@mC!_+[,4`_|BIV`07,!"5$|+J7IT;~F7DT94V1mU7+V
M[OGI*TW7LKY!:+B=4~W0Y&#Y|AN|$,@~CDY813*:\[T+))&IW%8.U_A=E9KD
M_"U_?'_$%.*/TD6Q;/.FY`PL]HGZm5O'?]X+WPE71JQORW+N%7|^D(?`.*(;
M)!AAmDS,!C$5V@ST^CH4HU77EK6`_6Y$2HF~H?Mm@*~R&0~+F`=`W/@$?20M
MW|%R%?0)6[6[@WW:_8@/_`UGEK]\=O4T,WYD;G':]?BZ7"mM|GTDFOCR$+`?
MLZFFE.(S4,OC6+W]H=H"ULZ8V:M+Y(/+C+=3O15Zm9OT+0CIHJW=T/1~5ETG
M9C7#RRUYERML,Fm!PZK%.\'J;26PUR\DB;M9\XO=;VIH+*&^V;@I~37*Q9U?
MOmWH1?$NDTP)B?HJ^5WAV!P;|L+*|+8`LJZ`HRO8)016/?CXS"1Z6O2?(*]T
M%/J|JY5mUB8)FOAF!#(0GW_FIL6HES8D+8T)4EL*$[+Q)]03L;.MZ/V=*Y%B
M+QFm'I:8#6\GV?36'#J,")K78D";7"X44?3#L2:]79T5(P|,#C3m"\~*(R|4
MZFI4CF1/DO!+V\/0&_I%J0TGAH+NR:F~:MW!=_5:%Q[RBWK;RUM5JXKR*FN$
M\HE$H#J1E%IUCY[LUZE^%L1M3~?F!42#5F=9)H_O[mL+|!2FD+Z.,[ZVAHXM
MZ2QJZROM~'6J%L08NS2'U|KQ,T|G$"|TFJ##KZ.PF&5+7A]?T&#HZ5,[$,ZS
MMFU[^Y65Y],4_*m517:=+O(A%!RV,6Q\5'53:Z,Z7N3VR.0LQ"mBE~1?;_9O
M+BK01)F,4)*$S.\CZ[H1?7\/VK~(HAR/Q+%Z@8&|7.,R![6B(,CHJ;)42"(D
M30I)F\A04*I%9~!Y5Q+I(=8W+*X3X+!I:!(;^9,K2)K,%[L@T^0F0,KJW`_5
M%]+%\KD]9m9%1'0%Z*.?^$@L~@&3(|&3U3~!YO20~_9H0D2~M1&TQL`[\&]|
M[Z(]TK08M]m8mT.;3GBW0K~`=RO?2UI|9~TV7Q]';|FJH2]+OCV[\@+M,Y`5
M+2[7H*TF*71/UXQmJ'/C!4M^|?A;1F\E'A]ZV0C@H5AW~0^+:RKR\PE$NII!
M`5JAB.6|$C//)(85Z?R^~#YLTR)N*1+")!DTBVAT2$/_:P:CHV$~^9[`240|
MI9+4MISmJLT"RMG5`DY;U^J$RN%9ONW^WOS,AmQ/5X?*^~;G^XDGY;JMEQ4;
MK7@[X@RAI/8IWZY)KU3Y=OZ^|K%;.:Z3B'!TL5M7(TIW;QM)J+~IXXL'T)(M
M@\#IQ9)Q[X)\N]1:W)]mFH__^_'CRG&Y06IN~_2@EDX5:,/HA?SPm|T\0OPE
M%OO`.7F.@|2'%!=!WOYVZ^:'[Q_O';:'"3M3R?=]^CX&6;/O7)(|S'H_+O+X
M\;/'A^WNMWAR6"HWUTP@[(4N#?S7_MY_'K;![6D+].`/A^V/[8|mT2#N6E=:
M*":I8KAWM@^77;6|*\#Y^7C_\N)BX5`4'&0,.#$#XFQ]'_0%95T,Y74"5&!#
M)m@T:~%C/%T=`Y)H%MHXY6P'@N$,TZH+C;1~U;YMWAGF%~F?J$B22MKQ5.%7
MU'8.$AR8\mE&*7D',Y@2A\RN3,8#`?,B)F91M"L'!FXK|+U`%RZm=P#C]~DL
ML`L"TW*(MS0ZCMDT0=Z"$1B4?@,MM9@&"@T]$1K%FDHDY;%900L/PS.PU/`W
M:2*m&E*&8O21\NVANDC6U/B6L[6&,S4*'65C|Z"Q\RO'.]:`|73T7mU/DCYD
MX*:HTDOKm9UI^LTLI::_V/+^BKV.+4$R\TV~^~801KSJ7MA\@:J~G[[U##DV
M*6DYAY1W#1T?B\;)M?GD06U6278:_::6UIO|'+F*U#U|8+#P"(;&|#[5|LL8
MX0*YRK1~CL]0H!PV&m~&(9O_80U;&41)E02KT_%141SSI_*BMP]O#JOY=G7[
M"'T[WC[|~S3=D5WP=;NIG8V/=ZS]ZR&3:&+3MM\?M|?),76!_N:/VPC2'2?G
M[X\O=H_;_!B=:Q_21|2_2V?E\WIGQ!6_]*MHQB~m_7/~O/KQH.,[`#7";:A&
M&^K`4Z^O]?HA.NL=U@.:"SFL?KXYDWKm|PQ*KXU?$+4+OR#/*~C?[!%$8S)L
MWI)?E;4'1=:S2W/"&0|O$#~]U33JQ_/RLBHR!]'@KZZ`@/A+;ZYUB*YL^=&,
MRTLI!]B&Y^Q7BDmE^+.K:#0'C^_YHH&`OWG^PV:RJW/\_T2.2"CAC6I`01PD
MQZ|FCVR&R2CEG%1#B~UQ=J"BE.UQ0V['H$:m\#UGL3IIB]*5+2MIm,P\?`@/
MP5HMWN']&CM|DJ+M7='=!;]!%Q~H\DTT;Z'HW)85;JM:ZYV`))D@/,+(CH.2
M,*6"6#;K5HPC.3VU:2'Y@)GDD#0]C1)m(\$*XM0FH0N_L8+^mWJEK'5(@:?*
MLE~*1["5A&^9194LDF%O)m/,*CFI?313$|F#3A&]%~+1C&?)PQQ61EZS?%~Q
M4HZ$9+KXN|[~..M_$OV4%K5N,\[EV3P*6UC+MO~#\YAH[1[~[^$RM9^VA!X(
MXHYCNU($D8S]4:(%:?+;,(+_CK@4H*G5~A=VJ#B$(F6QFX`9U_MN"[Y`[Z7*
MD'mITZCH:8NQ5W?T`A?=Q('|UEN,L`~W_9K(IXRR2&?&9`@6+$MVOHP][YR*
Mm#).PCM:1UKQVP.9Z\m%Q2O5W@WCA,4!R0?m;;K$'MH%G#W/#X*;m;W#[CD(
M=]M+M4KS=R7/K_UX|KBP1~]A=HZ.D.L&E];Y^7()]AB%3I/G5BmO5MB8ASGW
Mm!DHU[`\FQR%/'\CT\ZX&8^+O,7N14=A^~EZ?LG;?/^2`[CA"(:[:PYA,@J^
MV5"Z6Q~'I~[~5JGP42\;W,JQ[%0$C82X.EW4L+NWSE|I7+2GP3=%=`A@7?!4
M(KV3[/Y.VF_M'G?K,#@~"Y:)5m?J[G.5]#JWS#H!;1FPO#10,)0(TIQ:=RKF
M"mU1Z5FLZ@~?%+M3I8Z(~"J2(4UmD?$1I@YBPR[O:REVP.!]M/[C9`#D,YPN
M+KX5ZJ&3&@2JM.0Z9,.6M&JI5B858S]0|H3CNE2;`LW1E3E(Q`VF%Wm*&EN]
MU@FJ2;LVM|~09J3()@?A8ZF5[8\|YL,_LWV:Q|[`)R%W#_/~m,^*;(H&PBDD
M\G1$OTYON+7\;_,X_GNLRC*3~#XH4ZL&1(F[I:K6]W[B\K]P;A|6I\?QB',3
M|1I,(F$"+3[@A&EQJ:THO,mQ:H(_$($34Y[&JmR;OF'Z@)*L$#5?C%H4::;]
M9,RO.,8J*425[&'9.?O2~IV+,AG\FN1P05G/5|=F_$46',NWV+182KFI%|Em
MPC@4G&)+9H_!HW(V$:XD'NA)I+C$[Xm:1FD?J=[V'IOTS,B!@W0?@K!@L=U1
M*J=B)H],3_m$~5O8]RX!9Z\XSH&%1RML.N/$XL@QF~Q!W9Y;X"~DAGUZ(YE4
MF6MEBmO`~`#H_$DH#8V"Y\EDD67D.XQBDmS(ZQ"6?,4]5Qm$J7&^%[!mB"I8
MmYO`S)\~JDBH"G130PZ20F@U`*H1C,\QPJMS+7C$_OP4!DO31C~Q=8'DIHR~
MD|1O@*2IG?!Y9I,5Q^/$P"18V`D/=\/T&SDO~&RR;)~2@|[@|IDmI?J$4=8(
MX3'A\LI:@$A@R3$`FQ.L4").!\MV6MK~&E,X88@PEU:@B$:m0#2'?0$:U8P7
MBG9GHAJ@'+7'`]EU8.,D+KK!/P6~E4Gm#DS]/=PW0$%:3`:+I4(%K,VFP~?+
MN#'Z.D\6;P7Fm6+T9m\#IQ64Q|(:PTJmT\Y'#KZ&!]U[XmV+%Y5QV2V%D/=I
M49J#`^)(]ORP[(\0"/1+=9RZ//9A*+Y=E1~O?ZCX?L"L4@BV~;Y]8#L1S50C
M~M3VOFTN+;M`"_.7XQ678_8~8R77?,;'!%5m7:ZDT'GT5&NU|?K=7KWNAE'G
M$.Om`8(P+JV5NRK0=3@E2:NMFA/?^:CB2VFA'/X2IV=^WC$Y&:R6"6~$R9O!
MZ3P^KNS8\O)+LYQ!9TE]+^H&'Y#(%:6E~Z"7F#J8V9MD(Q['QFYW@O;[IZG(
M5)~'`(2@*07_K8]_.NQ%"_TN,\2^7BJ#'?2TU^FAE66T&)UQH$K(TQY_XGIN
M2*"!'?@P6%.CUJ~UK:L+m=&[8"*];;=]Y'_Q?M8MK+^;;]PVKH7VHZE15UD+
MKLLD+#&*%HZ8+V,70VWRB~TSB(\0*`#&FKPY%IH?V#HF1+HK9TFPB6Q="WU0
MP"D968CQQ0+=+!:,YR_^,AP1AVMmDI|6mP5#WK+93K1E#B$H,)YL$BAFX*+5
MYmV?PPU6;&#68@.`;.5Z'5XmJ\]6'HNMULOQ)~%PAE,I!9MC@M^~Gm&]|GMm
M9R]P:mJ:5,@B/_26D9|FSC.FY`C94&S]6TF*@""F.?(/,J*0?462~%EB+OY%
ML,__MF3A=[JX6*,;mH?I@[M9=`T2@[``EH&A]Q$XTJ2PH8227`AYGS'+F$Em
M"FG6|FMO:U_3TM)"G6_M7=QM[2_4TENFX|C'IU&"NA=YB^^P2HYS*[YC^/#U
M[=//)CX'F^~N$3[K4'=H8W6H9_SI1#^U!1:FTXDX/*\1?M=AR;`1UCJM5EUO
MATE$K$=HQA'NAT=1~$ECZ%2VMK:J~Y7CK?VC=G1|*CV?C|,]KR`7J^YYY4IW
M#I#.=\mG=_I;G%Z)B@C@OI*?0C[I[ZKJ+"4=#._N[LH_E_)2AIWRCT"#|@V:
MAZ6%#Y=^A7JX_""C"_599ZF8;+WEEQ'3DD4#LR'Sm;\+^Hm%0#V_.U\~D9?V
M~76X)LmWZ9')R~T]['UB__%A)(%!I5_Z)``7R!!=_J&Q5$Z2B*XN(PA.CWC!
MSYM^C/)^DA1T;N/P'_~6Z2|S.M?A^W6%\F2R^6V'?mM=5V3U9QD3[;A0,0=+
M^UBPF/=8|ZM?MF!6;!XO[1SC74W+1K]T01$%*E=P"Q"#GXG_A3.mD#"L"%X*
M7VZR#I;KIKK*#S1DB"G!&OIC,ZFSC)5,L)DDS;G05~(~3T4L@4E':B9B("=N
M*=`C/$HFHZU\UN]40EB`*L='O5G[.#SGQIWKQ:W+UDJR`TFMGQ2!*RFB,:WF
MW^/!|DOFA?`("I`M:)4Z^U3]\?E1NW=\%$^.B?^DO^G)!3]A3~\Qm^Qm!C#O
M^\53~VSN[D.`6LNH=@*;JPK+UJVN07@Z_~&LXX!Um9IA#.O*~&NW6V7UJGS=
M[E9W^:LH!OSm1+6CP/;![B)\'/*KL,APY(%?NK1C_YKU&mO#]YDWC(UXC%IP
M:^5167J)A|%)#'.C=_=!:)Wm%%;ZTF26AZRYGmU\U1]KE;GML)]!`9WJWOZ3
MWQG|#M%\Bm)B,*#=H.XICC%P66DP%N?5O)ICG?YBM08GEM&DC*X"(WJR5HL9
M`),2D9mRBY2*H5I~@;.[VS1%$9*;|,X?R^E)!NJTY)1A^Q68?C54C?ZP62JC
M:QEQ0B0|M71J2BT:5|1A*YMRS919_WLK|4!\(#`13QR+6;)WE!C5~$;J0?OH
M|N^XW:B"8=]RKYD+D0\N|EU`U:`L'2CC|?AM~(1_)"90@$@%S@ZZ;Y/7@2m+
M:%WG:1Xm71H)SOBE1ET_[P6D!*Y=|^&Q`$,2A`H01_Q+3\2*'O]F9(Q`##/~
M")Q_M=MG[UZ?D"1G]@=OB~_L9I#6~|FSH5GP8^E(U,4TO3/;]$1_/6K34^Y&
M/YP~IH~`WX/#0?M1K\^/!]IWFA))U,SN&9J`*9R/PU8K;,\E0T[(;\_'Y^'Q
MA;.*'=#.E'J[5!`UJP%MX;TD30YT$J;6.U,SN?!`[:UD]6Y+F49SIT|I'YL'
M9J?8~`*^L/VQ6/^*$U"J!X~`."~85$B0N&3M83^;,G+,GCL%D6Z#8(]%9O;0
MQ'G@A\=LULS;1VHL5H\2F`0ADD;'V]O\44MO?]MmZ?YB&W,W9|O*\78@AL,;
M69(S3FNW.0&V1&!8W;]TTB*(NDP.$\7ZQ.(),MZ(A5C^R;@WN(33QNW6TC7/
M]?8KYOm']C@56S=0?F)??E9+"MLAB"F9*|X8DPTN2Z_L"8%H'PV&J1PL=2\J
MN1;1CQ7VUK%N18$0@BU(S=17/U~U,P5*#J'*Y3BLF/&6C;mY6QN@(N8CK_!6
M^(NQD&A^&AVEL9.$M2,2EBZ/P^LGDS:;D]NG+\)+20F1|/8JV"DP^Y(W2K,M
MT'+!68QUV"RYD_22S6~TFP~P+#3]5YAXM8^2XV_'Q2'^[7Z[=;/_9/^_#]DV
MMOWMJ#@\:B?'V_K\F7P;Z7N847D3GU#FR~/'_W78mJ_"*G?4YM_JV_KS?Q]V
M&6@$](6H"R_$(R:K[%7%4[\=K"1UG\DMR^Z@$QH17|U1&BmBQW?U_MKm12PD
M32S=*I9]#"L&'`]M5A",GH|U5@9L0Y3SmA\TZO,B8[C?(m_NUH[XWF)W7+9%
M/I=D7!C['C.?(3.?~\QT=O=I&K?4K_\RF@W$|5Q`B&,#`"NF#=A5I[R@;&W1
M.'ED20+HT$`:;Y=:WQ:~5GA9^#B77mP~m#?V4ALD$2"\m|,*:\@0.&H3B24N
M,2(GC&*_?I\5*'mFZC0;8+WI#D'N"VK!;#60N(/6+NV!W][AW7R50P"*&RN:
MH/H57[%(\[N,,|WS`BJ_$M'M[J(S5~H*;m8S^E[E?]M?W;6_,,$4(P^=R2'=
MP|Q\JZEGY8`G14#GJ]ELMK^=#$B*I./XU6VR\#$O|DXI93*B7++RCA.RT#)Y
MH.R"T!QJOBL2_NERC6:WF)/~|?~\N]MEX0@&=\Y,0M_;O[%3$"45*S(=C(W_
MNLV'E:LA:K:4D0TS\O%CNVN|VM&1G2[[NG~mY_LHX#(?W8]M]H4W.679;(.0
MJE)\B#BJ3XP1T4F8)JQ&MY'9OU'!1APQ&1M3D)~$S2!\$O,@5C\,5G"=38QO
MPT!*PB8IV=I_,[NC6)@_H_]F#5S"56;3J|A]7(["8'ZQ!@X'\60C7B~~mS=G
M.DB9'`/ER'|5.[;_|.;%BCK97)U/2/JM~)22Q?26$=,_&S&]Y8GI'!VT!5PW
M3/0~?/AL+*~M'5X?*7O+IWPI4^G.8WEQF)J04%N:E5/Q+`#:I2MF0T=M)E3)
MSBK8X';\_%;1J5007;.%[KP"m,(~$&MM"\![Y61:H/|((@WL",!:,=.2#/TW
M).1&^B\5(E@1[\C|1GW:?7/6Q~*.+\VK;.mQ*@;#BL0NR\"288WJJ(?#HCmT
M||L2L).$1]1W"V+ZW7=B/0'~*+|/~m%P.]Q'+"178J2'86K*|H.P*1[E\^FQ
MT=)V*UO$;&'F*]W*L7P`H3UJHU3%0IV:/AU=SMK@;:WWI/|V[093`~^+Z#BL
M'(:!$U6XNWXOJ|X._JHFFH]NC&A&^HL~J"A#[SS"Um(,RUS7m3AMG.JDT6.M
M\W&=5Z%#$]+$)UGVP7PR+~\+SVX=,!HL~@QFO6(B7VD4QZC.!m5AU$~73XY_
M,%40E_\$H\5!$1AUm"7%V2HA`/L^.7|["+OFJ"/+QH.C?P%+^\CK"7N0GZB\
MHEH)+Y^~"`E&J^(E3_/=3=BE!!(03mT(QQX+0I`P""QYS*)KH6,YYZB41)&O
MI3FY(B_90&52!07|KLMW3!)5(D9[SY++P4&1@`DCL3)G"1M#DW:+XQ8P(_4P
MCVN#\NP/W85["_/2%JB7A^|]DH1!'9?_:&W~HQV@|G?3G7"G[6F"=RI5Y#ZJ
M[#!~)_0?_.,.U[E#WYW@GOm[K5T\;!\R0MC7)TmRIF[m|B0V:,'\?F10P+U~
M+ZC+BOR]#O=[[8QZ8.J;YG$#A+N=I(I,DH_C?M]D_%/([G9.3NZ9CP~AH+mV
M(MF4mD@M\:#I5(A.TX^O?@DE=~[X]BO3&=B@#YNZ`mH`F\O%Y4;)!:0DX8BZ
MI+B54`@QPL)AQB42Y'm;2#*:7ARP(8!D%Q..!V4_G&;@+M~0PN^2P~TFRm^"
M?FN)+PPMQ2ANI7&Q6`0:$,=Z"8X447RP~Z+5OEIm@Z95?\&X3RPQT(EmP~AQ
M*"VT+;O+BKG?():44AS/;M5)#L6A&"3&'R1K9C(B(D#|9W]9N4(W2=!6"V~1
M]=LFIFC['AN$1]%XK,V_A4W$TX2/~?=%N;@EmR=VR^T?\WJ,LQ&'@G*(R#Rm
M;Z;,HN@T!4mQ.$JNALW0E#|(4$O83"2GL[/4T:/GKT\0?W`|~/4QmU=^((87
M||L2YTK7^L15AUM~2?]1=!Q`P4%[|.D%m@&/.6*HDL\G)`3=5N`),TM(YHGm
M+]&X\)\*1%^X]U]TF6N`S0':4)_#L/+JUX#*3MA#0`+=X)Q$J_"C#:VWF;P8
M@37W@.B"4]C(?HY&2?_3?2C8;$J;|+$6'0LZ$|R"_TB22Z&QF.HO(:H[QO|P
M&KKPS:L?E;`I\(G`F&OXC%=)8+T0O1RO4)([_X_[\*I7Z0W'HR%Z+)[FP3~F
M7\T!K(1$5/9^][L;^G_8m&K^G1U$D34YD9.D'U*W]~K3Y5CCGR79PQD;X00)
M_1|?K*]!K(6$&I@47V*?ZK$DP&KG0IU9)3R,@1ICQO?6*%A!'@QK%E+9X=34
Mm3W$)W&3X.Q!B&.8PP?3!#?#9\)9QOXVI]4SOIR|@((Z`*?W^31A&$':JQ:&
ML*?8m9*MG0m&`@FTU6M*.4!m||J8`M8F*@``L8`3LB!`]QN3|.I1JQ02*`T*
M67HC~=E,B#::]RQVQJU=LZ6IOR);@[~0U)O%/$7V9#MGP&AR)Z]?_~F@@Z]K
M8A$%5D(2[mC2]0:5KF^(6Q3@N37O2mmK7C,@Y_)FM|9$*_Q%Z;JMP0O)UCPB
MASP+4$]8Sm*Z9OIQ^7[,;OPEYR3,P7;X/?S..m"#W82:|_Q"~S.'2^XRXB,Q
MIN.QYNJS\`W7&~SL\2B#Y?$`IAKH:C*Z2P#;D06:CLK4H9G'Y#Y66"%:G]N\
MB"?"`"_7($4"=3\R"~6@(]945P,;%KE4GS$!&+V'(+H&QBmmO63S8C97BZL)
MF!S+`~0V;,R_XGB:E%:C6%(I*U_/?N(]KW@B[K=V[KP^2N^64_|%7?#6CQ3[
M49:#WM9TH=MP8~@_"DIY^U[#]CN?Y|8C~6DH7MLF);N?X%FFBH%*8P7B(#[K
MKW&_*+_mLPP.PV48%R=A_L'8Q\U&;H2WV9RY+JRQ|?ICHEMJE,4*D^5.V;``
MSE:QNM695VG/+|(:JZCB830?%_6&_:V7I(M&8+YA`E#:_4YC\+Y![^Y]9=[,
M~QT11?K,E8$NQ?\.)%#O.P;1Y%[P1/J/%VO!_9=J"F7$/%^7\7A*AY4UO)*~
MCUBND:BD(D/"V'=&OmY9W0D?5NRUZSB961YG,(\%m"&WF~8YV6'.Z?W\4)N6
M[R`QC*\U(@%:(3]m!Z^'L8mI_DX^6BQm&V(0F'1!/$[LYL]=LXO8=/2YE$CH
M5(;MI4./G|mB((=D)_~|4=7+G~/#H!06P[H|FU7G\4~M4'4!HNW$44NM[[M/
MUEC?3\ND6~m%TI||Y1'L$V$RB*,mQY5(*.]H?I5%THm'W~ZN_=5)KLWBOV1H
MB/@]M@@=Y=)XZCTI3]\Y$5LD6&K$`&G.+R_N~&^mXX7_BG/5/)=\`=mH2A?Y
M3)/,[K5^GZ2mGOF6I!=WHSBC2V1VZU~S9CZ]mN#_4WTD7TX'U4T_O=74JUK`
M%5J"V%_^F4W#=X^ZXT%6YmV%]TLTI\MNMO8G`#S=F1;9L\Q\6:D?L\QM+m'3
MY\SJQFD?3C3@A$U4"WMK&?Tm(L29IYC$8I2HS?.YFATBOD""(IO6&QZ]?(=8
M%;;_21HKV;G63=IPW'"3]N;?NB0_8J*1%'|XLPOT3(ZIYm:|Y/%8?(Q?`ZQ+
MCE@P\,?B6|RE]PV!#~2$C\`^$)+2\Q#Pm`V7G]C*~|PQ;ZK~T,K4Q3|1],Hm
M;U[HPm)=,#.W2B/`S5"*V)%.RM4JP5SQIG/FSP|?HZ6U.Q$ZYZ4&BSRG9\Z[
M8FBA5\:Q)=0'Q~8Q|X|97:U5]H1[3T.OYKE.JJXX47Z$6'(0~UX*5A+"PG+W
MP$4ZNK:||Y7)%A.8Q4F(DQ/$(!L59QW"_?M!F'])AVI5MX'0.),PV=X!ASKW
MHDLRN@O@DPGTCHE,CV?43,`\.YO7K#DHFY8KE8`%ULAD1JZCG:H=1).MX"~B
ME%~Q7HER^[CmQ|mE:2[mPH\?K3V$JR~A"[;&1N#K)=@@J)H)+S[)Km*.KF"B
M86~_Y(+W&.C=LWE6;;8W8VK$.19/*"+)B7$I@5|I[Q`/A$_.@5@%:0!1X27#
MA0)/^&#S8F!#QH3[&4~]~.QW"4$#83+1*`m_\+8.84BY_U@[!7.SBABLK@PU
MFZGm4%YT:\=BAQQ~QB*U2U*+6Z.6\+2:+#:YJ4NVXCG)OVm\m$"$0:U'PO:G
M4"/V1%8V*7YD88PP7F\%RN]"01T/F\2#E1C~(/A5PHm]$R71&&P~:M5VL'0.
M'0DA81QI#8B(X%/XTCB_NMV0'PC'KXE=].;|R|U5L:P]L*083Q92:/'(\36A
MI_QC6]@E=#7:+`|QDE#`BH&_S9FYMKIV$R2B7*Z=(]1X`D4&#^&GLI/H@~0J
M5%4m5~]?6;Z;)L*EQ[~!+YZ48_Q226':YY0$|A7IE.:T7_BmIH|P%@AWZ+\O
MAF981_AM~K+DT8J,4U"1+[E3),2P^IZ2PCFR1^mGD&6#7R^X3NK#ZIRE9`W@
MY?@(.JIUI3784@_F4L(Y7BU.Z|Z~8JOWCU5?T$ZRGmK2&)J.S]m+AL^;,`WP
M.W~9STVJ:=':Em@_);HL?:G/2Jm\'Z@11PQ%;BF)SYF#6B%[Q*,5/LL$YKA?
M=':]DKA*5\N1m#KD``A^%`C712*`CIXNC'B64,/FAVXW,"\.DX=T1m;MOGZ4
M;GFSZ|27W_ID:@9M]F6&_KH)TYmT7+PUL!BT`[Z78#"MQB;]($&62%?3!~TF
MJ=R&["RAWL^EN\T&FC/@F`M(]KZS$[9~]DH$m7HA46Z'Z',K.!VRO`QL:J2$
MS:%_$|25CQ_%C|[J|4$|Y#`+5V9Cm.X6?N0J8R)#'\@GP*S,SH[OAA8G0!=(
M?;])Y\!BE2"Y3YZHNWEY()8FG4FJ5L\ZUF#.\M8W.[J&#DJ!W$IEH#4790Ym
M#U\VD:@M=L+1'$EES:VS6C5S&MR%Hm2%WJW%N=~|9N&Z3+`'9|7+(PD]Y+XU
MF=^6G_5:"O5W0YT72E@"=P,8;LV&9^NM[V7|Y~^H7'G2)1XZT.).NWH5T3GK
M&9AJ~_1Y07F0]VN3EC2H9BPL;9;9Z"^_()Y("E`NK&/,&*%*J9R@A)7D:$,_
MDAQZB43430'):.V3/YVUZ3XTVLS3Y[!~&;|4CZE5[SUIHW1UT|8,&(OM8&D*
MWI6D?.Q?!SULPRm=GE]I+!~,|H9|,/&L!ICK@.A;:5XEYZ5A6|+BIEB9SO4'
MI&0^/C"Zm[7@LO;E)+29~I=/"(MN*XXm|IJ6=[R~V`m[Q^C^m97[6]QUX9'|
M4FAG%CLUND$!U0WL~EQ&DR]9GSW(4WB;JN,NL2+~6H`M&L,TS0Lm_2(Qm6Y^
MC,K75\SHT6*2%BBC8@`?U*O9P3&|GR_G[89A&/mUR`U[EGR[+Y2(|T(IXET8
MPW2($\H6)PL8B:F@T5M:^m8L4@F^`B3/(KGR[=mD&B_Q3B0.)&m8F'B|`3/O
M?&WY`4XE#E?X~K2T!).Q3#P#(9YEQATN?L@17G[5W`(|/^G8,:?GLJ:"51+I
M,6+;X8MTL*%8H/Q821|7\43Z2A+K0.&G(P~?F\$XQ#=TmBP=Q/#.\N6;"+|J
MT,.U70BX"_:XPI$@UEO4.4P?"%Q*;!;"4F'K$RmH*.NN$[QG^Im~+Q[9Z`3+
MPIBE5E@2E~,#&;\O[DDD.Y:3W[6JTSP3GE.]B5Q&~/0)\9(1^P8:?8,9;#E5
MKP~U8$0+)TDXRFZ1"AT:)m@&'XW2`/J:DOYIM%&@=`R=Q$67L_^#4Q4K#VB%
M.8X(L2JFLF0Hm^~@S*]Y'1]P%N.W#MN||P#`D6N8P/+)Y=7[S*6D_X),(+^9
M;;!PAC9.AGR*.DTZ/O4=#[;1`@m9K32OR0?9!\~"LmL~V"A[9N&#$L,|;'~O
M&(3N;@\M;G|O855|~KI2SVHU](8#D]#9]T:WV01E+UOC92~"%BLQU""`EZWB
M]Wm#C,78:=:^X"~8^ZI9+U5]?Z^m#U&9!%J_5F8G9#/QUI8M;8/!Pm+#?!,/
M.']71JT,(3O2J?XIFR5_)T:/#J9]+"B~'J,m1W8O8J+/Nm@!*Y|&XIND.B:;
MC_S\'$`'K*[M7O8RH#&IL)`;RJE|@IYP83OMY6W.GF|(I_?^%,\D\L9U50/:
MQ+"$BQY0R6/$Y7A`7)+DTAU~|]Bm.S"N#;_'5^4~:SYW~:?47P%I91P#3QD:
MF$A325GH2?5R?\`8JU[~X/`Y[+Y$0,+P%3A4CO;@O18/DL(J,!V'",9=E|ST
M+R^Q26N]KEY:,L;+4RQ9U?!Km+L&(,A8537&^C@`Z|&_K&5\V4XYYSWD/TT]
M~|+.UO&U9~*0!DOW3705)6/K|'$"3"?6$RC@DP*]FZ&=mm7@T'~Z;[C,]3#=
MP,5K`&)~6]'HOA+:TUI6#H),Q)!X0!VY$1H9.":J`8"(~"IF9(^m,_ZL]`K[
MZ7'B#ZO$")8"]SBTA4^!+63|=2V4\`DmFG\3EHXJL~R~*?`3UXJ?98K$8;2P
M7!=.%^:?)0#0@7Y@~..|Q75:$'X'BR(%?&=+3?m~9F;A"!J|V&1UU@AD]$\Z
M'"'N9E#^/,\%DP!7JU&@&Dm,N_T/Z47W`[^P$+~&N9A1A)GBW"]%'H^'2%AE
MD|/$D]D`T9GI%%.SPG2AE^`A(HE:,S/B+:(~VU(5$;/KR14[~D1%Q*B^Mm7Z
M8X6K9YX^#]`$?|m[|&|N[RZK.|4,/GMSND2;G4?7F2I_H4:#36)).)[$@B3'
MJLN8_7MHPT6I[C)/9|P0?2MXY1|7&_7'Y^|G']Z\/GOWYNWKDQ=G9])GHC_)
Mm#;8L,1CZS%'6%9)X'%"DAmT[$YWTEXA(mV6"614`T94"PSN4%AS8'!@1!GA
M86`AK55+Q*];`A"PFYK5:^5U53?/8J*,*|WA~!Z'm9HL^61$/$X28B:X$~3&
M^W86"Y=D4~KZX*F+:]R~[ORHZ&=Q89)9X&$GT9:U2U?WF30WH[%`3S5$X6NB
M~?B4HTR8WTYZV9()|EDmL':m.R3*+RWG=YW/[!*]EW01]"RGLS~~SWH[%Q=|
M_.G%18F/D%WQCDG.BS^_~_OLP\D/+Y_]B(UA!N8mRYCS#/*`~.(HJE1^JmR[
M.7F,QXH%mHBXU%M3.5|`+UM^F7:H4U4.XMY\m&(`J'$TREMK^OCR^;^SDZ[V
MK^IEF|&WD;/ETVJ]0]2%*K2"_X!IGJ"J^KS68~`LKSVC1!2YA1AML?GPAK=8
M90J6J^DLD1;`ZHH"9,Y1F[4XA/$!U8Z)/]S*K[6D%;?`!4AXB]J6m?.N]6m2
MOY"%]%2Z:3JF6&B@M`MN29\3|0N2m7740;^@:V!PFKOOHSQ1][Z0G0P/%AO)
MVQI?2V"A@&7!4C|WZ"15"K3OKJO/$E~N#4%~]U86WEN9^F.:VM1W|O.+I^(9
MYEO'WmOJmJ9:$(5E\]^6=`\`"\MF0m!:~M\BN5E__Z6BJW654D=LKL|KYM?Q
MAHGR#^6WA5+;['"\WH~&@T*!R($Z!3I5RD%SW(KHS%05|SJTK&0TmF9!WKm.
M#\'A%K&YU=0IQ&'LJ*E37`(3ZR=I,A8961P&]/5+*VI.JS7#|TU,:5U;;HW'
M9E!R\5.G.AU'~EN:FR74&C\M.]OX`]/#2)#3U+5^8'NB`?VW]XR(NW1^_NS=
MNV|G/WU@JNM1VX8R)TM*E#*_HYQ88$FT=97C"Y+CZm~Q#,PM6`]^@#W'C&+K
MM27HK.8~7MU8XM"V=GM)MC"[QV+=H==(O6V7GM?mK=&F31BN;L*@M`Dm;\3R
ML)E9EMY4?O#6F=G:"?$AT/X&M#(S[%$)P1$'Y$AVD+HU&'1%JH2INVP#%DMQ
M\C!E"||\,]F]1HB0;|;:CU&77D|:SJ!3PUX?LL\"GQWUMI,_[~OR4]T[[^)#
MF]/9LV]\Q2R7C_I+Z%_64)4&F#OOY'MI)3U?7"&]_F`VI]SZVB'QMK(4Y?]L
MHR]MHW?PXI:)?^!LA]YLB_m09OP/1(Z&'S,H|3K0+_!U!KBY^&FK"&'+R6m%
M(^6J8[7*FS@]$V&&^6?Y#7$E&G9DKY9`91+EX^+^IWQUG#I5I?%J^@"VTYB!
MV:;AJ|7C+@^Om"*+B&;C"O6VF,TU'RK,@:,Y$((*YU,I5%!#NJAH*OKW6_9Q
M+_7]F;M5,0SMmQ=SZ\U@_7Y^0(G5";QKUW2P!.%F[M`P4G^;U6/)]YS;''9'
MV*NP.80W*%+5VUU&51T&OY&Z+#G`TYP8==/XUG,W\B]HHV=4T`KA[98T^m)N
MD@|P)?O#_,$,Z`2.^S)0.TAVYF=/m|\1LNSIKQ$(OYF:/CmLOL\*K%V`E51T
M=FP0KITKJ3~X==34["8[JTW9C'P`(CW:|K9T_W@1LR|^`5@6PCP1XJ1Y9M2(
MO!SW"1`G_A4B#T0%IWT^67%.XWT7()NSJCA]K8FHMN3L~4HVGY7#M`\&0F@"
MLWMR(P$2M\601,;_TEOm$E^^~E~=~,UH|)[/8=%|NMFS[=K]U.I[_M+6J|:^
M3!NFQQ+"!#8O.AJLU[`O9XN2^XA7J=)|_YYD?U%Q2N~]$[C|"QO[8U(T4$]L
MNE2WS3/UW`C,'1KW+Um9D(;X?/0=FD&*F`1F_#35Y]"M5.D^MQDI5K5(?*G*
M56\Q(&05J8F3\D(Q_5]9K76TW[OLC*#PD#OM+([7[PF.\5EWU8K+'G))CO,U
MG367U8,[_~6;JB'7mQ/.6%''U_0XD&%NOC0W]UP(UM?.|UD4H&ZIO[P7C?"@
M&;Z/C=S4YY=ZI,[/T4|J]S.?+=/Q9_;,B~~5+:;:(7$B4DmUUD/(0F[.E4B+
MN~~J:]^&8)99*VB/C9F"9!)m`50\@^LWG,Y3F[_6mVZI|EK"*JVUYOP|ESFM
MG]6+,#]N3VB\%,XG'C39=3Q8LH[Q%27~#=XM^26P"IXON?O*:N/`;,E)mI`X
M%BN$,FFKG9]7)\.+"]8NWTY+)`/33m+U53:&FS3]:X76$TYM*]P`|BT*76(+
MF$8&6B\')LFm0+RV/(]ZOQ=?K0[NJ'Y7\TK^_)|/)V_~=*JUDYmZ2'^S0A.?
M?!UO/6R^|&KA;I|_/6!JI:WN)5OD=^\~3XO%^7D83H:=RD|#$++6OM7MIMOY
M3MBM=&F&NY7P\_J*]`^CIJ"L#"9LX@V;:&3O8\7O~UFIO8D+^#ZC&9LQ8/Z]
M#,#:+)_,KH0]5X6m##`[2N)(3(9I7N=#$[BCT,Q;8?7BXOS\=%!%3B77Y)_4
M~?"LP.VAY_T9S5Y~""B^&"Sm=Om\#|7/D)&*A=~U?H#K~U`Q'~BFE7(?U!70
MM*UL.LM=ZN?Z+^H$HVO0,5L[$W;?E":~+7F|WE[GG`CQ.,MmFm2),3(~LJSC
MBYHV!&Em$[[I]|"[_&F=]+26C.4|~ZVQ=m$PU@:L,12L&?L`RLC7m~A,N0|`
M(A@.I:+R!E*74V'~&AKP8";]6F:EP1/![G(RA(:Q[)I5D8TC0;UE?M0QH|XH
M2@3'.1=R?[0Z:PFS=m.&TSJCMJ8J,49?%S/CA07226VWM5:Q^RI6U2;#[Z%|
M63#M|@*H0@+`2M;K/'2!9=H9Y|F$45NSL=[$LS&m%5X:_CH4F8%(TMM'UP*0
MZ3X+:m4Q.N^~"M8N312""+/H?DDW7;,7D3@ECB$mY=HXmQ^|(@K~_9L(UD]^
M\O1G.7PX`~Q['_'Z'\99~`X;]COC*7H@FOFF40`/[$ZWMF[FV6"FB~":=,B7
MK[UYPUIY$\*QOFXN.:Y:]mH!S1;2=S218Z2D\,`5S#13PY1R0Q[8S@Z^83G%
MI_|[2V+!P^KQ$KDO5\'29L`9~!#2J$'IEX!19,\"2:'G`[K81FPDD[".m%5~
M?KZE7U=,@|Z?M(10\?]O+G9F..]~/W^]"`+K%X#POFPVBE*DA@CQJ^P^T)/)
M+6M(H@F=!_7~.&7#!HWX.KJ%P_@LSL76CE,_2?+8Ym.P3"KFX)"#%9$2(`]/
M+4#D&#6`(,9H:9KEXEJ4&588:Z2^7`QKS!&;[#X':5*PmX%/|AN4NWT;$]/5
M*N/CO,*](_A(BTW~%Z*@[K*3X(&/]FHSmI4!@]2T(S)/'B28GS~9~!&(!YN"
M;~LV90VN]4($EDA\FVGT3][/V#$_8$Y6`YJIOI^SWm)I;UmC&H=)JK`@@NGD
MA9N)ML`T98YZ@7TYS`[H[H8'2:9#;4)V&O#MS%%"C*C,+S#JK\0V!:|(|O7G
M)%~O14[J)L(7Z[XX;!7J]`E|P*GK0!!R9=@Y|&*B+2[%E5@Q=K1"*Z3$~3^"
MSSS?Nm~:CU)F1!PF2]6~2M1WHB"P5W09O'G^@^R?TV`4:T0L3PTC#S2+K*FY
MWIB@|)9(IIH\[BB7(1"_Q,[S\*"4&|3Z7"$G%"OD9`'m3R;,F2_)L.8&*.[T
M@0GH8WB`7`[3H!0PRAVVH09Z[0$*S63?BmC1:9[7C=5!%+L(`&0U2RT:ZPX]
M536*|A@*#\[;*2KJ9E\0[~MEV:|#IRI$I2;:5E0YJDSD?mT\/)MY:R|/IMD4
MZE|F#RX4FFT|X11G2FVAP'TG`G4H\6?@QOYL491(YDK,%BLQB(/$*M8\4P,~
M9YQS&"Y_;|VZDV6#@$I~SB=`@ZWYAQ7MHS7$*C/SPPX_?@`TAUX$V90)42S[
M.+~3QmF0:*8.S'0):XL8:&T.|CJZ17.B|\:~FO1XAUmC(G$|~_O&=(DCQ&/F
M~\M+*[/XC"%VYB1SOZmQ$O_#)]X"=(EIW'3FD(,`~QR\C7T;\/KP(@\0_+=T
MU94`P[Y`#'M)CR:ZP3I_|5K7G&NTRO*;@TLP%@G!\P!+JR60O+.A^]E4L_DM
MKQ"SQ2!M|M)88#&V*UUSP^VTF`Q:L$IC+EN96I=|S[#;ZMRE/ODUEZ#/^,D"
MZ^U0.%LIJ1:YC%'4E/Y+H"734P&(S%&UC[1J77/8WB?:6=R!$%5E~]"1H8X)
MQ`O$*+[JA1"(~HL6:Q[S9MR\HJ_$~SSFVV;CNBHHF;GZC4\`Q(TDEDB8/E`0
M:R(SG(:CN?$4M:`%`I(BEG]T?|#;D*]GON=mHNm!9DY7I$?Bm!AD\YZ&6"?%
M7"QSU];V`D`KFY7V.C9`14+D8F8$ZX$!\!V.HT^WI9DVW"]M$'A+Q0Y*'4MI
MD3=Y~\'_$U//W1:%5CP;L6ME,9mJD3HWL~:?T@M1G^'&F1LE86K&#LZ_O#K]
MLP?O2=O7O`mXM8#!&KA'C'[E]6S5D'7*%Z)BF^[DG#GYXD+=Y'BS\=U$U~+=
M%5O/7S6LC/ED$%I1~&|B,$%^M.ND2D,#^#^mLRFKRD?HB%Q`XMJ4JE/|*@OM
M[\+3"8YL+%DUmVW"'T73*%YR:B07Z(FVJ,@.L*mH0RC2IWC,1^J^'W"7G]JP
MOM&81@Um+5`_#C8T~9I*L!)R%|\$%|8###$.M;B+U5#J+?93%0^%Y`N&X;+6
M;R5:)'S*HOC1,#T.F\?L*8P'])RSL1S=\&.S1OB:#'E#/&U*:\3&A4^Q"QY4
M])YH%#L!C`G3,(`=3]7@/!B$E9KQLJ]7!+UVH/m"#3%Z2N`AU%@H';8Z56HJ
M'+*^,[U~4X.!(+'@'XP*6~BVF_WG?UK/?59J*3V2PUS8Am_,R@3L6F5*6?5%
M#&HD*+PR$B]SJC4'PQ5T!)~&m_'L,IKF$H/J?*$9HHP=+GG])3F)D"J]*#1L
M*PM&Q&D|A([~J"?44mR0|248DB;7ML`AL4^(\3|mKET8LRA'm)0#H3$3/L7|
M#^V12#V?K#'=@m8$!I!']/Z1P`(B]'\M9OAJTG/O~DL$6I/#3_GDNXDQ1/!7
M!U..$\Q*0Y!6Z`CT@K:)[/06$mNP!31"^+/R9.I.&PD8#5/Q6~;II7A%'&|,
M\8BmHHI1H[VVB~399'!KUG,9*\C6&`C,3^[R(#A@!I#%2Z:I$J9@E@C`6V/~
MG@:#AB^VG&A7P~)&0_E,/[3"^UGN,M^^+'m:UBQI@._8^&2P*$;;+('LRL[B
ML67+]~J)X?S#IMUHSm$*1:R`G;D8C28]40DKD?PBV?J1RY6IL~/9E`[2/B,"
M&#X].OJNU6H]/3[N@$"I5S'KZFC)F6^79KEHTRMJ2/"FLAVOK'']7EOPD5|P
MUT`&=$M(QB#))|&;UB'I[.CWIZ7ZS~JSRDDJ#VLR`WP2ZO=1UWONG&|20*O[
M5*@A=IN8!XLL.!+2B~_'WQV!9G8_J&T=T3~L!~5CR#~7(~3L&K`\&X8XE?#)
MA$B7*%C@7F0)7'&%26J2@R;!_8E#FG$"DA0E~4^~,UR'IJ~4R"~F,\"1RIG~
M)~+#`!3HTE81)"@#:.6N)RC+I,=L\@0)8JU`&NN^@V$7D^@N%^G;=18XKE%O
M1$B:26[0RYD"T`]SU2S*A+;Y0FSY\RH.Q1I:!&0\39@6|6[WE'_!996'G|9*
M"\$76D@|#Z)BO9E2LX@2[B2$[[M6^)7OJ4F6;Z3FND8E3F;Y95JGSIK2YMR!
M+WK:].##9m)M^D;/DD1[PT`XK"mM9U:%Z]A/S^$;W"Y$0%IF\Q&,[37P^$9$
MN9P.L80]B(N~^40m4VJ$L;OS!:D."&ECT~_2O7LI|H7&4W+,A1SVB%6|/U.[
MTZD$32&%VmA|XJ@,?:!E1@.XRA2\FO=J3E,RBJ;8I&7F^O4@27V&0mm:!?Q|
M8GY+(J=9BV|ENQ`8R!,&Q,W2Y^PI2JO]|S;@S[C(H5HH.+DM'K6"5^H_:"$`
M5&$XAEE!,5@Y'I66$?H6=49*.12#IX4&VA~U;WZ5mB?S|9&(16~@4`!ERQ64
MIZIR5&G/X##2[|^7F%%J.57""ZAHV*!E6FBXUV@KDI#`."U7:~*EM&?*Q9O`
M~GR\\757!@)Z.!\;9R#6!27#P,P8NZ~5IG/&29DNU0C6"+DW+`Om4[5DL4;'
MN"H:E8XC/1+4[#QPZ4+DHU;B'#`=U$0O&2.;'OmGHLS,9B9Q,+2/O*m9L4@[
MOIDS1#S`?R`DLG);HMV9V:*M,9_~30=#:"`[=_ZP.L\/NC1Y]!L6?;'X;!!F
M'O3J7^C/SS\_?_[33S__?';6O+S|F4QVZHO/*P)@.3+^/_[/G__SY__\^3]_
0_L^??^+/_Q|(XO1;`#`"````
`
end
-->
</body>
</html>
